<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sdynpy.fem.sdynpy_exodus &mdash; SDynPy 0.6.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> SDynPy
          </a>
              <div class="version">
                0.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sdynpy_showcase.html">SDynPy Showcase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">SDynpy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modal_tutorials.html">Modal Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">SDynPy Programming Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SDynPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sdynpy.fem.sdynpy_exodus</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sdynpy.fem.sdynpy_exodus</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Import data from and save data to Exodus files.</span>

<span class="sd">Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,</span>
<span class="sd">LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S.</span>
<span class="sd">Government retains certain rights in this software.</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">SimpleNamespace</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">..core.sdynpy_geometry</span> <span class="kn">import</span> <span class="n">global_coord</span><span class="p">,</span> <span class="n">local_coord</span><span class="p">,</span> <span class="n">global_deflection</span><span class="p">,</span> <span class="n">_exodus_elem_type_map</span>

<span class="n">_inverse_exodus_elem_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">_exodus_elem_type_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.99&#39;</span>


<div class="viewcode-block" id="face_connectivity"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.face_connectivity.html#sdynpy.fem.sdynpy_exodus.face_connectivity">[docs]</a><span class="k">def</span> <span class="nf">face_connectivity</span><span class="p">(</span><span class="n">reduced_element_type</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">reduced_element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;tetra10&#39;</span> <span class="ow">and</span> <span class="n">keep_midside_nodes</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="s1">&#39;tri6&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])),)</span>
    <span class="k">elif</span> <span class="n">reduced_element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;tetra4&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">reduced_element_type</span> <span class="o">==</span> <span class="s1">&#39;tetra10&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">keep_midside_nodes</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="s1">&#39;tri3&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])),)</span>
    <span class="k">elif</span> <span class="n">reduced_element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hex20&#39;</span> <span class="ow">and</span> <span class="n">keep_midside_nodes</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="s1">&#39;quad8&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">]])),)</span>
    <span class="k">elif</span> <span class="n">reduced_element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hex8&#39;</span> <span class="ow">or</span> <span class="n">reduced_element_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hex&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">reduced_element_type</span> <span class="o">==</span> <span class="s1">&#39;hex20&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">keep_midside_nodes</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="s1">&#39;quad4&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),)</span></div>


<div class="viewcode-block" id="mesh_triangulation_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.mesh_triangulation_array.html#sdynpy.fem.sdynpy_exodus.mesh_triangulation_array">[docs]</a><span class="k">def</span> <span class="nf">mesh_triangulation_array</span><span class="p">(</span><span class="n">element_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;quad4&#39;</span><span class="p">:</span>
        <span class="n">triangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">element_type</span> <span class="o">==</span> <span class="s1">&#39;quad8&#39;</span><span class="p">:</span>
        <span class="n">triangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">triangles</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">triangles</span></div>


<div class="viewcode-block" id="ExodusError"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusError.html#sdynpy.fem.sdynpy_exodus.ExodusError">[docs]</a><span class="k">class</span> <span class="nc">ExodusError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Exodus"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus">[docs]</a><span class="k">class</span> <span class="nc">Exodus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Read or write exodus files.</span>

<span class="sd">    This class creates functionality to read or write exodus files using the</span>
<span class="sd">    netCDF4 python module.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The path string to the file that will be opened</span>
<span class="sd">    mode : str</span>
<span class="sd">        Mode with which the file is opened, &#39;r&#39; - Read, &#39;w&#39; - Write,</span>
<span class="sd">        &#39;a&#39; - Append.  Default is &#39;r&#39;.</span>
<span class="sd">    title : str</span>
<span class="sd">        Title of the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    num_dims : int</span>
<span class="sd">        Number of dimensions in the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    num_nodes : int</span>
<span class="sd">        Number of nodes in the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    num_elem : int</span>
<span class="sd">        Number of elements in the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    num_blocks : int</span>
<span class="sd">        Number of blocks in the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    num_node_sets : int</span>
<span class="sd">        Number of node sets in the exodus file, only required if mode = &#39;w&#39;.</span>
<span class="sd">    num_side_sets : int</span>
<span class="sd">        Number of side sets in the exodus file, only required if mode=&#39;w&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Exodus.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">num_blocks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_node_sets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_side_sets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">clobber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_character</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]:</span>
            <span class="c1"># Here we read in a file that already exists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Here we have to create one first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">,</span>
                                                <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF3_64BIT_OFFSET&#39;</span><span class="p">)</span>
            <span class="c1"># Assign attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="mf">5.22</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mf">5.22</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">floating_point_word_size</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">file_size</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">int64_status</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

            <span class="c1"># Assign Dimensions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;len_string&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;len_name&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;len_line&#39;</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;four&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_dims must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_dim&#39;</span><span class="p">,</span> <span class="n">num_dims</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_nodes must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_elem must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_elem&#39;</span><span class="p">,</span> <span class="n">num_elem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_blocks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_blocks must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_node_sets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_node_sets must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_node_sets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">,</span> <span class="n">num_node_sets</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_side_sets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_side_sets must be assigned for mode &#39;w&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_side_sets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">,</span> <span class="n">num_side_sets</span><span class="p">)</span>

            <span class="c1"># Create convenience variables</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">floating_point_word_size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span> <span class="o">=</span> <span class="s1">&#39;f8&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span> <span class="o">=</span> <span class="s1">&#39;f4&#39;</span>

            <span class="c1"># Initialize time</span>
            <span class="c1"># The time dimension is expandable in the Exodus format so we will</span>
            <span class="c1"># set the size of the dimension to none, which means unlimited.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time_step&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Initialize the time variable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time_whole&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span>
                                             <span class="p">(</span><span class="s1">&#39;time_step&#39;</span><span class="p">,))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the title of the exodus file&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">title</span>

<div class="viewcode-block" id="Exodus.get_qa_records"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_qa_records">[docs]</a>    <span class="k">def</span> <span class="nf">get_qa_records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the quality assurance records in the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qa_records : tuple</span>
<span class="sd">            Returns a nested tuple of strings where the first index is the</span>
<span class="sd">            record number, and the second is the line in the record.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;qa_records&#39;</span><span class="p">][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;QA Records are not yet defined!&#39;</span><span class="p">)</span>
        <span class="n">qa_records</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qa_records</span></div>

<div class="viewcode-block" id="Exodus.put_qa_records"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_qa_records">[docs]</a>    <span class="k">def</span> <span class="nf">put_qa_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the quality assurance records in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qa_records : sequence of sequence of strings</span>
<span class="sd">            A nested sequence (list/tuple/etc.) containing the quality assurance</span>
<span class="sd">            records.</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Each index in qa_records should consist of a length-4 tuple of strings:</span>

<span class="sd">        1. Analysis Code Name</span>
<span class="sd">        2. Analysis Code Version</span>
<span class="sd">        3. Analysis Date</span>
<span class="sd">        4. Analysis Time</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;num_qa_rec&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;QA Records have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_qa_rec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="n">len_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_string&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_qa_rec</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">len_string</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;QA Records can only have 4 entries per record!&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_string</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting QA records, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1"> entry </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_string</span><span class="p">]</span>
                <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
                <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_qa_rec&#39;</span><span class="p">,</span> <span class="n">num_qa_rec</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;qa_records&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_qa_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">,</span> <span class="s1">&#39;len_string&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;qa_records&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="Exodus.get_info_records"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_info_records">[docs]</a>    <span class="k">def</span> <span class="nf">get_info_records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the information records in the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        info_records : tuple</span>
<span class="sd">            Returns a tuple of strings where the index is the</span>
<span class="sd">            record number.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;info_records&#39;</span><span class="p">][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Information Records are not yet defined!&#39;</span><span class="p">)</span>
        <span class="n">info_records</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info_records</span></div>

<div class="viewcode-block" id="Exodus.put_info_records"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_info_records">[docs]</a>    <span class="k">def</span> <span class="nf">put_info_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the information records in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        info_records : sequence of strings</span>
<span class="sd">            A sequence (list/tuple/etc.) containing the information records.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;num_info&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Information Records have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_info</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="n">len_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_info</span><span class="p">,</span> <span class="n">len_line</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_line</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting info records, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_line</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_info&#39;</span><span class="p">,</span> <span class="n">num_info</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;info_records&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_info&#39;</span><span class="p">,</span> <span class="s1">&#39;len_line&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;info_records&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_times"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_times">[docs]</a>    <span class="k">def</span> <span class="nf">get_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the time values from the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time_array : np.masked_array</span>
<span class="sd">            A masked_array containing the time values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time_whole&#39;</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span></div>

<div class="viewcode-block" id="Exodus.set_time"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_time">[docs]</a>    <span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the time value of a given step in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        step : int</span>
<span class="sd">            The index in the time vector to set to value</span>
<span class="sd">        value : float</span>
<span class="sd">            A real number to set the value of the specified index in the time</span>
<span class="sd">            vector to.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time_whole&#39;</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Exodus.set_times"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_times">[docs]</a>    <span class="k">def</span> <span class="nf">set_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the time vector for the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : array-like</span>
<span class="sd">            A 1-dimensional array that has the time step values as it&#39;s entries</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If the vector is longer than the current time step vector, it will be</span>
<span class="sd">        expanded.  If the vector is shorter than the current time step vector,</span>
<span class="sd">        only the first len(values) entries of the time vector will be assigned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time_whole&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">values</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_dim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">     _   _           _           </span>
<span class="sd">    | \ | | ___   __| | ___  ___ </span>
<span class="sd">    |  \| |/ _ \ / _` |/ _ \/ __|</span>
<span class="sd">    | |\  | (_) | (_| |  __/\__ \</span>
<span class="sd">    |_| \_|\___/ \__,_|\___||___/</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_coord_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_coord_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_coord_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the coordinate names in the exodus file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coord_names : tuple</span>
<span class="sd">            Returns a tuple of strings containing the coordinate names in the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;coor_names&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Coordinate Names are not yet defined!&#39;</span><span class="p">)</span>
        <span class="n">coord_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">coord_names</span></div>

<div class="viewcode-block" id="Exodus.put_coord_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_coord_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_coord_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the coordinate names into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coord_names : sequence of strings</span>
<span class="sd">            A sequence (list/tuple/etc.) containing the coordinate names.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;coor_names&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Coordinate Names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_dimensions</span>  <span class="c1"># self._ncdf_handle.dimensions[&#39;num_dim&#39;].size</span>
        <span class="n">len_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_dim</span><span class="p">,</span> <span class="n">len_name</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coord_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting info records, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_name</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;coor_names&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_dim&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;coor_names&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="Exodus.get_coords"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_coords">[docs]</a>    <span class="k">def</span> <span class="nf">get_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the coordinates of the nodes in the exodus file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coords : np.array</span>
<span class="sd">            Returns a 2D array with size num_dims x num_nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO Add error checking</span>
        <span class="n">coord_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;coordx&#39;</span><span class="p">,</span> <span class="s1">&#39;coordy&#39;</span><span class="p">,</span> <span class="s1">&#39;coordz&#39;</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_dimensions</span><span class="p">]</span>
        <span class="n">raw_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">][:]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coord_names</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coords</span></div>

<div class="viewcode-block" id="Exodus.get_coord"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the coordinates of the specified node in the exodus file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The global node index (not node number) of the node of which the</span>
<span class="sd">            coordinates are desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coords : np.array</span>
<span class="sd">            Returns an array with size num_dims</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO Add Error Checking</span>
        <span class="n">coord_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;coordx&#39;</span><span class="p">,</span> <span class="s1">&#39;coordy&#39;</span><span class="p">,</span> <span class="s1">&#39;coordz&#39;</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_dimensions</span><span class="p">]</span>
        <span class="n">raw_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coord_names</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">raw_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coords</span></div>

<div class="viewcode-block" id="Exodus.put_coords"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_coords">[docs]</a>    <span class="k">def</span> <span class="nf">put_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the coordinate values into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : np.ndarray</span>
<span class="sd">            A 2d array containing coordinate values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">coord_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;coordx&#39;</span><span class="p">,</span> <span class="s1">&#39;coordy&#39;</span><span class="p">,</span> <span class="s1">&#39;coordz&#39;</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_dim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coord_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Coordinates have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;coords.shape should be (self.num_dimensions,self.num_nodes)&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coord_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="Exodus.get_node_num_map"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_num_map">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_num_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the list of local node IDs from the exodus file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        node_num_map : np.array</span>
<span class="sd">            Returns a 1D array with size num_nodes, denoting the node number</span>
<span class="sd">            for the node in each index</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If there is no node_num_map in the exodus file, this function simply</span>
<span class="sd">        returns an array from 1 to self.num_nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;node_num_map&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;node_num_map&#39;</span><span class="p">][:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.put_node_num_map"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_node_num_map">[docs]</a>    <span class="k">def</span> <span class="nf">put_node_num_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_num_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts a list of local node IDs into the exodus file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_num_map : np.array</span>
<span class="sd">            A 1D array with size num_nodes, denoting the node number</span>
<span class="sd">            for the node in each index</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;node_num_map&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;node_num_map has already been put to the exodus file.&#39;</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;node_num_map&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_nodes&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;node_num_map&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">node_num_map</span></div>

<div class="viewcode-block" id="Exodus.get_node_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets a tuple of nodal variable names from the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        node_var_names : tuple of strings</span>
<span class="sd">            Returns a tuple containing the names of the nodal variables in the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_nod_var&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node Variable Names are not defined!&#39;</span><span class="p">)</span>
        <span class="n">node_var_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_var_names</span></div>

<div class="viewcode-block" id="Exodus.put_node_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_node_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_node_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_var_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the specified variable names in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_var_names : tuple of strings</span>
<span class="sd">            A tuple containing the names of the nodal variables in the model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;name_nod_var&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Nodal Variable Names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_names</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_var_names</span><span class="p">)</span>
        <span class="n">string_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_names</span><span class="p">,</span> <span class="n">string_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_var_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">string_length</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting nodal variable names, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">string_length</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;vals_nod_var</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time_step&#39;</span><span class="p">,</span> <span class="s1">&#39;num_nodes&#39;</span><span class="p">))</span>
        <span class="c1"># Create the dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_nod_var&#39;</span><span class="p">,</span> <span class="n">num_names</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;name_nod_var&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_nod_var&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_nod_var&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_node_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_nod_var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Number of Node Variables is not defined!&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Exodus.get_node_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the node variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the nodal variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        node_variable_values : maskedarray</span>
<span class="sd">            A 1d array consisting of the variable values for each node at the</span>
<span class="sd">            specified time step.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_node_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_nod_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_nod_var</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Time Step&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][:]</span></div>

<div class="viewcode-block" id="Exodus.get_node_variable_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_variable_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets a node variable value for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the nodal variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        node_index : int</span>
<span class="sd">            Node index at which to recover the nodal variable</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        node_variable_value : float</span>
<span class="sd">            The variable values for the specified node at the specified time step.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_node_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_nod_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_nod_var</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Time Step&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">node_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][:,</span> <span class="n">node_index</span><span class="p">]</span></div>

<div class="viewcode-block" id="Exodus.set_node_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_node_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_node_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the node variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the nodal variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>
<span class="sd">        values : array-like</span>
<span class="sd">            A 1d array consisting of the variable values for each node at the</span>
<span class="sd">            specified time step.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_node_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_nod_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_nod_var</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Exodus.set_node_variable_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_node_variable_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_node_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the node variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the nodal variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        node_index : int</span>
<span class="sd">            Node index at which to recover the nodal variable</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>
<span class="sd">        value : float</span>
<span class="sd">            The variable value for the specified node at the specified time step.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_node_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_nod_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_nod_var</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_nod_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Exodus.get_displacements"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_displacements">[docs]</a>    <span class="k">def</span> <span class="nf">get_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement_name</span><span class="o">=</span><span class="s1">&#39;Disp&#39;</span><span class="p">,</span> <span class="n">capital_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_values</span><span class="p">(</span><span class="n">displacement_name</span> <span class="o">+</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">capital_coordinates</span> <span class="k">else</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                         <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="s1">&#39;xyz&#39;</span><span class="p">])</span></div>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;        </span>
<span class="sd">      _____ _                           _       </span>
<span class="sd">     | ____| | ___ _ __ ___   ___ _ __ | |_ ___ </span>
<span class="sd">     |  _| | |/ _ \ &#39;_ ` _ \ / _ \ &#39;_ \| __/ __|</span>
<span class="sd">     | |___| |  __/ | | | | |  __/ | | | |_\__ \</span>
<span class="sd">     |_____|_|\___|_| |_| |_|\___|_| |_|\__|___/</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_elem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_elem_num_map"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_num_map">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_num_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the list of local element IDs from the exodus file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_num_map : np.array</span>
<span class="sd">            Returns a 1D array with size num_elems, denoting the element number</span>
<span class="sd">            for the element in each index</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If there is no elem_num_map in the exodus file, this function simply</span>
<span class="sd">        returns an array from 1 to self.num_elems</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;elem_num_map&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;elem_num_map&#39;</span><span class="p">][:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elems</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.put_elem_num_map"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_elem_num_map">[docs]</a>    <span class="k">def</span> <span class="nf">put_elem_num_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_num_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts a list of local element IDs into the exodus file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elem_num_map : np.array</span>
<span class="sd">            A 1D array with size num_elems, denoting the element number</span>
<span class="sd">            for the element in each index</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;elem_num_map&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;elem_num_map has already been put to the exodus file.&#39;</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;elem_num_map&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_elem&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;elem_num_map&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">elem_num_map</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_blks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_elem_blk_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_blk_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_blk_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Gets a list of the element block ID numbers in the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        block_ids : tuple</span>
<span class="sd">            A tuple containing the block ID numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_prop1&#39;</span><span class="p">][:])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block IDs are not defined!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.put_elem_blk_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_elem_blk_ids">[docs]</a>    <span class="k">def</span> <span class="nf">put_elem_blk_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts a list of the element block ID numbers in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_ids : array-like</span>
<span class="sd">            A sequency of integers specifying the block id numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;eb_prop1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block IDs have already been put to the exodus file.&#39;</span><span class="p">)</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">block_ids</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Number of Block IDs Specified&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;eb_prop1&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_prop1&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">block_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_prop1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">)</span>
        <span class="c1"># Create block names too</span>
        <span class="n">block_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;block_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">block_ids</span><span class="p">]</span>
        <span class="n">num_blk</span><span class="p">,</span> <span class="n">len_name</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_blk</span><span class="p">,</span> <span class="n">len_name</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting block names, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_name</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;eb_names&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_names&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="c1"># Create eb_status as well</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;eb_status&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_status&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Exodus.get_elem_blk_info"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_blk_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_blk_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Gets the element block information for the specified element block ID</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Element Block ID number</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        element_type : str</span>
<span class="sd">            Name of the Element Type</span>
<span class="sd">        elements_in_block : int</span>
<span class="sd">            Number of elements in the block</span>
<span class="sd">        nodes_per_element : int</span>
<span class="sd">            Number of nodes per element in the block</span>
<span class="sd">        attributes_per_element : int</span>
<span class="sd">            Number of attributes per element</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_el_in_blk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_el_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
            <span class="n">num_nod_per_el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_nod_per_el</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;connect</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;elem_type&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;num_att_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="n">attr_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_att_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr_per_element</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Block </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">num_el_in_blk</span><span class="p">,</span> <span class="n">num_nod_per_el</span><span class="p">,</span> <span class="n">attr_per_element</span></div>

<div class="viewcode-block" id="Exodus.put_elem_blk_info"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_elem_blk_info">[docs]</a>    <span class="k">def</span> <span class="nf">put_elem_blk_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">,</span> <span class="n">num_nodes_per_element</span><span class="p">,</span> <span class="n">num_attrs_per_elem</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the element block information for an element block ID into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The block ID (not index) that the information is being specified for</span>
<span class="sd">        elem_type : str</span>
<span class="sd">            The element type (&#39;SHELL4&#39;,&#39;HEX8&#39;, etc.) in the block</span>
<span class="sd">        num_elements : int</span>
<span class="sd">            The number of elements in the block</span>
<span class="sd">        num_nodes_per_element : int</span>
<span class="sd">            The number of nodes per element in the block</span>
<span class="sd">        num_attrs_per_element : int</span>
<span class="sd">            The number of attributes per element in the block</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">num_el_in_blk_name</span> <span class="o">=</span> <span class="s1">&#39;num_el_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="n">num_nod_per_el_name</span> <span class="o">=</span> <span class="s1">&#39;num_nod_per_el</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_el_in_blk_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                <span class="s1">&#39;Information for block </span><span class="si">{:d}</span><span class="s1"> has already been put to the exodus file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="n">connect_name</span> <span class="o">=</span> <span class="s1">&#39;connect</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="c1"># Create the dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">num_el_in_blk_name</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">num_nod_per_el_name</span><span class="p">,</span> <span class="n">num_nodes_per_element</span><span class="p">)</span>
        <span class="c1"># Create the connectivity matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
            <span class="n">connect_name</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">num_el_in_blk_name</span><span class="p">,</span> <span class="n">num_nod_per_el_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">connect_name</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s1">&#39;elem_type&#39;</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">)</span>
        <span class="c1"># Create attributes if necessary</span>
        <span class="k">if</span> <span class="n">num_attrs_per_elem</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:Element attribute functionality has not been thoroughly checked out, use with caution.&#39;</span><span class="p">)</span>
            <span class="n">num_att_in_blk_name</span> <span class="o">=</span> <span class="s1">&#39;num_att_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
            <span class="n">attrib_name</span> <span class="o">=</span> <span class="s1">&#39;attrib</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">num_att_in_blk_name</span><span class="p">,</span> <span class="n">num_attrs_per_elem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
                <span class="n">attrib_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="n">num_el_in_blk_name</span><span class="p">,</span> <span class="n">num_att_in_blk_name</span><span class="p">))</span>
        <span class="c1"># Set the eb_status to 1 when it is defined (I&#39;m not sure this is</span>
        <span class="c1"># actually what it should be, just every exodus file I&#39;ve looked at has</span>
        <span class="c1"># the eb_status as all ones...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_status&#39;</span><span class="p">][</span><span class="n">block_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Exodus.get_elem_connectivity"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_connectivity">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the element connectivity matrix for a given block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The block id for which the element connectivity matrix is desired.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        connectivity : np.masked_array</span>
<span class="sd">            The 2d connectivity matrix for the block with dimensions num_elem x</span>
<span class="sd">            num_nodes_per_element.  The returned value is converted from the</span>
<span class="sd">            1-based Exodus indexing to 0-based Python/NumPy indexing.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">conn_name</span> <span class="o">=</span> <span class="s1">&#39;connect</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">conn_name</span><span class="p">][:]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block </span><span class="si">{:d}</span><span class="s1"> has not been defined yet&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.set_elem_connectivity"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_elem_connectivity">[docs]</a>    <span class="k">def</span> <span class="nf">set_elem_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the element connectivity matrix for a given block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int </span>
<span class="sd">            The block id for which the element connectivity is being assigned</span>
<span class="sd">        connectivity : 2D array-like</span>
<span class="sd">            A 2D array of dimension num_elements x num_nodes_per_element</span>
<span class="sd">            defining the element connectivity.  Note that the connectivity</span>
<span class="sd">            matrix should be 0-based (first node index is zero) per Python</span>
<span class="sd">            conventions.  It will be converted to one-based when it is written</span>
<span class="sd">            to the Exodus file.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">conn_name</span> <span class="o">=</span> <span class="s1">&#39;connect</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conn_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block </span><span class="si">{:d}</span><span class="s1"> has not been defined yet&#39;</span><span class="p">)</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">conn_name</span><span class="p">][:]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Shape of connectivity matrix should be </span><span class="si">{}</span><span class="s1"> (recieved </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">conn_name</span><span class="p">][:]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                                                                               <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">conn_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">connectivity</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Exodus.num_attr"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.num_attr">[docs]</a>    <span class="k">def</span> <span class="nf">num_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the number of attributes per element for an element block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : int </span>
<span class="sd">            The block id for which the number of attributes is desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr_per_element : int</span>
<span class="sd">            The number of attributes per element in a block</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;num_att_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">attr_per_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_att_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr_per_element</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">attr_per_element</span></div>

<div class="viewcode-block" id="Exodus.num_elems_in_blk"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.num_elems_in_blk">[docs]</a>    <span class="k">def</span> <span class="nf">num_elems_in_blk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the number of elements in an element block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : int </span>
<span class="sd">            The block id for which the number of attributes is desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_per_element : int</span>
<span class="sd">            The number of elements in the block</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_el_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Block </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.num_nodes_per_elem"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.num_nodes_per_elem">[docs]</a>    <span class="k">def</span> <span class="nf">num_nodes_per_elem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the number of nodes per element in an element block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : int </span>
<span class="sd">            The block id for which the number of attributes is desired</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nodes_per_elem : int</span>
<span class="sd">            The number of nodes per element in the block</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_nod_per_el</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Block </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.get_elem_attr"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_attr">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the element attributes for a given block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The block id for which the element connectivity matrix is desired.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attributes : np.masked_array</span>
<span class="sd">            The 2d attribute matrix for the block with dimensions num_elem x</span>
<span class="sd">            num_attributes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;attrib</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No attributes defined for Block </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.set_elem_attr"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_elem_attr">[docs]</a>    <span class="k">def</span> <span class="nf">set_elem_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the element attributes for a given block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The block id for which the element connectivity matrix is desired.</span>
<span class="sd">        attributes : 2D array-like</span>
<span class="sd">            The 2d attribute matrix for the block with dimensions num_elem x</span>
<span class="sd">            num_attributes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">attr_name</span> <span class="o">=</span> <span class="s1">&#39;attrib</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block </span><span class="si">{:d}</span><span class="s1"> has no defined attributes&#39;</span><span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][:]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Shape of attributes matrix should be </span><span class="si">{}</span><span class="s1"> (recieved </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][:]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                                                                             <span class="n">attributes</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">attributes</span></div>

<div class="viewcode-block" id="Exodus.get_elem_type"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the element type for a given block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The block id for which the element connectivity matrix is desired.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        type : str</span>
<span class="sd">            The element type of the block</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;connect</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_index</span><span class="p">)]</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="s1">&#39;elem_type&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Block </span><span class="si">{:d}</span><span class="s1"> has not been defined yet&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.get_elem_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets a tuple of element variable names from the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_var_names : tuple of strings</span>
<span class="sd">            Returns a tuple containing the names of the element variables in the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_elem_var&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Variable Names are not defined!&#39;</span><span class="p">)</span>
        <span class="n">elem_var_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elem_var_names</span></div>

<div class="viewcode-block" id="Exodus.put_elem_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_elem_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_elem_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_var_names</span><span class="p">,</span> <span class="n">elem_var_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the specified variable names in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elem_var_names : tuple of strings</span>
<span class="sd">            A tuple containing the names of the element variables in the exodus</span>
<span class="sd">            file</span>
<span class="sd">        elem_var_table : 2d array-like</span>
<span class="sd">            A 2d array of shape num_el_blk x num_elem_var defining which</span>
<span class="sd">            element variables are defined for which element blocks</span>
<span class="sd">            elem_var_table[i,j] should be True if the j-th element variable is</span>
<span class="sd">            defined for the i-th block (index, not id number) in the model.</span>
<span class="sd">            If not specified, it is assumed that all variables are defined for</span>
<span class="sd">            all blocks.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;name_elem_var&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Variable Names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_names</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem_var_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elem_var_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elem_var_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_blks</span><span class="p">,</span> <span class="n">num_names</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">elem_var_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elem_var_table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elem_var_table</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_blks</span><span class="p">,</span> <span class="n">num_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Shape of elem_var_table matrix should be </span><span class="si">{}</span><span class="s1"> (recieved </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_blks</span><span class="p">,</span> <span class="n">num_names</span><span class="p">),</span>
                                                                                                 <span class="n">elem_var_table</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">string_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_names</span><span class="p">,</span> <span class="n">string_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elem_var_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">string_length</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting nodal variable names, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">string_length</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
            <span class="c1"># Create the element variables if they exist</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">blkid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">elem_var_table</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;vals_elem_var</span><span class="si">{:d}</span><span class="s1">eb</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time_step&#39;</span><span class="p">,</span> <span class="s1">&#39;num_el_in_blk</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="c1"># Create the dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_elem_var&#39;</span><span class="p">,</span> <span class="n">num_names</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;name_elem_var&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_elem_var&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;elem_var_tab&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_el_blk&#39;</span><span class="p">,</span> <span class="s1">&#39;num_elem_var&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_elem_var&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;elem_var_tab&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">elem_var_table</span></div>

<div class="viewcode-block" id="Exodus.get_elem_variable_table"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_variable_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_variable_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the element variable table</span>

<span class="sd">        Gets the element variable table showing which elements are defined for</span>
<span class="sd">        which blocks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_var_table : np.masked_array</span>
<span class="sd">            A 2D array with dimension num_blocks x num_element_variables.  If</span>
<span class="sd">            the jth element variable is defined for the ith block,</span>
<span class="sd">            elem_var_table[i,j] == True</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;elem_var_tab&#39;</span><span class="p">][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Element Variable Table has not been defined in the exodus file&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_elem_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_elem_var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Number of element variables is not defined&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Exodus.get_elem_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets a block&#39;s element variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            Block id number for the block from which element variable values</span>
<span class="sd">            are desired.</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the element variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the element variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_variable_values : maskedarray</span>
<span class="sd">            A 1d array consisting of the variable values for each element in</span>
<span class="sd">            the specified block at the specified time step.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">var_index</span> <span class="o">=</span> <span class="n">name_or_index</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">[</span><span class="n">var_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">name_or_index</span>
                <span class="n">var_index</span> <span class="o">=</span> <span class="n">var_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                    <span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_elem_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()[</span><span class="n">block_index</span><span class="p">,</span> <span class="n">var_index</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Variable </span><span class="si">{}</span><span class="s1"> is not defined for block </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
        <span class="n">variable_value_name</span> <span class="o">=</span> <span class="s1">&#39;vals_elem_var</span><span class="si">{:d}</span><span class="s1">eb</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Timestep&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][:,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="Exodus.get_elem_variable_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_elem_variable_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_elem_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets an element&#39;s variable value for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            Block id number for the block from which element variable value</span>
<span class="sd">            is desired.</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the element variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        element_index : int</span>
<span class="sd">            element index at which to recover the nodal variable</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elem_variable_value : float</span>
<span class="sd">            The variable values for the specified element at the specified time</span>
<span class="sd">            step.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">var_index</span> <span class="o">=</span> <span class="n">name_or_index</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">[</span><span class="n">var_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">name_or_index</span>
                <span class="n">var_index</span> <span class="o">=</span> <span class="n">var_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                    <span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_elem_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()[</span><span class="n">block_index</span><span class="p">,</span> <span class="n">var_index</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Variable </span><span class="si">{}</span><span class="s1"> is not defined for block </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
        <span class="n">variable_value_name</span> <span class="o">=</span> <span class="s1">&#39;vals_elem_var</span><span class="si">{:d}</span><span class="s1">eb</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Timestep&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">element_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][:,</span> <span class="n">element_index</span><span class="p">]</span></div>

<div class="viewcode-block" id="Exodus.set_elem_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_elem_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_elem_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets a block&#39;s element variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            Block id number for the block from which element variable values</span>
<span class="sd">            are desired.</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the element variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the element variable</span>
<span class="sd">        values : array-like</span>
<span class="sd">            A 1d array consisting of the variable values for each element in</span>
<span class="sd">            the specified block at the specified time step.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">var_index</span> <span class="o">=</span> <span class="n">name_or_index</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">[</span><span class="n">var_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">name_or_index</span>
                <span class="n">var_index</span> <span class="o">=</span> <span class="n">var_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                    <span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_elem_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()[</span><span class="n">block_index</span><span class="p">,</span> <span class="n">var_index</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Variable </span><span class="si">{}</span><span class="s1"> is not defined for block </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
        <span class="n">variable_value_name</span> <span class="o">=</span> <span class="s1">&#39;vals_elem_var</span><span class="si">{:d}</span><span class="s1">eb</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#        values = np.array(values).flatten()</span>
<span class="c1">#        if values.shape != (self.num_elems_in_blk(block_id),):</span>
<span class="c1">#            raise ExodusError(&#39;values should have {:d} elements&#39;.format(self.num_elems_in_blk(block_id)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Exodus.set_elem_variable_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_elem_variable_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_elem_variable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">element_index</span><span class="p">,</span>
                                <span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets an element variable value for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            Block id number for the block from which element variable values</span>
<span class="sd">            are desired.</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the element variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the element variable</span>
<span class="sd">        value : float</span>
<span class="sd">            The variable values for the specified element in the specified</span>
<span class="sd">            block at the specified time step.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">block_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Block ID&#39;</span><span class="p">)</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">var_index</span> <span class="o">=</span> <span class="n">name_or_index</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">[</span><span class="n">var_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">name_or_index</span>
                <span class="n">var_index</span> <span class="o">=</span> <span class="n">var_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                    <span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_elem_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()[</span><span class="n">block_index</span><span class="p">,</span> <span class="n">var_index</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Variable </span><span class="si">{}</span><span class="s1"> is not defined for block </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
        <span class="n">variable_value_name</span> <span class="o">=</span> <span class="s1">&#39;vals_elem_var</span><span class="si">{:d}</span><span class="s1">eb</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_value_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">element_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Exodus.get_element_property_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_element_property_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_property_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Exodus.get_element_property_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_element_property_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_property_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Exodus.put_element_property_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_element_property_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_element_property_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Exodus.put_element_property_value"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_element_property_value">[docs]</a>    <span class="k">def</span> <span class="nf">put_element_property_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;        </span>
<span class="sd">     _   _           _                _       </span>
<span class="sd">    | \ | | ___   __| | ___  ___  ___| |_ ___ </span>
<span class="sd">    |  \| |/ _ \ / _` |/ _ \/ __|/ _ \ __/ __|</span>
<span class="sd">    | |\  | (_) | (_| |  __/\__ \  __/ |_\__ \</span>
<span class="sd">    |_| \_|\___/ \__,_|\___||___/\___|\__|___/</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_node_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_node_set_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the node set names in the exodus file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ns_names : tuple</span>
<span class="sd">            Returns a tuple of strings containing the node set names in the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_names&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set names are not yet defined!&#39;</span><span class="p">)</span>
        <span class="n">ns_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ns_names</span></div>

<div class="viewcode-block" id="Exodus.put_node_set_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_node_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_node_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the node set names into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ns_names : sequence of strings</span>
<span class="sd">            A sequence (list/tuple/etc.) containing the node set names.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;ns_names&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_node_sets</span>  <span class="c1"># self._ncdf_handle.dimensions[&#39;num_dim&#39;].size</span>
        <span class="k">if</span> <span class="n">num_ns</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Length of ns_names should be same as self.num_node_sets&#39;</span><span class="p">)</span>
        <span class="n">len_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_ns</span><span class="p">,</span> <span class="n">len_name</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ns_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting info records, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_name</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ns_names&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_names&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="Exodus.get_node_set_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Gets a list of the node set ID numbers in the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ns_ids : tuple</span>
<span class="sd">            A tuple containing the node set ID numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_prop1&#39;</span><span class="p">][:])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set IDs are not defined!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.put_node_set_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_node_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">put_node_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts a list of the node set ID numbers in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ns_ids : array-like</span>
<span class="sd">            A sequency of integers specifying the node set id numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;ns_prop1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set IDs have already been put to the exodus file.&#39;</span><span class="p">)</span>
        <span class="n">ns_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ns_ids</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid number of Node set IDs specified&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ns_prop1&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_prop1&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">ns_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_prop1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">)</span>
        <span class="c1"># Create ns_status as well</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ns_status&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_node_sets&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_status&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Exodus.get_node_set_num_nodes"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_set_num_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the number of nodes in the specified node set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Node set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num_nodes : int</span>
<span class="sd">            The number of nodes in the node set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ns_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ns_index</span> <span class="o">=</span> <span class="n">ns_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid node set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_nod_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.get_node_set_dist_factors"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_set_dist_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_dist_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the distribution factors of the specified node set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Node set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist_factor : np.array</span>
<span class="sd">            The distribution factors in the node set</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ns_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ns_index</span> <span class="o">=</span> <span class="n">ns_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid node set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;dist_fact_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No distribution factors defined for node set </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.get_node_set_nodes"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_node_set_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_set_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the nodes in the specified node set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Node set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nodes : np.array</span>
<span class="sd">            The node indices of nodes in the node set.  Note that while the</span>
<span class="sd">            Exodus file format uses 1-based indexing, the returned nodes array</span>
<span class="sd">            is converted so it is 0-based.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ns_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ns_index</span> <span class="o">=</span> <span class="n">ns_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1">#            print(ns_index)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid node set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;node_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)][:]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Node set </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.put_node_set_info"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_node_set_info">[docs]</a>    <span class="k">def</span> <span class="nf">put_node_set_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">dist_fact</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the node set information for a node set ID into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The node set ID (not index)</span>
<span class="sd">        nodes : array-like</span>
<span class="sd">            A 1d array containing the node indices.  Note the array should be</span>
<span class="sd">            zero-based, it will be converted to one based when written to the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        dist_fact : array-like</span>
<span class="sd">            A 1d array containing the node set distribution factors.  If not</span>
<span class="sd">            specified, the distribution factors will be assumed to be 1.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ns_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ns_index</span> <span class="o">=</span> <span class="n">ns_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid node set ID&#39;</span><span class="p">)</span>
        <span class="n">num_node_in_ns_name</span> <span class="o">=</span> <span class="s1">&#39;num_nod_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_node_in_ns_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                <span class="s1">&#39;Information for node set </span><span class="si">{:d}</span><span class="s1"> has already been put to the exodus file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dist_fact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dist_fact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dist_fact</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">dist_fact</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;dist_fact must be the same size as nodes&#39;</span><span class="p">)</span>
        <span class="c1"># Create dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">num_node_in_ns_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
        <span class="c1"># Create variables</span>
        <span class="n">node_name</span> <span class="o">=</span> <span class="s1">&#39;node_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">num_node_in_ns_name</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">node_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">nodes</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dist_fact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distfact_name</span> <span class="o">=</span> <span class="s1">&#39;dist_fact_ns</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
                <span class="n">distfact_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="n">num_node_in_ns_name</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">distfact_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">dist_fact</span>
        <span class="c1"># Set the ns_status to 1 when it is defined (I&#39;m not sure this is</span>
        <span class="c1"># actually what it should be, just every exodus file I&#39;ve looked at has</span>
        <span class="c1"># the eb_status as all ones...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_status&#39;</span><span class="p">][</span><span class="n">ns_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       _____ _     _                _       </span>
<span class="sd">      / ____(_)   | |              | |      </span>
<span class="sd">     | (___  _  __| | ___  ___  ___| |_ ___ </span>
<span class="sd">      \___ \| |/ _` |/ _ \/ __|/ _ \ __/ __|</span>
<span class="sd">      ____) | | (_| |  __/\__ \  __/ |_\__ \</span>
<span class="sd">     |_____/|_|\__,_|\___||___/\___|\__|___/</span>
<span class="sd">     &#39;&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_side_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Exodus.get_side_set_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Retrieve the side set names in the exouds file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ss_names : tuple</span>
<span class="sd">            Returns a tuple of strings containing the side set names in the</span>
<span class="sd">            exodus file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_names&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set names are not yet defined!&#39;</span><span class="p">)</span>
        <span class="n">ss_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ss_names</span></div>

<div class="viewcode-block" id="Exodus.put_side_set_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_side_set_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_side_set_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the side set names into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ss_names : sequence of strings</span>
<span class="sd">            A sequence (list/tuple/etc.) containing the side set names.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;xs_names&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_side_sets</span>
        <span class="k">if</span> <span class="n">num_ss</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Length of ss_names should be same as self.num_side_sets&#39;</span><span class="p">)</span>
        <span class="n">len_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_ss</span><span class="p">,</span> <span class="n">len_name</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ss_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">len_name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting info records, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">len_name</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ss_names&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_names&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="Exodus.get_side_set_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Gets a list of the side set ID numbers in the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ss_ids : tuple</span>
<span class="sd">            A tuple containing the side set ID numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_prop1&#39;</span><span class="p">][:])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set IDs are not defined!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.put_side_set_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_side_set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">put_side_set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts a list of the side set ID numbers in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ss_ids : array-like</span>
<span class="sd">            A sequency of integers specifying the side set id numbers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;ss_prop1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set IDs have already been put to the exodus file.&#39;</span><span class="p">)</span>
        <span class="n">ss_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ss_ids</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ss_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid number of side set IDs specified&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ss_prop1&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_prop1&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">ss_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_prop1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">)</span>
        <span class="c1"># Create ns_status as well</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;ss_status&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_side_sets&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_status&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Exodus.get_side_set_num_faces"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_num_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_num_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the number of faces in the specified side set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Side set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num_faces : int</span>
<span class="sd">            The number of faces in the side set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ss_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ss_index</span> <span class="o">=</span> <span class="n">ss_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid side set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_side_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.get_side_set_dist_factors"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_dist_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_dist_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the distribution factors of the specified side set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Side set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist_factor : np.array</span>
<span class="sd">            The distribution factors in the node set</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ss_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ss_index</span> <span class="o">=</span> <span class="n">ss_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid side set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;dist_fact_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)][:]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No distribution factors defined for side set </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.get_side_set_faces"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Get the faces in the specified side set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            Side set ID (not index)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elements : np.array</span>
<span class="sd">            The element of each face in the sideset (converted from 1-based</span>
<span class="sd">            exodus indexing to 0-based python indexing)</span>
<span class="sd">        sides : np.array</span>
<span class="sd">            The element side of each face in the sideset (converted from</span>
<span class="sd">            1-based exodus indexing to 0-based python indexing)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ss_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ss_index</span> <span class="o">=</span> <span class="n">ss_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1">#            print(ss_index)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid side set ID&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;elem_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)][:]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;side_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)][:]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Side set </span><span class="si">{:d}</span><span class="s1"> not initialized correctly&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Exodus.put_side_set_info"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_side_set_info">[docs]</a>    <span class="k">def</span> <span class="nf">put_side_set_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">sides</span><span class="p">,</span> <span class="n">dist_fact</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the side set information for a side set ID into the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            The side set ID (not index)</span>
<span class="sd">        elements : np.array</span>
<span class="sd">            The element of each face in the sideset (converted from 1-based</span>
<span class="sd">            exodus indexing to 0-based python indexing)</span>
<span class="sd">        sides : np.array</span>
<span class="sd">            The element side of each face in the sideset (converted from</span>
<span class="sd">            1-based exodus indexing to 0-based python indexing)</span>
<span class="sd">        dist_fact : array-like</span>
<span class="sd">            A 1d array containing the node set distribution factors.  If not</span>
<span class="sd">            specified, the distribution factors will be assumed to be 1.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ss_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ss_index</span> <span class="o">=</span> <span class="n">ss_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid side set ID&#39;</span><span class="p">)</span>
        <span class="n">num_side_in_ss_name</span> <span class="o">=</span> <span class="s1">&#39;num_side_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_side_in_ss_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span>
                <span class="s1">&#39;Information for side set </span><span class="si">{:d}</span><span class="s1"> has already been put to the exodus file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">sides</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sides</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dist_fact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:Distribution factors for sidesets have not been thoroughly checked! Use with Caution!&#39;</span><span class="p">)</span>
            <span class="n">dist_fact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dist_fact</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="c1"># TODO: Check if the size of dist_fact is correct</span>
<span class="c1">#            if nodes.shape != dist_fact.shape:</span>
<span class="c1">#                raise ExodusError(&#39;dist_fact must be the same size as nodes&#39;)</span>
        <span class="c1"># Create dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">num_side_in_ss_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
        <span class="c1"># Create variables</span>
        <span class="n">elem_name</span> <span class="o">=</span> <span class="s1">&#39;elem_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)</span>
        <span class="n">side_name</span> <span class="o">=</span> <span class="s1">&#39;side_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">elem_name</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">num_side_in_ss_name</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">side_name</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">num_side_in_ss_name</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">elem_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">side_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">sides</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dist_fact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distfact_name</span> <span class="o">=</span> <span class="s1">&#39;dist_fact_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)</span>
            <span class="n">distfact_dim_name</span> <span class="o">=</span> <span class="s1">&#39;num_df_ss</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">distfact_dim_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist_fact</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
                <span class="n">distfact_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="n">distfact_dim_name</span><span class="p">,))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">distfact_name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">dist_fact</span>
        <span class="c1"># Set the ns_status to 1 when it is defined (I&#39;m not sure this is</span>
        <span class="c1"># actually what it should be, just every exodus file I&#39;ve looked at has</span>
        <span class="c1"># the eb_status as all ones...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_status&#39;</span><span class="p">][</span><span class="n">ss_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Exodus.get_side_set_node_list"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_side_set_node_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_side_set_node_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;        </span>
<span class="sd">       _____ _       _           _  __      __        _       _     _           </span>
<span class="sd">      / ____| |     | |         | | \ \    / /       (_)     | |   | |          </span>
<span class="sd">     | |  __| | ___ | |__   __ _| |  \ \  / /_ _ _ __ _  __ _| |__ | | ___  ___ </span>
<span class="sd">     | | |_ | |/ _ \| &#39;_ \ / _` | |   \ \/ / _` | &#39;__| |/ _` | &#39;_ \| |/ _ \/ __|</span>
<span class="sd">     | |__| | | (_) | |_) | (_| | |    \  / (_| | |  | | (_| | |_) | |  __/\__ \</span>
<span class="sd">      \_____|_|\___/|_.__/ \__,_|_|     \/ \__,_|_|  |_|\__,_|_.__/|_|\___||___/</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_global_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;num_glo_var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Number of global variables is not defined&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Exodus.put_global_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.put_global_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">put_global_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_var_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Puts the specified global variable names in the exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        global_var_names : tuple of strings</span>
<span class="sd">            A tuple containing the names of the global variables in the model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;name_glo_var&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Global Variable Names have already been put to the exodus file&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure that it is the correct shape</span>
        <span class="n">num_names</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_var_names</span><span class="p">)</span>
        <span class="n">string_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;len_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_names</span><span class="p">,</span> <span class="n">string_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_var_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">string_length</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning:When setting global variable names, entry &quot;</span><span class="si">{}</span><span class="s1">&quot; (record </span><span class="si">{}</span><span class="s1">) will be truncated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">string_length</span><span class="p">]</span>
            <span class="n">listed_string</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
            <span class="c1"># Create the coordinate variables</span>
            <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">listed_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">listed_string</span>
        <span class="c1"># Create the dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;num_glo_var&#39;</span><span class="p">,</span> <span class="n">num_names</span><span class="p">)</span>
        <span class="c1"># Create the variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;name_glo_var&#39;</span><span class="p">,</span> <span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;num_glo_var&#39;</span><span class="p">,</span> <span class="s1">&#39;len_name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
            <span class="s1">&#39;vals_glo_var&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floating_point_type</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time_step&#39;</span><span class="p">,</span> <span class="s1">&#39;num_glo_var&#39;</span><span class="p">))</span>
        <span class="c1"># Assign to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_glo_var&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="Exodus.get_global_variable_names"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_global_variable_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets a tuple of global variable names from the exodus file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global_var_names : tuple of strings</span>
<span class="sd">            Returns a tuple containing the names of the global variables in the</span>
<span class="sd">            exodus file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_glo_var&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Global Variable Names are not defined!&#39;</span><span class="p">)</span>
        <span class="n">global_var_names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">global_var_names</span></div>

<div class="viewcode-block" id="Exodus.get_global_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_global_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_global_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the global variable value for the specified timesteps</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the global variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global_variable_values : maskedarray or float</span>
<span class="sd">            A 1d array or floating point number consisting of the variable</span>
<span class="sd">            values at the specified time steps.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_global_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_glo_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_glo_var&#39;</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Invalid Time Step&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_glo_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_glo_var_name</span><span class="p">][:,</span> <span class="n">index</span><span class="p">]</span></div>

<div class="viewcode-block" id="Exodus.set_global_variable_values"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.set_global_variable_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_global_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_or_index</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets the global variable values for the specified timestep</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name_or_index : str or int</span>
<span class="sd">            Name or Index of the nodal variable that is desired.  If</span>
<span class="sd">            type(name_or_index) == str, then it is assumed to be the name.  If</span>
<span class="sd">            type(name_or_index) == int, then it is assumed to be the index.</span>
<span class="sd">        step : int</span>
<span class="sd">            Time step at which to recover the nodal variable</span>
<span class="sd">        value : array-like</span>
<span class="sd">            A 1d array consisting of the variable values for each node at the</span>
<span class="sd">            specified time step.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If step is not a valid index for the time vector, the time vector will</span>
<span class="sd">        be expanded so that it is.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">name_or_index</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">character</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name_or_index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> not found in self.get_global_variable_names().  Options are </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name_or_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="n">vals_glo_var_name</span> <span class="o">=</span> <span class="s1">&#39;vals_glo_var&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vals_glo_var_name</span><span class="p">][</span><span class="n">step</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="c1"># TODO: Still need to do Nodeset and Sideset Variables;</span>
    <span class="c1"># Coordinate Frames (see ExodusIO.m), Element Block Attribute Names</span>

<div class="viewcode-block" id="Exodus.close"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Exodus.load_into_memory"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.load_into_memory">[docs]</a>    <span class="k">def</span> <span class="nf">load_into_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Loads the exodus file into an ExodusInMemory object</span>

<span class="sd">        This function loads the exodus file into memory in an ExodusInMemory</span>
<span class="sd">        format.  Not for use with large files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        close : bool</span>
<span class="sd">            Close the netcdf file upon loading into memory.  Optional argument,</span>
<span class="sd">            default is true.</span>
<span class="sd">        variables : iterable</span>
<span class="sd">            A list of variable names that are loaded into memory.  Default is</span>
<span class="sd">            to load all variables</span>
<span class="sd">        timesteps : iterable</span>
<span class="sd">            A list of timestep indices that are loaded into memory.  Default is</span>
<span class="sd">            to load all timesteps.</span>
<span class="sd">        blocks : iterable</span>
<span class="sd">            A list of block ids that are loaded into memory.  Default is to</span>
<span class="sd">            load all blocks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fexo : ExodusInMemory</span>
<span class="sd">            The exodus file in an ExodusInMemory format</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fexo</span> <span class="o">=</span> <span class="n">ExodusInMemory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fexo</span></div>

<div class="viewcode-block" id="Exodus.get_block_surface"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.get_block_surface">[docs]</a>    <span class="k">def</span> <span class="nf">get_block_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the node indices and element connectivity of surface elements</span>

<span class="sd">        This function &quot;skins&quot; the element block, returning a list of node</span>
<span class="sd">        indices and a surface connectivity matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            The ID number of the block that will be skinned.</span>
<span class="sd">        keep_midside_nodes : bool</span>
<span class="sd">            Specifies whether or not to keep midside nodes in the surface mesh.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        warn : bool</span>
<span class="sd">            Specifies whether or not to warn the user if the block ID doesn&#39;t</span>
<span class="sd">            have a skinning method defined for its element type.  Default is</span>
<span class="sd">            True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        element_block_information : list</span>
<span class="sd">            A list of tuples of element information.  These data are</span>
<span class="sd">            element_type, node_indices, block_surface_connectivity, and</span>
<span class="sd">            block_surface_original_elements.  The element_type is a string</span>
<span class="sd">            representing the new block element type (&#39;quad4&#39;,&#39;tri3&#39;,etc.).  The</span>
<span class="sd">            node_indices can be used as an index into the coordinate or nodal</span>
<span class="sd">            variable arrays to select nodes corresponding to this block. The</span>
<span class="sd">            block_surface_connectivity represents the connectivity array of the</span>
<span class="sd">            surface faces of the block.  Values in this array correspond to</span>
<span class="sd">            indices into the node_indices array.  To recover the connectivity</span>
<span class="sd">            array in the original node indices of the exodus file, it can be</span>
<span class="sd">            passed through the node_indices as </span>
<span class="sd">            node_indices[block_surface_connectivity].  The</span>
<span class="sd">            block_surface_original_elements array shows the original element</span>
<span class="sd">            indices of the block that each surface came from.  This can be</span>
<span class="sd">            used to map element variables to the new surface mesh.  This list</span>
<span class="sd">            will normally be length 1 unless an element type is processed that</span>
<span class="sd">            has two different surface elements in it (e.g. wedges have</span>
<span class="sd">            tris and quads)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">elem_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_type</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_connectivity</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">face_connectivity_array</span> <span class="o">=</span> <span class="n">face_connectivity</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="p">)</span>
        <span class="n">element_block_information</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reduced_elem_type</span><span class="p">,</span> <span class="n">reduced_connectivity</span> <span class="ow">in</span> <span class="n">face_connectivity_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reduced_elem_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Element Type </span><span class="si">{:}</span><span class="s1"> has no defined face reduction.  Passing connectivity unchanged.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">elem_type</span><span class="p">))</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
                <span class="n">block_elem_type</span> <span class="o">=</span> <span class="n">elem_type</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[:,</span>
                                                       <span class="n">reduced_connectivity</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">reduced_connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                         <span class="n">reduced_connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">block_elem_type</span> <span class="o">=</span> <span class="n">reduced_elem_type</span>
                <span class="c1"># Remove faces that are duplicates</span>
                <span class="p">(</span><span class="n">unique_rows</span><span class="p">,</span> <span class="n">unique_row_indices</span><span class="p">,</span> <span class="n">unique_inverse</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                    <span class="n">block_face_connectivity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">original_unique_counts</span> <span class="o">=</span> <span class="n">unique_counts</span><span class="p">[</span><span class="n">unique_inverse</span><span class="p">]</span>
                <span class="n">nondupe_faces</span> <span class="o">=</span> <span class="n">original_unique_counts</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">block_face_connectivity</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">block_face_original_elements</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">]</span>

            <span class="n">node_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">block_face_connectivity</span><span class="p">)</span>
            <span class="n">node_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">node_map</span><span class="p">[</span><span class="n">node_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_indices</span><span class="p">))</span>
            <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">[</span><span class="n">block_face_connectivity</span><span class="p">]</span>
            <span class="n">element_block_information</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">block_elem_type</span><span class="p">,</span>
                                              <span class="n">node_indices</span><span class="p">,</span>
                                              <span class="n">block_face_connectivity</span><span class="p">,</span>
                                              <span class="n">block_face_original_elements</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">element_block_information</span></div>

<div class="viewcode-block" id="Exodus.triangulate_surface_mesh"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.triangulate_surface_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">triangulate_surface_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Triangulate a surface mesh for plotting patches</span>

<span class="sd">        This function generates a triangle mesh for each block in the model if</span>
<span class="sd">        it can.  If there are more than 3 nodes per element in a block, and the</span>
<span class="sd">        triangulation scheme hasn&#39;t been defined in</span>
<span class="sd">        pyexodus.mesh_triangulation_array, it will be skipped.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        triangulated_mesh_info : list</span>
<span class="sd">            A list of tuples containing block id, node_indices, triangulated</span>
<span class="sd">            connectivity, and original block elements</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">triangulated_mesh_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">():</span>
            <span class="n">surface_mesh_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_block_surface</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">original_elements</span> <span class="ow">in</span> <span class="n">surface_mesh_info</span><span class="p">:</span>
                <span class="n">triangulation_scheme</span> <span class="o">=</span> <span class="n">mesh_triangulation_array</span><span class="p">(</span><span class="n">elem_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">triangulation_scheme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: More than 3 (</span><span class="si">{:}</span><span class="s1">) nodes per element in block </span><span class="si">{:}</span><span class="s1">, this block will not be triangulated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">block_id</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">triangulated_mesh_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">original_elements</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">triangulated_mesh_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">block_id</span><span class="p">,</span>
                         <span class="n">node_indices</span><span class="p">,</span>
                         <span class="n">connectivity</span><span class="p">[:,</span>
                                      <span class="n">triangulation_scheme</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">triangulation_scheme</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">original_elements</span><span class="p">,</span> <span class="n">triangulation_scheme</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">triangulated_mesh_info</span></div>

<div class="viewcode-block" id="Exodus.reduce_to_surfaces"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.reduce_to_surfaces">[docs]</a>    <span class="k">def</span> <span class="nf">reduce_to_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reduce_exodus_to_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Exodus.extract_sharp_edges"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.extract_sharp_edges">[docs]</a>    <span class="k">def</span> <span class="nf">extract_sharp_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">extract_sharp_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="s1">&#39;Exodus File at </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  </span><span class="si">{:}</span><span class="s1"> Timesteps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_times</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  </span><span class="si">{:}</span><span class="s1"> Nodes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  </span><span class="si">{:}</span><span class="s1"> Elements&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elems</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Blocks: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                                                      <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Node Variables: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Element Variables: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Global Variables: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">()))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">return_string</span></div>

    <span class="c1"># def plot_mesh(self,surface_kwargs={&#39;color&#39;:(0,0,1)},</span>
    <span class="c1">#              bar_kwargs = {&#39;color&#39;:(0,1,0),&#39;tube_radius&#39;:None},</span>
    <span class="c1">#              point_kwargs = {&#39;color&#39;:(1,0,0),&#39;scale_factor&#39;:0.1},</span>
    <span class="c1">#              plot_surfaces = True, plot_bars = True, plot_points = True,</span>
    <span class="c1">#              plot_edges = False):</span>
    <span class="c1">#     &#39;&#39;&#39;Skins, triangulates, and plots a 3D representation of the mesh.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     mesh_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of surface</span>
    <span class="c1">#         patches.</span>
    <span class="c1">#     bar_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of lines (bar,</span>
    <span class="c1">#         beam elements)</span>
    <span class="c1">#     point_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of points</span>
    <span class="c1">#         (sphere elements)</span>
    <span class="c1">#     show : bool</span>
    <span class="c1">#         A flag to specify whether or not to show the window.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     window : GLViewWidget</span>
    <span class="c1">#         A reference to the view that the 3D content is plotted in.</span>
    <span class="c1">#     meshes : list</span>
    <span class="c1">#         A list of the mesh objects that have been added to the view.</span>

    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#     if mlab is None:</span>
    <span class="c1">#         raise ModuleNotFoundError(&#39;Mayavi not installed!&#39;)</span>
    <span class="c1">#     triangulated_mesh_info = self.triangulate_surface_mesh()</span>
    <span class="c1">#     meshes = []</span>
    <span class="c1">#     for block,node_indices,faces,original_elements in triangulated_mesh_info:</span>
    <span class="c1">#         if faces.shape[1] == 3:</span>
    <span class="c1">#             if plot_surfaces:</span>
    <span class="c1">#                 meshes.append(mlab.triangular_mesh(</span>
    <span class="c1">#                         *(self.get_coords()[:,node_indices]),faces,</span>
    <span class="c1">#                               **surface_kwargs))</span>
    <span class="c1">#                 if plot_edges:</span>
    <span class="c1">#                     meshes.append(mlab.triangular_mesh(</span>
    <span class="c1">#                         *(self.get_coords()[:,node_indices]),faces,</span>
    <span class="c1">#                               representation=&#39;wireframe&#39;,color=(0,0,0)))</span>
    <span class="c1">#         elif faces.shape[1] == 2:</span>
    <span class="c1">#             if plot_bars:</span>
    <span class="c1">#                 line_items = []</span>
    <span class="c1">#                 xs,ys,zs = self.get_coords()[:,node_indices][:,faces]</span>
    <span class="c1">#                 for x,y,z in zip(xs,ys,zs):</span>
    <span class="c1">#                     line_items.append(mlab.plot3d(x,y,z,**bar_kwargs))</span>
    <span class="c1">#                 meshes.append(line_items)</span>
    <span class="c1">#         elif faces.shape[1] == 1:</span>
    <span class="c1">#             if plot_points:</span>
    <span class="c1">#                 meshes.append(mlab.points3d(*(self.get_coords()[:,node_indices]),</span>
    <span class="c1">#                                             **point_kwargs))</span>
    <span class="c1">#     return meshes</span>


<div class="viewcode-block" id="subfield"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.subfield.html#sdynpy.fem.sdynpy_exodus.subfield">[docs]</a><span class="k">class</span> <span class="nc">subfield</span><span class="p">(</span><span class="n">SimpleNamespace</span><span class="p">):</span>
<div class="viewcode-block" id="subfield.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.subfield.html#sdynpy.fem.sdynpy_exodus.subfield.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="s1">&#39;Field with subfields: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span>
            <span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:}</span><span class="s1">=</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>
        <span class="k">return</span> <span class="n">return_string</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExodusInMemory"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory">[docs]</a><span class="k">class</span> <span class="nc">ExodusInMemory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Read or write exodus files loaded into memory</span>

<span class="sd">    This is a convenience class wrapped around the exodus class to enable</span>
<span class="sd">    easier manipulation of exodus files that fit entirely into memory</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exo : exodus</span>
<span class="sd">        An exodus object, if you want to load an exodus file into memory, or</span>
<span class="sd">        None if you want to create an empty exodus file.</span>
<span class="sd">    variables : iterable</span>
<span class="sd">        A list of variable names that are loaded into memory.  Default is</span>
<span class="sd">        to load all variables</span>
<span class="sd">    timesteps : iterable</span>
<span class="sd">        A list of timestep indices that are loaded into memory.  Default is</span>
<span class="sd">        to load all timesteps.</span>
<span class="sd">    blocks : iterable</span>
<span class="sd">        A list of block ids that are loaded into memory.  Default is to load</span>
<span class="sd">        all blocks.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="ExodusInMemory.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_exodus</span><span class="p">(</span><span class="n">exo</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Title</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="c1"># Attributes</span>
            <span class="n">attribute_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;api_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.22</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.22</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;floating_point_word_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;file_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;int64_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">attribute_dict</span><span class="p">)</span>
            <span class="c1"># QA Records</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Info records</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
            <span class="c1"># Nodes</span>
            <span class="n">node_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;node_num_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_dict</span><span class="p">)</span>
            <span class="c1"># TODO Coordinate Frames</span>
            <span class="c1"># Blocks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Element Map</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_map</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Nodesets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Sidesets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Global Variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Element Variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Nodal Variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Time Steps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="ExodusInMemory.load_from_exodus"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.load_from_exodus">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_exodus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exo</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">title</span>
        <span class="c1"># Attributes</span>
        <span class="n">attribute_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;api_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">api_version</span>
        <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">version</span>
        <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;floating_point_word_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">floating_point_word_size</span>
        <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;file_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">file_size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;int64_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">int64_status</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">attribute_dict</span><span class="p">[</span><span class="s1">&#39;int64_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">attribute_dict</span><span class="p">)</span>

        <span class="c1"># QA Records</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_qa_records</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Info Records</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_info_records</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_records</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="c1"># Get Nodes</span>
        <span class="n">node_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;node_num_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_num_map</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
        <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_coord_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_dict</span><span class="p">)</span>
        <span class="c1"># TODO Read Coordinate Frames</span>
        <span class="c1"># Blocks</span>
        <span class="k">if</span> <span class="n">blocks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">block_ids</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">block_id</span> <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span> <span class="k">if</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">blk_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_ids</span><span class="p">):</span>
            <span class="n">blk_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blk_id</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_connectivity</span><span class="p">(</span><span class="n">blk_id</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_type</span><span class="p">(</span><span class="n">blk_id</span><span class="p">)</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_names&#39;</span><span class="p">]</span>
                                       <span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">))</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;eb_status&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_attr</span><span class="p">(</span><span class="n">blk_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># TODO: Add attribute names once implemented</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># exo.get_elem_attr_names(blk_id)</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">blk_dict</span><span class="p">))</span>
        <span class="c1"># Element Map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_map</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_num_map</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Get Nodesets</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodeset_ids</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_set_ids</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ns_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodeset_ids</span><span class="p">):</span>
                <span class="n">ns_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ns_id</span>
                <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_set_nodes</span><span class="p">(</span><span class="n">ns_id</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;dist_factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_set_dist_factors</span><span class="p">(</span><span class="n">ns_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                    <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;dist_factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_set_names</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                    <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ns_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ns_status&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">ns_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get Sidesets</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sideset_ids</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_side_set_ids</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ss_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sideset_ids</span><span class="p">):</span>
                <span class="n">ss_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss_id</span>
                <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">],</span> <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;sides&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_side_set_faces</span><span class="p">(</span><span class="n">ss_id</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;dist_factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_side_set_dist_factors</span><span class="p">(</span><span class="n">ss_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                    <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;dist_factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">_ncdf_handle</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ss_status&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_side_set_names</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                    <span class="n">ss_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">ss_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get Global Variables</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_glob_vars</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">num_global_variables</span>
            <span class="k">if</span> <span class="n">num_glob_vars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">global_var_names</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_global_variable_names</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">global_var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">global_var_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_var_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No Global Variables to Load&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">global_var_names</span><span class="p">):</span>
                    <span class="n">global_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">global_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="n">global_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_global_variable_values</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="n">time_indices</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">global_var_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get Nodal Variables</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_node_vars</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">num_node_variables</span>
            <span class="k">if</span> <span class="n">num_node_vars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">node_var_names</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">node_var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">node_var_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_var_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No Nodal Variables to Load&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_var_names</span><span class="p">):</span>
                    <span class="n">node_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_node_variable_values</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_indices</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_var_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get Element Variables</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_elem_vars</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">num_elem_variables</span>
            <span class="k">if</span> <span class="n">num_elem_vars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">elem_var_names</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
                <span class="n">variable_truth_table</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
                <span class="k">for</span> <span class="n">blk_index</span><span class="p">,</span> <span class="n">blk_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exo</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">blk_id</span> <span class="ow">in</span> <span class="n">block_ids</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">block_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blk_id</span>
                    <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">elem_index</span><span class="p">,</span> <span class="n">elem_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elem_var_names</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elem_name</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">variable_truth_table</span><span class="p">[</span><span class="n">blk_index</span><span class="p">,</span> <span class="n">elem_index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">elem_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_name</span>
                            <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_elem_variable_values</span><span class="p">(</span>
                                <span class="n">blk_id</span><span class="p">,</span> <span class="n">elem_index</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_indices</span><span class="p">,</span> <span class="p">:]</span>
                            <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">elem_var_dict</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ExodusError</span><span class="p">(</span><span class="s1">&#39;No Element Variables to Load&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">block_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Get Time Steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">get_times</span><span class="p">(</span><span class="n">time_indices</span><span class="p">)</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ExodusInMemory.from_sdynpy"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.from_sdynpy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_sdynpy</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">displacement_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fexo</span> <span class="o">=</span> <span class="n">ExodusInMemory</span><span class="p">()</span>

        <span class="c1"># Put in the node positions</span>
        <span class="n">node_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">definition_coordinate_systems</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">node_data</span><span class="o">.</span><span class="n">def_cs</span><span class="p">)</span>
        <span class="n">global_positions</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="n">definition_coordinate_systems</span><span class="p">,</span> <span class="n">node_data</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">global_positions</span>
        <span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="o">=</span> <span class="n">node_data</span><span class="o">.</span><span class="n">id</span>
        <span class="n">node_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span>
            <span class="p">{</span><span class="n">node_id</span><span class="p">:</span> <span class="n">node_index</span> <span class="k">for</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_data</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
        <span class="c1"># Now go through and add in the elements</span>
        <span class="n">element_data</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">element</span>
        <span class="n">element_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">element_data</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="n">elem_colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem_type</span> <span class="ow">in</span> <span class="n">element_types</span><span class="p">:</span>
            <span class="n">blk_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_type</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;block_</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem_type</span><span class="p">)</span>
            <span class="n">elements_this_type</span> <span class="o">=</span> <span class="n">element_data</span><span class="p">[</span><span class="n">element_data</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">elem_type</span><span class="p">]</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">elements_this_type</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_index_map</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inverse_exodus_elem_type_map</span><span class="p">[</span><span class="n">elem_type</span><span class="p">]</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">elem_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements_this_type</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">blk_dict</span><span class="p">))</span>

        <span class="c1"># Now do the same for the tracelines</span>
        <span class="n">traceline_data</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">traceline</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">traceline</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traceline_data</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()):</span>
            <span class="n">connectivity_1d</span> <span class="o">=</span> <span class="n">node_index_map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">connectivity_1d</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                           <span class="n">connectivity_1d</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">blk_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">500</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceline</span><span class="o">.</span><span class="n">description</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connectivity</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">elem_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">traceline</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">blk_dict</span><span class="p">))</span>

        <span class="kn">from</span> <span class="nn">..core.sdynpy_shape</span> <span class="kn">import</span> <span class="n">ShapeArray</span>
        <span class="kn">from</span> <span class="nn">..core.sdynpy_data</span> <span class="kn">import</span> <span class="n">NDDataArray</span><span class="p">,</span> <span class="n">TimeHistoryArray</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement_data</span><span class="p">,</span> <span class="n">ShapeArray</span><span class="p">):</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">frequency</span>
            <span class="c1"># Add global variables frequency and damping</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;damping&#39;</span><span class="p">]:</span>
                <span class="n">global_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">global_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">global_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Now add displacement data for the shapes</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">node_data</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="c1"># Keep only displacements</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span>
                                      <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">local_deformation_directions</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
            <span class="n">coordinate_nodes</span> <span class="o">=</span> <span class="n">node_data</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
            <span class="n">displacement_coordinate_systems</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">coordinate_nodes</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
            <span class="n">shape_displacements</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span>
            <span class="n">coordinates</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node_index_map</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">global_positions</span><span class="p">[</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">]</span>
            <span class="n">global_deformation_directions</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span><span class="n">displacement_coordinate_systems</span><span class="p">,</span>
                                                              <span class="n">local_deformation_directions</span><span class="p">,</span>
                                                              <span class="n">points</span><span class="p">)</span>
            <span class="n">node_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">shape_displacements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
                                          <span class="o">+</span> <span class="n">node_data</span><span class="o">.</span><span class="n">shape</span>
                                          <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">shape_displacements</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">shape_coefficients</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">global_deformation_directions</span><span class="p">,</span> <span class="n">shape_displacements</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">node_index</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">node</span>
                <span class="n">displacements</span> <span class="o">=</span> <span class="n">shape_coefficients</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">direction</span>
                <span class="n">node_displacements</span><span class="p">[:,</span> <span class="n">node_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">displacements</span>

            <span class="c1"># Now add the variables</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;DispX&#39;</span><span class="p">,</span> <span class="s1">&#39;DispY&#39;</span><span class="p">,</span> <span class="s1">&#39;DispZ&#39;</span><span class="p">)):</span>
                <span class="n">node_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_displacements</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_var_dict</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement_data</span><span class="p">,</span> <span class="n">NDDataArray</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement_data</span><span class="p">,</span> <span class="n">TimeHistoryArray</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">fexo</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span>
                <span class="c1"># Now add displacement data for the shapes</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">response_coordinate</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">node_data</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
                <span class="c1"># Keep only displacements</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>
                                          <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="n">local_deformation_directions</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
                <span class="n">coordinate_nodes</span> <span class="o">=</span> <span class="n">node_data</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
                <span class="n">displacement_coordinate_systems</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
                    <span class="n">coordinate_nodes</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
                <span class="n">data_displacements</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">coordinates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]]</span><span class="o">.</span><span class="n">ordinate</span><span class="o">.</span><span class="n">T</span>
                <span class="n">coordinates</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node_index_map</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">global_positions</span><span class="p">[</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">]</span>
                <span class="n">global_deformation_directions</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span><span class="n">displacement_coordinate_systems</span><span class="p">,</span>
                                                                  <span class="n">local_deformation_directions</span><span class="p">,</span>
                                                                  <span class="n">points</span><span class="p">)</span>
                <span class="n">node_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data_displacements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
                                              <span class="o">+</span> <span class="n">node_data</span><span class="o">.</span><span class="n">shape</span>
                                              <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_displacements</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">shape_coefficients</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">global_deformation_directions</span><span class="p">,</span> <span class="n">data_displacements</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                    <span class="n">node_index</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">node</span>
                    <span class="n">displacements</span> <span class="o">=</span> <span class="n">shape_coefficients</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">direction</span>
                    <span class="n">node_displacements</span><span class="p">[:,</span> <span class="n">node_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+=</span> <span class="n">displacements</span>

                <span class="c1"># Now add the variables</span>
                <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;DispX&#39;</span><span class="p">,</span> <span class="s1">&#39;DispY&#39;</span><span class="p">,</span> <span class="s1">&#39;DispZ&#39;</span><span class="p">)):</span>
                    <span class="n">node_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_displacements</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_var_dict</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s1">&#39;Saving Functions with type </span><span class="si">{:}</span><span class="s1"> to Exodus Data is Not Implemented Yet&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">displacement_data</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Now add color information</span>
        <span class="n">node_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NodeColor&#39;</span>
        <span class="n">node_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">node_data</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_var_dict</span><span class="p">))</span>

        <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">,</span> <span class="n">elem_colors</span><span class="p">):</span>
            <span class="n">block_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span>
            <span class="n">elem_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ElemColor&#39;</span>
            <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">block_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">elem_var_dict</span><span class="p">)]</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">block_dict</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fexo</span></div>

<div class="viewcode-block" id="ExodusInMemory.write_to_file"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.write_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">num_nodes</span><span class="p">,</span> <span class="n">num_dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">num_elem</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">])</span>
        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_node_sets</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_node_sets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_side_sets</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_side_sets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span><span class="p">)</span>
        <span class="n">exo_out</span> <span class="o">=</span> <span class="n">Exodus</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                         <span class="n">num_dims</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">,</span> <span class="n">num_elem</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">num_node_sets</span><span class="p">,</span>
                         <span class="n">num_side_sets</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">)</span>

        <span class="c1"># Write time steps</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">set_times</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

        <span class="c1"># Initialize Information</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">put_info_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_records</span><span class="p">)</span>
        <span class="n">qa_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qa_records</span><span class="p">)</span>
        <span class="n">qa_records</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;pyexodus&#39;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">put_qa_records</span><span class="p">(</span><span class="n">qa_records</span><span class="p">)</span>

        <span class="c1"># Write the nodes</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">put_coord_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">put_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_node_num_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span><span class="p">)</span>

        <span class="c1"># Initialize blocks</span>
        <span class="n">exo_out</span><span class="o">.</span><span class="n">put_elem_blk_ids</span><span class="p">([</span><span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nattr_per_elem</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nattr_per_elem</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_elem_blk_info</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="n">block</span><span class="o">.</span><span class="n">elem_type</span><span class="p">,</span>
                                      <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                      <span class="n">nattr_per_elem</span><span class="p">)</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">set_elem_connectivity</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nattr_per_elem</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exo_out</span><span class="o">.</span><span class="n">set_elem_attr</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Element Map</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_elem_num_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_map</span><span class="p">)</span>

        <span class="c1"># Nodesets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_node_set_ids</span><span class="p">([</span><span class="n">ns</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span><span class="p">])</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_node_set_names</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">nodeset</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nodeset</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">nodeset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">nodeset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodesets</span><span class="p">:</span>
                <span class="n">exo_out</span><span class="o">.</span><span class="n">put_node_set_info</span><span class="p">(</span><span class="n">nodeset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">nodeset</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodeset</span><span class="o">.</span><span class="n">dist_factors</span><span class="p">)</span>

        <span class="c1"># Sidesets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_side_set_ids</span><span class="p">([</span><span class="n">ns</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span><span class="p">])</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_side_set_names</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">sideset</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sideset</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">sideset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">sideset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidesets</span><span class="p">:</span>
                <span class="n">exo_out</span><span class="o">.</span><span class="n">put_side_set_info</span><span class="p">(</span><span class="n">sideset</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sideset</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
                                          <span class="n">sideset</span><span class="o">.</span><span class="n">sides</span><span class="p">,</span> <span class="n">sideset</span><span class="o">.</span><span class="n">dist_factors</span><span class="p">)</span>

        <span class="c1"># Global Variables #TODO: Make it so I can write all timesteps at once.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_global_variable_names</span><span class="p">([</span><span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                    <span class="n">exo_out</span><span class="o">.</span><span class="n">set_global_variable_values</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># Nodal Variables #TODO: Make it so I can write all timesteps at once.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_node_variable_names</span><span class="p">([</span><span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                    <span class="n">exo_out</span><span class="o">.</span><span class="n">set_node_variable_values</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>

        <span class="c1"># Element Variables # TODO: Make it so I can write all timesteps at once</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">)</span>
            <span class="n">nelemvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">)</span>
            <span class="n">elem_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nblocks</span><span class="p">,</span> <span class="n">nelemvars</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nblocks</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelemvars</span><span class="p">):</span>
                    <span class="n">elem_table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="c1"># Detect if any variables are not used ever</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">keep_booleans</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelemvars</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">elem_table</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">variable_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">keep_booleans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">variable_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">keep_booleans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">elem_table</span> <span class="o">=</span> <span class="n">elem_table</span><span class="p">[:,</span> <span class="n">keep_booleans</span><span class="p">]</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">boolean</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">variable_names</span><span class="p">,</span> <span class="n">keep_booleans</span><span class="p">)</span> <span class="k">if</span> <span class="n">boolean</span><span class="p">]</span>
            <span class="n">keep_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">keep_booleans</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">exo_out</span><span class="o">.</span><span class="n">put_elem_variable_names</span><span class="p">(</span><span class="n">variable_names</span><span class="p">,</span> <span class="n">elem_table</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variable_names</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">elem_table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                            <span class="n">exo_out</span><span class="o">.</span><span class="n">set_elem_variable_values</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">[</span><span class="n">keep_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">exo_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExodusInMemory.repack"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.repack">[docs]</a>    <span class="k">def</span> <span class="nf">repack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Repackages an exodus file as a linear combination of itself&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode_indices</span> <span class="o">=</span> <span class="n">modes</span>

        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mode_indices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Number of rows in q must be equivalent to number of time steps in exodus file&#39;</span><span class="p">)</span>

        <span class="n">out_fexo</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">out_fexo</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">global_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_vars</span><span class="p">):</span>
                <span class="n">out_fexo</span><span class="o">.</span><span class="n">global_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">global_var</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">mode_indices</span><span class="p">]</span> <span class="o">@</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nodal_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">):</span>
                <span class="n">out_fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodal_var</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="n">mode_indices</span><span class="p">]</span> <span class="o">@</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">elem_vars</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">elem_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out_fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">elem_vars</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="n">mode_indices</span><span class="p">]</span> <span class="o">@</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">out_fexo</span></div>

<div class="viewcode-block" id="ExodusInMemory.get_block_surface"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.get_block_surface">[docs]</a>    <span class="k">def</span> <span class="nf">get_block_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Gets the node indices and element connectivity of surface elements</span>

<span class="sd">        This function &quot;skins&quot; the element block, returning a list of node</span>
<span class="sd">        indices and a surface connectivity matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            The ID number of the block that will be skinned.</span>
<span class="sd">        keep_midside_nodes : bool</span>
<span class="sd">            Specifies whether or not to keep midside nodes in the surface mesh.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        warn : bool</span>
<span class="sd">            Specifies whether or not to warn the user if the block ID doesn&#39;t</span>
<span class="sd">            have a skinning method defined for its element type.  Default is</span>
<span class="sd">            True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        element_block_information : list</span>
<span class="sd">            A list of tuples of element information.  These data are</span>
<span class="sd">            element_type, node_indices, block_surface_connectivity, and</span>
<span class="sd">            block_surface_original_elements.  The element_type is a string</span>
<span class="sd">            representing the new block element type (&#39;quad4&#39;,&#39;tri3&#39;,etc.).  The</span>
<span class="sd">            node_indices can be used as an index into the coordinate or nodal</span>
<span class="sd">            variable arrays to select nodes corresponding to this block. The</span>
<span class="sd">            block_surface_connectivity represents the connectivity array of the</span>
<span class="sd">            surface faces of the block.  Values in this array correspond to</span>
<span class="sd">            indices into the node_indices array.  To recover the connectivity</span>
<span class="sd">            array in the original node indices of the exodus file, it can be</span>
<span class="sd">            passed through the node_indices as </span>
<span class="sd">            node_indices[block_surface_connectivity].  The</span>
<span class="sd">            block_surface_original_elements array shows the original element</span>
<span class="sd">            indices of the block that each surface came from.  This can be</span>
<span class="sd">            used to map element variables to the new surface mesh.  This list</span>
<span class="sd">            will normally be length 1 unless an element type is processed that</span>
<span class="sd">            has two different surface elements in it (e.g. wedges have</span>
<span class="sd">            tris and quads)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">block_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">elem_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span><span class="o">.</span><span class="n">elem_type</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span><span class="o">.</span><span class="n">connectivity</span>
        <span class="n">face_connectivity_array</span> <span class="o">=</span> <span class="n">face_connectivity</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="p">)</span>
        <span class="n">element_block_information</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reduced_elem_type</span><span class="p">,</span> <span class="n">reduced_connectivity</span> <span class="ow">in</span> <span class="n">face_connectivity_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reduced_elem_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Element Type </span><span class="si">{:}</span><span class="s1"> has no defined face reduction.  Passing connectivity unchanged.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">elem_type</span><span class="p">))</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
                <span class="n">block_elem_type</span> <span class="o">=</span> <span class="n">elem_type</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[:,</span>
                                                       <span class="n">reduced_connectivity</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">reduced_connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                         <span class="n">reduced_connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">block_elem_type</span> <span class="o">=</span> <span class="n">reduced_elem_type</span>
                <span class="c1"># Remove faces that are duplicates</span>
                <span class="p">(</span><span class="n">unique_rows</span><span class="p">,</span> <span class="n">unique_row_indices</span><span class="p">,</span> <span class="n">unique_inverse</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                    <span class="n">block_face_connectivity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">original_unique_counts</span> <span class="o">=</span> <span class="n">unique_counts</span><span class="p">[</span><span class="n">unique_inverse</span><span class="p">]</span>
                <span class="n">nondupe_faces</span> <span class="o">=</span> <span class="n">original_unique_counts</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">block_face_connectivity</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">block_face_original_elements</span> <span class="o">=</span> <span class="n">block_face_original_elements</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">]</span>

            <span class="n">node_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">block_face_connectivity</span><span class="p">)</span>
            <span class="n">node_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">node_map</span><span class="p">[</span><span class="n">node_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_indices</span><span class="p">))</span>
            <span class="n">block_face_connectivity</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">[</span><span class="n">block_face_connectivity</span><span class="p">]</span>
            <span class="n">element_block_information</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">block_elem_type</span><span class="p">,</span>
                                              <span class="n">node_indices</span><span class="p">,</span>
                                              <span class="n">block_face_connectivity</span><span class="p">,</span>
                                              <span class="n">block_face_original_elements</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">element_block_information</span></div>

<div class="viewcode-block" id="ExodusInMemory.triangulate_surface_mesh"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.triangulate_surface_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">triangulate_surface_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Triangulate a surface mesh for plotting patches</span>

<span class="sd">        This function generates a triangle mesh for each block in the model if</span>
<span class="sd">        it can.  If there are more than 3 nodes per element in a block, and the</span>
<span class="sd">        triangulation scheme hasn&#39;t been defined in</span>
<span class="sd">        pyexodus.mesh_triangulation_array, it will be skipped.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        triangulated_mesh_info : list</span>
<span class="sd">            A list of tuples containing block id, node_indices, triangulated</span>
<span class="sd">            connectivity, and original block elements</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">triangulated_mesh_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
            <span class="n">surface_mesh_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_block_surface</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">original_elements</span> <span class="ow">in</span> <span class="n">surface_mesh_info</span><span class="p">:</span>
                <span class="n">triangulation_scheme</span> <span class="o">=</span> <span class="n">mesh_triangulation_array</span><span class="p">(</span><span class="n">elem_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">triangulation_scheme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: More than 3 (</span><span class="si">{:}</span><span class="s1">) nodes per element in block </span><span class="si">{:}</span><span class="s1">, this block will not be triangulated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">triangulated_mesh_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="n">original_elements</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">triangulated_mesh_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                         <span class="n">node_indices</span><span class="p">,</span>
                         <span class="n">connectivity</span><span class="p">[:,</span>
                                      <span class="n">triangulation_scheme</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">triangulation_scheme</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">original_elements</span><span class="p">,</span> <span class="n">triangulation_scheme</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">triangulated_mesh_info</span></div></div>

    <span class="c1"># def plot_mesh(self,surface_kwargs={&#39;color&#39;:(0,0,1)},</span>
    <span class="c1">#              bar_kwargs = {&#39;color&#39;:(0,1,0),&#39;tube_radius&#39;:None},</span>
    <span class="c1">#              point_kwargs = {&#39;color&#39;:(1,0,0),&#39;scale_factor&#39;:0.1},</span>
    <span class="c1">#              plot_surfaces = True, plot_bars = True, plot_points = True,</span>
    <span class="c1">#              plot_edges = False):</span>
    <span class="c1">#     &#39;&#39;&#39;Skins, triangulates, and plots a 3D representation of the mesh.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     mesh_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of surface</span>
    <span class="c1">#         patches.</span>
    <span class="c1">#     bar_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of lines (bar,</span>
    <span class="c1">#         beam elements)</span>
    <span class="c1">#     point_kwargs : dict</span>
    <span class="c1">#         A dictionary of keyword arguments for the rendering of points</span>
    <span class="c1">#         (sphere elements)</span>
    <span class="c1">#     show : bool</span>
    <span class="c1">#         A flag to specify whether or not to show the window.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     window : GLViewWidget</span>
    <span class="c1">#         A reference to the view that the 3D content is plotted in.</span>
    <span class="c1">#     meshes : list</span>
    <span class="c1">#         A list of the mesh objects that have been added to the view.</span>

    <span class="c1">#     &#39;&#39;&#39;</span>
    <span class="c1">#     if mlab is None:</span>
    <span class="c1">#         raise ModuleNotFoundError(&#39;Mayavi not installed!&#39;)</span>
    <span class="c1">#     triangulated_mesh_info = self.triangulate_surface_mesh()</span>
    <span class="c1">#     meshes = []</span>
    <span class="c1">#     for block,node_indices,faces,original_elements in triangulated_mesh_info:</span>
    <span class="c1">#         if faces.shape[1] == 3:</span>
    <span class="c1">#             if plot_surfaces:</span>
    <span class="c1">#                 meshes.append(mlab.triangular_mesh(</span>
    <span class="c1">#                         *(self.nodes.coordinates.T[:,node_indices]),faces,</span>
    <span class="c1">#                               **surface_kwargs))</span>
    <span class="c1">#                 if plot_edges:</span>
    <span class="c1">#                     meshes.append(mlab.triangular_mesh(</span>
    <span class="c1">#                         *(self.nodes.coordinates.T[:,node_indices]),faces,</span>
    <span class="c1">#                               representation=&#39;wireframe&#39;,color=(0,0,0)))</span>
    <span class="c1">#         elif faces.shape[1] == 2:</span>
    <span class="c1">#             if plot_bars:</span>
    <span class="c1">#                 line_items = []</span>
    <span class="c1">#                 xs,ys,zs = self.nodes.coordinates.T[:,node_indices][:,faces]</span>
    <span class="c1">#                 for x,y,z in zip(xs,ys,zs):</span>
    <span class="c1">#                     line_items.append(mlab.plot3d(x,y,z,**bar_kwargs))</span>
    <span class="c1">#                 meshes.append(line_items)</span>
    <span class="c1">#         elif faces.shape[1] == 1:</span>
    <span class="c1">#             if plot_points:</span>
    <span class="c1">#                 meshes.append(mlab.points3d(*(self.nodes.coordinates.T[:,node_indices]),</span>
    <span class="c1">#                                             **point_kwargs))</span>
    <span class="c1">#     return meshes</span>

    <span class="c1"># def reduce_to_surfaces(self,*args,**kwargs):</span>
    <span class="c1">#     return reduce_exodus_to_surfaces(self,*args,**kwargs)</span>

    <span class="c1"># def extract_sharp_edges(self,*args,**kwargs):</span>
    <span class="c1">#     return extract_sharp_edges(self, *args,**kwargs)</span>


<div class="viewcode-block" id="reduce_exodus_to_surfaces"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.reduce_exodus_to_surfaces.html#sdynpy.fem.sdynpy_exodus.reduce_exodus_to_surfaces">[docs]</a><span class="k">def</span> <span class="nf">reduce_exodus_to_surfaces</span><span class="p">(</span><span class="n">fexo</span><span class="p">,</span> <span class="n">blocks_to_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variables_to_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_midside_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert exodus finite element models to surface elements</span>

<span class="sd">    This function converts specified volume meshes in an exodus file to surface</span>
<span class="sd">    meshes to ease computational complexity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fexo : ExodusInMemory object or Exodus object</span>
<span class="sd">        fexo should be an in-memory representation of the finite element mesh</span>
<span class="sd">    blocks_to_transform : iterable</span>
<span class="sd">        blocks_to_transform includes all of the blocks that will be included</span>
<span class="sd">        in the output model</span>
<span class="sd">    variables_to_transform : iterable</span>
<span class="sd">        variables_to_transform is a case-insensitive list of all variable names</span>
<span class="sd">        that will be kept in the final model</span>
<span class="sd">    keep_midside_nodes : bool</span>
<span class="sd">        keep_midside_nodes specifies whether or not to transform quadratic</span>
<span class="sd">        elements into linear elements, discarding any non-corner nodes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fexo_out : ExodusInMemory object</span>
<span class="sd">        An equivalent fexo reduced to the surface geometry.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    TO ADD MORE ELEMENT TYPES, we need to define a volume element name that</span>
<span class="sd">    we will find in the exodus file, for example &#39;tetra4&#39; or &#39;hex20&#39;, the</span>
<span class="sd">    number of nodes per face on the element, and a connectivity matrix that</span>
<span class="sd">    specifies how the faces are made from the nodes of the element.  For</span>
<span class="sd">    example a hex8 element has the following structure::</span>

<span class="sd">              8--------------7</span>
<span class="sd">             /|             /|</span>
<span class="sd">            / |            / |</span>
<span class="sd">           /  |           /  |</span>
<span class="sd">          5--------------6   |</span>
<span class="sd">          |   4----------|---3</span>
<span class="sd">          |  /           |  / </span>
<span class="sd">          | /            | /  </span>
<span class="sd">          |/             |/   </span>
<span class="sd">          1--------------2</span>

<span class="sd">    So the 6 faces are as follows::</span>

<span class="sd">       1,2,6,5</span>
<span class="sd">       2,3,7,6</span>
<span class="sd">       3,4,8,7</span>
<span class="sd">       4,1,5,8</span>
<span class="sd">       4,3,2,1</span>
<span class="sd">       5,6,7,8</span>

<span class="sd">    We create the element face connectivity by simply mashing these together</span>
<span class="sd">    one after another like so: 1,2,6,5,2,3,7,6,3,4,8,7,4,1,5,8,4,3,2,1,5,6,7,8</span>
<span class="sd">    We lastly need to specify what we are turning the element into, in this</span>
<span class="sd">    case, quad4.</span>
<span class="sd">    So we add an entry to the reduce_element_types,</span>
<span class="sd">    reduce_element_nodes_per_face, reduce_element_face, and</span>
<span class="sd">    reduce_element_substitute_type variables containing this information</span>
<span class="sd">    hex8::</span>

<span class="sd">        reduce_element_types{4} = &#39;hex8&#39;</span>
<span class="sd">        reduce_element_nodes_per_face{4} = 4</span>
<span class="sd">        reduce_element_face{4} = [1,2,6,5,2,3,7,6,3,4,8,7,4,1,5,8,4,3,2,1,5,6,7,8]</span>
<span class="sd">        reduce_element_substitute_type{4} = &#39;quad4&#39;</span>

<span class="sd">    To see what other elements look like, see page 18 of the exodusII manual:</span>
<span class="sd">    http://prod.sandia.gov/techlib/access-control.cgi/1992/922137.pdf</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fexo</span><span class="p">,</span> <span class="n">Exodus</span><span class="p">):</span>
        <span class="n">exo_in_mem</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exo_in_mem</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If blocks_to_transform is not specified, keep all blocks</span>
    <span class="k">if</span> <span class="n">blocks_to_transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
            <span class="n">blocks_to_transform</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blocks_to_transform</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">()</span>

    <span class="c1"># if variables_to_keep is not specified, keep all variables</span>
    <span class="k">if</span> <span class="n">variables_to_transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">num_node_variables</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">num_elem_variables</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nodal_variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">)</span> <span class="k">if</span> <span class="n">nodal_variable</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables_to_transform</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Need to do extra processing for element variable names because</span>
            <span class="c1"># not all variable names are in all blocks (might be none)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elem_var_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">)):</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">elem_var</span> <span class="ow">in</span> <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">var_name</span> <span class="o">=</span> <span class="n">elem_var</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                            <span class="k">break</span>
                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="n">elem_var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">elem_var_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables_to_transform</span><span class="p">]])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">fexo</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">())</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables_to_transform</span><span class="p">]])</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">node_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">())</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables_to_transform</span><span class="p">]])</span>
            <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
                <span class="n">elem_variables_to_transform</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keeping </span><span class="si">{:}</span><span class="s1"> nodal variables and </span><span class="si">{:}</span><span class="s1"> element variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">node_variables_to_transform</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem_variables_to_transform</span><span class="p">)))</span>

    <span class="c1"># Define element types and what we will do to reduce them</span>
    <span class="n">reduced_element_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reduced_element_nodes_per_face</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reduced_element_face_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reduced_element_substitute_type</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 10-node tetrahedral</span>
    <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tetra10&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep_midside_nodes</span><span class="p">:</span>
        <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                                  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
                                                  <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>
                                                  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tri6&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                                  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                                  <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                                  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tri3&#39;</span><span class="p">)</span>
    <span class="c1"># 4-node tetrahedral</span>
    <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tetra4&#39;</span><span class="p">)</span>
    <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                              <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                              <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tri3&#39;</span><span class="p">)</span>
    <span class="c1"># 20-node hexahedral</span>
    <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hex20&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep_midside_nodes</span><span class="p">:</span>
        <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>
                                                  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span>
                                                  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span>
                                                  <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>
                                                  <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                                                  <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">])</span>
        <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;quad8&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                                  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                                                  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                                                  <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                                  <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                  <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
        <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;quad4&#39;</span><span class="p">)</span>
    <span class="c1"># 8-node hexahedral</span>
    <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hex8&#39;</span><span class="p">)</span>
    <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                              <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                                              <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                              <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                              <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;quad4&#39;</span><span class="p">)</span>
    <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
    <span class="n">reduced_element_nodes_per_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">reduced_element_face_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                              <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                                              <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                                              <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                              <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">reduced_element_substitute_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;quad4&#39;</span><span class="p">)</span>

    <span class="c1"># Keep track of which nodes are used in the final model</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">keep_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">keep_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="c1"># Create the output variable</span>
    <span class="n">fexo_out</span> <span class="o">=</span> <span class="n">ExodusInMemory</span><span class="p">()</span>
    <span class="c1"># Set the same times</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># Since we are just visualizing, eliminate exodus features that we don&#39;t</span>
    <span class="c1"># care about</span>
    <span class="n">fexo_out</span><span class="o">.</span><span class="n">element_map</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fexo_out</span><span class="o">.</span><span class="n">sidesets</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodesets</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">block_inds_to_transform</span> <span class="o">=</span> <span class="p">[(</span><span class="n">block_index</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">block_index</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span> <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">blocks_to_transform</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">block_inds_to_transform</span> <span class="o">=</span> <span class="p">[(</span><span class="n">block_index</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">block_index</span><span class="p">,</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_blk_ids</span><span class="p">())</span> <span class="k">if</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">blocks_to_transform</span><span class="p">]</span>

    <span class="c1"># If the exodus file has element variables, we are only keeping the ones</span>
    <span class="c1"># corresponding to the blocks we are keeping</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">has_elem_vars</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_variables_to_transform</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">has_elem_vars</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">num_elem_variables</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem_variables_to_transform</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="n">has_elem_vars</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">has_elem_vars</span><span class="p">:</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Now we loop through each block to reduce the elements to faces</span>
    <span class="k">for</span> <span class="n">block_index</span><span class="p">,</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">block_inds_to_transform</span><span class="p">:</span>
        <span class="c1"># Determine the element type</span>
        <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
            <span class="n">elem_type</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span><span class="o">.</span><span class="n">elem_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elem_type</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_blk_info</span><span class="p">(</span><span class="n">block_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_connectivity</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analyzing Block </span><span class="si">{}</span><span class="s1">, type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">elem_type</span> <span class="ow">in</span> <span class="n">reduced_element_types</span><span class="p">:</span>
            <span class="n">block_type_ind</span> <span class="o">=</span> <span class="n">reduced_element_types</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem_type</span><span class="p">)</span>
            <span class="c1"># If the element type IS in our list of types to reduce, then we</span>
            <span class="c1"># will reduce to only surface nodes and elements.</span>
            <span class="c1"># Here we are computing all the faces in the block and creating a</span>
            <span class="c1"># face connectivity matrix (nfaces x nnodes per face) from an</span>
            <span class="c1"># element connectivity matrix (nelems x nnodes per element).  It is</span>
            <span class="c1"># a complicated one-liner but boy is it fast.  The basic steps are:</span>
            <span class="c1"># 1. Pass the element reduce_element_face vector in as the column</span>
            <span class="c1"># indices of the element connectivity matrix, which selects the face</span>
            <span class="c1"># nodes of all faces, making each row of the block connectivity</span>
            <span class="c1">#  matrix contain all faces</span>
            <span class="c1"># block.connectivity[:,reduced_element_face_connectivity[block_type_ind]]</span>
            <span class="c1"># 2. Since each row now contains a number of faces, we want to</span>
            <span class="c1"># split it out into each face using the reshape command with the</span>
            <span class="c1"># number of nodes per face.  After we do this, we have a connectivity</span>
            <span class="c1"># matrix where each row is a face of the element and the columns are</span>
            <span class="c1"># the nodes in that face.</span>
            <span class="n">face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[:,</span> <span class="n">reduced_element_face_connectivity</span><span class="p">[</span><span class="n">block_type_ind</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">reduced_element_nodes_per_face</span><span class="p">[</span><span class="n">block_type_ind</span><span class="p">]))</span>
            <span class="c1"># We will create a list that ties each face back to the original</span>
            <span class="c1"># element.  This is used to map the element variables that were</span>
            <span class="c1"># defined for the volume elements to the newly created surface</span>
            <span class="c1"># elements.  Basically this vector will be increasing by 1, with</span>
            <span class="c1"># each number repeated for the number of faces in the element.  For</span>
            <span class="c1"># example if the elements are tet4s with 4 faces per element, the</span>
            <span class="c1"># vector will look like</span>
            <span class="c1"># [0,0,0,0, 1,1,1,1, 2,2,2,2, 3,3,3,3, 4,4,4,4, ... ]</span>
            <span class="n">face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">reduced_element_face_connectivity</span><span class="p">[</span><span class="n">block_type_ind</span><span class="p">])</span> <span class="o">/</span> <span class="n">reduced_element_nodes_per_face</span><span class="p">[</span><span class="n">block_type_ind</span><span class="p">])</span>
            <span class="c1"># To find EXTERIOR faces, we want to look for faces that only exist</span>
            <span class="c1"># once.  If two elements have the same face, then that face is</span>
            <span class="c1"># necessarily on the interior of the block.  Because the ordering</span>
            <span class="c1"># of the nodes is somewhat arbitrary, we first sort the nodes so</span>
            <span class="c1"># they are in ascending order for each face, then we can directly</span>
            <span class="c1"># compare the rows because two rows consisting of the same nodes</span>
            <span class="c1"># will look the same if they are sorted.  This gives us the unique</span>
            <span class="c1"># rows (but we don&#39;t really care about them because they are</span>
            <span class="c1"># sorted, so we ditch the first output argument), the unique row</span>
            <span class="c1"># indices, which is a list of the first time that index appeared</span>
            <span class="c1"># for each unique entry, and a unique row mapping, which is the</span>
            <span class="c1"># location each row in the original face connectivity matrix ends</span>
            <span class="c1"># up in the unique set of rows (see help unique for more info)</span>
            <span class="p">(</span><span class="n">unique_rows</span><span class="p">,</span> <span class="n">unique_row_indices</span><span class="p">,</span> <span class="n">unique_inverse</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                <span class="n">face_connectivity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># We can compute the values that are duplicates by using the optional</span>
            <span class="c1"># output argumenst of unique.  The counts variable will enable us to</span>
            <span class="c1"># see which values were repeated, and the unique_inverse will allow us</span>
            <span class="c1"># to reconstruct the original array from the unique array.</span>
            <span class="n">original_unique_counts</span> <span class="o">=</span> <span class="n">unique_counts</span><span class="p">[</span><span class="n">unique_inverse</span><span class="p">]</span>
            <span class="c1"># The non-duplicated faces are then the ones that only exist once in</span>
            <span class="c1"># the array</span>
            <span class="n">nondupe_faces</span> <span class="o">=</span> <span class="n">original_unique_counts</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="c1"># We then reduce the face connectivity matrix, keeping only the faces</span>
            <span class="c1"># that are not duplicated.</span>
            <span class="n">face_connectivity</span> <span class="o">=</span> <span class="n">face_connectivity</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">,</span> <span class="p">:]</span>
            <span class="c1"># We also reduce our vector that ties the faces back to the original</span>
            <span class="c1"># values to keep it consistent with the face connectivity matrix</span>
            <span class="n">face_original_elements</span> <span class="o">=</span> <span class="n">face_original_elements</span><span class="p">[</span><span class="n">nondupe_faces</span><span class="p">]</span>
            <span class="c1"># Now we need to also reduce the element variables in the same way,</span>
            <span class="c1"># mapping the original elements variables to the faces that correspond</span>
            <span class="c1"># to that element.</span>
            <span class="n">new_elem_type</span> <span class="o">=</span> <span class="n">reduced_element_substitute_type</span><span class="p">[</span><span class="n">block_type_ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we don&#39;t reduce,</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  No Reduction&#39;</span><span class="p">)</span>
            <span class="n">face_connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
            <span class="n">face_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">new_elem_type</span> <span class="o">=</span> <span class="n">elem_type</span>
        <span class="c1"># We then update the connectivity in the block to make it match our new</span>
        <span class="c1"># face connectivity</span>
        <span class="n">blk_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_id</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_connectivity</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_elem_type</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;block_</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">blk_dict</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Converted to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_type&#39;</span><span class="p">]))</span>
        <span class="c1"># The nodes in the block are now all the unique nodes in the face</span>
        <span class="c1"># connectivity matrix, so we make sure to keep those nodes in the final</span>
        <span class="c1"># set of nodes.</span>
        <span class="n">block_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">face_connectivity</span><span class="p">)</span>
        <span class="n">keep_nodes</span><span class="p">[</span><span class="n">block_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Update element variables if necessary</span>
        <span class="k">if</span> <span class="n">has_elem_vars</span><span class="p">:</span>
            <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">var_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
                <span class="c1"># Select the correct variable</span>
                <span class="n">face_elem_vars</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">[[</span><span class="n">var</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fexo</span><span class="o">.</span><span class="n">elem_vars</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">elem_index</span><span class="p">,</span> <span class="n">elem_var_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">face_elem_vars</span><span class="o">.</span><span class="n">elem_var_data</span><span class="p">):</span>
                    <span class="c1"># Check if we need to skip it</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">elem_index</span> <span class="ow">in</span> <span class="n">elem_variables_to_transform</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Skipping Element Variable </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem_index</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="c1"># If the variable doesn&#39;t exist it will be None (for example a</span>
                    <span class="c1"># volume quantity on a surface element).  We only operate if</span>
                    <span class="c1"># the variable exists (is not None)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">elem_var_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># We use the face&#39;s original elements vector to map the</span>
                        <span class="c1"># element data to the face connectivity matrix</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Processing Element Variable </span><span class="si">{:}</span><span class="s1"> for block </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">elem_var_data</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
                        <span class="n">var_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem_var_data</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">face_original_elements</span><span class="p">])</span>
                        <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem_var_data</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Element Variable </span><span class="si">{:}</span><span class="s1"> not defined for block </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">elem_index</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
                        <span class="n">var_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Get the element truth table</span>
                <span class="n">elem_truth_table</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_variable_table</span><span class="p">()</span>
                <span class="c1"># Get the element variable names</span>
                <span class="n">elem_var_names</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_variable_names</span><span class="p">()</span>
                <span class="c1"># Loop through and pick element variables that exist in the truth table</span>
                <span class="k">for</span> <span class="n">elem_index</span><span class="p">,</span> <span class="n">elem_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elem_var_names</span><span class="p">):</span>
                    <span class="c1"># Check if we need to skip it</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">elem_index</span> <span class="ow">in</span> <span class="n">elem_variables_to_transform</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Skipping Element Variable </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem_name</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">elem_truth_table</span><span class="p">[</span><span class="n">block_index</span><span class="p">,</span> <span class="n">elem_index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Element Variable </span><span class="si">{:}</span><span class="s1"> not defined for block </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">elem_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
                        <span class="n">var_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                        <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># We use the face&#39;s original elements vector to map the</span>
                        <span class="c1"># element data to the face connectivity matrix</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Processing Element Variable </span><span class="si">{:}</span><span class="s1"> for block </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">elem_name</span><span class="p">,</span> <span class="n">block_id</span><span class="p">))</span>
                        <span class="n">var_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">get_elem_variable_values</span><span class="p">(</span>
                            <span class="n">block_id</span><span class="p">,</span> <span class="n">elem_index</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">face_original_elements</span><span class="p">])</span>
                        <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem_name</span><span class="p">)</span>
            <span class="c1"># Now add the element variable</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Adding Element Variables to output exodus file&#39;</span><span class="p">)</span>
            <span class="n">blk_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_id</span>
            <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">var_data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elem_var_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="n">elem_var_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="n">blk_dict</span><span class="p">[</span><span class="s1">&#39;elem_var_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">elem_var_dict</span><span class="p">))</span>
            <span class="n">fexo_out</span><span class="o">.</span><span class="n">elem_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">blk_dict</span><span class="p">))</span>

    <span class="c1"># We have reduced the face connectivity, so now we need to reduce the nodes</span>
    <span class="c1"># as well.  We create a node map vector that maps the initial node indices</span>
    <span class="c1"># to the new node indices</span>
    <span class="c1"># i.e. the new_node_index = node_map[old_node_index]</span>
    <span class="c1"># We will need to do this because once we reduce the nodes, we will need to</span>
    <span class="c1"># re-update the element connectivity matrices with the updated node numbers</span>
    <span class="c1"># since the element connectivity matrix refers to the node index, not a</span>
    <span class="c1"># node number.  By eliminating nodes, we are effectively renumbering the</span>
    <span class="c1"># nodes.</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analyzing Nodes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">original_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">))</span> <span class="o">+</span> \
            <span class="mi">1</span> <span class="k">if</span> <span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">original_nodes</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_node_num_map</span><span class="p">()</span>
    <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="o">=</span> <span class="n">original_nodes</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">]</span>
    <span class="n">node_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">keep_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">node_map</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">))</span>
    <span class="c1"># Reduce the nodes, keeping only the ones where keep_nodes is true</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Reducing Coordinates&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()[:,</span> <span class="n">keep_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># We do the same thing to the nodal variables if they exist</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Reducing Nodal Variables&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exo_in_mem</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_variables_to_transform</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node_var_index</span><span class="p">,</span> <span class="n">node_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node_var_index</span> <span class="ow">in</span> <span class="n">node_variables_to_transform</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Skipping Nodal Variable </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_var</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="n">node_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_var</span><span class="o">.</span><span class="n">name</span>
                <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">node_var</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">keep_nodes</span><span class="p">])</span>
                <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_dict</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_variables_to_transform</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">node_vars</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_node_variable_names</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">node_var_index</span><span class="p">,</span> <span class="n">node_var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_vars</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node_var_index</span> <span class="ow">in</span> <span class="n">node_variables_to_transform</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Skipping Nodal Variable </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_var_name</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Variable </span><span class="si">{:}</span><span class="s1">: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_var_index</span><span class="p">,</span> <span class="n">node_var_name</span><span class="p">))</span>
                    <span class="n">node_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_var_name</span>
                    <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fexo_out</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">)))</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fexo_out</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Step </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="n">node_dict</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">get_node_variable_values</span><span class="p">(</span>
                            <span class="n">node_var_index</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">]</span>
                    <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodal_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="p">(</span><span class="o">**</span><span class="n">node_dict</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ExodusError</span><span class="p">:</span>
            <span class="n">fexo_out</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Finally we go through each element block and map the old node indices to</span>
    <span class="c1"># the new node indices</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">fexo_out</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
        <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">]</span>

    <span class="c1"># Return our new fexo</span>
    <span class="k">return</span> <span class="n">fexo_out</span></div>


<div class="viewcode-block" id="extract_sharp_edges"><a class="viewcode-back" href="../../../_autosummary/sdynpy.fem.sdynpy_exodus.extract_sharp_edges.html#sdynpy.fem.sdynpy_exodus.extract_sharp_edges">[docs]</a><span class="k">def</span> <span class="nf">extract_sharp_edges</span><span class="p">(</span><span class="n">exo</span><span class="p">,</span> <span class="n">edge_threshold</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">dot_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">edge_threshold</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">surface_fexo</span> <span class="o">=</span> <span class="n">reduce_exodus_to_surfaces</span><span class="p">(</span><span class="n">exo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">edge_fexo</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">surface_fexo</span><span class="p">)</span>
    <span class="n">keep_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">surface_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">block_ind</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surface_fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span>
        <span class="k">if</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="s1">&#39;bar&#39;</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">elem_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;beam&#39;</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">elem_type</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_ind</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reducing Block </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">edge_connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">connectivity</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">edge_original_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">(</span><span class="n">unique_rows</span><span class="p">,</span> <span class="n">unique_row_indices</span><span class="p">,</span> <span class="n">unique_inverse</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">edge_connectivity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Now we go through each edge and compute the angle between the two original faces</span>
        <span class="n">keep_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">unique_rows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique_rows</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">keep_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find faces that the edges are in</span>
                <span class="n">edge_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">unique_inverse</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">face_indices</span> <span class="o">=</span> <span class="n">edge_original_elements</span><span class="p">[</span><span class="n">edge_indices</span><span class="p">]</span>
                <span class="n">face_connectivities</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span><span class="n">face_indices</span><span class="p">]</span>
                <span class="n">node_coords</span> <span class="o">=</span> <span class="n">surface_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">face_connectivities</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="p">:]</span>
                <span class="n">vectors_a</span> <span class="o">=</span> <span class="n">node_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">node_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">vectors_b</span> <span class="o">=</span> <span class="n">node_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">node_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vectors_a</span><span class="p">,</span> <span class="n">vectors_b</span><span class="p">)</span>
                <span class="n">normals</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="o">*</span><span class="n">normals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dot_threshold</span><span class="p">:</span>
                    <span class="n">keep_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Kept </span><span class="si">{:}</span><span class="s1"> of </span><span class="si">{:}</span><span class="s1"> edges&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keep_edges</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">keep_edges</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">edge_connectivity</span> <span class="o">=</span> <span class="n">unique_rows</span><span class="p">[</span><span class="n">keep_edges</span><span class="p">]</span>
        <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_ind</span><span class="p">]</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">edge_connectivity</span>
        <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_ind</span><span class="p">]</span><span class="o">.</span><span class="n">elem_type</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
        <span class="n">block_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edge_connectivity</span><span class="p">)</span>
        <span class="n">keep_nodes</span><span class="p">[</span><span class="n">block_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">node_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">keep_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">node_map</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">))</span>
    <span class="n">edge_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">edge_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">node_var_index</span><span class="p">,</span> <span class="n">node_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edge_fexo</span><span class="o">.</span><span class="n">nodal_vars</span><span class="p">):</span>
        <span class="n">node_var</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">node_var</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">keep_nodes</span><span class="p">]</span>
    <span class="n">edge_fexo</span><span class="o">.</span><span class="n">elem_vars</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">edge_fexo</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
        <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">]</span>
    <span class="n">edge_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="o">=</span> <span class="n">surface_fexo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span><span class="p">[</span><span class="n">keep_nodes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">edge_fexo</span></div>

<span class="c1">#nc = netCDF4.Dataset(r&#39;Z:\ASRG_GRD_P90_R0_Vel_25_TMat_A36_Steel_HS_Ver_2013_04_17.exo&#39;)</span>
<span class="c1">#nc = netCDF4.Dataset(r&#39;Z:\modal\Wind_Turbine\Blade_FE_Model\blade.exo&#39;)</span>
<span class="c1">#nc = netCDF4.Dataset(r&#39;Z:\modal\Wind_Turbine\Blade_FE_Model\blade-out_test_copy.exo&#39;)</span>
<span class="c1">#nc = netCDF4.Dataset(r&#39;C:\Users\dprohe\Documents\Projects\Other\Barc\IMMAT\FEMs\rcomp_fixture-eig_global.exo&#39;)</span>

<span class="c1">#exo = exodus(r&#39;Z:\ASRG_GRD_P90_R0_Vel_25_TMat_A36_Steel_HS_Ver_2013_04_17.exo&#39;)</span>
<span class="c1">#exo = exodus(r&#39;Z:\modal\Wind_Turbine\Blade_FE_Model\blade-out_test_copy.exo&#39;)</span>
<span class="c1">#exo = exodus(r&#39;Z:\modal\Wind_Turbine\Blade_FE_Model\blade.exo&#39;)</span>
<span class="c1">#exo = exodus(r&#39;C:\Users\dprohe\Documents\Projects\Other\Barc\IMMAT\FEMs\rcomp_fixture-eig_global.exo&#39;)</span>
<span class="c1">#exo = exodus(r&#39;C:\Users\dprohe\Documents\Projects\Test_Problems\salinas_tests\cb_substructure\tuning_fork_block_1.exo&#39;)</span>
<span class="c1"># exo.close()</span>

<span class="c1"># nodes = np.array([[0,0,0],</span>
<span class="c1">#                  [0,0,1],</span>
<span class="c1">#                  [0,1,1],</span>
<span class="c1">#                  [0,1,0],</span>
<span class="c1">#                  [1,0,0],</span>
<span class="c1">#                  [1,0,1],</span>
<span class="c1">#                  [1,1,1],</span>
<span class="c1">#                  [1,1,0],</span>
<span class="c1">#                  [2,0,0],</span>
<span class="c1">#                  [2,0,1],</span>
<span class="c1">#                  [2,1,1],</span>
<span class="c1">#                  [2,1,0],</span>
<span class="c1">#                  [3,0,0],</span>
<span class="c1">#                  [3,0,1],</span>
<span class="c1">#                  [3,1,1],</span>
<span class="c1">#                  [3,1,0],])</span>
<span class="c1">#exo = exodus(&#39;test_exodus_file.exo&#39;,&#39;w&#39;,&#39;Test Exodus File&#39;,3,nodes.shape[0],4,2,0,0,clobber=True)</span>
<span class="c1"># Set up info records</span>
<span class="c1">#qa_records = ((&#39;Hello&#39;,&#39;My&#39;,&#39;Name&#39;,&#39;Is&#39;),(&#39;Dan&#39;,&#39;What &#39;,&#39;IS your name we should be friends!&#39;,&#39;this is a really long string not sure if its 33 characters or not maybe it is but maybe not&#39;))</span>
<span class="c1"># exo.put_qa_records(qa_records)</span>
<span class="c1"># exo.get_qa_records()</span>
<span class="c1"># info_records = (&#39;whats up football football football football football football football football football football&#39;,</span>
<span class="c1">#                &#39;my name is dan&#39;,&#39;hey&#39;)</span>
<span class="c1"># exo.put_info_records(info_records)</span>
<span class="c1"># exo.get_info_records()</span>
<span class="c1"># Set up coordinates</span>
<span class="c1"># exo.put_coord_names((&#39;X&#39;,&#39;Y&#39;,&#39;Z&#39;))</span>
<span class="c1"># exo.get_coord_names()</span>
<span class="c1"># exo.put_coords(nodes.T)</span>
<span class="c1"># Set time steps</span>
<span class="c1"># exo.set_times(np.arange(10))</span>
<span class="c1"># exo.get_times()</span>
<span class="c1"># Add nodal variables</span>
<span class="c1"># exo.put_node_variable_names((&#39;DispX&#39;,&#39;DispY&#39;,&#39;DispZ&#39;))</span>
<span class="c1"># for i,time in enumerate(exo.get_times()):</span>
<span class="c1">#    exo.set_node_variable_values(&#39;DispX&#39;,i,0.1)</span>
<span class="c1">#    exo.set_node_variable_values(&#39;DispZ&#39;,i,0.1)</span>
<span class="c1">#    exo.set_node_variable_values(&#39;DispY&#39;,i,time*0.1)</span>
<span class="c1">#</span>
<span class="c1"># Create element blocks</span>
<span class="c1"># exo.put_elem_blk_ids([2,4])</span>
<span class="c1"># exo.get_elem_blk_ids()</span>
<span class="c1">#</span>
<span class="c1"># Create element block 2</span>
<span class="c1"># exo.put_elem_blk_info(2,&#39;SHELL4&#39;,2,4,0)</span>
<span class="c1"># exo.set_elem_connectivity(2,[[0,1,2,3],</span>
<span class="c1">#                             [8,9,10,11]])</span>
<span class="c1"># Create element block 4</span>
<span class="c1"># exo.put_elem_blk_info(4,&#39;SHELL4&#39;,2,4,0)</span>
<span class="c1"># exo.set_elem_connectivity(4,[[4,5,6,7],</span>
<span class="c1">#                             [12,13,14,15]])</span>
<span class="c1">#</span>
<span class="c1"># Create element variables</span>
<span class="c1"># exo.put_elem_variable_names((&#39;Block_2_Var&#39;,&#39;Block_4_Var&#39;,&#39;BothBlock_Var&#39;),[[1,0,1],[0,1,1]])</span>
<span class="c1"># for i,time in enumerate(exo.get_times()):</span>
<span class="c1">#    exo.set_elem_variable_values(2,&#39;Block_2_Var&#39;,i,time*0.15)</span>
<span class="c1">#    exo.set_elem_variable_values(4,&#39;Block_4_Var&#39;,i,time-1)</span>
<span class="c1">#    exo.set_elem_variable_values(2,&#39;BothBlock_Var&#39;,i,time*0.1)</span>
<span class="c1">#    exo.set_elem_variable_values(4,&#39;BothBlock_Var&#39;,i,time*0.2)</span>


<span class="c1"># print(exo._ncdf_handle)</span>
<span class="c1"># print(sorted(exo._ncdf_handle.dimensions.keys()))</span>
<span class="c1"># print(sorted(exo._ncdf_handle.variables.keys()))</span>

<span class="c1"># exo.close()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,     LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS,     the U.S. Government retains certain rights in this software.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>