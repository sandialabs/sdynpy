<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sdynpy.core.sdynpy_shape &mdash; SDynPy 0.5.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> SDynPy
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">SDynpy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modal_tutorials.html">Modal Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">SDynPy Programming Interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SDynPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sdynpy.core.sdynpy_shape</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sdynpy.core.sdynpy_shape</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Objects and procedures to handle operations on test or model shapes</span>

<span class="sd">Shapes are generally defined as a set of coordinates or degrees of freedom and</span>
<span class="sd">the respective displacements at each of those degrees of freedom.</span>

<span class="sd">Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,</span>
<span class="sd">LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S.</span>
<span class="sd">Government retains certain rights in this software.</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sdynpy_colors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sdynpy_coordinate</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sdynpy_array</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sdynpy_data</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sdynpy_system</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_integration</span> <span class="kn">import</span> <span class="n">integrate_MCK</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_correlation</span> <span class="kn">import</span> <span class="n">mac</span> <span class="k">as</span> <span class="n">mac_corr</span><span class="p">,</span> <span class="n">matrix_plot</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_complex</span> <span class="kn">import</span> <span class="n">collapse_complex_to_real</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_rotation</span> <span class="kn">import</span> <span class="n">unit_magnitude_constraint</span><span class="p">,</span> <span class="n">quaternion_to_rotation_matrix</span>
<span class="kn">from</span> <span class="nn">..fem.sdynpy_exodus</span> <span class="kn">import</span> <span class="n">Exodus</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<div class="viewcode-block" id="ShapeArray"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray">[docs]</a><span class="k">class</span> <span class="nc">ShapeArray</span><span class="p">(</span><span class="n">sdynpy_array</span><span class="o">.</span><span class="n">SdynpyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shape information specifying displacements at nodes.</span>

<span class="sd">    Use the shape_array helper function to create the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ShapeArray.real_data_dtype"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.real_data_dtype">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">real_data_dtype</span><span class="p">(</span><span class="n">ndof</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data type of the underlying numpy structured array for real shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ndof : int</span>
<span class="sd">            Number of degrees of freedom in the shape array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Numpy dtype that can be passed into any of the numpy array</span>
<span class="sd">            constructors</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;damping&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;coordinate&#39;</span><span class="p">,</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">ndof</span><span class="p">,)),</span>
            <span class="p">(</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ndof</span><span class="p">,)),</span>
            <span class="p">(</span><span class="s1">&#39;modal_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment1&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment2&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment3&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment4&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment5&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="ShapeArray.complex_data_dtype"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.complex_data_dtype">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">complex_data_dtype</span><span class="p">(</span><span class="n">ndof</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data type of the underlying numpy structured array for complex shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ndof : int</span>
<span class="sd">            Number of degrees of freedom in the shape array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Numpy dtype that can be passed into any of the numpy array</span>
<span class="sd">            constructors</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;damping&#39;</span><span class="p">,</span> <span class="s1">&#39;complex128&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;coordinate&#39;</span><span class="p">,</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">ndof</span><span class="p">,)),</span>
            <span class="p">(</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;complex128&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ndof</span><span class="p">,)),</span>
            <span class="p">(</span><span class="s1">&#39;modal_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;complex128&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment1&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment2&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment3&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment4&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;comment5&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U80&#39;</span><span class="p">),</span>
        <span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">ndof</span><span class="p">,</span> <span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Create the ndarray instance of our type, given the usual</span>
        <span class="c1"># ndarray input arguments.  This will call the standard</span>
        <span class="c1"># ndarray constructor, but return an object of our type.</span>
        <span class="c1"># It also triggers a call to InfoArray.__array_finalize__</span>
        <span class="c1"># Data Types</span>
        <span class="c1">#    &#39;coordinates&#39;, - This will actually be an attribute</span>
        <span class="c1">#    &#39;shape_matrix&#39;,</span>
        <span class="c1">#    &#39;frequency&#39;,</span>
        <span class="c1">#    &#39;damping&#39;,</span>
        <span class="c1">#    &#39;modal_mass&#39;,</span>
        <span class="c1">#    &#39;comment1&#39;,</span>
        <span class="c1">#    &#39;comment2&#39;,</span>
        <span class="c1">#    &#39;comment3&#39;,</span>
        <span class="c1">#    &#39;comment4&#39;,</span>
        <span class="c1">#    &#39;comment5&#39;,</span>
        <span class="c1">#    &#39;numerator_type&#39;,</span>
        <span class="c1">#    &#39;denominator_type&#39;,</span>
        <span class="c1">#    &#39;load_case_number&#39;,</span>
        <span class="c1">#    &#39;mode_number&#39;,</span>
        <span class="c1">#    &#39;reference_coordinate&#39;,</span>
        <span class="c1">#    &#39;response_coordinate&#39;,</span>
        <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
            <span class="n">data_dtype</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">real_data_dtype</span><span class="p">(</span><span class="n">ndof</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;complex&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;imaginary&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;imag&#39;</span><span class="p">:</span>
            <span class="n">data_dtype</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">complex_data_dtype</span><span class="p">(</span><span class="n">ndof</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ShapeArray</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">data_dtype</span><span class="p">,</span>
                                                 <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span>
                                                 <span class="n">order</span><span class="p">)</span>
        <span class="c1"># Finally, we must return the newly created object:</span>
        <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="ShapeArray.is_complex"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.is_complex">[docs]</a>    <span class="k">def</span> <span class="nf">is_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns true if the shape is a complex shape, False if shape is real</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the shape is complex</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;10s}</span><span class="s1">, </span><span class="si">{:&gt;10s}</span><span class="s1">, </span><span class="si">{:&gt;10s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Damping&#39;</span><span class="p">,</span> <span class="s1">&#39;# DoFs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;----------- Empty -------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;10.4f}</span><span class="s1">, </span><span class="si">{:&gt;9.4f}</span><span class="s1">%, </span><span class="si">{:&gt;10d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">string_out</span>

    <span class="c1"># def __getattribute__(self,attr):</span>
    <span class="c1">#     return_obj = np.recarray.__getattribute__(self,attr)</span>
    <span class="c1">#     if attr == &#39;coordinate&#39;:</span>
    <span class="c1">#         return return_obj.view(sdynpy_coordinate.CoordinateArray)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return return_obj</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">:</span>
            <span class="c1"># Get the coordinate array</span>
            <span class="n">coordinate_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span>
            <span class="n">single_shape_coordinate_array</span> <span class="o">=</span> <span class="n">coordinate_array</span><span class="p">[(</span>
                <span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">coordinate_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)]</span>
            <span class="c1"># Now check if the coordinates are consistent across the arrays</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">coordinate_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">single_shape_coordinate_array</span><span class="p">)):</span>
                <span class="c1"># If they aren&#39;t, raise a value error</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Shape array must have equivalent coordinates for all shapes to index by coordinate&#39;</span><span class="p">)</span>
            <span class="c1"># Otherwise we will do an intersection</span>
            <span class="n">consistent_arrays</span><span class="p">,</span> <span class="n">shape_indices</span><span class="p">,</span> <span class="n">request_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">single_shape_coordinate_array</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Make sure that all of the keys are actually in the consistent array matrix</span>
            <span class="k">if</span> <span class="n">consistent_arrays</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">key</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">extra_keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">single_shape_coordinate_array</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">extra_keys</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Duplicate coordinate values requested.  Please ensure coordinate indices are unique.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Not all indices in requested coordinate array exist in the shape</span><span class="se">\n</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)))</span>
            <span class="c1"># Handle sign flipping</span>
            <span class="n">multiplications</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">request_indices</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">single_shape_coordinate_array</span><span class="p">[</span><span class="n">shape_indices</span><span class="p">]</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">shape_indices</span><span class="p">]</span> <span class="o">*</span> <span class="n">multiplications</span>
            <span class="c1"># Invert the indices to return the dofs in the correct order as specified in keys</span>
            <span class="n">inverse_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">request_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">inverse_indices</span><span class="p">[</span><span class="n">request_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">request_indices</span><span class="p">))</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">inverse_indices</span><span class="p">]</span>
            <span class="c1"># Reshape to the original coordinate array shape</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="n">return_value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">return_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;coordinate&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">this</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ShapeArray</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">shape_matrix</span>
        <span class="n">this</span><span class="o">.</span><span class="n">shape_matrix</span> <span class="o">*=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">this</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ndof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of degrees of freedom in the shape&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># @property</span>
    <span class="c1"># def U(self):</span>
    <span class="c1">#     if self.shape_matrix.ndim &gt; 1:</span>
    <span class="c1">#         return self.shape_matrix.swapaxes(-2,-1)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return self.shape_matrix[:,np.newaxis]</span>

    <span class="c1"># @U.setter</span>
    <span class="c1"># def U(self,value):</span>
    <span class="c1">#     raise AttributeError(&#39;Cannot set the U attribute directly.  Set the shape_matrix parameter instead&#39;)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modeshape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The mode shape matrix with degrees of freedom as second to last axis&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="nd">@modeshape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">modeshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ShapeArray.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.from_unv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="n">unv_data_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load ShapeArrays from universal file data from read_unv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_data_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>
<span class="sd">        combine : bool, optional</span>
<span class="sd">            If True, return as a single ShapeArray</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if an unknown data characteristic is provided</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_arrays : ShapeArray</span>
<span class="sd">            Shapes read from unv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">unv_data_dict</span><span class="p">[</span><span class="mi">55</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ShapeArray</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">node_data_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data_characteristic</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span>
                    <span class="n">nodes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data_characteristic</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span>
                    <span class="n">nodes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot handle shapes besides 3Dof and 6Dof&#39;</span><span class="p">)</span>
            <span class="n">data_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_data_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">this_shape</span> <span class="o">=</span> <span class="n">shape_array</span><span class="p">(</span>
                <span class="n">coordinate</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                <span class="n">shape_matrix</span><span class="o">=</span><span class="n">data_matrix</span><span class="p">,</span>
                <span class="n">frequency</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                <span class="n">damping</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">modal_viscous_damping</span><span class="p">,</span>
                <span class="n">modal_mass</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">,</span>
                <span class="n">comment1</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">idline1</span><span class="p">,</span>
                <span class="n">comment2</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">idline2</span><span class="p">,</span>
                <span class="n">comment3</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">idline3</span><span class="p">,</span>
                <span class="n">comment4</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">idline4</span><span class="p">,</span>
                <span class="n">comment5</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">idline5</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">output_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">output_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">output_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">output_arrays</span></div>

    <span class="n">from_uff</span> <span class="o">=</span> <span class="n">from_unv</span>

    <span class="c1"># @classmethod</span>
    <span class="c1"># def from_exodus(cls,exo,x_disp = &#39;DispX&#39;,y_disp = &#39;DispY&#39;,z_disp = &#39;DispZ&#39;,timesteps = None):</span>
    <span class="c1">#     if isinstance(exo,Exodus):</span>
    <span class="c1">#         exo = exo.load_into_memory(close=False,variables = [x_disp,y_disp,z_disp],timesteps = None, blocks=[])</span>
    <span class="c1">#     node_ids = np.arange(exo.nodes.coordinates.shape[0])+1 if exo.nodes.node_num_map is None else exo.nodes.node_num_map</span>
    <span class="c1">#     x_var = [var for var in exo.nodal_vars if var.name.lower() == x_disp.lower()][0].data[slice(timesteps) if timesteps is None else timesteps]</span>
    <span class="c1">#     y_var = [var for var in exo.nodal_vars if var.name.lower() == y_disp.lower()][0].data[slice(timesteps) if timesteps is None else timesteps]</span>
    <span class="c1">#     z_var = [var for var in exo.nodal_vars if var.name.lower() == z_disp.lower()][0].data[slice(timesteps) if timesteps is None else timesteps]</span>
    <span class="c1">#     frequencies = exo.time[slice(timesteps) if timesteps is None else timesteps]</span>
    <span class="c1">#     shape_matrix = np.concatenate((x_var,y_var,z_var),axis=-1)</span>
    <span class="c1">#     coordinates = sdynpy_coordinate.coordinate_array(node_ids,np.array((1,2,3))[:,np.newaxis]).flatten()</span>
    <span class="c1">#     return shape_array(coordinates,shape_matrix,frequencies)</span>

<div class="viewcode-block" id="ShapeArray.from_exodus"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.from_exodus">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_exodus</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">exo</span><span class="p">,</span> <span class="n">x_disp</span><span class="o">=</span><span class="s1">&#39;DispX&#39;</span><span class="p">,</span> <span class="n">y_disp</span><span class="o">=</span><span class="s1">&#39;DispY&#39;</span><span class="p">,</span> <span class="n">z_disp</span><span class="o">=</span><span class="s1">&#39;DispZ&#39;</span><span class="p">,</span> <span class="n">x_rot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_rot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_rot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads shape data from displacements in an Exodus file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exo : Exodus or ExodusInMemory</span>
<span class="sd">            The exodus data from which geometry will be created.</span>
<span class="sd">        x_disp : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the X-direction displacement should be read. The default is &#39;DispX&#39;.</span>
<span class="sd">            Specify `None` if no x_disp is to be read.</span>
<span class="sd">        y_disp : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the Y-direction displacement should be read. The default is &#39;DispY&#39;.</span>
<span class="sd">            Specify `None` if no y_disp is to be read.</span>
<span class="sd">        z_disp : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the Z-direction displacement should be read. The default is &#39;DispZ&#39;.</span>
<span class="sd">            Specify `None` if no z_disp is to be read.</span>
<span class="sd">        x_rot : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the X-direction rotation should be read. The default is `None` which</span>
<span class="sd">            results in the X-direction rotation not being read. Typically this</span>
<span class="sd">            would be set to &#39;RotX&#39; if rotational values are desired.</span>
<span class="sd">        y_rot : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the Y-direction rotation should be read. The default is `None` which</span>
<span class="sd">            results in the Y-direction rotation not being read. Typically this</span>
<span class="sd">            would be set to &#39;RotY&#39; if rotational values are desired.</span>
<span class="sd">        z_rot : str, optional</span>
<span class="sd">            String denoting the nodal variable in the exodus file from which</span>
<span class="sd">            the Z-direction rotation should be read. The default is `None` which</span>
<span class="sd">            results in the Z-direction rotation not being read. Typically this</span>
<span class="sd">            would be set to &#39;RotZ&#39; if rotational values are desired.    </span>
<span class="sd">        timesteps : iterable, optional</span>
<span class="sd">            A list of timesteps from which data should be read. The default is</span>
<span class="sd">            `None`, which reads all timesteps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            Shape data from the exodus file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exo</span><span class="p">,</span> <span class="n">Exodus</span><span class="p">):</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x_disp</span><span class="p">,</span> <span class="n">y_disp</span><span class="p">,</span> <span class="n">z_disp</span><span class="p">,</span> <span class="n">x_rot</span><span class="p">,</span> <span class="n">y_rot</span><span class="p">,</span> <span class="n">z_rot</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">exo</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">load_into_memory</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span>

        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
            <span class="p">[</span><span class="n">exo</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timesteps</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">coord_nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_disp</span><span class="p">,</span> <span class="n">y_disp</span><span class="p">,</span> <span class="n">z_disp</span><span class="p">,</span> <span class="n">x_rot</span><span class="p">,</span> <span class="n">y_rot</span><span class="p">,</span> <span class="n">z_rot</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodal_vars</span> <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">variable</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span>
                <span class="p">)][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timesteps</span><span class="p">]</span>
                <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">coord_nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_nums</span><span class="p">,</span> <span class="p">[</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timesteps</span><span class="p">]</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span>
            <span class="n">node_ids</span><span class="p">,</span> <span class="n">coord_nums</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.from_imat_struct"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.from_imat_struct">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_imat_struct</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">imat_shp_struct</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a ShapeArray from an imat_shp class saved to a Matlab structure</span>

<span class="sd">        In IMAT, a structure can be created from an `imat_shp` by using the get()</span>
<span class="sd">        function.  This can then be saved to a .mat file and loaded using</span>
<span class="sd">        `scipy.io.loadmat`.  The output from loadmat can be passed into this function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imat_fem_struct : np.ndarray</span>
<span class="sd">            structure from loadmat containing data from an imat_shp</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            ShapeArray constructed from the data in the imat structure</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">frequency</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">doftype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;DOFType&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">doftype</span> <span class="o">=</span> <span class="n">doftype</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">doftype</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">directions</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
            <span class="n">doftype</span> <span class="o">==</span> <span class="s1">&#39;3DOF&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">directions</span> <span class="o">=</span> <span class="n">directions</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span>
                                                                     <span class="n">directions</span>
                                                                     <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">frequency</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;Shape&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">frequency</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">comment_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;IDLine1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">comment_1</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comment_1</span> <span class="o">=</span> <span class="n">comment_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">comment_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comment_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comment_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
        <span class="n">comment_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;IDLine2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">comment_2</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comment_2</span> <span class="o">=</span> <span class="n">comment_1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">comment_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comment_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comment_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
        <span class="n">comment_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;IDLine3&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">comment_3</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comment_3</span> <span class="o">=</span> <span class="n">comment_3</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">comment_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comment_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comment_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
        <span class="n">comment_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;IDLine4&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">comment_4</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comment_4</span> <span class="o">=</span> <span class="n">comment_4</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">comment_4</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comment_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comment_4</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
        <span class="n">comment_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;IDLine5&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">comment_5</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">comment_5</span> <span class="o">=</span> <span class="n">comment_5</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">comment_5</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comment_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">comment_5</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
        <span class="n">modal_mass</span> <span class="o">=</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;ModalMassReal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
            <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isrealobj</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;ModalMassImag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">damping</span> <span class="o">=</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;Damping&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isrealobj</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;ModalDampingReal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imat_shp_struct</span><span class="p">[</span><span class="s1">&#39;ModalDampingImag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">damping</span><span class="p">,</span> <span class="n">modal_mass</span><span class="p">,</span>
                           <span class="n">comment_1</span><span class="p">,</span> <span class="n">comment_2</span><span class="p">,</span> <span class="n">comment_3</span><span class="p">,</span> <span class="n">comment_4</span><span class="p">,</span> <span class="n">comment_5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.compute_frf"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.compute_frf">[docs]</a>    <span class="k">def</span> <span class="nf">compute_frf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">displacement_derivative</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes FRFs from shape data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frequencies : iterable</span>
<span class="sd">            A list of frequencies to compute the FRF at.</span>
<span class="sd">        responses : CoordinateArray, optional</span>
<span class="sd">            Degrees of freedom to use as responses. The default is to compute</span>
<span class="sd">            FRFs at all degrees of freedom in the shape.</span>
<span class="sd">        references : CoordinateArray, optional</span>
<span class="sd">            Degrees of freedom to use as references.  The default is to compute</span>
<span class="sd">            FRFs using the response degrees of freedom also as references.</span>
<span class="sd">        displacement_derivative : int, optional</span>
<span class="sd">            The derivative to use when computing the FRFs.  0 corresponds to</span>
<span class="sd">            displacement FRFs, 1 corresponds to velocity, and 2 corresponds to</span>
<span class="sd">            acceleration. The default is 2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_data : TransferFunctionArray</span>
<span class="sd">            A transfer function array containing the specified references and</span>
<span class="sd">            responses.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flat_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_coords</span> <span class="o">=</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">coordinate</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">all_coords</span><span class="o">.</span><span class="n">ndim</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">responses</span> <span class="o">=</span> <span class="n">all_coords</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">references</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">references</span> <span class="o">=</span> <span class="n">responses</span>
        <span class="n">response_shape_matrix</span> <span class="o">=</span> <span class="n">flat_self</span><span class="p">[</span><span class="n">responses</span><span class="p">]</span>
        <span class="n">reference_shape_matrix</span> <span class="o">=</span> <span class="n">flat_self</span><span class="p">[</span><span class="n">references</span><span class="p">]</span>
        <span class="n">w_bc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c1"># frequencies along axis 1</span>
        <span class="n">wn_bc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c1"># Each mode along axis 0</span>
        <span class="n">zn_bc</span> <span class="o">=</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">damping</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">output_shapes</span> <span class="o">=</span> <span class="n">response_shape_matrix</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c1"># Put mode in axis 0 and dof in axis 2</span>
        <span class="n">input_shapes</span> <span class="o">=</span> <span class="n">reference_shape_matrix</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Put mode in axis 0 and dof in axis 3</span>

        <span class="c1"># Simply use the FRF Accelerance equation</span>
        <span class="n">H_4D</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">w_bc</span><span class="p">)</span><span class="o">**</span><span class="n">displacement_derivative</span><span class="p">)</span> <span class="o">*</span> <span class="n">output_shapes</span> <span class="o">*</span> \
            <span class="n">input_shapes</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">wn_bc</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">w_bc</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">zn_bc</span> <span class="o">*</span> <span class="n">w_bc</span> <span class="o">*</span> <span class="n">wn_bc</span><span class="p">))</span>

        <span class="c1"># Now sum over all modes (axis 0)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">H_4D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Now package into a sdynpy array</span>
        <span class="n">output_data</span> <span class="o">=</span> <span class="n">sdynpy_data</span><span class="o">.</span><span class="n">data_array</span><span class="p">(</span><span class="n">sdynpy_data</span><span class="o">.</span><span class="n">FunctionTypes</span><span class="o">.</span><span class="n">FREQUENCY_RESPONSE_FUNCTION</span><span class="p">,</span>
                                             <span class="n">frequencies</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">responses</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">references</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">output_data</span></div>

<div class="viewcode-block" id="ShapeArray.reduce"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodelist_or_coordinate_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the shape to the degrees of freedom specified</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodelist_or_coordinate_array : iterable or CoordinateArray</span>
<span class="sd">            Consists of either a list of node ids or a CoordinateArray.  The </span>
<span class="sd">            ShapeArray will be reduced to only the degrees of freedom specified</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            A reduced ShapeArray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodelist_or_coordinate_array</span><span class="p">,</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">):</span>
            <span class="n">coord_array</span> <span class="o">=</span> <span class="n">nodelist_or_coordinate_array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coord_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
            <span class="n">coord_array</span> <span class="o">=</span> <span class="n">coord_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coord_array</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">nodelist_or_coordinate_array</span><span class="p">)]</span>
        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">coord_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coord_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">shape_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.repack"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.repack">[docs]</a>    <span class="k">def</span> <span class="nf">repack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates new shapes by linearly combining existing shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coefficients : np.ndarray</span>
<span class="sd">            coefficient matrix that will be multiplied by the shapes.  This</span>
<span class="sd">            should have number of rows equal to the number of shapes that are</span>
<span class="sd">            going to be combined.  The number of columns will specify the</span>
<span class="sd">            number of shapes that will result</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            ShapeArray consisting of linear combinations of the original</span>
<span class="sd">            ShapeArray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">coefficients</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">new_shape</span><span class="o">.</span><span class="n">T</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.expand"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_geometry</span><span class="p">,</span> <span class="n">expansion_geometry</span><span class="p">,</span> <span class="n">expansion_shapes</span><span class="p">,</span>
               <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expansion_coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_coefficients</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform SEREP expansion on shape data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        initial_geometry : Geometry</span>
<span class="sd">            The initial or &quot;Test&quot; Geometry, corresponding to the initial</span>
<span class="sd">            shapes (self)</span>
<span class="sd">        expansion_geometry : Geometry</span>
<span class="sd">            The expanded or &quot;FEM&quot; Geometry, corresponding to the shapes that</span>
<span class="sd">            will be expanded</span>
<span class="sd">        expansion_shapes : ShapeArray</span>
<span class="sd">            Shapes defined on the expanded geometry, which will be used</span>
<span class="sd">            to expand the initial shapes</span>
<span class="sd">        node_id_map : id_map, optional</span>
<span class="sd">            If the initial and expanded geometry or shapes do not have common</span>
<span class="sd">            node ids, an id_map can be specified to map the finite element</span>
<span class="sd">            node ids to test node ids.  The default is None, which means no</span>
<span class="sd">            mapping will occur, and the shapes have common id numbers.</span>
<span class="sd">        expansion_coordinates : CoordinateArray, optional</span>
<span class="sd">            Degrees of freedom in the test shapes to use in the expansion.  The</span>
<span class="sd">            default is None, which results in all degrees of freedom being used</span>
<span class="sd">            for expansion</span>
<span class="sd">        return_coefficients : bool, optional</span>
<span class="sd">            If True, the coefficients used in the expansion will be returned</span>
<span class="sd">            along with the expanded shapes.  The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            The original shapes expanded to the expansion_geometry</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The coefficients used to perform the expansion, only returned if</span>
<span class="sd">            return_coefficients is True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expansion_shape_in_original_basis</span> <span class="o">=</span> <span class="n">expansion_shapes</span><span class="o">.</span><span class="n">transform_coordinate_system</span><span class="p">(</span>
            <span class="n">expansion_geometry</span><span class="p">,</span> <span class="n">initial_geometry</span><span class="p">,</span> <span class="n">node_id_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expansion_coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expansion_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">,</span> <span class="n">expansion_shape_in_original_basis</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">expansion_shape_matrix</span> <span class="o">=</span> <span class="n">expansion_shape_in_original_basis</span><span class="p">[</span><span class="n">expansion_coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">original_shape_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">expansion_coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">expansion_shape_matrix</span><span class="p">,</span> <span class="n">original_shape_matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">expanded_shapes</span> <span class="o">=</span> <span class="n">expansion_shapes</span><span class="o">.</span><span class="n">repack</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">modal_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_mass</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">comment1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment1</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">comment2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment2</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">comment3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment3</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">comment4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment4</span>
        <span class="n">expanded_shapes</span><span class="o">.</span><span class="n">comment5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment5</span>
        <span class="k">if</span> <span class="n">return_coefficients</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expanded_shapes</span><span class="p">,</span> <span class="n">coefficients</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expanded_shapes</span></div>

<div class="viewcode-block" id="ShapeArray.transform_coordinate_system"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.transform_coordinate_system">[docs]</a>    <span class="k">def</span> <span class="nf">transform_coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_geometry</span><span class="p">,</span> <span class="n">new_geometry</span><span class="p">,</span> <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs coordinate system transformations on the shape</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        original_geometry : Geometry</span>
<span class="sd">            The Geometry in which the shapes are currently defined</span>
<span class="sd">        new_geometry : Geometry</span>
<span class="sd">            The Geometry in which the shapes are desired to be defined</span>
<span class="sd">        node_id_map : id_map, optional</span>
<span class="sd">            If the original and new geometries do not have common</span>
<span class="sd">            node ids, an id_map can be specified to map the original geometry</span>
<span class="sd">            node ids to new geometry node ids.  The default is None, which means no</span>
<span class="sd">            mapping will occur, and the geometries have common id numbers.</span>
<span class="sd">        rotations : bool, optional</span>
<span class="sd">            If True, also transform rotational degrees of freedom. The default</span>
<span class="sd">            is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            A ShapeArray that can now be plotted with the new geometry</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_id_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">original_geometry</span> <span class="o">=</span> <span class="n">original_geometry</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">from_ids</span><span class="p">)</span>
            <span class="n">original_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="n">original_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">node_id_map</span><span class="o">.</span><span class="n">from_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">common_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">original_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">))</span>
        <span class="n">original_coordinate_systems</span> <span class="o">=</span> <span class="n">original_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
            <span class="n">original_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">common_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="n">new_coordinate_systems</span> <span class="o">=</span> <span class="n">new_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
            <span class="n">new_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">common_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span>
            <span class="n">common_nodes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="n">rotations</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">*</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">transform_from_original</span> <span class="o">=</span> <span class="n">original_coordinate_systems</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">transform_to_new</span> <span class="o">=</span> <span class="n">new_coordinate_systems</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rotations</span><span class="p">:</span>
            <span class="c1"># If we are doing rotations, we need to do a block diagonal for translations and rotations</span>
            <span class="n">transform_from_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">transform_from_original</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="n">transform_from_original</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">transform_from_original</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                               <span class="n">transform_from_original</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">transform_to_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">transform_to_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">transform_to_new</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">transform_to_new</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">transform_to_new</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nij,nkj,...nk-&gt;...ni&#39;</span><span class="p">,</span> <span class="n">transform_to_new</span><span class="p">,</span>
                                     <span class="n">transform_from_original</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">new_shape_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.plot_frequency"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.plot_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">plot_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interp_abscissa</span><span class="p">,</span> <span class="n">interp_ordinate</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the frequencies of the shapes on curves of a 2D plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interp_abscissa : np.ndarray</span>
<span class="sd">            The abscissa used to interpolate the Y-position of the frequency</span>
<span class="sd">            mark</span>
<span class="sd">        interp_ordinate : np.ndarray</span>
<span class="sd">            The ordinate used to interpolate the Y-postiion of the frequency</span>
<span class="sd">            mark</span>
<span class="sd">        ax : matplotlib axes, optional</span>
<span class="sd">            Axes on which to plot the frequency marks. The default is None,</span>
<span class="sd">            which creates a new window</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Additional arguments to pass to the matplotlib plot command. The</span>
<span class="sd">            default is {&#39;color&#39;:&#39;k&#39;,&#39;marker&#39;:&#39;x&#39;,&#39;linestyle&#39;:&quot;None&quot;}.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib axes, optional</span>
<span class="sd">            Axes on which the frequency marks were plotted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">interp_abscissa</span><span class="p">,</span> <span class="n">interp_ordinate</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ys</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="ShapeArray.to_real"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.to_real">[docs]</a>    <span class="k">def</span> <span class="nf">to_real</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates real shapes from complex shapes by collapsing the complexity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : various</span>
<span class="sd">            Extra arguments to pass to collapse_complex_to_real</span>
<span class="sd">        **kwargs : various</span>
<span class="sd">            Extra arguments to pass to collapse_complex_to_real</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            Real shapes created from the original complex shapes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">collapse_complex_to_real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">,</span> <span class="n">matrix</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">modal_mass</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.write_to_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.write_to_unv">[docs]</a>    <span class="k">def</span> <span class="nf">write_to_unv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">specific_data_type</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">load_case_number</span><span class="o">=</span><span class="mi">0</span>
                     <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes shape data to a unverisal file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename to which the geometry will be written.  If None, </span>
<span class="sd">            unv data will be returned instead, similar to that</span>
<span class="sd">            obtained from the readunv function in sdynpy</span>
<span class="sd">        specific_data_type : int, optional</span>
<span class="sd">            Integer specifying the type of data in the shape. The default is 12,</span>
<span class="sd">            which denotes acceleration shapes.</span>
<span class="sd">        load_case_number : int, optional</span>
<span class="sd">            The load case number. The default is 0.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Raised if complex numbers are used as they are not implemented yet</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        shape_unv : List</span>
<span class="sd">            A list of Sdynpy_UFF_Dataset_55 objects, only if filename is None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..fileio.sdynpy_uff</span> <span class="kn">import</span> <span class="n">dataset_55</span>
        <span class="c1"># First check if any rotations are in the shape</span>
        <span class="n">is_six_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">is_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_six_dof</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">full_coord_array</span> <span class="o">=</span> <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span><span class="n">nodes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">directions</span><span class="p">)</span>
        <span class="n">flat_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">full_coord_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_matrix</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">full_coord_array</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shape_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_self</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># This means it&#39;s a uniaxial sensor and no triaxial dofs exist so we&#39;ll leave it at zero</span>
        <span class="c1"># Go through shapes and create the unv structures</span>
        <span class="n">shape_unv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="c1"># Create node dictionary</span>
            <span class="n">node_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="p">:</span> <span class="n">node_shape_matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                         <span class="k">for</span> <span class="n">node_coords</span><span class="p">,</span> <span class="n">node_shape_matrix</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">full_coord_array</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="p">)}</span>
            <span class="c1"># Create the integer data</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="p">[</span><span class="n">load_case_number</span><span class="p">,</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Create the real data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_complex</span><span class="p">:</span>
                <span class="n">reals</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">modal_mass</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="mf">1e-8</span> <span class="o">&lt;</span> <span class="n">shape</span><span class="o">.</span><span class="n">modal_mass</span><span class="o">.</span><span class="n">imag</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;I don&#39;t know what modal mass is for a complex mode&quot;</span><span class="p">)</span>
                <span class="n">reals</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">shape</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>  <span class="c1"># Real part of eigenvalue</span>
                         <span class="c1"># Imaginary part of eigenvalue</span>
                         <span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">shape</span><span class="o">.</span><span class="n">damping</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                         <span class="n">shape</span><span class="o">.</span><span class="n">modal_mass</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>  <span class="c1"># Real modal mass</span>
                         <span class="n">shape</span><span class="o">.</span><span class="n">modal_mass</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>  <span class="c1"># Imaginary modal mass</span>
                         <span class="mf">0.0</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">,</span>
                         <span class="p">]</span>  <span class="c1"># I don&#39;t actually know what modal a and modal b are...</span>
            <span class="n">shape_unv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_55</span><span class="o">.</span><span class="n">Sdynpy_UFF_Dataset_55</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment5</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">is_complex</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">is_six_dof</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span> <span class="n">specific_data_type</span><span class="p">,</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">is_complex</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">ints</span><span class="p">,</span> <span class="n">reals</span><span class="p">,</span> <span class="n">node_dict</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shape_unv</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">shape_unv</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    55</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">write_string</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.concatenate_dofs"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.concatenate_dofs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">concatenate_dofs</span><span class="p">(</span><span class="n">shape_arrays</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines the degrees of freedom from multiple shapes into one set of</span>
<span class="sd">        shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shape_arrays : list of ShapeArray</span>
<span class="sd">            List of ShapeArray objects to combine in to one set of shapes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapeArray</span>
<span class="sd">            ShapeArray object containing degrees of freedom from all input shapes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dof_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_arrays</span><span class="p">]</span>
        <span class="n">shape_matrices</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape_arrays</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dofs</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dofs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dof_lists</span><span class="p">)]</span>

        <span class="n">all_dofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dof_lists</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">all_shape_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">shape_matrices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create new shapes</span>
        <span class="k">return</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">all_dofs</span><span class="p">,</span> <span class="n">all_shape_matrices</span><span class="p">,</span> <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                           <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">,</span>
                           <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span> <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span>
                           <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span> <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span>
                           <span class="n">shape_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.overlay_shapes"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.overlay_shapes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">overlay_shapes</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">color_override</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines several shapes and geometries for comparitive visualization</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometries : Iterable of Geometry</span>
<span class="sd">            A list of Geometry objects that will be combined into a single</span>
<span class="sd">            Geometry</span>
<span class="sd">        shapes : Iterable of ShapeArray</span>
<span class="sd">            A list of ShapeArray objects that will be combined into a single</span>
<span class="sd">            ShapeArray</span>
<span class="sd">        color_override : iterable, optional</span>
<span class="sd">            An iterble of integers specifying colors, which will override the</span>
<span class="sd">            existing geometry colors.  This should have the same length as the </span>
<span class="sd">            `geometries` input.  The default is None, which keeps the original</span>
<span class="sd">            geometry colors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_geometry : Geometry</span>
<span class="sd">            A geometry consisting of a combination of the specified geometries</span>
<span class="sd">        new_shape : ShapeArray</span>
<span class="sd">            A ShapeArray consisting of a combination of the specified ShapeArrays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.sdynpy_geometry</span> <span class="kn">import</span> <span class="n">Geometry</span>
        <span class="n">new_geometry</span><span class="p">,</span> <span class="n">node_offset</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">overlay_geometries</span><span class="p">(</span>
            <span class="n">geometries</span><span class="p">,</span> <span class="n">color_override</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">new_shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_shapes</span><span class="p">)):</span>
            <span class="n">new_shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">+=</span> <span class="n">node_offset</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">concatenate_dofs</span><span class="p">(</span><span class="n">new_shapes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_geometry</span><span class="p">,</span> <span class="n">new_shape</span></div>

<div class="viewcode-block" id="ShapeArray.time_integrate"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.time_integrate">[docs]</a>    <span class="k">def</span> <span class="nf">time_integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forces</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">displacement_derivative</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrate equations of motion created from shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forces : np.ndarray</span>
<span class="sd">            Input force provided to the shapes, with number of rows equal to</span>
<span class="sd">            the number of references, and number of columns equal to the number</span>
<span class="sd">            of time steps in the simulation.</span>
<span class="sd">        dt : float</span>
<span class="sd">            Time increment for the integration.  For accuracy, this is generally</span>
<span class="sd">            about 10x higher than the bandwidth of interest</span>
<span class="sd">        responses : CoordinateArray, optional</span>
<span class="sd">            Degrees of freedom to get response measurements. The default is None,</span>
<span class="sd">            which returns modal responses.</span>
<span class="sd">        references : CoordinateArray, optional</span>
<span class="sd">            Degrees of freedom at which to apply forces. The default is None,</span>
<span class="sd">            which means the input forces are treated as modal forces</span>
<span class="sd">        displacement_derivative : int, optional</span>
<span class="sd">            The derivative to use for the responses.  0 corresponds to</span>
<span class="sd">            displacement, 1 corresponds to velocity, and 2 corresponds to</span>
<span class="sd">            acceleration. The default is 2.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Complex shapes are not currently implemented</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response_array : TimeHistoryArray</span>
<span class="sd">            Input forces assembled into a TimeHistoryArray.</span>
<span class="sd">        reference_array : TimeHistoryArray</span>
<span class="sd">            Responses assembled into a TimeHistoryArray.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_complex</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Complex Modes not Implemented&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flat_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">)</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">modal_mass</span> <span class="o">*</span> <span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">modal_mass</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span>
                        <span class="n">flat_self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">flat_self</span><span class="o">.</span><span class="n">damping</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">phi_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phi_out</span> <span class="o">=</span> <span class="n">flat_self</span><span class="p">[</span><span class="n">responses</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="k">if</span> <span class="n">references</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">phi_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phi_in</span> <span class="o">=</span> <span class="n">flat_self</span><span class="p">[</span><span class="n">references</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">modal_forces</span> <span class="o">=</span> <span class="n">phi_in</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">forces</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">forces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">forces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">modal_response</span> <span class="o">=</span> <span class="n">integrate_MCK</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">modal_forces</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span>
                <span class="n">displacement_derivative</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">phi_out</span> <span class="o">@</span> <span class="n">modal_response</span>
            <span class="n">response_array</span> <span class="o">=</span> <span class="n">sdynpy_data</span><span class="o">.</span><span class="n">data_array</span><span class="p">(</span><span class="n">sdynpy_data</span><span class="o">.</span><span class="n">FunctionTypes</span><span class="o">.</span><span class="n">TIME_RESPONSE</span><span class="p">,</span>
                                                    <span class="n">times</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span>
                                                    <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">if</span> <span class="n">responses</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">responses</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
            <span class="n">reference_array</span> <span class="o">=</span> <span class="n">sdynpy_data</span><span class="o">.</span><span class="n">data_array</span><span class="p">(</span><span class="n">sdynpy_data</span><span class="o">.</span><span class="n">FunctionTypes</span><span class="o">.</span><span class="n">TIME_RESPONSE</span><span class="p">,</span>
                                                     <span class="n">times</span><span class="p">,</span> <span class="n">forces</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">forces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                                     <span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">coordinate_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flat_self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">if</span> <span class="n">references</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">references</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">response_array</span><span class="p">,</span> <span class="n">reference_array</span></div>

<div class="viewcode-block" id="ShapeArray.system"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.system">[docs]</a>    <span class="k">def</span> <span class="nf">system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create system matrices from the shapes</span>

<span class="sd">        This will create a System object with modal mass, stiffness, and</span>
<span class="sd">        damping matrices, with the mode shape matrix as the transformation</span>
<span class="sd">        to physical coordinates</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Raised if complex modes are used</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        System</span>
<span class="sd">            A System object containing modal mass, stiffness, and damping</span>
<span class="sd">            matrices, with the mode shape matrix as the transformation</span>
<span class="sd">            to physical coordinates</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_complex</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Complex Modes Not Implemented Yet&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sdynpy_system</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
                                                <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span> <span class="o">*</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">modal_mass</span><span class="p">),</span>
                                        <span class="bp">self</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapeArray.shape_alignment"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.shape_alignment">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">shape_alignment</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">,</span> <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes if the shapes are aligned, or if one needs to be flipped</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shape_1 : ShapeArray</span>
<span class="sd">            Shape to compare.</span>
<span class="sd">        shape_2 : ShapeArray</span>
<span class="sd">            Shape to compare.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            An array denoting if one of the shapes need to be flipped (-1)</span>
<span class="sd">            to be equivalent to the other, or if they are already aligned (1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node_id_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape_2</span> <span class="o">=</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">common_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">coordinate</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ij-&gt;i&#39;</span><span class="p">,</span> <span class="n">shape_1</span><span class="p">[</span><span class="n">common_coordinates</span><span class="p">],</span> <span class="n">shape_2</span><span class="p">[</span><span class="n">common_coordinates</span><span class="p">]))</span></div>

<div class="viewcode-block" id="ShapeArray.mode_table"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.mode_table">[docs]</a>    <span class="k">def</span> <span class="nf">mode_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
                   <span class="n">frequency_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="p">,</span>
                   <span class="n">damping_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">%&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a table of modal information including frequency and damping</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_format : str, optional</span>
<span class="sd">            The type of table to generate.  Can be &#39;csv&#39;, &#39;rst&#39;, &#39;markdown&#39;,</span>
<span class="sd">            &#39;latex&#39;, or &#39;ascii&#39;. The default is &#39;csv&#39;.</span>
<span class="sd">        frequency_format : str, optional</span>
<span class="sd">            Format specifier for frequency. The default is &#39;{:0.2f}&#39;.</span>
<span class="sd">        damping_format : str, optional</span>
<span class="sd">            Format specifier for damping percent. The default is &#39;{:0.2f}%&#39;.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if a invalid `table_format` is specified</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : str</span>
<span class="sd">            String representation of the mode table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;rst&#39;</span><span class="p">,</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">available_formats</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`table_format` must be one of </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">available_formats</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ascii&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span><span class="p">]:</span>
            <span class="c1"># Create a Pandas dataframe</span>
            <span class="n">sorted_flat_self</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mode&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sorted_flat_self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                         <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">frequency_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_flat_self</span><span class="o">.</span><span class="n">frequency</span><span class="p">],</span>
                         <span class="s1">&#39;Damping&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">damping_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="k">if</span> <span class="s1">&#39;%&#39;</span> <span class="ow">in</span> <span class="n">damping_format</span> <span class="k">else</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_flat_self</span><span class="o">.</span><span class="n">damping</span><span class="p">]}</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;comment1&#39;</span><span class="p">,</span> <span class="s1">&#39;comment2&#39;</span><span class="p">,</span> <span class="s1">&#39;comment3&#39;</span><span class="p">,</span> <span class="s1">&#39;comment4&#39;</span><span class="p">,</span> <span class="s1">&#39;comment5&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">sorted_flat_self</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="o">=</span> <span class="n">sorted_flat_self</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;latex&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<span class="c1">#    def string_array(self):</span>
<span class="c1">#        return create_coordinate_string_array(self.node,self.direction)</span>
<span class="c1">#</span>
<span class="c1">#    def __repr__(self):</span>
<span class="c1">#        return &#39;coordinate_array(string_array=\n&#39;+repr(self.string_array())+&#39;)&#39;</span>
<span class="c1">#</span>
<span class="c1">#    def __str__(self):</span>
<span class="c1">#        return str(self.string_array())</span>
<span class="c1">#</span>
<span class="c1">#    def __eq__(self,value):</span>
<span class="c1">#        value = np.array(value)</span>
<span class="c1">#        # A string</span>
<span class="c1">#        if np.issubdtype(value.dtype,np.character):</span>
<span class="c1">#            return self.string_array() == value</span>
<span class="c1">#        else:</span>
<span class="c1">#            if value.dtype.names is None:</span>
<span class="c1">#                node_logical = self.node == value[...,0]</span>
<span class="c1">#                direction_logical = self.direction == value[...,1]</span>
<span class="c1">#            else:</span>
<span class="c1">#                node_logical = self.node == value[&#39;node&#39;]</span>
<span class="c1">#                direction_logical = self.direction == value[&#39;direction&#39;]</span>
<span class="c1">#            return np.logical_and(node_logical,direction_logical)</span>
<span class="c1">#</span>
<span class="c1">#    def __ne__(self,value):</span>
<span class="c1">#        return ~self.__eq__(value)</span>
<span class="c1">#</span>
<span class="c1">#    def __abs__(self):</span>
<span class="c1">#        abs_coord = self.copy()</span>
<span class="c1">#        abs_coord.direction = abs(abs_coord.direction)</span>
<span class="c1">#        return abs_coord</span>
<span class="c1">#</span>
<span class="c1">#    def __neg__(self):</span>
<span class="c1">#        neg_coord = self.copy()</span>
<span class="c1">#        neg_coord.direction = -neg_coord.direction</span>
<span class="c1">#        return neg_coord</span>
<span class="c1">#</span>
<span class="c1">#    def __pos__(self):</span>
<span class="c1">#        pos_coord = self.copy()</span>
<span class="c1">#        pos_coord.direction = +pos_coord.direction</span>
<span class="c1">#        return pos_coord</span>
<span class="c1">#</span>
<span class="c1">#    def abs(self):</span>
<span class="c1">#        return self.__abs__()</span>
<span class="c1">#</span>

<div class="viewcode-block" id="shape_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.shape_array.html#sdynpy.core.sdynpy_shape.shape_array">[docs]</a><span class="k">def</span> <span class="nf">shape_array</span><span class="p">(</span><span class="n">coordinate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">damping</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">modal_mass</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">comment1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">comment2</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">comment3</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">comment4</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">comment5</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">structured_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a coordinate array that specify degrees of freedom.</span>

<span class="sd">    Creates an array of coordinates that specify degrees of freedom in a test</span>
<span class="sd">    or analysis.  Coordinate arrays can be created using a numpy structured</span>
<span class="sd">    array or two arrays for node and direction.  Multidimensional arrays can</span>
<span class="sd">    be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coordinate : CoordinateArray</span>
<span class="sd">        Array of coordinates corresponding to the last dimension of the</span>
<span class="sd">        shape_matrix</span>
<span class="sd">    shape_matrix : ndarray</span>
<span class="sd">        Matrix of shape coefficients.  If complex, then the shape will be made</span>
<span class="sd">        into a complex shape.  Otherwise it will be real.  The last dimension</span>
<span class="sd">        should be the &quot;coordinate&quot; dimension, and the first dimension(s) should</span>
<span class="sd">        be the shape dimension(s).  Note that this is transposed from the</span>
<span class="sd">        typical modal approach, but it makes for better itegration with numpy.</span>
<span class="sd">    frequency : ndarray</span>
<span class="sd">        Natural Frequencies for each shape of the array</span>
<span class="sd">    damping : ndarray</span>
<span class="sd">        Fraction of Critical Damping (as proportion not percentage) for each</span>
<span class="sd">        shape of the array</span>
<span class="sd">    modal_mass : ndarray</span>
<span class="sd">        Modal mass for each shape of the array</span>
<span class="sd">    comment1 - comment5 : ndarray</span>
<span class="sd">        Comments for the universal file for each shape.  Note that comment5 will</span>
<span class="sd">        not be stored to the universal file format.</span>
<span class="sd">    structured_array : ndarray (structured)</span>
<span class="sd">        Alternatively to the above, a structured array can be passed with</span>
<span class="sd">        identical parameters to the above.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    shape_array : ShapeArray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;coordinate&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shape_matrix&#39;</span><span class="p">,</span>
        <span class="s1">&#39;frequency&#39;</span><span class="p">,</span>
        <span class="s1">&#39;damping&#39;</span><span class="p">,</span>
        <span class="s1">&#39;modal_mass&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment5&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">structured_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;structured_array must be numpy.ndarray with dtype names </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinate</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape_matrix</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;damping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">damping</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;modal_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modal_mass</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comment1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U80&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comment2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U80&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comment3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U80&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comment4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U80&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">comment5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U80&#39;</span><span class="p">)</span>

    <span class="c1"># Create the coordinate array</span>
    <span class="n">shp_array</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                           <span class="s1">&#39;real&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isrealobj</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="s1">&#39;complex&#39;</span><span class="p">)</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;shape_matrix&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;damping&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">modal_mass</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;modal_mass&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">comment1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment1&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">comment2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment2&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">comment3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment3&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">comment4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment4&#39;</span><span class="p">]</span>
    <span class="n">shp_array</span><span class="o">.</span><span class="n">comment5</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment5&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">shp_array</span></div>


<span class="n">from_imat_struct</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">from_imat_struct</span>
<span class="n">from_exodus</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">from_exodus</span>
<span class="n">from_unv</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">from_unv</span>
<span class="n">load</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">load</span>
<span class="n">concatenate_dofs</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">concatenate_dofs</span>
<span class="n">overlay_shapes</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">overlay_shapes</span>
<span class="n">shape_alignment</span> <span class="o">=</span> <span class="n">ShapeArray</span><span class="o">.</span><span class="n">shape_alignment</span>


<div class="viewcode-block" id="rigid_body_error"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.rigid_body_error.html#sdynpy.core.sdynpy_shape.rigid_body_error">[docs]</a><span class="k">def</span> <span class="nf">rigid_body_error</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">rigid_shapes</span><span class="p">,</span> <span class="o">**</span><span class="n">rigid_shape_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes rigid shape error based on geometries</span>

<span class="sd">    Analytic rigid body shapes are computed from the geometry.  The supplied</span>
<span class="sd">    rigid_shapes are then projected through these analytic shapes and a</span>
<span class="sd">    residual is computed by subtracting the projected shapes from the original</span>
<span class="sd">    shapes.  This residual is a measure of how &quot;non-rigid&quot; the provided shapes</span>
<span class="sd">    were.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : Geometry</span>
<span class="sd">        Geometry from which analytic rigid body shapes will be created</span>
<span class="sd">    rigid_shapes : ShapeArray</span>
<span class="sd">        ShapeArray consisting of nominally rigid shapes from which errors are</span>
<span class="sd">        to be computed</span>
<span class="sd">    **rigid_shape_kwargs : various</span>
<span class="sd">        Additional keywords that can be passed to the Geometry.rigid_body_shapes</span>
<span class="sd">        method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coordinates : CoordinateArray</span>
<span class="sd">        The coordinates corresponding to the output residual array</span>
<span class="sd">    residual : np.ndarray</span>
<span class="sd">        Residuals computed by subtracting the provided shapes from those same</span>
<span class="sd">        shapes projected through the analytical rigid body shapes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rigid_shapes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
    <span class="n">true_rigid_shapes</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">rigid_body_shapes</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="o">**</span><span class="n">rigid_shape_kwargs</span><span class="p">)</span>
    <span class="n">shape_matrix_exp</span> <span class="o">=</span> <span class="n">rigid_shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">shape_matrix_true</span> <span class="o">=</span> <span class="n">true_rigid_shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">shape_matrix_true</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">shape_matrix_true</span><span class="p">,</span> <span class="n">shape_matrix_exp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shape_matrix_exp</span> <span class="o">-</span> <span class="n">projection</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">residual</span></div>


<div class="viewcode-block" id="rigid_body_check"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.rigid_body_check.html#sdynpy.core.sdynpy_shape.rigid_body_check">[docs]</a><span class="k">def</span> <span class="nf">rigid_body_check</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">rigid_shapes</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">distance_number</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">distance_yscale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">residuals_to_label</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                     <span class="n">return_shape_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">rigid_shape_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs rigid body checks, both looking at the complex plane and residuals</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : Geometry</span>
<span class="sd">        Geometry from which analytic rigid body shapes will be created</span>
<span class="sd">    rigid_shapes : ShapeArray</span>
<span class="sd">        ShapeArray consisting of nominally rigid shapes from which errors are</span>
<span class="sd">        to be computed</span>
<span class="sd">    distance : float, optional</span>
<span class="sd">        Threshold for computing distance from other points to find outliers.</span>
<span class="sd">        The default is 0.25.</span>
<span class="sd">    distance_number : int, optional</span>
<span class="sd">        Threshold for number of neighbors to find outliers. The default is 5.</span>
<span class="sd">    distance_yscale : float, optional</span>
<span class="sd">        Penalty factor applied to the complex portion of the shape when</span>
<span class="sd">        computing distances. The default is 20.</span>
<span class="sd">    residuals_to_label : int, optional</span>
<span class="sd">        The top `residuals_to_label` residuals will be highlighted in the </span>
<span class="sd">        residual plots. The default is 5.</span>
<span class="sd">    return_shape_diagnostics : True, optional</span>
<span class="sd">        If True, additional outputs are returned to help diagnose issues. The</span>
<span class="sd">        default is False.</span>
<span class="sd">    plot : bool, optional</span>
<span class="sd">        Whether or not to create plots of the results. The default is True.</span>
<span class="sd">    **rigid_shape_kwargs : various</span>
<span class="sd">        Additional keywords that can be passed to the Geometry.rigid_body_shapes</span>
<span class="sd">        method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    suspicious_channels : CoordinateArray</span>
<span class="sd">        A set of suspicous channels that should be investigated</span>
<span class="sd">    analytic_rigid_shapes : ShapeArray</span>
<span class="sd">        Rigid body shapes created from the geometry.  Only returned if </span>
<span class="sd">        return_shape_diagnostics is True</span>
<span class="sd">    residual : np.ndarray</span>
<span class="sd">        Values of the residuals at coordinates np.unique(rigid_shapes.coordinate).</span>
<span class="sd">        Only returned if return_shape_diagnostics is True</span>
<span class="sd">    shape_matrix_exp : np.ndarray</span>
<span class="sd">        The shape matrix of the supplied rigid shapes.  Only returned if </span>
<span class="sd">        return_shape_diagnostics is True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rigid_shapes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
    <span class="n">true_rigid_shapes</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">rigid_body_shapes</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="o">**</span><span class="n">rigid_shape_kwargs</span><span class="p">)</span>
    <span class="n">shape_matrix_exp</span> <span class="o">=</span> <span class="n">rigid_shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">shape_matrix_true</span> <span class="o">=</span> <span class="n">true_rigid_shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">shape_matrix_true</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">shape_matrix_true</span><span class="p">,</span> <span class="n">shape_matrix_exp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shape_matrix_exp</span> <span class="o">-</span> <span class="n">projection</span><span class="p">)</span>
    <span class="n">suspicious_channels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Plot the complex plane for each shape</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rigid_shapes</span><span class="p">,</span> <span class="n">shape_matrix_exp</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s1">&#39;Shape </span><span class="si">{:}</span><span class="s1"> Complex Plane&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">i</span> <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment1</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Real Part&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imag Part&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Shape </span><span class="si">{:}</span><span class="se">\n</span><span class="s1">Complex Plane&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">i</span> <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment1</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">shape</span><span class="o">.</span><span class="n">comment1</span><span class="p">))</span>
            <span class="n">shape_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">distance_yscale</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">point_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">shape_points</span> <span class="o">-</span> <span class="n">shape_points</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">point_distances</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">distance_number</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">outlier</span> <span class="ow">in</span> <span class="n">outliers</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">outlier</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">outlier</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">outlier</span><span class="p">]))</span>
                <span class="n">suspicious_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">outlier</span><span class="p">])</span>
    <span class="c1"># Now plot the residuals</span>
    <span class="n">residual_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s1">&#39;Projection Residuals&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">residuals_to_label</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">residual_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">residual</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="n">suspicious_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="c1"># ax.set_yscale(&#39;log&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Degree of Freedom&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_shape_diagnostics</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">suspicious_channels</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">),</span> <span class="n">true_rigid_shapes</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="n">shape_matrix_exp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">suspicious_channels</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">sdynpy_coordinate</span><span class="o">.</span><span class="n">CoordinateArray</span><span class="p">)</span></div>


<div class="viewcode-block" id="rigid_body_fix_node_orientation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.rigid_body_fix_node_orientation.html#sdynpy.core.sdynpy_shape.rigid_body_fix_node_orientation">[docs]</a><span class="k">def</span> <span class="nf">rigid_body_fix_node_orientation</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">rigid_shapes</span><span class="p">,</span> <span class="n">suspect_nodes</span><span class="p">,</span> <span class="n">new_cs_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solves for the best sensor orientation in the geometry to minimize the residual</span>

<span class="sd">    This function uses a nonlinear optimizer to solve for the orientation of</span>
<span class="sd">    the specified nodes that provide the best estimate of a rigid body shape.</span>
<span class="sd">    This can be used to try to figure out the true orientation of a sensor in</span>
<span class="sd">    a test.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : Geometry</span>
<span class="sd">        Geometry from which analytic rigid body shapes will be created</span>
<span class="sd">    rigid_shapes : ShapeArray</span>
<span class="sd">        ShapeArray consisting of nominally rigid shapes from which errors are</span>
<span class="sd">        to be corrected</span>
<span class="sd">    suspect_nodes : np.ndarray</span>
<span class="sd">        A set of node ids to investigate.  The coordinate system of each of</span>
<span class="sd">        these will be modified.</span>
<span class="sd">    new_cs_ids : np.ndarray, optional</span>
<span class="sd">        Id numbers to give the newly added coordinate systems.   The default is</span>
<span class="sd">        None, which simply increments the maximum coordinate system for each</span>
<span class="sd">        suspect node</span>
<span class="sd">    gtol : float, optional</span>
<span class="sd">        Global tolerance for convergence for the nonlinear optimizer. The</span>
<span class="sd">        default is 1e-8.</span>
<span class="sd">    xtol : TYPE, optional</span>
<span class="sd">        Relative tolerance for convergence for the nonlinear optimizer. The</span>
<span class="sd">        default is 1e-8.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    corrected_geometry : Geometry</span>
<span class="sd">        A geometry with coordinate systems modified to be consistent with the</span>
<span class="sd">        rigid body shapes supplied.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_css</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Loop through all suspect nodes</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">suspect_nodes</span><span class="p">):</span>
        <span class="n">keep_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">suspect_nodes</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">node</span><span class="p">)]</span>
        <span class="n">error_geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">)</span>
        <span class="n">error_shapes</span> <span class="o">=</span> <span class="n">rigid_shapes</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">objective_function</span><span class="p">(</span><span class="n">quaternion</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">quaternion_to_rotation_matrix</span><span class="p">(</span><span class="n">quaternion</span><span class="p">)</span>
            <span class="c1"># Create a new geometry with the rotation applied</span>
            <span class="n">updated_geometry</span> <span class="o">=</span> <span class="n">error_geometry</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new_cs</span> <span class="o">=</span> <span class="n">updated_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">updated_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
            <span class="n">new_cs</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">updated_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
            <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">new_cs_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">new_cs_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">new_cs</span><span class="o">.</span><span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">@</span> <span class="n">new_cs</span><span class="o">.</span><span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">updated_geometry</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span><span class="n">updated_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">new_cs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]])</span>
            <span class="n">updated_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">[</span><span class="n">updated_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cs</span><span class="o">.</span><span class="n">id</span>
            <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rigid_body_error</span><span class="p">(</span><span class="n">updated_geometry</span><span class="p">,</span> <span class="n">error_shapes</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">residual</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimizing Orientation of Node </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective_function</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;trust-constr&#39;</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="p">[</span>
                              <span class="n">unit_magnitude_constraint</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gtol&#39;</span><span class="p">:</span> <span class="n">gtol</span><span class="p">,</span> <span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="n">xtol</span><span class="p">})</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">quaternion_to_rotation_matrix</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">new_cs</span> <span class="o">=</span> <span class="n">error_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">error_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="n">new_cs</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">error_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="k">if</span> <span class="n">new_cs_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">new_cs_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">new_cs</span><span class="o">.</span><span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">@</span> <span class="n">new_cs</span><span class="o">.</span><span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">error_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">error_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_node</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="n">new_cs</span><span class="o">.</span><span class="n">id</span>
        <span class="n">new_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
        <span class="n">new_css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cs</span><span class="p">)</span>
    <span class="c1"># Now add the nodes and coordinate systems to the geometry</span>
    <span class="n">output_geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">new_nodes</span><span class="p">:</span>
        <span class="n">output_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">output_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
    <span class="n">output_geometry</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">output_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">new_css</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">output_geometry</span></div>


<div class="viewcode-block" id="mac"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.mac.html#sdynpy.core.sdynpy_shape.mac">[docs]</a><span class="k">def</span> <span class="nf">mac</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the modal assurance critera between two sets of shapes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shape_1 : ShapeArray</span>
<span class="sd">        A set of shapes to compute the MAC</span>
<span class="sd">    shape_2 : ShapeArray, optional</span>
<span class="sd">        A second set of shapes to compute the MAC.  If not specified, the</span>
<span class="sd">        AutoMAC of shape_1 is computed</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mac_array : np.ndarray</span>
<span class="sd">        A numpy ndarray consisting of the MAC</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">shape_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape_2</span> <span class="o">=</span> <span class="n">shape_1</span>
    <span class="k">if</span> <span class="n">node_id_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape_2</span> <span class="o">=</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
    <span class="n">common_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">coordinate</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">shape_2</span><span class="o">.</span><span class="n">coordinate</span><span class="p">))</span>
    <span class="n">phi_1</span> <span class="o">=</span> <span class="n">shape_1</span><span class="p">[</span><span class="n">common_coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">phi_2</span> <span class="o">=</span> <span class="n">shape_2</span><span class="p">[</span><span class="n">common_coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">mac_corr</span><span class="p">(</span><span class="n">phi_1</span><span class="p">,</span> <span class="n">phi_2</span><span class="p">)</span></div>


<div class="viewcode-block" id="shape_comparison_table"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_shape.shape_comparison_table.html#sdynpy.core.sdynpy_shape.shape_comparison_table">[docs]</a><span class="k">def</span> <span class="nf">shape_comparison_table</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">,</span> <span class="n">frequency_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">damping_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.02f}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">mac_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">percent_error_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">table_format</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a shape comparison table between two sets of shapes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shape_1 : ShapeArray</span>
<span class="sd">        The first shape set to compare</span>
<span class="sd">    shape_2 : ShapeArray</span>
<span class="sd">        The second shape set to compare</span>
<span class="sd">    frequency_format : str, optional</span>
<span class="sd">        Format specifier for frequency. The default is &#39;{:0.2f}&#39;.</span>
<span class="sd">    damping_format : TYPE, optional</span>
<span class="sd">        Format specifier for damping. The default is &#39;{:.02f}%&#39;.</span>
<span class="sd">    mac_format : TYPE, optional</span>
<span class="sd">        Format specifier for MAC. The default is &#39;{:0.0f}&#39;.</span>
<span class="sd">    percent_error_format : TYPE, optional</span>
<span class="sd">        Format specifier for percent error. The default is &#39;{:0.1f}%&#39;.</span>
<span class="sd">    spacing : TYPE, optional</span>
<span class="sd">        Spacing added between columns. The default is 2.</span>
<span class="sd">    table_format : str, optional</span>
<span class="sd">        Table format to return.  Must be &#39;text&#39;, &#39;markdown&#39;, or &#39;latex&#39;. The</span>
<span class="sd">        default is &#39;text&#39;.</span>
<span class="sd">    node_id_map : id_map, optional</span>
<span class="sd">        An ID map to use if shapes do not have identical node ids.  The default</span>
<span class="sd">        is to assume that the shapes have common node ids.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Raised if an invalid `table_format` is specified</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_string : str</span>
<span class="sd">        String representation of the output table</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape_1</span> <span class="o">=</span> <span class="n">shape_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">shape_2</span> <span class="o">=</span> <span class="n">shape_2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">frequency_strings_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Freq 1 (Hz)&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">frequency_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                                             <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_1</span><span class="p">]</span>
    <span class="n">frequency_strings_2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Freq 2 (Hz)&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">frequency_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                                             <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_2</span><span class="p">]</span>
    <span class="n">index_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mode&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape_1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">mac_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MAC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">mac_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii-&gt;i&#39;</span><span class="p">,</span> <span class="n">mac</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">,</span> <span class="n">node_id_map</span><span class="p">))]</span>
    <span class="n">freq_error_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Freq Error&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">percent_error_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">s2</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span> <span class="k">for</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">)]</span>
    <span class="n">index_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">index_strings</span><span class="p">])</span>
    <span class="n">freq_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">frequency_strings_1</span> <span class="o">+</span> <span class="n">frequency_strings_2</span><span class="p">])</span>
    <span class="n">mac_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">mac_strings</span><span class="p">])</span>
    <span class="n">freqerr_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">freq_error_strings</span><span class="p">])</span>
    <span class="n">index_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">freq_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">mac_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mac_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="n">freqerr_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freqerr_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">damping_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">damping_strings_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Damp 1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">damping_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                                          <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_1</span><span class="p">]</span>
        <span class="n">damping_strings_2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Damp 2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">damping_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                                          <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_2</span><span class="p">]</span>
        <span class="n">damp_error_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Damp Error&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">percent_error_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">damping</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="n">damping</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">s2</span><span class="o">.</span><span class="n">damping</span><span class="p">)</span> <span class="k">for</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shape_1</span><span class="p">,</span> <span class="n">shape_2</span><span class="p">)]</span>
        <span class="n">damp_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">damping_strings_1</span> <span class="o">+</span> <span class="n">damping_strings_2</span><span class="p">])</span>
        <span class="n">damperr_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">damp_error_strings</span><span class="p">])</span>
        <span class="n">damp_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">damp_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
        <span class="n">damperr_table_format</span> <span class="o">=</span> <span class="s1">&#39;{{:&gt;</span><span class="si">{:}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">damperr_size</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span>
        <span class="n">table_begin_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">table_end_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">separator_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">lineend_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">linebegin_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">header_separator_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;markdown&#39;</span><span class="p">:</span>
        <span class="n">table_begin_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">table_end_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">separator_string</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
        <span class="n">lineend_string</span> <span class="o">=</span> <span class="s1">&#39;|</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">linebegin_string</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">damping_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header_separator_string</span> <span class="o">=</span> <span class="n">lineend_string</span> <span class="o">+</span> <span class="n">linebegin_string</span> <span class="o">+</span> <span class="n">separator_string</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">index_size</span><span class="p">,</span> <span class="n">freq_size</span><span class="p">,</span> <span class="n">freq_size</span><span class="p">,</span> <span class="n">freqerr_size</span><span class="p">,</span>
                <span class="n">damp_size</span><span class="p">,</span> <span class="n">damp_size</span><span class="p">,</span> <span class="n">damperr_size</span><span class="p">,</span> <span class="n">mac_size</span><span class="p">]])</span> <span class="o">+</span> <span class="n">lineend_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header_separator_string</span> <span class="o">=</span> <span class="n">lineend_string</span> <span class="o">+</span> <span class="n">linebegin_string</span> <span class="o">+</span> <span class="n">separator_string</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span> <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">index_size</span><span class="p">,</span> <span class="n">freq_size</span><span class="p">,</span> <span class="n">freq_size</span><span class="p">,</span> <span class="n">freqerr_size</span><span class="p">,</span> <span class="n">mac_size</span><span class="p">]])</span> <span class="o">+</span> <span class="n">lineend_string</span>
    <span class="k">elif</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;latex&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">damping_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table_begin_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{tabular}{rrrrrrrr}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_begin_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{tabular}{rrrrr}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">table_end_string</span> <span class="o">=</span> <span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span>
        <span class="n">separator_string</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span>
        <span class="n">lineend_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
        <span class="n">linebegin_string</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span>
        <span class="n">header_separator_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="se">\\</span><span class="s1">hline</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid table_format.  Must be one of [&#39;text&#39;,&#39;markdown&#39;,&#39;latex&#39;].&quot;</span><span class="p">)</span>
    <span class="n">output_string</span> <span class="o">=</span> <span class="n">table_begin_string</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">damping_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">de</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">index_strings</span><span class="p">,</span> <span class="n">frequency_strings_1</span><span class="p">,</span> <span class="n">frequency_strings_2</span><span class="p">,</span>
                <span class="n">damping_strings_1</span><span class="p">,</span> <span class="n">damping_strings_2</span><span class="p">,</span> <span class="n">freq_error_strings</span><span class="p">,</span>
                <span class="n">damp_error_strings</span><span class="p">,</span> <span class="n">mac_strings</span><span class="p">)):</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="p">(</span><span class="n">linebegin_string</span> <span class="o">+</span> <span class="n">index_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freq_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freq_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freqerr_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">damp_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">damp_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">damperr_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">mac_table_format</span>
                              <span class="o">+</span> <span class="p">(</span><span class="n">header_separator_string</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lineend_string</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                  <span class="n">ind</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">de</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">index_strings</span><span class="p">,</span> <span class="n">frequency_strings_1</span><span class="p">,</span> <span class="n">frequency_strings_2</span><span class="p">,</span>
                <span class="n">freq_error_strings</span><span class="p">,</span>
                <span class="n">mac_strings</span><span class="p">)):</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="p">(</span><span class="n">linebegin_string</span> <span class="o">+</span> <span class="n">index_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freq_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freq_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">freqerr_table_format</span> <span class="o">+</span> <span class="n">separator_string</span>
                              <span class="o">+</span> <span class="n">mac_table_format</span>
                              <span class="o">+</span> <span class="p">(</span><span class="n">header_separator_string</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lineend_string</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                  <span class="n">ind</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">output_string</span> <span class="o">+=</span> <span class="n">table_end_string</span>
    <span class="k">if</span> <span class="n">table_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;latex&#39;</span><span class="p">:</span>
        <span class="n">output_string</span> <span class="o">=</span> <span class="n">output_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">%&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_string</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,     LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS,     the U.S. Government retains certain rights in this software.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>