<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sdynpy.core.sdynpy_geometry &mdash; SDynPy 0.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo_horizontal_light.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sdynpy_showcase.html">SDynPy Showcase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">SDynpy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modal_tutorials.html">Modal Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">SDynPy Programming Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SDynPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sdynpy.core.sdynpy_geometry</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sdynpy.core.sdynpy_geometry</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Objects and procedures to handle operations on test or model geometries</span>

<span class="sd">This module defines a Geometry object as well as all of the subcomponents of</span>
<span class="sd">a geometry object: nodes, elements, tracelines and coordinate system.  Geometry</span>
<span class="sd">plotting is also handled in this module.</span>

<span class="sd">Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,</span>
<span class="sd">LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S.</span>
<span class="sd">Government retains certain rights in this software.</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">import</span> <span class="nn">pyvistaqt</span> <span class="k">as</span> <span class="nn">pvqt</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">from</span> <span class="nn">qtpy</span> <span class="kn">import</span> <span class="n">uic</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">qtpy.QtGui</span> <span class="kn">import</span> <span class="n">QKeySequence</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">qtpy.QtGui</span> <span class="kn">import</span> <span class="n">QAction</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">qtpy.QtWidgets</span> <span class="kn">import</span> <span class="n">QAction</span>
<span class="kn">from</span> <span class="nn">qtpy.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QMenu</span>
<span class="kn">from</span> <span class="nn">.sdynpy_array</span> <span class="kn">import</span> <span class="n">SdynpyArray</span>
<span class="kn">from</span> <span class="nn">.sdynpy_colors</span> <span class="kn">import</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">coord_colormap</span>
<span class="kn">from</span> <span class="nn">.sdynpy_coordinate</span> <span class="kn">import</span> <span class="n">CoordinateArray</span><span class="p">,</span> <span class="n">coordinate_array</span><span class="p">,</span> <span class="n">from_nodelist</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_rotation</span> <span class="kn">import</span> <span class="n">R</span><span class="p">,</span> <span class="n">lstsq_rigid_transform</span>
<span class="kn">from</span> <span class="nn">..signal_processing.sdynpy_camera</span> <span class="kn">import</span> <span class="n">point_on_pixel</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">repr</span><span class="p">(</span><span class="n">pv</span><span class="o">.</span><span class="n">GPUInfo</span><span class="p">())</span>
    <span class="n">IGNORE_PLOTS</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
    <span class="n">IGNORE_PLOTS</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No GPU Found, Geometry plotting will not work!&#39;</span><span class="p">)</span>

<span class="c1"># Enumerations</span>

<span class="n">_cs_type_strings</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Polar&#39;</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Spherical&#39;</span><span class="p">}</span>

<span class="n">_element_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;Rod&#39;</span><span class="p">,</span>
    <span class="mi">21</span><span class="p">:</span> <span class="s1">&#39;Linear beam&#39;</span><span class="p">,</span>
    <span class="mi">22</span><span class="p">:</span> <span class="s1">&#39;Tapered beam&#39;</span><span class="p">,</span>
    <span class="mi">23</span><span class="p">:</span> <span class="s1">&#39;Curved beam&#39;</span><span class="p">,</span>
    <span class="mi">24</span><span class="p">:</span> <span class="s1">&#39;Parabolic beam&#39;</span><span class="p">,</span>
    <span class="mi">31</span><span class="p">:</span> <span class="s1">&#39;Straight pipe&#39;</span><span class="p">,</span>
    <span class="mi">32</span><span class="p">:</span> <span class="s1">&#39;Curved pipe&#39;</span><span class="p">,</span>
    <span class="mi">41</span><span class="p">:</span> <span class="s1">&#39;Plane Stress Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">42</span><span class="p">:</span> <span class="s1">&#39;Plane Stress Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">43</span><span class="p">:</span> <span class="s1">&#39;Plane Stress Cubic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">44</span><span class="p">:</span> <span class="s1">&#39;Plane Stress Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">45</span><span class="p">:</span> <span class="s1">&#39;Plane Stress Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">46</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Cubic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">51</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">52</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">53</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Cubic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">54</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">55</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">56</span><span class="p">:</span> <span class="s1">&#39;Plane Strain Cubic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">61</span><span class="p">:</span> <span class="s1">&#39;Plate Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">62</span><span class="p">:</span> <span class="s1">&#39;Plate Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">63</span><span class="p">:</span> <span class="s1">&#39;Plate Cubic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">64</span><span class="p">:</span> <span class="s1">&#39;Plate Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">65</span><span class="p">:</span> <span class="s1">&#39;Plate Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">66</span><span class="p">:</span> <span class="s1">&#39;Plate Cubic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">71</span><span class="p">:</span> <span class="s1">&#39;Membrane Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">72</span><span class="p">:</span> <span class="s1">&#39;Membrane Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">73</span><span class="p">:</span> <span class="s1">&#39;Membrane Cubic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">74</span><span class="p">:</span> <span class="s1">&#39;Membrane Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">75</span><span class="p">:</span> <span class="s1">&#39;Membrane Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">76</span><span class="p">:</span> <span class="s1">&#39;Membrane Cubic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">81</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Solid Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">82</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Solid Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">84</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Solid Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">85</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Solid Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">91</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Linear Triangle&#39;</span><span class="p">,</span>
    <span class="mi">92</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Parabolic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">93</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Cubic Triangle&#39;</span><span class="p">,</span>
    <span class="mi">94</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Linear Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">95</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Parabolic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">96</span><span class="p">:</span> <span class="s1">&#39;Thin Shell Cubic Quadrilateral&#39;</span><span class="p">,</span>
    <span class="mi">101</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Linear Wedge&#39;</span><span class="p">,</span>
    <span class="mi">102</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Parabolic Wedge&#39;</span><span class="p">,</span>
    <span class="mi">103</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Cubic Wedge&#39;</span><span class="p">,</span>
    <span class="mi">104</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Linear Brick&#39;</span><span class="p">,</span>
    <span class="mi">105</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Parabolic Brick&#39;</span><span class="p">,</span>
    <span class="mi">106</span><span class="p">:</span> <span class="s1">&#39;Thick Shell Cubic Brick&#39;</span><span class="p">,</span>
    <span class="mi">111</span><span class="p">:</span> <span class="s1">&#39;Solid Linear Tetrahedron&#39;</span><span class="p">,</span>
    <span class="mi">112</span><span class="p">:</span> <span class="s1">&#39;Solid Linear Wedge&#39;</span><span class="p">,</span>
    <span class="mi">113</span><span class="p">:</span> <span class="s1">&#39;Solid Parabolic Wedge&#39;</span><span class="p">,</span>
    <span class="mi">114</span><span class="p">:</span> <span class="s1">&#39;Solid Cubic Wedge&#39;</span><span class="p">,</span>
    <span class="mi">115</span><span class="p">:</span> <span class="s1">&#39;Solid Linear Brick&#39;</span><span class="p">,</span>
    <span class="mi">116</span><span class="p">:</span> <span class="s1">&#39;Solid Parabolic Brick&#39;</span><span class="p">,</span>
    <span class="mi">117</span><span class="p">:</span> <span class="s1">&#39;Solid Cubic Brick&#39;</span><span class="p">,</span>
    <span class="mi">118</span><span class="p">:</span> <span class="s1">&#39;Solid Parabolic Tetrahedron&#39;</span><span class="p">,</span>
    <span class="mi">121</span><span class="p">:</span> <span class="s1">&#39;Rigid Bar&#39;</span><span class="p">,</span>
    <span class="mi">122</span><span class="p">:</span> <span class="s1">&#39;Rigid Element&#39;</span><span class="p">,</span>
    <span class="mi">136</span><span class="p">:</span> <span class="s1">&#39;Node To Node Translational Spring&#39;</span><span class="p">,</span>
    <span class="mi">137</span><span class="p">:</span> <span class="s1">&#39;Node To Node Rotational Spring&#39;</span><span class="p">,</span>
    <span class="mi">138</span><span class="p">:</span> <span class="s1">&#39;Node To Ground Translational Spring&#39;</span><span class="p">,</span>
    <span class="mi">139</span><span class="p">:</span> <span class="s1">&#39;Node To Ground Rotational Spring&#39;</span><span class="p">,</span>
    <span class="mi">141</span><span class="p">:</span> <span class="s1">&#39;Node To Node Damper&#39;</span><span class="p">,</span>
    <span class="mi">142</span><span class="p">:</span> <span class="s1">&#39;Node To Gound Damper&#39;</span><span class="p">,</span>
    <span class="mi">151</span><span class="p">:</span> <span class="s1">&#39;Node To Node Gap&#39;</span><span class="p">,</span>
    <span class="mi">152</span><span class="p">:</span> <span class="s1">&#39;Node To Ground Gap&#39;</span><span class="p">,</span>
    <span class="mi">161</span><span class="p">:</span> <span class="s1">&#39;Lumped Mass&#39;</span><span class="p">,</span>
    <span class="mi">171</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Linear Shell&#39;</span><span class="p">,</span>
    <span class="mi">172</span><span class="p">:</span> <span class="s1">&#39;Axisymetric Parabolic Shell&#39;</span><span class="p">,</span>
    <span class="mi">181</span><span class="p">:</span> <span class="s1">&#39;Constraint&#39;</span><span class="p">,</span>
    <span class="mi">191</span><span class="p">:</span> <span class="s1">&#39;Plastic Cold Runner&#39;</span><span class="p">,</span>
    <span class="mi">192</span><span class="p">:</span> <span class="s1">&#39;Plastic Hot Runner&#39;</span><span class="p">,</span>
    <span class="mi">193</span><span class="p">:</span> <span class="s1">&#39;Plastic Water Line&#39;</span><span class="p">,</span>
    <span class="mi">194</span><span class="p">:</span> <span class="s1">&#39;Plastic Fountain&#39;</span><span class="p">,</span>
    <span class="mi">195</span><span class="p">:</span> <span class="s1">&#39;Plastic Baffle&#39;</span><span class="p">,</span>
    <span class="mi">196</span><span class="p">:</span> <span class="s1">&#39;Plastic Rod Heater&#39;</span><span class="p">,</span>
    <span class="mi">201</span><span class="p">:</span> <span class="s1">&#39;Linear node-to-node interface&#39;</span><span class="p">,</span>
    <span class="mi">202</span><span class="p">:</span> <span class="s1">&#39;Linear edge-to-edge interface&#39;</span><span class="p">,</span>
    <span class="mi">203</span><span class="p">:</span> <span class="s1">&#39;Parabolic edge-to-edge interface&#39;</span><span class="p">,</span>
    <span class="mi">204</span><span class="p">:</span> <span class="s1">&#39;Linear face-to-face interface&#39;</span><span class="p">,</span>
    <span class="mi">208</span><span class="p">:</span> <span class="s1">&#39;Parabolic face-to-face interface&#39;</span><span class="p">,</span>
    <span class="mi">212</span><span class="p">:</span> <span class="s1">&#39;Linear axisymmetric interface&#39;</span><span class="p">,</span>
    <span class="mi">213</span><span class="p">:</span> <span class="s1">&#39;Parabolic axisymmetric interface&#39;</span><span class="p">,</span>
    <span class="mi">221</span><span class="p">:</span> <span class="s1">&#39;Linear rigid surface&#39;</span><span class="p">,</span>
    <span class="mi">222</span><span class="p">:</span> <span class="s1">&#39;Parabolic rigid surface&#39;</span><span class="p">,</span>
    <span class="mi">231</span><span class="p">:</span> <span class="s1">&#39;Axisymetric linear rigid surface&#39;</span><span class="p">,</span>
    <span class="mi">232</span><span class="p">:</span> <span class="s1">&#39;Axisymentric parabolic rigid surface&#39;</span><span class="p">}</span>

<span class="n">_exodus_elem_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hex8&#39;</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span>
                         <span class="s1">&#39;tet4&#39;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span>
                         <span class="s1">&#39;quad4&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                         <span class="s1">&#39;tri3&#39;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
                         <span class="s1">&#39;shell4&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                         <span class="s1">&#39;shell3&#39;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
                         <span class="s1">&#39;bar2&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                         <span class="s1">&#39;truss2&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                         <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span>
                         <span class="s1">&#39;shell8&#39;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
                         <span class="s1">&#39;hex20&#39;</span><span class="p">:</span> <span class="mi">116</span><span class="p">,</span>
                         <span class="s1">&#39;tetra10&#39;</span><span class="p">:</span> <span class="mi">118</span><span class="p">,</span>
                         <span class="s1">&#39;hex&#39;</span><span class="p">:</span> <span class="mi">115</span><span class="p">,</span>
                         <span class="s1">&#39;beam&#39;</span><span class="p">:</span> <span class="mi">21</span>
                         <span class="c1"># Add new elements here</span>
                         <span class="p">}</span>

<span class="n">_beam_elem_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">121</span><span class="p">]</span>
<span class="n">_face_element_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">107</span><span class="p">)]</span>
<span class="n">_solid_element_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="mi">119</span><span class="p">)]</span>
<span class="n">_vtk_element_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">111</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_TETRA</span><span class="p">,</span>
    <span class="mi">112</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_WEDGE</span><span class="p">,</span>
    <span class="mi">113</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_QUADRATIC_WEDGE</span><span class="p">,</span>
    <span class="mi">115</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_HEXAHEDRON</span><span class="p">,</span>
    <span class="mi">116</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_QUADRATIC_HEXAHEDRON</span><span class="p">,</span>
    <span class="mi">118</span><span class="p">:</span> <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_QUADRATIC_TETRA</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_vtk_connectivity_reorder</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">vtk</span><span class="o">.</span><span class="n">VTK_QUADRATIC_HEXAHEDRON</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
                                   <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">MAX_NUMBER_REPR</span> <span class="o">=</span> <span class="mi">100</span>

<div class="viewcode-block" id="GeometryPlotter"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.GeometryPlotter.html#sdynpy.core.sdynpy_geometry.GeometryPlotter">[docs]</a><span class="k">class</span> <span class="nc">GeometryPlotter</span><span class="p">(</span><span class="n">pvqt</span><span class="o">.</span><span class="n">BackgroundPlotter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class used to plot geometry</span>

<span class="sd">    This class is essentially identical to PyVista&#39;s BackgroundPlotter;</span>
<span class="sd">    however a small amount of additional functionality is added.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GeometryPlotter.save_rotation_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.GeometryPlotter.html#sdynpy.core.sdynpy_geometry.GeometryPlotter.save_rotation_animation">[docs]</a>    <span class="k">def</span> <span class="nf">save_rotation_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                <span class="n">individual_images</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves an animation of the rotating geometry to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Path to the file being saved. The default is None, which returns</span>
<span class="sd">            the images as an array rather than saves them to a file</span>
<span class="sd">        frames : int, optional</span>
<span class="sd">            Number of frames in the animation. The default is 20.</span>
<span class="sd">        frame_rate : float, optional</span>
<span class="sd">            Number of frames per second if the animation is saved to a GIF.</span>
<span class="sd">            The default is 20.</span>
<span class="sd">        individual_images : bool, optional</span>
<span class="sd">            Boolean to specify whether the images are saved as individual PNG</span>
<span class="sd">            files or a single GIF. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        imgs : np.ndarray or None</span>
<span class="sd">            Returns array of images if filename is None, otherwise returns None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">focus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">initial_view_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">-</span> <span class="n">focus</span>
        <span class="n">view_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">up</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
            <span class="c1"># Compute a rotation matrix</span>
            <span class="n">rotmat</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">view_up</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
            <span class="n">view_from</span> <span class="o">=</span> <span class="p">(</span><span class="n">rotmat</span> <span class="o">@</span> <span class="n">initial_view_from</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">focus</span><span class="p">)</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">view_from</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">view_from</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span> <span class="o">=</span> <span class="n">focus</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">view_up</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
            <span class="c1"># Force GUI Update to ensure the OS doesn&#39;t delay events</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screenshot</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">imgs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs</span><span class="p">):</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">ADAPTIVE</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">]</span>
                <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                             <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">frame_rate</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TransientPlotter"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter">[docs]</a><span class="k">class</span> <span class="nc">TransientPlotter</span><span class="p">(</span><span class="n">GeometryPlotter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class used to plot transient deformations&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TransientPlotter.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">displacement_data</span><span class="p">,</span> <span class="n">displacement_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">frames_per_second</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">transformation_shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_curves</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                 <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">off_screen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">allow_quit_keypress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">menu_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">editor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">update_app_icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a TransientPlotter object to plot displacements over time</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometry : Geometry</span>
<span class="sd">            Geometry on which the displacements will be plotted</span>
<span class="sd">        displacement_data : TimeHistoryArray</span>
<span class="sd">            Transient displacement data that will be applied</span>
<span class="sd">        displacement_scale : float, optional</span>
<span class="sd">            Scale factor applied to displacements. The default is 1.0.</span>
<span class="sd">        frames_per_second : float, optional</span>
<span class="sd">            Number of time steps to plot per second while the displacement is</span>
<span class="sd">            animating.  Default is 20.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            Opacity of the undeformed geometry. The default is 0.0, or</span>
<span class="sd">            completely transparent.</span>
<span class="sd">        deformed_opacity : float, optional</span>
<span class="sd">            Opacity of the deformed geometry. The default is 1.0, or completely</span>
<span class="sd">            opaque.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Keyword arguments passed to the Geometry.plot function</span>
<span class="sd">        transformation_shapes : ShapeArray</span>
<span class="sd">            Shape matrix that will be used to expand the data.  Must be the</span>
<span class="sd">            same size as the `displacement_data`</span>
<span class="sd">        num_curves : int, optional</span>
<span class="sd">            Maximum number of curves to plot on the time selector.  Default is</span>
<span class="sd">            50</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Show the plotting window.  If ``False``, show this window by</span>
<span class="sd">            running ``show()``. The default is True.</span>
<span class="sd">        app : QApplication, optional</span>
<span class="sd">            Creates a `QApplication` if left as `None`.  The default is None.</span>
<span class="sd">        window_size : list of int, optional</span>
<span class="sd">            Window size in pixels.  Defaults to ``[1024, 768]``</span>
<span class="sd">        off_screen : TYPE, optional</span>
<span class="sd">            Renders off screen when True.  Useful for automated</span>
<span class="sd">            screenshots or debug testing. The default is None.</span>
<span class="sd">        allow_quit_keypress : bool, optional</span>
<span class="sd">            Allow user to exit by pressing ``&quot;q&quot;``. The default is True.</span>
<span class="sd">        toolbar : bool, optional</span>
<span class="sd">            If True, display the default camera toolbar. Defaults to True.</span>
<span class="sd">        menu_bar : bool, optional</span>
<span class="sd">            If True, display the default main menu. Defaults to True.</span>
<span class="sd">        editor : TYPE, optional</span>
<span class="sd">            If True, display the VTK object editor. Defaults to False.</span>
<span class="sd">        update_app_icon : bool, optional</span>
<span class="sd">            If True, update_app_icon will be called automatically to update the</span>
<span class="sd">            Qt app icon based on the current rendering output. If None, the</span>
<span class="sd">            logo of PyVista will be used. If False, no icon will be set.</span>
<span class="sd">            Defaults to None. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of plotting window.</span>
<span class="sd">        multi_samples : int, optional</span>
<span class="sd">            The number of multi-samples used to mitigate aliasing. 4 is a</span>
<span class="sd">            good default but 8 will have better results with a potential</span>
<span class="sd">            impact on performance.</span>
<span class="sd">        line_smoothing : bool, optional</span>
<span class="sd">            If True, enable line smothing</span>
<span class="sd">        point_smoothing : bool, optional</span>
<span class="sd">            If True, enable point smothing</span>
<span class="sd">        polygon_smoothing : bool, optional</span>
<span class="sd">            If True, enable polygon smothing</span>
<span class="sd">        auto_update : float, bool, optional</span>
<span class="sd">            Automatic update rate in seconds.  Useful for automatically</span>
<span class="sd">            updating the render window when actors are change without</span>
<span class="sd">            being automatically ``Modified``.  If set to ``True``, update</span>
<span class="sd">            rate will be 1 second.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QToolbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QToolBar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_abscissa_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QTimer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames_per_second</span> <span class="o">=</span> <span class="n">frames_per_second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TransientPlotter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">show</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">window_size</span><span class="p">),</span>
                                               <span class="n">off_screen</span><span class="p">,</span>
                                               <span class="n">allow_quit_keypress</span><span class="p">,</span> <span class="n">toolbar</span><span class="p">,</span>
                                               <span class="n">menu_bar</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">update_app_icon</span><span class="p">,</span>
                                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_abscissa_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get the layout so we can add a new widget to it</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">sizePolicy</span><span class="p">()</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">setVerticalPolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">sizeHint</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">1006</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
        <span class="c1"># self.time_selector_plot.getPlotItem().hideAxis(&#39;left&#39;)</span>
        <span class="c1"># self.time_selector_plot.getPlotItem().axes[&#39;left&#39;][&#39;item&#39;].setStyle(showValues=False)</span>

        <span class="c1"># Now we need to plot the data in the plot</span>
        <span class="k">if</span> <span class="n">num_curves</span> <span class="o">&lt;</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_curves</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">indices</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ordinate</span><span class="p">)</span>
        <span class="c1"># Plot the envelope</span>
        <span class="n">max_envelope</span> <span class="o">=</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">ordinate</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">min_envelope</span> <span class="o">=</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">ordinate</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">max_envelope</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">min_envelope</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Add an infinite line for a cursor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">abscissa</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                     <span class="n">displacement_data</span><span class="o">.</span><span class="n">abscissa</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector_plot</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_abscissa</span><span class="p">)</span>

        <span class="c1"># Set initial values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">=</span> <span class="n">displacement_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span> <span class="o">=</span> <span class="n">displacement_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">transformation_shapes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">transformation_shapes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_geometry</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">num_elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_sig_figs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span><span class="p">)))))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_format_spec</span> <span class="o">=</span> <span class="s1">&#39;Time: {{:0.</span><span class="si">{:}</span><span class="s1">f}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_sig_figs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_sig_figs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Plot the geometry</span>
        <span class="n">plotter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_undeformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_undeformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_undeformed</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                                                                                   <span class="n">opacity</span><span class="o">=</span><span class="n">undeformed_opacity</span><span class="p">,</span>
                                                                                                                   <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="n">plotter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_deformed</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                                                                             <span class="n">opacity</span><span class="o">=</span><span class="n">deformed_opacity</span><span class="p">,</span>
                                                                                                             <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="c1"># Compute the node indices up front to make things faster when switching steps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                  <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                                  <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)]</span>
        <span class="n">global_deflections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_geometry</span><span class="o">.</span><span class="n">global_deflection</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span><span class="p">[</span><span class="n">coordinates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]]</span><span class="o">.</span><span class="n">ordinate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Compute global displacements for each node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_deflections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">shape_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="n">coord_indices</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">node</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_deflections</span><span class="p">[</span><span class="n">node_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:(</span><span class="n">node_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                                  <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_deflections</span><span class="p">[:,</span> <span class="n">coord_indices</span><span class="p">]</span> <span class="o">@</span> <span class="n">shape_array</span><span class="p">[</span><span class="n">coord_indices</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation_shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_data</span><span class="o">.</span><span class="n">ordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.modify_abscissa"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.modify_abscissa">[docs]</a>    <span class="k">def</span> <span class="nf">modify_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">abscissa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span> <span class="o">-</span> <span class="n">abscissa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">(</span><span class="n">update_selector</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TransientPlotter.update_displacement"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.update_displacement">[docs]</a>    <span class="k">def</span> <span class="nf">update_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_selector</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span><span class="p">))</span>
        <span class="n">abscissa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_abscissa_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">SetText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_format_spec</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abscissa</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">SetText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_deflections</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_deflections</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span><span class="p">[:,</span>
                                                                  <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span>
        <span class="k">for</span> <span class="n">mesh_deformed</span><span class="p">,</span> <span class="n">mesh_undeformed</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_undeformed</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_undeformed</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_undeformed</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh_deformed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mesh_deformed</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">(</span><span class="n">mesh_undeformed</span><span class="o">.</span><span class="n">points</span> <span class="o">+</span>
                                        <span class="n">displacement</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span>
                                        <span class="p">)</span>
        <span class="c1"># Update the time selector</span>
        <span class="k">if</span> <span class="n">update_selector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">abscissa</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_selector</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.add_toolbars"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.add_toolbars">[docs]</a>    <span class="k">def</span> <span class="nf">add_toolbars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds toolbars to the BackgroundPlotter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_toolbars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span>
            <span class="s2">&quot;Shape Selector&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;|&lt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_first_step</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_previous_step</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_next_step</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;&gt;|&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">go_to_last_step</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span>
            <span class="s2">&quot;Animation Control&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">,</span> <span class="s1">&#39;&lt;  Play&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_animation_reverse</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">,</span> <span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">,</span> <span class="s1">&#39;Play &gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TransientPlotter.add_menu_bar"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.add_menu_bar">[docs]</a>    <span class="k">def</span> <span class="nf">add_menu_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the menu bar to the BackgroundPlotter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_menu_bar</span><span class="p">()</span>

        <span class="n">shape_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Shape&quot;</span><span class="p">)</span>
        <span class="n">scaling_menu</span> <span class="o">=</span> <span class="n">shape_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Scaling&#39;</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;1/4x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p25</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;1/2x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;0.8x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;1.25x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_1p25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_2p0</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;4x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_4p0</span><span class="p">)</span>
        <span class="n">speed_menu</span> <span class="o">=</span> <span class="n">shape_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Animation Speed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;0.8x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_speed_0p8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="p">)</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_speed_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;1.25x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_speed_1p25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_abscissa_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Show Abscissa&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_abscissa_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Loop Animation&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="p">)</span></div>

<div class="viewcode-block" id="TransientPlotter.go_to_first_step"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.go_to_first_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_first_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.go_to_previous_step"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.go_to_previous_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_previous_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.go_to_next_step"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.go_to_next_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_next_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.go_to_last_step"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.go_to_last_step">[docs]</a>    <span class="k">def</span> <span class="nf">go_to_last_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_0p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_0p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.25x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_0p5"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_0p5">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.5x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_0p8"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_0p8">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.8x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_1"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_1">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets shape scaling to 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_1p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_1p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_1p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 1.25x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">1.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_2p0"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_2p0">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_2p0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 2x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_scaling_4p0"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_scaling_4p0">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_4p0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 4x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*=</span> <span class="mf">4.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.select_speed_1"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_speed_1">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets animation speed to default quantities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">=</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="TransientPlotter.select_speed_0p8"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_speed_0p8">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_0p8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current animation speed by 0.8</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">*=</span> <span class="mf">0.8</span></div>

<div class="viewcode-block" id="TransientPlotter.select_speed_1p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.select_speed_1p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_1p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current animation speed by 1.25</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">*=</span> <span class="mf">1.25</span></div>

<div class="viewcode-block" id="TransientPlotter.play_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.play_animation">[docs]</a>    <span class="k">def</span> <span class="nf">play_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_abscissa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.play_animation_reverse"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.play_animation_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">play_animation_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_abscissa_reverse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.stop_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.stop_animation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TransientPlotter.update_abscissa"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.update_abscissa">[docs]</a>    <span class="k">def</span> <span class="nf">update_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
        <span class="n">index_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames_per_second</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">*</span> <span class="n">time_elapsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">+=</span> <span class="n">index_change</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.update_abscissa_reverse"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.update_abscissa_reverse">[docs]</a>    <span class="k">def</span> <span class="nf">update_abscissa_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
        <span class="n">index_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames_per_second</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">*</span> <span class="n">time_elapsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">-=</span> <span class="n">index_change</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_abscissa</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span></div>

<div class="viewcode-block" id="TransientPlotter.save_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TransientPlotter.html#sdynpy.core.sdynpy_geometry.TransientPlotter.save_animation">[docs]</a>    <span class="k">def</span> <span class="nf">save_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                       <span class="n">individual_images</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current shape animation to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Path to the file being saved. The default is None, which returns</span>
<span class="sd">            the images as an array rather than saves them to a file</span>
<span class="sd">        frame_rate : float, optional</span>
<span class="sd">            Number of frames per second if the animation is saved to a GIF.</span>
<span class="sd">            The default is 20.</span>
<span class="sd">        individual_images : bool, optional</span>
<span class="sd">            Boolean to specify whether the images are saved as individual PNG</span>
<span class="sd">            files or a single GIF. The default is False.</span>
<span class="sd">        start_time : float, optional</span>
<span class="sd">            Time value at which the animation will start.  Default is first</span>
<span class="sd">            time step</span>
<span class="sd">        stop_time : float, optional</span>
<span class="sd">            Time value at which the animation will end.  Default is last time</span>
<span class="sd">            step</span>
<span class="sd">        step : int, optional</span>
<span class="sd">            Only render every ``step`` time steps.  Default is to render all</span>
<span class="sd">            timesteps</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        imgs : np.ndarray or None</span>
<span class="sd">            Returns array of images if filename is None, otherwise returns None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stop_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">abscissa</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">stop_time</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abscissa_index</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_displacement</span><span class="p">()</span>
            <span class="c1"># Force GUI Update to ensure the OS doesn&#39;t delay events</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screenshot</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">imgs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs</span><span class="p">):</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">ADAPTIVE</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">]</span>
                <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                             <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">frame_rate</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransientPlotter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter">[docs]</a><span class="k">class</span> <span class="nc">ShapePlotter</span><span class="p">(</span><span class="n">GeometryPlotter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class used to plot animated shapes&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ShapePlotter.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span>
                 <span class="n">background_plotter_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;auto_update&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
                 <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">starting_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">shape_name</span><span class="o">=</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span>
                 <span class="n">show_damping</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Shape Plotter object to plot shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometry : Geometry</span>
<span class="sd">            Geometry on which the shapes will be plotted</span>
<span class="sd">        shapes : ShapeArray</span>
<span class="sd">            Shapes to plot on the geometry</span>
<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            Keyword arguments passed to the Geometry.plot function</span>
<span class="sd">        background_plotter_kwargs : dict, optional</span>
<span class="sd">            Keyword arguments passed to the BackgroundPlotter constructor.</span>
<span class="sd">            The default is {&#39;auto_update&#39;:0.01}.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            Opacity of the undeformed geometry.  Set to zero for no undeformed</span>
<span class="sd">            geometry. The default is 0.25.</span>
<span class="sd">        starting_scale : float, optional</span>
<span class="sd">            Starting scale of the shapes on the plot. The default is 1.0.</span>
<span class="sd">        shape_name : str, optional</span>
<span class="sd">            Name that will be used in the plotter to describe the shape. The </span>
<span class="sd">            default is &quot;Mode&quot;</span>
<span class="sd">        show_damping : bool, optional</span>
<span class="sd">            Boolean that specifies whether the damping should be displayed in</span>
<span class="sd">            the comment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QToolbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QToolBar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_animation_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_undeformed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">=</span> <span class="n">starting_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">:</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QTimer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_name</span> <span class="o">=</span> <span class="n">shape_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_damping</span> <span class="o">=</span> <span class="n">show_damping</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">background_plotter_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plotter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_undeformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_undeformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_undeformed</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                                                                                   <span class="n">opacity</span><span class="o">=</span><span class="n">undeformed_opacity</span><span class="p">,</span>
                                                                                                                   <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="n">plotter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_deformed</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                                                                             <span class="n">opacity</span><span class="o">=</span><span class="n">deformed_opacity</span><span class="p">,</span>
                                                                                                             <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="c1"># Compute the node indices up front to make things faster when switching shapes</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">node</span>
        <span class="c1"># Only do coordinates that are in the geometry node array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_node_index_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">coordinate_index</span><span class="p">,</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">direction</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">direction</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_node_index_map</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_node_index_map</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_node_index_map</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinate_index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">local_deformations</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
        <span class="n">ordered_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">ordered_nodes</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
            <span class="n">ordered_nodes</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="n">ordered_nodes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_deflections</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span><span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">local_deformations</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.compute_displacements"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.compute_displacements">[docs]</a>    <span class="k">def</span> <span class="nf">compute_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes displacements to apply to the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        compute_scale : bool, optional</span>
<span class="sd">            Renormalize the displacement scaling. The default is True.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape_displacements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">shape_matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">node_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span>
                                      <span class="n">dtype</span><span class="o">=</span><span class="n">shape_displacements</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_node_index_map</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Node </span><span class="si">{:}</span><span class="s1"> not found in shape array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">node_displacements</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">continue</span>
            <span class="n">node_deflection_scales</span> <span class="o">=</span> <span class="n">shape_displacements</span><span class="p">[</span><span class="n">node_indices</span><span class="p">]</span>
            <span class="n">node_deflection_directions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_deflections</span><span class="p">[</span><span class="n">node_indices</span><span class="p">]</span>
            <span class="n">node_displacements</span><span class="p">[</span><span class="n">node_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">node_deflection_scales</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span>
                                                     <span class="n">node_deflection_directions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span> <span class="o">=</span> <span class="n">node_displacements</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># Compute maximum displacement</span>
        <span class="k">if</span> <span class="n">compute_scale</span><span class="p">:</span>
            <span class="n">max_displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">global_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">global_node_coordinate</span><span class="p">()</span>
            <span class="n">bbox_diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">global_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">global_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">bbox_diagonal</span> <span class="o">/</span> \
                <span class="n">max_displacement</span>  <span class="c1"># Set to 5% of bounding box dimension</span></div>

<div class="viewcode-block" id="ShapePlotter.update_shape_mode"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.update_shape_mode">[docs]</a>    <span class="k">def</span> <span class="nf">update_shape_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the mode that is being plotted</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase : float, optional</span>
<span class="sd">            Sets the current phase of the shape. The default is None, which </span>
<span class="sd">            computes the new phase based on the time elapsed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
            <span class="n">phase_change</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">*</span> <span class="n">time_elapsed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">+=</span> <span class="n">phase_change</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="c1"># print(&#39;Updating Phase: {:}&#39;.format(self.phase))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="c1"># print(&#39;Complex&#39;)</span>
            <span class="n">deformation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="c1"># print(&#39;Real&#39;)</span>
            <span class="n">deformation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="c1"># print(&#39;Imag&#39;)</span>
            <span class="n">deformation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="c1"># print(&#39;Signed Amplitude&#39;)</span>
            <span class="n">imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">best_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">best_fit_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">best_fit</span><span class="p">)</span>
            <span class="n">rectified_displacements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_displacements</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">best_fit_phase</span><span class="p">)</span>
            <span class="n">deformation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">rectified_displacements</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mesh_deformed</span><span class="p">,</span> <span class="n">mesh_undeformed</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_mesh_undeformed</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_mesh_undeformed</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_deformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_mesh_undeformed</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh_deformed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mesh_deformed</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">(</span><span class="n">mesh_undeformed</span><span class="o">.</span><span class="n">points</span> <span class="o">+</span>
                                        <span class="n">deformation</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span>
                                        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.update_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.update_shape">[docs]</a>    <span class="k">def</span> <span class="nf">update_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the shape that is being plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape_mode</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.save_animation_from_action"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.save_animation_from_action">[docs]</a>    <span class="k">def</span> <span class="nf">save_animation_from_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">file_filter</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Select File to Save Animation&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;GIF (*.gif)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_animation</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapePlotter.save_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.save_animation">[docs]</a>    <span class="k">def</span> <span class="nf">save_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                       <span class="n">individual_images</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the current shape animation to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Path to the file being saved. The default is None, which returns</span>
<span class="sd">            the images as an array rather than saves them to a file</span>
<span class="sd">        frames : int, optional</span>
<span class="sd">            Number of frames in the animation. The default is 20.</span>
<span class="sd">        frame_rate : float, optional</span>
<span class="sd">            Number of frames per second if the animation is saved to a GIF.</span>
<span class="sd">            The default is 20.</span>
<span class="sd">        individual_images : bool, optional</span>
<span class="sd">            Boolean to specify whether the images are saved as individual PNG</span>
<span class="sd">            files or a single GIF. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        imgs : np.ndarray or None</span>
<span class="sd">            Returns array of images if filename is None, otherwise returns None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_shape_mode</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="c1"># Force GUI Update to ensure the OS doesn&#39;t delay events</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screenshot</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">imgs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs</span><span class="p">):</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">ADAPTIVE</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">]</span>
                <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                             <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">frame_rate</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapePlotter.save_animation_all_shapes"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.save_animation_all_shapes">[docs]</a>    <span class="k">def</span> <span class="nf">save_animation_all_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename_base</span><span class="o">=</span><span class="s1">&#39;Shape_</span><span class="si">{:}</span><span class="s1">.gif&#39;</span><span class="p">,</span>
                                  <span class="n">frames</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                  <span class="n">individual_images</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to easily save animations for all shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename_base : str, optional</span>
<span class="sd">            Filename that will be passed to the format function to produce the</span>
<span class="sd">            actual file name for each shape. The default is &#39;Shape_{:}.gif&#39;.</span>
<span class="sd">        frames : int, optional</span>
<span class="sd">            Number of frames in the animation. The default is 20.</span>
<span class="sd">        frame_rate : float, optional</span>
<span class="sd">            Number of frames per second if the animation is saved to a GIF.</span>
<span class="sd">            The default is 20.</span>
<span class="sd">        individual_images : bool, optional</span>
<span class="sd">            Boolean to specify whether the images are saved as individual PNG</span>
<span class="sd">            files or a single GIF. The default is False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="n">shape</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_animation</span><span class="p">(</span><span class="n">filename_base</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                <span class="n">frames</span><span class="p">,</span> <span class="n">frame_rate</span><span class="p">,</span> <span class="n">individual_images</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapePlotter.add_menu_bar"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.add_menu_bar">[docs]</a>    <span class="k">def</span> <span class="nf">add_menu_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the menu bar to the BackgroundPlotter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_menu_bar</span><span class="p">()</span>

        <span class="c1"># Get the file menu</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_menu</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QMenu</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_animation_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Save Animation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_animation_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_animation_from_action</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="n">file_menu</span><span class="o">.</span><span class="n">actions</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_animation_action</span><span class="p">)</span>

        <span class="n">shape_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Shape&quot;</span><span class="p">)</span>
        <span class="n">complex_display_menu</span> <span class="o">=</span> <span class="n">shape_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Complex Display&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Signed Amplitude&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_complex</span><span class="p">)</span>
        <span class="n">complex_display_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Complex&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_complex</span><span class="p">)</span>
        <span class="n">complex_display_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_complex</span><span class="p">)</span>
        <span class="n">complex_display_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_complex</span><span class="p">)</span>
        <span class="n">complex_display_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span><span class="p">)</span>
        <span class="n">scaling_menu</span> <span class="o">=</span> <span class="n">shape_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Scaling&#39;</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;1/4x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p25</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;1/2x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;0.8x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_0p8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_0p8_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_reset_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;1.25x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_1p25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_1p25_action</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_2p0</span><span class="p">)</span>
        <span class="n">scaling_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;4x&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_scaling_4p0</span><span class="p">)</span>
        <span class="n">speed_menu</span> <span class="o">=</span> <span class="n">shape_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Animation Speed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;0.8x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_speed_0p8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_0p8_action</span><span class="p">)</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_speed_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;1.25x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_speed_1p25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span>
        <span class="n">speed_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_1p25_action</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Show Comments&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Loop Animation&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_loop</span><span class="p">)</span>
        <span class="n">shape_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_action</span><span class="p">)</span>

        <span class="n">display_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Display&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_undeformed</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s1">&#39;Show Undeformed&#39;</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_undeformed</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_undeformed</span><span class="p">)</span>
        <span class="n">display_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_undeformed</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShapePlotter.add_toolbars"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.add_toolbars">[docs]</a>    <span class="k">def</span> <span class="nf">add_toolbars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds toolbars to the BackgroundPlotter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_toolbars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span>
            <span class="s2">&quot;Shape Selector&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_shape</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_shape</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape_select_toolbar</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_shape</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_window</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span>
            <span class="s2">&quot;Animation Control&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">,</span> <span class="s1">&#39;Play&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation_control_toolbar</span><span class="p">,</span> <span class="s1">&#39;Stop&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ShapePlotter.play_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.play_animation">[docs]</a>    <span class="k">def</span> <span class="nf">play_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts the animation playing&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">pvqt</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.stop_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.stop_animation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops the animation from playing&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ShapePlotter.toggle_undeformed"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.toggle_undeformed">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_undeformed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_0p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_0p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.25x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_0p5"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_0p5">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.5x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_0p8"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_0p8">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_0p8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 0.8x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_1"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_1">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets shape scaling to 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_1p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_1p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_1p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 1.25x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">1.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_2p0"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_2p0">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_2p0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 2x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_scaling_4p0"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_scaling_4p0">[docs]</a>    <span class="k">def</span> <span class="nf">select_scaling_4p0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current shape scaling by 4x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_scale_modification</span> <span class="o">*=</span> <span class="mf">4.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_speed_1"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_speed_1">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets animation speed to default quantities</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">=</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="ShapePlotter.select_speed_0p8"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_speed_0p8">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_0p8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current animation speed by 0.8</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">/=</span> <span class="mf">0.8</span></div>

<div class="viewcode-block" id="ShapePlotter.select_speed_1p25"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_speed_1p25">[docs]</a>    <span class="k">def</span> <span class="nf">select_speed_1p25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current animation speed by 1.25</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">animation_speed</span> <span class="o">/=</span> <span class="mf">1.25</span></div>

<div class="viewcode-block" id="ShapePlotter.select_complex"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_complex">[docs]</a>    <span class="k">def</span> <span class="nf">select_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts how complex shapes are plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">complex_actions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signed_amplitude_action</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">complex_action</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">real_action</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imag_action</span>
        <span class="p">]</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">sender_index</span> <span class="o">=</span> <span class="n">complex_actions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
        <span class="n">complex_actions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sender_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sender</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">sender</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">complex_actions</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_loop"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_loop">[docs]</a>    <span class="k">def</span> <span class="nf">select_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ShapePlotter.next_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.next_shape">[docs]</a>    <span class="k">def</span> <span class="nf">next_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increases the index of the shape being plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.prev_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.prev_shape">[docs]</a>    <span class="k">def</span> <span class="nf">prev_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decreases the index of the shape being plotted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShapePlotter.select_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.select_shape">[docs]</a>    <span class="k">def</span> <span class="nf">select_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ShapePlotter.show_comment"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ShapePlotter.html#sdynpy.core.sdynpy_geometry.ShapePlotter.show_comment">[docs]</a>    <span class="k">def</span> <span class="nf">show_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows or hides the shape comment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_comments_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">SetText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;</span><span class="si">{:}</span><span class="s1"> </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s1">&#39;  Frequency: </span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">)]</span> <span class="o">+</span>
                <span class="p">([</span><span class="s1">&#39;  Damping: </span><span class="si">{:.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">damping</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_damping</span> <span class="k">else</span> <span class="p">[])</span> <span class="o">+</span>
                <span class="p">[</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">comment1</span><span class="p">,</span>
                 <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">comment2</span><span class="p">,</span>
                 <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">comment3</span><span class="p">,</span>
                 <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">comment4</span><span class="p">,</span>
                 <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span><span class="p">]</span><span class="o">.</span><span class="n">comment5</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">SetText</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ShapePlotter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span></div>

<div class="viewcode-block" id="DeflectionShapePlotter"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.html#sdynpy.core.sdynpy_geometry.DeflectionShapePlotter">[docs]</a><span class="k">class</span> <span class="nc">DeflectionShapePlotter</span><span class="p">(</span><span class="n">ShapePlotter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class used to plot animated deflection shapes from spectra&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DeflectionShapePlotter.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.html#sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">deflection_shape_data</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span>
                 <span class="n">background_plotter_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;auto_update&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
                 <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">starting_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">num_curves</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a DeflectionShapePlotter object to plot shapes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometry : Geometry</span>
<span class="sd">            Geometry on which the shapes will be plotted</span>
<span class="sd">        deflection_shape_data : NDDataArray</span>
<span class="sd">            Data array containing the deflection shapes to plot</span>
<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            Keyword arguments passed to the Geometry.plot function</span>
<span class="sd">        background_plotter_kwargs : dict, optional</span>
<span class="sd">            Keyword arguments passed to the BackgroundPlotter constructor.</span>
<span class="sd">            The default is {&#39;auto_update&#39;:0.01}.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            Opacity of the undeformed geometry.  Set to zero for no undeformed</span>
<span class="sd">            geometry. The default is 0.25.</span>
<span class="sd">        starting_scale : float, optional</span>
<span class="sd">            Starting scale of the shapes on the plot. The default is 1.0.</span>
<span class="sd">        num_curves : int, optional</span>
<span class="sd">            Maximum number of curves to plot on the frequency selector.</span>
<span class="sd">            Default is 50</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert function data into shapes</span>
        <span class="kn">from</span> <span class="nn">.sdynpy_shape</span> <span class="kn">import</span> <span class="n">shape_array</span>
        <span class="n">flattened_data</span> <span class="o">=</span> <span class="n">deflection_shape_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">response_coordinates</span> <span class="o">=</span> <span class="n">flattened_data</span><span class="o">.</span><span class="n">response_coordinate</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">response_coordinates</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">response_coordinates</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;all response coordinates for operating data must be unique&#39;</span><span class="p">)</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">response_coordinates</span><span class="p">,</span> <span class="n">flattened_data</span><span class="o">.</span><span class="n">ordinate</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                             <span class="n">flattened_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">background_plotter_kwargs</span><span class="p">,</span>
                         <span class="n">undeformed_opacity</span><span class="p">,</span> <span class="n">starting_scale</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="p">,</span> <span class="n">shape_name</span><span class="o">=</span><span class="s1">&#39;Shape&#39;</span><span class="p">,</span>
                         <span class="n">show_damping</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get the layout so we can add a new widget to it</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">sizePolicy</span><span class="p">()</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">setVerticalPolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">sizeHint</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">1006</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>

        <span class="c1"># Now we need to plot the data in the plot</span>
        <span class="k">if</span> <span class="n">num_curves</span> <span class="o">&lt;</span> <span class="n">flattened_data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">flattened_data</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_curves</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flattened_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">flattened_data</span><span class="p">[</span><span class="n">indices</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ordinate</span><span class="p">))</span>
        <span class="c1"># Plot the envelope</span>
        <span class="n">max_envelope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span>
            <span class="n">flattened_data</span><span class="o">.</span><span class="n">ordinate</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">flattened_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">max_envelope</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Add an infinite line for a cursor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="n">flattened_data</span><span class="o">.</span><span class="n">abscissa</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                     <span class="n">flattened_data</span><span class="o">.</span><span class="n">abscissa</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modify_abscissa</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">setLogMode</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector_plot</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span>
            <span class="n">yRange</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_envelope</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_envelope</span><span class="o">.</span><span class="n">max</span><span class="p">())))</span></div>

<div class="viewcode-block" id="DeflectionShapePlotter.modify_abscissa"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.html#sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.modify_abscissa">[docs]</a>    <span class="k">def</span> <span class="nf">modify_abscissa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_selector</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="n">frequency</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shape</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span></div>

<div class="viewcode-block" id="DeflectionShapePlotter.save_multiline_animation"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.html#sdynpy.core.sdynpy_geometry.DeflectionShapePlotter.save_multiline_animation">[docs]</a>    <span class="k">def</span> <span class="nf">save_multiline_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frame_rate</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                 <span class="n">phase_change_per_frame</span><span class="o">=</span><span class="mf">0.087</span><span class="p">,</span>
                                 <span class="n">frequency_change_per_frame</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="n">start_phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                 <span class="n">start_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">individual_images</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_animation</span><span class="p">()</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">start_frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">end_frequency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end_frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">frequency_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_frequency</span><span class="p">,</span> <span class="n">end_frequency</span><span class="p">,</span> <span class="n">frequency_change_per_frame</span><span class="p">)</span>
        <span class="n">phase_frames</span> <span class="o">=</span> <span class="n">start_phase</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">frequency_frames</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">phase_change_per_frame</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frequency_frames</span><span class="p">,</span> <span class="n">phase_frames</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="n">frequency</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_displacements</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_shape_mode</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_comment</span><span class="p">()</span>
            <span class="c1"># Force GUI Update to ensure the OS doesn&#39;t delay events</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">imgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screenshot</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">imgs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgs</span><span class="p">):</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">ADAPTIVE</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">]</span>
                <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                             <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">frame_rate</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="split_list"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.split_list.html#sdynpy.core.sdynpy_geometry.split_list">[docs]</a><span class="k">def</span> <span class="nf">split_list</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits a list by a value that exists in the list</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    seq : iterable</span>
<span class="sd">        The sequence to split up</span>
<span class="sd">    value : </span>
<span class="sd">        Value within the list to use to split up the list</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    group : list</span>
<span class="sd">        Sublist of seq separated into groups.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">group</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">group</span>
            <span class="n">group</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">yield</span> <span class="n">group</span></div>


<div class="viewcode-block" id="global_coord"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.global_coord.html#sdynpy.core.sdynpy_geometry.global_coord">[docs]</a><span class="k">def</span> <span class="nf">global_coord</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">local_coord</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Compute global coordinates from local coordinates</span>

<span class="sd">    Compute the global coordinates of a node from its local coordinates in the</span>
<span class="sd">    corresponding coordinate system.  </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    coordinate_system : CoordinateSystemArray</span>
<span class="sd">        An array of coordinate systems of shape [...]</span>
<span class="sd">    local_coord : ndarray</span>
<span class="sd">        An array of coordinates of shape [...,3]</span>

<span class="sd">    Returns </span>
<span class="sd">    ------</span>
<span class="sd">    global_coord : ndarray</span>
<span class="sd">        An array of coordinates of shape [...,3]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Make sure we don&#39;t change local_coord</span>
    <span class="n">local_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">local_coord</span><span class="p">))</span>

    <span class="c1"># First convert to cartesian if necessary</span>
    <span class="n">cylindrical_css</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">cyl_coord</span> <span class="o">=</span> <span class="n">local_coord</span><span class="p">[</span><span class="n">cylindrical_css</span><span class="p">]</span>
    <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
                                            <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>
    <span class="n">local_coord</span><span class="p">[</span><span class="n">cylindrical_css</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyl_coord</span>

    <span class="n">spherical_css</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">sph_coord</span> <span class="o">=</span> <span class="n">local_coord</span><span class="p">[</span><span class="n">spherical_css</span><span class="p">]</span>
    <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span>
        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
        <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
        <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>
    <span class="n">local_coord</span><span class="p">[</span><span class="n">spherical_css</span><span class="p">]</span> <span class="o">=</span> <span class="n">sph_coord</span>
    <span class="c1"># Convert to global cartesian from local cartesian</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...i-&gt;...j&#39;</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">local_coord</span><span class="p">)</span> <span class="o">+</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:]</span></div>


<div class="viewcode-block" id="local_coord"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.local_coord.html#sdynpy.core.sdynpy_geometry.local_coord">[docs]</a><span class="k">def</span> <span class="nf">local_coord</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">global_coord</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute local coordinates from global coordinates</span>

<span class="sd">    Compute the local coordinates of a node in the</span>
<span class="sd">    corresponding coordinate system from its global coordinates.  </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    coordinate_system : CoordinateSystemArray</span>
<span class="sd">        An array of coordinate systems of shape [...]</span>
<span class="sd">    global_coord : ndarray</span>
<span class="sd">        An array of coordinates of shape [...,3]</span>

<span class="sd">    Returns </span>
<span class="sd">    ------</span>
<span class="sd">    local_coord : ndarray</span>
<span class="sd">        An array of coordinates of shape [...,3]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure we don&#39;t change global_coord</span>
    <span class="n">global_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">global_coord</span><span class="p">))</span>
    <span class="c1"># Make sure we&#39;re working with a numpy array</span>
    <span class="c1"># Convert to the local cartesian</span>
    <span class="n">local_coordinate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
        <span class="s1">&#39;...ji,...i-&gt;...j&#39;</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">global_coord</span> <span class="o">-</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>

    <span class="c1"># Convert to cylindrical or spherical if necessary.</span>
    <span class="n">cylindrical_css</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">cyl_coord</span> <span class="o">=</span> <span class="n">local_coordinate</span><span class="p">[</span><span class="n">cylindrical_css</span><span class="p">]</span>
    <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">cyl_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">local_coordinate</span><span class="p">[</span><span class="n">cylindrical_css</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyl_coord</span>

    <span class="n">spherical_css</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">sph_coord</span> <span class="o">=</span> <span class="n">local_coordinate</span><span class="p">[</span><span class="n">spherical_css</span><span class="p">]</span>
    <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="c1"># At this point local_coordinate[2,:] is still z and local_coordinate[0,:] is</span>
    <span class="c1"># now r instead of x</span>
    <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c1"># Flip the 1 and 2 rows to be consistent with IMAT</span>
    <span class="n">sph_coord</span> <span class="o">=</span> <span class="n">sph_coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">local_coordinate</span><span class="p">[</span><span class="n">spherical_css</span><span class="p">]</span> <span class="o">=</span> <span class="n">sph_coord</span>
    <span class="k">return</span> <span class="n">local_coordinate</span></div>


<div class="viewcode-block" id="global_deflection"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.global_deflection.html#sdynpy.core.sdynpy_geometry.global_deflection">[docs]</a><span class="k">def</span> <span class="nf">global_deflection</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">local_deflection</span><span class="p">,</span> <span class="n">global_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute deflections in the global coordinate system</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coordinate_system : CoordinateSystemArray</span>
<span class="sd">        An array of coordinate systems of shape [...]</span>
<span class="sd">    local_deflection : ndarray</span>
<span class="sd">        An array of deflections of shape [...,3]</span>
<span class="sd">    global_point : np.ndarray, optional</span>
<span class="sd">        An array of coordinates in the global coordinate system of shape</span>
<span class="sd">        [...,3]. Must be specified if there are spherical or cylindrical</span>
<span class="sd">        coordinate systems.  The default is None.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If cylindrical or spherical coordinate systems exist and global_point</span>
<span class="sd">        is not specified</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    global_deflection : ndarray</span>
<span class="sd">        An array of coordinates of shape [...,3] specifying the deflection</span>
<span class="sd">        directions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure we don&#39;t change local_deflection or point</span>
    <span class="n">local_deflection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">local_deflection</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">global_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">global_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">global_point</span><span class="p">))</span>
    <span class="c1"># Convert cylindrical and spherical to a local cartesian AT THE POINT</span>
    <span class="c1"># OF INTEREST (i.e. rotated in the coordinate system)</span>
    <span class="n">local_rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">this_local_rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cs</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">global_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;point must be specified for Cylindrical coordinate systems&#39;</span><span class="p">)</span>
            <span class="n">local_point</span> <span class="o">=</span> <span class="n">local_coord</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">global_point</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">this_local_rotation</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">local_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cs</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">global_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;point must be specified for Spherical coordinate systems&#39;</span><span class="p">)</span>
            <span class="n">local_point</span> <span class="o">=</span> <span class="n">local_coord</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">global_point</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">this_local_rotation</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="n">local_point</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">@</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">local_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid coordinate system type </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">cs_type</span><span class="p">))</span>
        <span class="n">local_rotation</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_local_rotation</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...ik-&gt;...jk&#39;</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">local_rotation</span><span class="p">),</span> <span class="n">local_deflection</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoordinateSystemArray"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.CoordinateSystemArray.html#sdynpy.core.sdynpy_geometry.CoordinateSystemArray">[docs]</a><span class="k">class</span> <span class="nc">CoordinateSystemArray</span><span class="p">(</span><span class="n">SdynpyArray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coordinate System Information specifying position and directions.</span>

<span class="sd">    Use the coordinate_system_array helper function to create the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U40&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;cs_type&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Create the ndarray instance of our type, given the usual</span>
        <span class="c1"># ndarray input arguments.  This will call the standard</span>
        <span class="c1"># ndarray constructor, but return an object of our type.</span>
        <span class="c1"># It also triggers a call to InfoArray.__array_finalize__</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CoordinateSystemArray</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span>
                                                            <span class="n">CoordinateSystemArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="c1"># Finally, we must return the newly created object:</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;6s}</span><span class="s1">, </span><span class="si">{:&gt;20s}</span><span class="s1">, </span><span class="si">{:&gt;5s}</span><span class="s1">, </span><span class="si">{:&gt;10s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Color&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;----------- Empty -------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_NUMBER_REPR</span><span class="p">:</span>
                <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">break</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8}</span><span class="s1">, </span><span class="si">{:&gt;6}</span><span class="s1">, </span><span class="si">{:&gt;20}</span><span class="s1">, </span><span class="si">{:&gt;5}</span><span class="s1">, </span><span class="si">{:&gt;10}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">_cs_type_strings</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">cs_type</span><span class="p">[()]])</span>
        <span class="k">return</span> <span class="n">string_out</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_by_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select coordinate system by id rather than by index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index_by_id : int or np.ndarray</span>
<span class="sd">            ID number(s) to use to select coordinate systems.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If specified ID(s) not found in array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output : CoordinateSystemArray</span>
<span class="sd">            Subset of CoordinateSystemArray with the specified IDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[()]:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()}</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_by_id</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ID </span><span class="si">{:}</span><span class="s1"> not found in array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="CoordinateSystemArray.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.CoordinateSystemArray.html#sdynpy.core.sdynpy_geometry.CoordinateSystemArray.from_unv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="n">unv_data_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load CoordinateSystemArrays from universal file data from read_unv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_data_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>
<span class="sd">        combine : bool, optional</span>
<span class="sd">            If True, return as a single CoordinateSytemArray</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_arrays : CoordinateSystemArray</span>
<span class="sd">            Coordinate Systems read from unv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">unv_data_dict</span><span class="p">[</span><span class="mi">2420</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CoordinateSystemArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">output_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinate_system_array</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">cs_labels</span><span class="p">,</span>
                                                         <span class="n">dataset</span><span class="o">.</span><span class="n">cs_names</span><span class="p">,</span>
                                                         <span class="n">dataset</span><span class="o">.</span><span class="n">cs_colors</span><span class="p">,</span>
                                                         <span class="n">dataset</span><span class="o">.</span><span class="n">cs_types</span><span class="p">,</span>
                                                         <span class="n">dataset</span><span class="o">.</span><span class="n">cs_matrices</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">output_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">output_arrays</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_arrays</span></div></div>

<div class="viewcode-block" id="coordinate_system_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.coordinate_system_array.html#sdynpy.core.sdynpy_geometry.coordinate_system_array">[docs]</a><span class="k">def</span> <span class="nf">coordinate_system_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cs_type</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                            <span class="n">structured_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an array that specifies coordinate systems in the geometry</span>

<span class="sd">    Creates an array of coordinate systems that specify directions of sensors</span>
<span class="sd">    in a test or analysis.  Coordinate system arrays can be created using a</span>
<span class="sd">    numpy structured array or individual arrays for each attribute.</span>
<span class="sd">    Multidimensional arrays can be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : ndarray</span>
<span class="sd">        Integer array corresponding to the id of the coordinate systems. Input</span>
<span class="sd">        will be cast to an integer (i.e. 2.0 -&gt; 2, 1.9 -&gt; 1)</span>
<span class="sd">    name : ndarray</span>
<span class="sd">        name of the coordinate systems</span>
<span class="sd">    color : ndarray</span>
<span class="sd">        color of the coordinate systems as integers</span>
<span class="sd">    cs_type : ndarray</span>
<span class="sd">        Coordinate system types (0 = Cartesian, 1 = Polar, 2 = Spherical)</span>
<span class="sd">    matrix : ndarray</span>
<span class="sd">        Coordinate system transformation matrix with shape [... x 4 x 3]</span>
<span class="sd">    structured_array : ndarray (structured)</span>
<span class="sd">        Alternatively to the individual attributes, a single numpy structured</span>
<span class="sd">        array can be passed, which should have the same name as the inputs to</span>
<span class="sd">        the function listed above.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coordinate_system_array : CoordinateSystemArray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">structured_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">cs_type</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;cs_type&#39;</span><span class="p">]</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;matrix&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;structured_array must be numpy.ndarray with dtype names &quot;id&quot;, &quot;name&quot;, &quot;color&quot;, &quot;cs_type&quot; and &quot;matrix&quot;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">cs_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cs_type</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="c1"># Don&#39;t check shapes because we want them to be broadcastable, but id have to</span>
    <span class="c1"># be unique so we will use that for the shape</span>
    <span class="n">coord_sys_array</span> <span class="o">=</span> <span class="n">CoordinateSystemArray</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">coord_sys_array</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="n">coord_sys_array</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">coord_sys_array</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="n">coord_sys_array</span><span class="o">.</span><span class="n">cs_type</span> <span class="o">=</span> <span class="n">cs_type</span>
    <span class="n">coord_sys_array</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span>

    <span class="k">return</span> <span class="n">coord_sys_array</span></div>

<div class="viewcode-block" id="ElementArray"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ElementArray.html#sdynpy.core.sdynpy_geometry.ElementArray">[docs]</a><span class="k">class</span> <span class="nc">ElementArray</span><span class="p">(</span><span class="n">SdynpyArray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Element information array</span>

<span class="sd">    Use the element_array helper function to create the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;uint8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;connectivity&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Create the ndarray instance of our type, given the usual</span>
        <span class="c1"># ndarray input arguments.  This will call the standard</span>
        <span class="c1"># ndarray constructor, but return an object of our type.</span>
        <span class="c1"># It also triggers a call to InfoArray.__array_finalize__</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ElementArray</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span>
                                                   <span class="n">ElementArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="c1"># Finally, we must return the newly created object:</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;6s}</span><span class="s1">, </span><span class="si">{:&gt;4s}</span><span class="s1">, </span><span class="si">{:&gt;5s}</span><span class="s1">, </span><span class="si">{:&gt;7s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Color&#39;</span><span class="p">,</span> <span class="s1">&#39;# Nodes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;----------- Empty -------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_NUMBER_REPR</span><span class="p">:</span>
                <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">break</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8}</span><span class="s1">, </span><span class="si">{:&gt;6}</span><span class="s1">, </span><span class="si">{:&gt;4}</span><span class="s1">, </span><span class="si">{:&gt;5}</span><span class="s1">, </span><span class="si">{:&gt;7}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">string_out</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_by_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select elements by id rather than by index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index_by_id : int or np.ndarray</span>
<span class="sd">            ID number(s) to use to select elements.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If specified ID(s) not found in array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output : ElementArray</span>
<span class="sd">            Subset of ElementArray with the specified IDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[()]:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()}</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_by_id</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ID </span><span class="si">{:}</span><span class="s1"> not found in array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="ElementArray.reduce"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ElementArray.html#sdynpy.core.sdynpy_geometry.ElementArray.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep only elements that have all nodes contained in node_list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_list : iterable</span>
<span class="sd">            Iterable containing nodes to keep.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ElementArray</span>
<span class="sd">            ElementArray containing only elements with all nodes in node_list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">node_list</span><span class="p">)):</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ElementArray</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElementArray.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.ElementArray.html#sdynpy.core.sdynpy_geometry.ElementArray.from_unv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="n">unv_data_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load ElementArrays from universal file data from read_unv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_data_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>
<span class="sd">        combine : bool, optional</span>
<span class="sd">            If True, return as a single ElementArray</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_arrays : ElementArray</span>
<span class="sd">            Elements read from unv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">unv_data_dict</span><span class="p">[</span><span class="mi">2412</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ElementArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">output_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_array</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">element_labels</span><span class="p">,</span>
                                               <span class="n">dataset</span><span class="o">.</span><span class="n">fe_descriptor_ids</span><span class="p">,</span>
                                               <span class="n">dataset</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span>
                                               <span class="n">dataset</span><span class="o">.</span><span class="n">connectivities</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">output_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">output_arrays</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_arrays</span></div></div>


<div class="viewcode-block" id="element_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.element_array.html#sdynpy.core.sdynpy_geometry.element_array">[docs]</a><span class="k">def</span> <span class="nf">element_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">structured_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an array that specifies elements in the geometry</span>

<span class="sd">    Creates an array of elements that specify connectivity of sensors</span>
<span class="sd">    in a test or analysis.  Element arrays can be created using a</span>
<span class="sd">    numpy structured array or individual arrays for each attribute.</span>
<span class="sd">    Multidimensional arrays can be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : ndarray</span>
<span class="sd">        Integer array corresponding to the id of the node. Input</span>
<span class="sd">        will be cast to an integer (i.e. 2.0 -&gt; 2, 1.9 -&gt; 1)</span>
<span class="sd">    type : ndarray</span>
<span class="sd">        Element types.  See notes for type mapping</span>
<span class="sd">    color : ndarray</span>
<span class="sd">        color of the elements as integers</span>
<span class="sd">    connectivity : ndarray</span>
<span class="sd">        An object array of iterables defining the connectivity for each element.</span>
<span class="sd">    structured_array : ndarray (structured)</span>
<span class="sd">        Alternatively to the individual attributes, a single numpy structured</span>
<span class="sd">        array can be passed, which should have the same name as the inputs to</span>
<span class="sd">        the function listed above.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    element_array : ElementArray</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Here is a list of element types</span>

<span class="sd">       11 : &#39;Rod&#39;,</span>
<span class="sd">       21 : &#39;Linear beam&#39;,</span>
<span class="sd">       22 : &#39;Tapered beam&#39;,</span>
<span class="sd">       23 : &#39;Curved beam&#39;,</span>
<span class="sd">       24 : &#39;Parabolic beam&#39;,</span>
<span class="sd">       31 : &#39;Straight pipe&#39;,</span>
<span class="sd">       32 : &#39;Curved pipe&#39;,</span>
<span class="sd">       41 : &#39;Plane Stress Linear Triangle&#39;,</span>
<span class="sd">       42 : &#39;Plane Stress Parabolic Triangle&#39;,</span>
<span class="sd">       43 : &#39;Plane Stress Cubic Triangle&#39;,</span>
<span class="sd">       44 : &#39;Plane Stress Linear Quadrilateral&#39;,</span>
<span class="sd">       45 : &#39;Plane Stress Parabolic Quadrilateral&#39;,</span>
<span class="sd">       46 : &#39;Plane Strain Cubic Quadrilateral&#39;,</span>
<span class="sd">       51 : &#39;Plane Strain Linear Triangle&#39;,</span>
<span class="sd">       52 : &#39;Plane Strain Parabolic Triangle&#39;,</span>
<span class="sd">       53 : &#39;Plane Strain Cubic Triangle&#39;,</span>
<span class="sd">       54 : &#39;Plane Strain Linear Quadrilateral&#39;,</span>
<span class="sd">       55 : &#39;Plane Strain Parabolic Quadrilateral&#39;,</span>
<span class="sd">       56 : &#39;Plane Strain Cubic Quadrilateral&#39;,</span>
<span class="sd">       61 : &#39;Plate Linear Triangle&#39;,</span>
<span class="sd">       62 : &#39;Plate Parabolic Triangle&#39;,</span>
<span class="sd">       63 : &#39;Plate Cubic Triangle&#39;,</span>
<span class="sd">       64 : &#39;Plate Linear Quadrilateral&#39;,</span>
<span class="sd">       65 : &#39;Plate Parabolic Quadrilateral&#39;,</span>
<span class="sd">       66 : &#39;Plate Cubic Quadrilateral&#39;,</span>
<span class="sd">       71 : &#39;Membrane Linear Quadrilateral&#39;,</span>
<span class="sd">       72 : &#39;Membrane Parabolic Triangle&#39;,</span>
<span class="sd">       73 : &#39;Membrane Cubic Triangle&#39;,</span>
<span class="sd">       74 : &#39;Membrane Linear Triangle&#39;,</span>
<span class="sd">       75 : &#39;Membrane Parabolic Quadrilateral&#39;,</span>
<span class="sd">       76 : &#39;Membrane Cubic Quadrilateral&#39;,</span>
<span class="sd">       81 : &#39;Axisymetric Solid Linear Triangle&#39;,</span>
<span class="sd">       82 : &#39;Axisymetric Solid Parabolic Triangle&#39;,</span>
<span class="sd">       84 : &#39;Axisymetric Solid Linear Quadrilateral&#39;,</span>
<span class="sd">       85 : &#39;Axisymetric Solid Parabolic Quadrilateral&#39;,</span>
<span class="sd">       91 : &#39;Thin Shell Linear Triangle&#39;,</span>
<span class="sd">       92 : &#39;Thin Shell Parabolic Triangle&#39;,</span>
<span class="sd">       93 : &#39;Thin Shell Cubic Triangle&#39;,</span>
<span class="sd">       94 : &#39;Thin Shell Linear Quadrilateral&#39;,</span>
<span class="sd">       95 : &#39;Thin Shell Parabolic Quadrilateral&#39;,</span>
<span class="sd">       96 : &#39;Thin Shell Cubic Quadrilateral&#39;,</span>
<span class="sd">       101: &#39;Thick Shell Linear Wedge&#39;,</span>
<span class="sd">       102: &#39;Thick Shell Parabolic Wedge&#39;,</span>
<span class="sd">       103: &#39;Thick Shell Cubic Wedge&#39;,</span>
<span class="sd">       104: &#39;Thick Shell Linear Brick&#39;,</span>
<span class="sd">       105: &#39;Thick Shell Parabolic Brick&#39;,</span>
<span class="sd">       106: &#39;Thick Shell Cubic Brick&#39;,</span>
<span class="sd">       111: &#39;Solid Linear Tetrahedron&#39;,</span>
<span class="sd">       112: &#39;Solid Linear Wedge&#39;,</span>
<span class="sd">       113: &#39;Solid Parabolic Wedge&#39;,</span>
<span class="sd">       114: &#39;Solid Cubic Wedge&#39;,</span>
<span class="sd">       115: &#39;Solid Linear Brick&#39;,</span>
<span class="sd">       116: &#39;Solid Parabolic Brick&#39;,</span>
<span class="sd">       117: &#39;Solid Cubic Brick&#39;,</span>
<span class="sd">       118: &#39;Solid Parabolic Tetrahedron&#39;,</span>
<span class="sd">       121: &#39;Rigid Bar&#39;,</span>
<span class="sd">       122: &#39;Rigid Element&#39;,</span>
<span class="sd">       136: &#39;Node To Node Translational Spring&#39;,</span>
<span class="sd">       137: &#39;Node To Node Rotational Spring&#39;,</span>
<span class="sd">       138: &#39;Node To Ground Translational Spring&#39;,</span>
<span class="sd">       139: &#39;Node To Ground Rotational Spring&#39;,</span>
<span class="sd">       141: &#39;Node To Node Damper&#39;,</span>
<span class="sd">       142: &#39;Node To Gound Damper&#39;,</span>
<span class="sd">       151: &#39;Node To Node Gap&#39;,</span>
<span class="sd">       152: &#39;Node To Ground Gap&#39;,</span>
<span class="sd">       161: &#39;Lumped Mass&#39;,</span>
<span class="sd">       171: &#39;Axisymetric Linear Shell&#39;,</span>
<span class="sd">       172: &#39;Axisymetric Parabolic Shell&#39;,</span>
<span class="sd">       181: &#39;Constraint&#39;,</span>
<span class="sd">       191: &#39;Plastic Cold Runner&#39;,</span>
<span class="sd">       192: &#39;Plastic Hot Runner&#39;,</span>
<span class="sd">       193: &#39;Plastic Water Line&#39;,</span>
<span class="sd">       194: &#39;Plastic Fountain&#39;,</span>
<span class="sd">       195: &#39;Plastic Baffle&#39;,</span>
<span class="sd">       196: &#39;Plastic Rod Heater&#39;,</span>
<span class="sd">       201: &#39;Linear node-to-node interface&#39;,</span>
<span class="sd">       202: &#39;Linear edge-to-edge interface&#39;,</span>
<span class="sd">       203: &#39;Parabolic edge-to-edge interface&#39;,</span>
<span class="sd">       204: &#39;Linear face-to-face interface&#39;,</span>
<span class="sd">       208: &#39;Parabolic face-to-face interface&#39;,</span>
<span class="sd">       212: &#39;Linear axisymmetric interface&#39;,</span>
<span class="sd">       213: &#39;Parabolic axisymmetric interface&#39;,</span>
<span class="sd">       221: &#39;Linear rigid surface&#39;,</span>
<span class="sd">       222: &#39;Parabolic rigid surface&#39;,</span>
<span class="sd">       231: &#39;Axisymetric linear rigid surface&#39;,</span>
<span class="sd">       232: &#39;Axisymentric parabolic rigid surface&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">structured_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;structured_array must be numpy.ndarray with dtype names &quot;id&quot;, &quot;type&quot;, &quot;color&quot;, and &quot;connectivity&quot;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="c1"># Need to make connectivity an object array so don&#39;t do this!</span>
        <span class="c1"># connectivity = np.array(connectivity,dtype=object)</span>

    <span class="c1"># Don&#39;t check shapes because we want them to be broadcastable, but id have to</span>
    <span class="c1"># be unique so we will use that for the shape</span>
    <span class="n">earray</span> <span class="o">=</span> <span class="n">ElementArray</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">earray</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="n">earray</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="n">earray</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">earray</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># This is gross, but it works!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">earray</span><span class="p">,</span> <span class="s1">&#39;connectivity&#39;</span><span class="p">)[()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint32&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="n">earray</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint32&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">earray</span></div>


<div class="viewcode-block" id="NodeArray"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray">[docs]</a><span class="k">class</span> <span class="nc">NodeArray</span><span class="p">(</span><span class="n">SdynpyArray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Node information array</span>

<span class="sd">    Use the node_array helper function to create the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;coordinate&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;def_cs&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;disp_cs&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Create the ndarray instance of our type, given the usual</span>
        <span class="c1"># ndarray input arguments.  This will call the standard</span>
        <span class="c1"># ndarray constructor, but return an object of our type.</span>
        <span class="c1"># It also triggers a call to InfoArray.__array_finalize__</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NodeArray</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span>
                                                <span class="n">NodeArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="c1"># Finally, we must return the newly created object:</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;6s}</span><span class="s1">, </span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;5s}</span><span class="s1">, </span><span class="si">{:&gt;5s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;DefCS&#39;</span><span class="p">,</span> <span class="s1">&#39;DisCS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;----------- Empty -------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_NUMBER_REPR</span><span class="p">:</span>
                <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">break</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8}</span><span class="s1">, </span><span class="si">{:&gt;6}</span><span class="s1">, </span><span class="si">{:&gt;8.3f}</span><span class="s1">, </span><span class="si">{:&gt;8.3f}</span><span class="s1">, </span><span class="si">{:&gt;8.3f}</span><span class="s1">, </span><span class="si">{:&gt;5}</span><span class="s1">, </span><span class="si">{:&gt;5}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">*</span><span class="n">val</span><span class="o">.</span><span class="n">coordinate</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">def_cs</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string_out</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_by_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select nodes by id rather than by index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index_by_id : int or np.ndarray</span>
<span class="sd">            ID number(s) to use to select nodes.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If specified ID(s) not found in array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output : NodeArray</span>
<span class="sd">            Subset of NodeArray with the specified IDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[()]:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()}</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_by_id</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ID </span><span class="si">{:}</span><span class="s1"> not found in array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="NodeArray.reduce"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep only nodes that are contained in node_list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_list : iterable</span>
<span class="sd">            Iterable containing nodes to keep.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NodeArray</span>
<span class="sd">            NodeArray containing only nodes in node_list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeArray.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.from_unv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="n">unv_data_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load NodeArrays from universal file data from read_unv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_data_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>
<span class="sd">        combine : bool, optional</span>
<span class="sd">            If True, return as a single NodeArray</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_arrays : NodeArray</span>
<span class="sd">            Nodes read from unv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">unv_data_dict</span><span class="p">[</span><span class="mi">2411</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">NodeArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">output_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_array</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_labels</span><span class="p">,</span>
                                            <span class="n">dataset</span><span class="o">.</span><span class="n">coordinates</span><span class="p">,</span>
                                            <span class="n">dataset</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span>
                                            <span class="n">dataset</span><span class="o">.</span><span class="n">export_coordinate_systems</span><span class="p">,</span>
                                            <span class="n">dataset</span><span class="o">.</span><span class="n">displacement_coordinate_systems</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">output_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">output_arrays</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_arrays</span></div>

<div class="viewcode-block" id="NodeArray.by_position"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.by_position">[docs]</a>    <span class="k">def</span> <span class="nf">by_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position_array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select node by closest position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position_array : np.ndarray</span>
<span class="sd">            A (...,3) shape array containing positions of nodes to keep</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NodeArray</span>
<span class="sd">            NodArray containing nodes that were closest to the positions in</span>
<span class="sd">            position_array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">-</span> <span class="n">position_array</span><span class="p">[(</span><span class="bp">Ellipsis</span><span class="p">,)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_differences</span> <span class="o">=</span> <span class="n">node_differences</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">position_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="n">node_differences</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">node_indices</span><span class="p">]</span></div>

<div class="viewcode-block" id="NodeArray.project_to_minimum_plane"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.project_to_minimum_plane">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">project_to_minimum_plane</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">return_3D</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projects coordinates to a single best-fit plane</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : np.ndarray</span>
<span class="sd">            A (...,3) coordinate array.</span>
<span class="sd">        return_3D : bool, optional</span>
<span class="sd">            If True, return the 3D coordinates of the projected points.</span>
<span class="sd">            Otherwise return the projected 2D coordinate. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Points projected to a best-fit plane.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">-=</span> <span class="n">mean</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">coords</span>
        <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">return_3D</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">U</span> <span class="o">@</span> <span class="n">coords</span> <span class="o">+</span> <span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="NodeArray.global_coordinate"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.global_coordinate">[docs]</a>    <span class="k">def</span> <span class="nf">global_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs_array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the global coordinate of each node</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cs_array : CoordinateSystemArray</span>
<span class="sd">            CoordinateSystemArray consisting of the local coordinate systems for</span>
<span class="sd">            each node</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        points : np.ndarray</span>
<span class="sd">            Coordinates of the nodes in the global coordinate system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="n">cs_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">points</span></div>

<div class="viewcode-block" id="NodeArray.triangulate"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.triangulate">[docs]</a>    <span class="k">def</span> <span class="nf">triangulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs_array</span><span class="p">,</span> <span class="n">projection_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">return_element_array</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">element_color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">condition_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates elements for a node set using Delaunay Triangulation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cs_array : CoordinateSystemArray</span>
<span class="sd">            CoordinateSystemArray containing coordinate systems for each node.</span>
<span class="sd">        projection_function : function, optional</span>
<span class="sd">            Function to use to project 3D coordinates to 2D coordinates for </span>
<span class="sd">            triangulation. The default is None.</span>
<span class="sd">        return_element_array : bool, optional</span>
<span class="sd">            Returns an ElementArray if True, otherwise it simply returns the</span>
<span class="sd">            triangle simplices. The default is True.</span>
<span class="sd">        element_color : np.ndarray or int, optional</span>
<span class="sd">            Integers representing colors applied to the elements.</span>
<span class="sd">            The default is 1.</span>
<span class="sd">        condition_threshold : float, optional</span>
<span class="sd">            Condition number threshold used to remove triangles that are poorly</span>
<span class="sd">            shaped. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ElementArray or np.ndarray</span>
<span class="sd">            ElementArray containing elements or np.ndarray containing triangle</span>
<span class="sd">            simplices.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">projection_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">projection_function</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_to_minimum_plane</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Compute global positions of the nodes</span>
        <span class="n">global_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_coordinate</span><span class="p">(</span><span class="n">cs_array</span><span class="p">)</span>
        <span class="c1"># Now compute the projection function</span>
        <span class="n">projected_positions</span> <span class="o">=</span> <span class="n">projection_function</span><span class="p">(</span><span class="n">global_positions</span><span class="p">)</span>
        <span class="c1"># Now triangulate</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">projected_positions</span><span class="p">)</span>
        <span class="n">simplices</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">simplices</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">condition_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Now remove small triangles via condition number</span>
            <span class="n">tri_points</span> <span class="o">=</span> <span class="n">projected_positions</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">tri_points</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tri_points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">simplices</span> <span class="o">=</span> <span class="n">simplices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">tri_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">condition_threshold</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_element_array</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">simplices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create an element array</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">simplices</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">element_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                 <span class="nb">type</span><span class="o">=</span><span class="mi">61</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">element_color</span><span class="p">,</span>
                                 <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeArray.by_grid"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.by_grid">[docs]</a>    <span class="k">def</span> <span class="nf">by_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_spacing</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">x_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects nodes in a grid</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        grid_spacing : float</span>
<span class="sd">            Approximate grid spacing between selected nodes</span>
<span class="sd">        x_min : float, optional</span>
<span class="sd">            Minimum X-value of the grid.</span>
<span class="sd">            The default is the minimum node x-coordinate.</span>
<span class="sd">        y_min : float, optional</span>
<span class="sd">            Minimun Y-value of the grid.</span>
<span class="sd">            The default is the minimum node y-coordinate.</span>
<span class="sd">        z_min : float, optional</span>
<span class="sd">            Minimum Z-value of the grid.</span>
<span class="sd">            The default is the minimum node z-coordinate.</span>
<span class="sd">        x_max : float, optional</span>
<span class="sd">            Maximum X-value of the grid.</span>
<span class="sd">            The default is the maximum node x-coordinate.</span>
<span class="sd">        y_max : float, optional</span>
<span class="sd">            Maximum Y-value of the grid.</span>
<span class="sd">            The default is the maximum node y-coordinate.</span>
<span class="sd">        z_max : float, optional</span>
<span class="sd">            Maximum Z-value of the grid.</span>
<span class="sd">            The default is the maximum node z-coordinate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NodeArray</span>
<span class="sd">            NodeArray containing the closest nodes to the grid points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">y_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">z_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">y_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">z_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">z_min</span><span class="p">))</span>
        <span class="n">max_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_max</span><span class="p">))</span>
        <span class="n">range_coords</span> <span class="o">=</span> <span class="n">max_coords</span> <span class="o">-</span> <span class="n">min_coords</span>
        <span class="n">num_grids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">range_coords</span> <span class="o">/</span> <span class="n">grid_spacing</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Now we will create the grid in each dimension using linspace</span>
        <span class="n">grid_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_coord</span><span class="p">,</span> <span class="n">max_coord</span><span class="p">,</span> <span class="n">num_coord</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">min_coord</span><span class="p">,</span> <span class="n">max_coord</span><span class="p">,</span> <span class="n">num_coord</span>
                       <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">min_coords</span><span class="p">,</span> <span class="n">max_coords</span><span class="p">,</span> <span class="n">num_grids</span><span class="p">)]</span>
        <span class="c1"># We will then use meshgrid to assemble the array grid.  We will flatten the</span>
        <span class="c1"># point dimension and transpose so the array has shape (n_points x 3)</span>
        <span class="n">grid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">grid_arrays</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Now we will select nodes that are closest to the points in the grid</span>
        <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_position</span><span class="p">(</span><span class="n">grid_points</span><span class="p">)</span>
        <span class="c1"># Reduce to only nodes that are within one grid spacing of their requested point</span>
        <span class="c1"># this reduces the nodes that are selected by points far from the model</span>
        <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="n">candidate_nodes</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">-</span> <span class="n">grid_points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">grid_spacing</span><span class="p">]</span>
        <span class="c1"># Remove any duplicates</span>
        <span class="n">candidate_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">candidate_nodes</span><span class="p">(</span><span class="n">candidate_node_ids</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="node_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.node_array.html#sdynpy.core.sdynpy_geometry.node_array">[docs]</a><span class="k">def</span> <span class="nf">node_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">coordinate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">def_cs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp_cs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">structured_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an array that specifies nodes in the geometry</span>

<span class="sd">    Creates an array of nodes that specify positions of sensors</span>
<span class="sd">    in a test or analysis.  Node arrays can be created using a</span>
<span class="sd">    numpy structured array or individual arrays for each attribute.</span>
<span class="sd">    Multidimensional arrays can be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : ndarray</span>
<span class="sd">        Integer array corresponding to the id of the node. Input</span>
<span class="sd">        will be cast to an integer (i.e. 2.0 -&gt; 2, 1.9 -&gt; 1)</span>
<span class="sd">    coordinate : ndarray</span>
<span class="sd">        Positions of the nodes in space</span>
<span class="sd">    color : ndarray</span>
<span class="sd">        color of the nodes as integers</span>
<span class="sd">    def_cs : ndarray</span>
<span class="sd">        Coordinate system where the node&#39;s position is defined</span>
<span class="sd">    disp_cs : ndarray</span>
<span class="sd">        Coordinate system where the node&#39;s displacements are defined</span>
<span class="sd">    structured_array : ndarray (structured)</span>
<span class="sd">        Alternatively to the individual attributes, a single numpy structured</span>
<span class="sd">        array can be passed, which should have the same name as the inputs to</span>
<span class="sd">        the function listed above.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    node_array : NodeArray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">structured_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">coordinate</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">def_cs</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;def_cs&#39;</span><span class="p">]</span>
            <span class="n">disp_cs</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;disp_cs&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;structured_array must be numpy.ndarray with dtype names &quot;id&quot;, &quot;coordinate&quot;, &quot;color&quot;, &quot;def_cs&quot; and &quot;disp_cs&quot;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">coordinate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">def_cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">def_cs</span><span class="p">)</span>
        <span class="n">disp_cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">disp_cs</span><span class="p">)</span>

    <span class="c1"># Don&#39;t check shapes because we want them to be broadcastable, but id have to</span>
    <span class="c1"># be unique so we will use that for the shape</span>
    <span class="n">narray</span> <span class="o">=</span> <span class="n">NodeArray</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">narray</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="n">narray</span><span class="o">.</span><span class="n">coordinate</span> <span class="o">=</span> <span class="n">coordinate</span>
    <span class="n">narray</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="n">narray</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">=</span> <span class="n">def_cs</span>
    <span class="n">narray</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="n">disp_cs</span>

    <span class="k">return</span> <span class="n">narray</span></div>


<div class="viewcode-block" id="TracelineArray"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TracelineArray.html#sdynpy.core.sdynpy_geometry.TracelineArray">[docs]</a><span class="k">class</span> <span class="nc">TracelineArray</span><span class="p">(</span><span class="n">SdynpyArray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Traceline information array</span>

<span class="sd">    Use the traceline_array helper function to create the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;uint64&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;U40&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;connectivity&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Create the ndarray instance of our type, given the usual</span>
        <span class="c1"># ndarray input arguments.  This will call the standard</span>
        <span class="c1"># ndarray constructor, but return an object of our type.</span>
        <span class="c1"># It also triggers a call to InfoArray.__array_finalize__</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TracelineArray</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span>
                                                     <span class="n">TracelineArray</span><span class="o">.</span><span class="n">data_dtype</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
        <span class="c1"># Finally, we must return the newly created object:</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;6s}</span><span class="s1">, </span><span class="si">{:&gt;20s}</span><span class="s1">, </span><span class="si">{:&gt;5s}</span><span class="s1">, </span><span class="si">{:&gt;7s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Color&#39;</span><span class="p">,</span> <span class="s1">&#39;# Nodes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;----------- Empty -------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_NUMBER_REPR</span><span class="p">:</span>
                <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">  .</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">break</span>
            <span class="n">string_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&gt;8s}</span><span class="s1">, </span><span class="si">{:&gt;6d}</span><span class="s1">, </span><span class="si">{:&gt;20s}</span><span class="s1">, </span><span class="si">{:&gt;5d}</span><span class="s1">, </span><span class="si">{:&gt;7d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">string_out</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_by_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select nodes by id rather than by index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index_by_id : int or np.ndarray</span>
<span class="sd">            ID number(s) to use to select nodes.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If specified ID(s) not found in array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output : TracelineArray</span>
<span class="sd">            Subset of TracelineArray with the specified IDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[()]:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()}</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_by_id</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ids</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ID </span><span class="si">{:}</span><span class="s1"> not found in array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="TracelineArray.reduce"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TracelineArray.html#sdynpy.core.sdynpy_geometry.TracelineArray.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep only tracelines fully contain nodes in node_list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_list : iterable</span>
<span class="sd">            Iterable containing nodes to keep.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TracelineArray</span>
<span class="sd">            TracelineArray containing lines that contain only nodes in node_list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">traceline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">node_list</span><span class="p">)):</span>
                <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traceline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">TracelineArray</span><span class="p">)</span></div>

<div class="viewcode-block" id="TracelineArray.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.TracelineArray.html#sdynpy.core.sdynpy_geometry.TracelineArray.from_unv">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="n">unv_data_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load TracelineArrays from universal file data from read_unv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_data_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>
<span class="sd">        combine : bool, optional</span>
<span class="sd">            If True, return as a single TracelineArray object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_arrays : TracelineArray</span>
<span class="sd">            Tracelines read from unv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="n">unv_data_dict</span><span class="p">[</span><span class="mi">82</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">TracelineArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="n">output_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">output_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traceline_array</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">traceline_number</span><span class="p">,</span>
                                                 <span class="n">dataset</span><span class="o">.</span><span class="n">identification</span><span class="p">,</span>
                                                 <span class="n">dataset</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
                                                 <span class="n">dataset</span><span class="o">.</span><span class="n">nodes</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">output_arrays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">output_arrays</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_arrays</span></div></div>


<div class="viewcode-block" id="traceline_array"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.traceline_array.html#sdynpy.core.sdynpy_geometry.traceline_array">[docs]</a><span class="k">def</span> <span class="nf">traceline_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">structured_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an array that specifies tracelines in the geometry</span>

<span class="sd">    Creates an array of tracelines that specify connectivity of sensors</span>
<span class="sd">    in a test or analysis.  Traceline arrays can be created using a</span>
<span class="sd">    numpy structured array or individual arrays for each attribute.</span>
<span class="sd">    Multidimensional arrays can be used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    id : ndarray</span>
<span class="sd">        Integer array corresponding to the id of the node. Input</span>
<span class="sd">        will be cast to an integer (i.e. 2.0 -&gt; 2, 1.9 -&gt; 1)</span>
<span class="sd">    Description : ndarray</span>
<span class="sd">        Traceline name</span>
<span class="sd">    color : ndarray</span>
<span class="sd">        color of the elements as integers</span>
<span class="sd">    connectivity : ndarray</span>
<span class="sd">        An object array of iterables defining the connectivity for each traceline.</span>
<span class="sd">    structured_array : ndarray (structured)</span>
<span class="sd">        Alternatively to the individual attributes, a single numpy structured</span>
<span class="sd">        array can be passed, which should have the same name as the inputs to</span>
<span class="sd">        the function listed above.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    traceline_array : TracelineArray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">structured_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">structured_array</span><span class="p">[</span><span class="s1">&#39;connectivity&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;structured_array must be numpy.ndarray with dtype names &quot;id&quot;, &quot;color&quot;, &quot;description&quot;, and &quot;connectivity&quot;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="c1"># Don&#39;t do this, need to keep as an object dtype</span>
        <span class="c1"># connectivity = np.array(connectivity)</span>

    <span class="c1"># Don&#39;t check shapes because we want them to be broadcastable, but id have to</span>
    <span class="c1"># be unique so we will use that for the shape</span>
    <span class="n">tlarray</span> <span class="o">=</span> <span class="n">TracelineArray</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">tlarray</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="n">tlarray</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="n">tlarray</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">tlarray</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">tlarray</span><span class="p">,</span> <span class="s1">&#39;connectivity&#39;</span><span class="p">)[()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint32&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="n">tlarray</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint32&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tlarray</span></div>


<span class="kn">from</span> <span class="nn">..fem.sdynpy_exodus</span> <span class="kn">import</span> <span class="n">Exodus</span><span class="p">,</span> <span class="n">ExodusInMemory</span>
<span class="kn">from</span> <span class="nn">.sdynpy_shape</span> <span class="kn">import</span> <span class="n">shape_array</span>

<div class="viewcode-block" id="Geometry"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry">[docs]</a><span class="k">class</span> <span class="nc">Geometry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for nodes, coordinate systems, tracelines, and elements</span>

<span class="sd">    Geometry is the class that is most useful for working with the positioning</span>
<span class="sd">    and spatial visualization of test or analysis data.  It contains functions</span>
<span class="sd">    to plot and animate 3D geometry&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Geometry.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">NodeArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">CoordinateSystemArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                 <span class="n">traceline</span><span class="o">=</span><span class="n">TracelineArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">element</span><span class="o">=</span><span class="n">ElementArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,))):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a geometry object with nodes, coordinate systems, tracelines,</span>
<span class="sd">        and elements.</span>

<span class="sd">        All input arguments will be flattened when passed to the Geometry, as</span>
<span class="sd">        the geometry does not support multi-dimensional object arrays.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : NodeArray, optional</span>
<span class="sd">            The set of nodes in the geometry. The default is NodeArray((0,)),</span>
<span class="sd">            an empty NodeArray.</span>
<span class="sd">        coordinate_system : CoordinateSystemArray, optional</span>
<span class="sd">            The set of coordinate systems in the geometry. The default is</span>
<span class="sd">            CoordinateSystemArray((0,)), an empty CoordinateSystemArray</span>
<span class="sd">        traceline : TracelineArray, optional</span>
<span class="sd">            The set of tracelines defined in the geometry. The default is</span>
<span class="sd">            TracelineArray((0,)), an empty TracelineArray</span>
<span class="sd">        element : ElementArray, optional</span>
<span class="sd">            The set of elements defined in the geometry. The default is</span>
<span class="sd">            ElementArray((0,)), an empty element array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">coordinate_system</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span> <span class="o">=</span> <span class="n">traceline</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string_out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinate_system&#39;</span><span class="p">,</span> <span class="s1">&#39;traceline&#39;</span><span class="p">,</span> <span class="s1">&#39;element&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">string_out</span>

<div class="viewcode-block" id="Geometry.reduce"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.reduce">[docs]</a>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduce the geometry to only contain nodes in `node_list`</span>

<span class="sd">        Elements and tracelines will only be kept if all nodes in each element</span>
<span class="sd">        or traceline are in `node_list`.  Coordinate systems will only be kept</span>
<span class="sd">        if they are required by a node in `node_list`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_list : iterable</span>
<span class="sd">            An iterable of integer node id numbers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            A geometry only containing the nodes in `node_list`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">traceline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)))</span>
        <span class="n">coordinate_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">css</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="p">,</span> <span class="n">traceline</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.add_traceline"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.add_traceline">[docs]</a>    <span class="k">def</span> <span class="nf">add_traceline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a traceline to the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        connectivity : iterable</span>
<span class="sd">            Iterable containing the node_ids to connect with the traceline</span>
<span class="sd">        id : TYPE, optional</span>
<span class="sd">            The id number of the new traceline. The default is None, which</span>
<span class="sd">            results in the new traceline having an id of one greater than the</span>
<span class="sd">            current maximum traceline it.</span>
<span class="sd">        description : str, optional</span>
<span class="sd">            A string description of the new traceline. The default is &#39;&#39;.</span>
<span class="sd">        color : int, optional</span>
<span class="sd">            An integer corresponding to the color of the new traceline.</span>
<span class="sd">            The default is 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.  Modifications are made in-place to the current geometry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">new_traceline</span> <span class="o">=</span> <span class="n">traceline_array</span><span class="p">((</span><span class="nb">id</span><span class="p">,),</span> <span class="n">description</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span>
                                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="p">,</span> <span class="n">new_traceline</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.add_element"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.add_element">[docs]</a>    <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">connectivity</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">new_element</span> <span class="o">=</span> <span class="n">element_array</span><span class="p">((</span><span class="nb">id</span><span class="p">,),</span><span class="n">elem_type</span><span class="p">,</span><span class="n">color</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span><span class="n">new_element</span><span class="p">))</span></div>

<div class="viewcode-block" id="Geometry.from_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.from_unv">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_unv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">unv_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a geometry from universal file format data from readunv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unv_dict : dict</span>
<span class="sd">            Dictionary containing data from read_unv</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            Geometry object read from the unv data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="n">CoordinateSystemArray</span><span class="o">.</span><span class="n">from_unv</span><span class="p">(</span><span class="n">unv_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="n">CoordinateSystemArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
        <span class="c1"># Nodes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">NodeArray</span><span class="o">.</span><span class="n">from_unv</span><span class="p">(</span><span class="n">unv_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cs_indices</span> <span class="o">=</span> <span class="n">coordinate_systems</span><span class="o">.</span><span class="n">id</span>
            <span class="k">for</span> <span class="n">node_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
                <span class="n">cs_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cs_indices</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">)</span>
                <span class="n">matching_cs</span> <span class="o">=</span> <span class="n">coordinate_systems</span><span class="p">[</span><span class="n">cs_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">matching_cs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Coordinate System </span><span class="si">{:}</span><span class="s1"> not found in universal file structure.  Adding Global Cartesian with ID </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">))</span>
                    <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">coordinate_system_array</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">,))))</span>
                    <span class="n">cs_indices</span> <span class="o">=</span> <span class="n">coordinate_systems</span><span class="o">.</span><span class="n">id</span>
            <span class="c1">#         cs_index = np.where(cs_indices == node.def_cs)</span>
            <span class="c1">#     node.coordinate = local_coord(coordinate_systems[cs_index][0],node.coordinate)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">NodeArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">ElementArray</span><span class="o">.</span><span class="n">from_unv</span><span class="p">(</span><span class="n">unv_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">ElementArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tracelines</span> <span class="o">=</span> <span class="n">TracelineArray</span><span class="o">.</span><span class="n">from_unv</span><span class="p">(</span><span class="n">unv_dict</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">tracelines</span> <span class="o">=</span> <span class="n">TracelineArray</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">tracelines</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span></div>

    <span class="n">from_uff</span> <span class="o">=</span> <span class="n">from_unv</span>

<div class="viewcode-block" id="Geometry.from_exodus"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.from_exodus">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_exodus</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">exo</span><span class="p">:</span> <span class="n">Exodus</span><span class="p">,</span> <span class="n">blocks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">preferred_local_orientation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span>
                    <span class="n">secondary_preferred_local_orientation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
                    <span class="n">local_nodes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a geometry from exodus file data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exo : Exodus or ExodusInMemory</span>
<span class="sd">            The exodus data from which geometry will be created.</span>
<span class="sd">        blocks : iterable, optional</span>
<span class="sd">            Iterable containing a set of block ids to import when creating the</span>
<span class="sd">            geometry.  The default is None, which uses all blocks in the model.</span>
<span class="sd">        local : bool, optional</span>
<span class="sd">            Flag to specify whether or not to create local coordinate systems</span>
<span class="sd">            for each node in the model.  This can be useful when creating</span>
<span class="sd">            instrumnetation positions from a finite element model, where the </span>
<span class="sd">            sensor will be oriented perpendicular to the surface it is mounted</span>
<span class="sd">            on.  The default is False, which returns all data in a single</span>
<span class="sd">            global coordinate system.</span>
<span class="sd">        preferred_local_orientation : np.ndarray, optional</span>
<span class="sd">            A preferred direction for the local coordinate system.  The first</span>
<span class="sd">            constraint is that the local Z+ axis is perpendicular to the</span>
<span class="sd">            surface.  The coordinate system will then try to align itself as</span>
<span class="sd">            much as it can with this direction.  The default is</span>
<span class="sd">            np.array((0.0,0.0,1.0)), which points the local coordinate systems</span>
<span class="sd">            along the global Z+ axis.</span>
<span class="sd">        secondary_preferred_local_orientation : np.ndarray, optional</span>
<span class="sd">            A secondary preferred direction is only used if the surface normal</span>
<span class="sd">            direction is parallel to the primary preferred_local_orientation. </span>
<span class="sd">            The default is np.array((1.0,0.0,0.0)), which points the local</span>
<span class="sd">            coordinate system along the local Z+ axis.</span>
<span class="sd">        local_nodes : np.ndarray, optional</span>
<span class="sd">            If specified, only create local coordinate systems at the specified</span>
<span class="sd">            nodes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            A geometry consisting of the finite element nodes and element</span>
<span class="sd">            connectivity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exo</span><span class="p">,</span> <span class="n">Exodus</span><span class="p">):</span>
            <span class="n">exo</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">load_into_memory</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[],</span> <span class="n">timesteps</span><span class="o">=</span><span class="p">[],</span> <span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">)</span>
        <span class="c1"># Get nodes</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exo</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_num_map</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">node_array</span><span class="p">(</span><span class="n">node_map</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
        <span class="n">tl_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elem_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tl_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elem_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elem_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">blocks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">blocks</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">exo</span><span class="o">.</span><span class="n">blocks</span> <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
            <span class="n">color_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">14</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="n">node_map</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">]</span>
            <span class="n">elem_type</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">elem_type</span>
            <span class="k">if</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Skip conmasses</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">connectivity</span><span class="p">:</span>
                <span class="n">elem_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="n">elem_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_index</span><span class="p">)</span>
                <span class="n">elem_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_exodus_elem_type_map</span><span class="p">[</span><span class="n">elem_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="n">tls</span> <span class="o">=</span> <span class="n">traceline_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tl_connectivity</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">tl_color</span><span class="p">,</span>
                              <span class="n">connectivity</span><span class="o">=</span><span class="n">tl_connectivity</span><span class="p">)</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="n">element_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elem_connectivity</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="n">elem_types</span><span class="p">,</span> <span class="n">elem_color</span><span class="p">,</span> <span class="n">elem_connectivity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">local</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">local_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node_map_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_map</span><span class="p">)}</span>
                <span class="n">local_node_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">node_map_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">local_nodes</span><span class="p">])</span>
                <span class="n">local_node_index_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_index</span><span class="p">:</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">node_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">local_node_indices</span><span class="p">)}</span>
            <span class="n">preferred_local_orientation</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">preferred_local_orientation</span><span class="p">)</span>
            <span class="n">secondary_preferred_local_orientation</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                <span class="n">secondary_preferred_local_orientation</span><span class="p">)</span>
            <span class="c1"># Go through each node, find the block that it&#39;s in, get its elements</span>
            <span class="n">normal_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="n">local_nodes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">local_nodes</span><span class="p">),</span>
                 <span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Skip conmasses</span>
                    <span class="k">continue</span>
                <span class="n">full_block_node_positions</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">normal_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">full_block_node_positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">full_block_node_positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
                                          <span class="n">full_block_node_positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">full_block_node_positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">normal_vectors</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">block_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">local_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">block_nodes</span> <span class="o">=</span> <span class="n">local_node_indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">local_node_indices</span><span class="p">,</span><span class="n">block_nodes</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">block_nodes</span><span class="p">:</span>
                    <span class="n">node_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">node_normals</span> <span class="o">=</span> <span class="n">normal_vectors</span><span class="p">[</span><span class="n">node_elements</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">local_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">normal_sum</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">node_normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">normal_sum</span><span class="p">[</span><span class="n">local_node_index_map</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">node_normals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Put small nodes to reasonable values to avoid divide by zero</span>
            <span class="n">normal_sum</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal_sum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-14</span><span class="p">]</span> <span class="o">=</span> <span class="n">preferred_local_orientation</span>
            <span class="n">node_rotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)</span> <span class="o">+</span> <span class="n">normal_sum</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">normal_sum</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal_sum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Find the nodes that are basically in the direction of the preferred direction</span>
            <span class="n">nodes_in_preferred_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,j-&gt;i&#39;</span><span class="p">,</span> <span class="n">node_rotations</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">preferred_local_orientation</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.99</span>
            <span class="c1"># Compute cross products if we are not parallel with the preferred orientation</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">~</span><span class="n">nodes_in_preferred_direction</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                <span class="n">node_rotations</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">~</span><span class="n">nodes_in_preferred_direction</span><span class="p">],</span> <span class="n">preferred_local_orientation</span><span class="p">)</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nodes_in_preferred_direction</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                <span class="n">node_rotations</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">nodes_in_preferred_direction</span><span class="p">],</span> <span class="n">secondary_preferred_local_orientation</span><span class="p">)</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">node_rotations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">node_rotations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_rotations</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">node_rotations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">node_rotations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">node_rotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">node_rotations</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Create the coordinate system matrix</span>
            <span class="n">cs_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_rotations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">node_rotations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">node_rotations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Put a global coordinate system at the end</span>
            <span class="n">cs_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cs_matrix</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">local_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cs_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_map</span><span class="p">,</span> <span class="p">(</span><span class="n">node_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">cs_descriptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Node </span><span class="si">{:}</span><span class="s1"> Disp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">node_map</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Global&#39;</span><span class="p">]</span>
                <span class="n">css</span> <span class="o">=</span> <span class="n">coordinate_system_array</span><span class="p">(</span><span class="n">cs_ids</span><span class="p">,</span> <span class="n">cs_descriptions</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cs_matrix</span><span class="p">)</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">=</span> <span class="n">cs_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="n">cs_ids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cs_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">local_nodes</span><span class="p">,</span> <span class="p">(</span><span class="n">node_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">cs_descriptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Node </span><span class="si">{:}</span><span class="s1"> Disp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">local_nodes</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Global&#39;</span><span class="p">]</span>
                <span class="n">css</span> <span class="o">=</span> <span class="n">coordinate_system_array</span><span class="p">(</span><span class="n">cs_ids</span><span class="p">,</span> <span class="n">cs_descriptions</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cs_matrix</span><span class="p">)</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">=</span> <span class="n">cs_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="n">cs_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">[</span><span class="n">local_node_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs_ids</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="n">coordinate_system_array</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">css</span><span class="p">,</span> <span class="n">tls</span><span class="p">,</span> <span class="n">elems</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.camera_visualization"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.camera_visualization">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">camera_visualization</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">RT</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a geometry used to visualize a camera specified with K and RT</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        K : ndarray</span>
<span class="sd">            A (...,3,3) matrix containing the intrinsic parameters of the cameras</span>
<span class="sd">        RT : ndarray</span>
<span class="sd">            A (...,3,4) matrix containing the extrinsic parameters of the cameras</span>
<span class="sd">        image_size : ndarray</span>
<span class="sd">            A (...,2) matrix containing the width,height of each camera</span>
<span class="sd">        size : float</span>
<span class="sd">            The distance that the rays will project from the pinhole of the camera</span>
<span class="sd">        colors : int or ndarray</span>
<span class="sd">            The colors assigned to each camera</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        geometry : cls</span>
<span class="sd">            A geoemtry containing the cameras that can be used for visualization</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">K</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">K</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RT</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">RT</span> <span class="o">=</span> <span class="n">RT</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">RT</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">RT</span> <span class="o">=</span> <span class="n">RT</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_size</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">image_size</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">image_size</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">image_size</span> <span class="o">=</span> <span class="n">image_size</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">coordinate_system</span><span class="o">=</span><span class="n">coordinate_system_array</span><span class="p">((</span><span class="mi">1</span><span class="p">,)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">thisK</span><span class="p">,</span> <span class="n">thisRT</span><span class="p">,</span> <span class="n">this_size</span><span class="p">,</span> <span class="n">this_color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">RT</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="n">colors</span><span class="p">)):</span>
            <span class="n">pixel_corners</span> <span class="o">=</span> <span class="n">corners</span> <span class="o">*</span> <span class="n">this_size</span>

            <span class="c1"># Compute the positions</span>
            <span class="n">image_corners</span> <span class="o">=</span> <span class="n">point_on_pixel</span><span class="p">(</span><span class="n">thisK</span><span class="p">,</span> <span class="n">thisRT</span><span class="p">,</span> <span class="n">pixel_corners</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">pinhole</span> <span class="o">=</span> <span class="o">-</span><span class="n">thisRT</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">thisRT</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:]</span>
            <span class="c1"># Create a geometry</span>
            <span class="n">pinhole_node</span> <span class="o">=</span> <span class="n">node_array</span><span class="p">(((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,),</span> <span class="n">pinhole</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">disp_cs</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">pixel_nodes</span> <span class="o">=</span> <span class="n">node_array</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                     <span class="n">image_corners</span><span class="p">,</span> <span class="n">disp_cs</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">coordinate_system_array</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,),</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisRT</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">pinhole_node</span><span class="p">,</span> <span class="n">pixel_nodes</span><span class="p">))</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">this_color</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geometry</span></div>

<div class="viewcode-block" id="Geometry.compress_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.compress_ids">[docs]</a>    <span class="k">def</span> <span class="nf">compress_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">compress_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">compress_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">compress_tracelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">compress_cs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">return_maps</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compresses ID numbers to make node, element, etc. contiguous</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        compress_nodes : bool, optional</span>
<span class="sd">            If True, compress the node ids.  The default is True.</span>
<span class="sd">        compress_elements : bool, optional</span>
<span class="sd">            If True, compress the element ids. The default is True.</span>
<span class="sd">        compress_tracelines : bool, optional</span>
<span class="sd">            If True, compress the traceline ids. The default is True.</span>
<span class="sd">        compress_cs : bool, optional</span>
<span class="sd">            If True, compress the coordinate system ids. The default is True.</span>
<span class="sd">        return_maps : bool, optional</span>
<span class="sd">            If True, return id maps for nodes, elements, tracelines, and</span>
<span class="sd">            coordinate systems.  Maps will be equal to `None` if no compression</span>
<span class="sd">            was done on that field. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mapped_geometry : Geometry</span>
<span class="sd">            Geometry with contiguous id numbers for the selected fields.</span>
<span class="sd">        node_map : id_map or `None`</span>
<span class="sd">            Mapping from the old set of nodes to the new set of nodes, only</span>
<span class="sd">            returned if `return_maps` is True.  If `compress_nodes` is False,</span>
<span class="sd">            this will be `None`.</span>
<span class="sd">        traceline_map : id_map or `None`</span>
<span class="sd">            Mapping from the old set of tracelines to the new set of tracelines, only</span>
<span class="sd">            returned if `return_maps` is True.  If `compress_tracelines` is False,</span>
<span class="sd">            this will be `None`.</span>
<span class="sd">        element_map : id_map or `None`</span>
<span class="sd">            Mapping from the old set of elements to the new set of elements, only</span>
<span class="sd">            returned if `return_maps` is True.  If `compress_elements` is False,</span>
<span class="sd">            this will be `None`.</span>
<span class="sd">        cs_map : id_map or `None`</span>
<span class="sd">            Mapping from the old set of coordinate systems to the new set of</span>
<span class="sd">            coordinate systems, only</span>
<span class="sd">            returned if `return_maps` is True.  If `compress_cs` is False,</span>
<span class="sd">            this will be `None`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">compress_nodes</span><span class="p">:</span>
            <span class="n">to_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">from_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">node_map</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">(</span><span class="n">from_nodes</span><span class="p">,</span><span class="n">to_nodes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">compress_cs</span><span class="p">:</span>
            <span class="n">to_cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">from_cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">cs_map</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">(</span><span class="n">from_cs</span><span class="p">,</span><span class="n">to_cs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cs_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">compress_elements</span><span class="p">:</span>
            <span class="n">to_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">from_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">element_map</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">(</span><span class="n">from_elements</span><span class="p">,</span><span class="n">to_elements</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">element_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">compress_tracelines</span><span class="p">:</span>
            <span class="n">to_tls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">from_tls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">traceline_map</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">(</span><span class="n">from_tls</span><span class="p">,</span><span class="n">to_tls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">traceline_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">mapped_geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_ids</span><span class="p">(</span><span class="n">node_map</span><span class="p">,</span><span class="n">traceline_map</span><span class="p">,</span><span class="n">element_map</span><span class="p">,</span><span class="n">cs_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_maps</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mapped_geometry</span><span class="p">,</span><span class="n">node_map</span><span class="p">,</span><span class="n">traceline_map</span><span class="p">,</span><span class="n">element_map</span><span class="p">,</span><span class="n">cs_map</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mapped_geometry</span></div>

<div class="viewcode-block" id="Geometry.from_imat_struct"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.from_imat_struct">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_imat_struct</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">imat_fem_struct</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a Geometry from an imat_fem class saved to a Matlab structure</span>

<span class="sd">        In IMAT, a structure can be created from an `imat_fem` by using the get()</span>
<span class="sd">        function.  This can then be saved to a .mat file and loaded using</span>
<span class="sd">        `scipy.io.loadmat`.  The output from loadmat can be passed into this function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imat_fem_struct : np.ndarray</span>
<span class="sd">            structure from loadmat containing data from an imat_fem</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            Geometry constructed from the data in the imat structure</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_struct</span> <span class="o">=</span> <span class="n">imat_fem_struct</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">cs_array</span> <span class="o">=</span> <span class="n">node_struct</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">node_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">node_struct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                           <span class="n">coordinate</span><span class="o">=</span><span class="n">node_struct</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">node_struct</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                           <span class="n">def_cs</span><span class="o">=</span><span class="n">cs_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">disp_cs</span><span class="o">=</span><span class="n">cs_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">cs_struct</span> <span class="o">=</span> <span class="n">imat_fem_struct</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">cs_ids</span> <span class="o">=</span> <span class="n">cs_struct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cs_ids</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cs_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">cs_struct</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cs_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">coordinate_system_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">cs_ids</span><span class="p">,</span>
                                      <span class="n">name</span><span class="o">=</span><span class="n">cs_names</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="n">cs_struct</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                      <span class="n">cs_type</span><span class="o">=</span><span class="n">cs_struct</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                      <span class="n">matrix</span><span class="o">=</span><span class="n">cs_struct</span><span class="p">[</span><span class="s1">&#39;matrix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">elem_struct</span> <span class="o">=</span> <span class="n">imat_fem_struct</span><span class="p">[</span><span class="s1">&#39;elem&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="n">element_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">elem_struct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                              <span class="nb">type</span><span class="o">=</span><span class="n">elem_struct</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">elem_struct</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                              <span class="n">connectivity</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">elem_struct</span><span class="p">[</span><span class="s1">&#39;conn&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
        <span class="n">tl_struct</span> <span class="o">=</span> <span class="n">imat_fem_struct</span><span class="p">[</span><span class="s1">&#39;tl&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">tl_ids</span> <span class="o">=</span> <span class="n">tl_struct</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tl_ids</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tl_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tl_struct</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tl_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tls</span> <span class="o">=</span> <span class="n">traceline_array</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tl_ids</span><span class="p">,</span>
                              <span class="n">description</span><span class="o">=</span><span class="n">tl_names</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">tl_struct</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                              <span class="n">connectivity</span><span class="o">=</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tl_struct</span><span class="p">[</span><span class="s1">&#39;conn&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">css</span><span class="p">,</span> <span class="n">tls</span><span class="p">,</span> <span class="n">elems</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.global_node_coordinate"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.global_node_coordinate">[docs]</a>    <span class="k">def</span> <span class="nf">global_node_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Position of the Geometry&#39;s nodes in the global coordinate system</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_ids : np.ndarray</span>
<span class="sd">            An array of node id numbers to keep in the output coordinate.  If</span>
<span class="sd">            not specified, all nodes will be returned in the order they are in</span>
<span class="sd">            the model.</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            numpy array with shape (n,3) where n is the number of nodes in the</span>
<span class="sd">            geometry.  This array contains the 3d position of each node in the</span>
<span class="sd">            global coordinate system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
        <span class="n">cs_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">global_coordinate</span><span class="p">(</span><span class="n">cs_array</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.node_by_global_position"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.node_by_global_position">[docs]</a>    <span class="k">def</span> <span class="nf">node_by_global_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">global_position_array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select node by closest position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        global_position_array : np.ndarray</span>
<span class="sd">            A (...,3) shape array containing positions of nodes to keep</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NodeArray</span>
<span class="sd">            NodArray containing nodes that were closest to the positions in</span>
<span class="sd">            position_array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_node_coordinate</span><span class="p">()</span> <span class="o">-</span> <span class="n">global_position_array</span><span class="p">[(</span><span class="bp">Ellipsis</span><span class="p">,)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ndim</span> <span class="o">+</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_differences</span> <span class="o">=</span> <span class="n">node_differences</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">global_position_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="n">node_differences</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">node_indices</span><span class="p">]</span></div>

<div class="viewcode-block" id="Geometry.global_deflection"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.global_deflection">[docs]</a>    <span class="k">def</span> <span class="nf">global_deflection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direction of local deflection in the global coordinate system</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinate_array : CoordinateArray</span>
<span class="sd">            A list of coordinates for which the global deformation direction</span>
<span class="sd">            will be computed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global_deflections : np.ndarray</span>
<span class="sd">            numpy array with shape (n,3) where n is the number of coordinates</span>
<span class="sd">            in the specified `coordinate_array`.  This array contains the 3d</span>
<span class="sd">            direction of motion for each coordinate in the global coordinate</span>
<span class="sd">            system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">local_deformations</span> <span class="o">=</span> <span class="n">coordinate_array</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
        <span class="n">ordered_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">coordinate_array</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">ordered_nodes</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
            <span class="n">ordered_nodes</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="n">ordered_nodes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">global_deflections</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span><span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">local_deformations</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">global_deflections</span></div>

<div class="viewcode-block" id="Geometry.overlay_geometries"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.overlay_geometries">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">overlay_geometries</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">color_override</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_node_id_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines several geometries, offsetting the id numbers to avoid conflicts</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometries : iterable</span>
<span class="sd">            An iterable of geometry objects that will be combined into a single</span>
<span class="sd">            geometry</span>
<span class="sd">        color_override : iterable, optional</span>
<span class="sd">            An iterble of integers specifying colors, which will override the</span>
<span class="sd">            existing geometry colors.  This should have the same length as the </span>
<span class="sd">            `geometries` input.  The default is None, which keeps the original</span>
<span class="sd">            geometry colors.</span>
<span class="sd">        return_node_id_offset : bool, optional</span>
<span class="sd">            Specifies whether or not the applied node offset should be returned,</span>
<span class="sd">            which is useful if the new node numbers are to be mapped to the old</span>
<span class="sd">            node numbers.  The default is False, which only returns the combined</span>
<span class="sd">            geometry.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            A geometry consisting of a combination of the specified geometries</span>
<span class="sd">        node_offset</span>
<span class="sd">            An integer specifying the node id offset applied to avoid conflicts</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">])</span>
        <span class="n">cs_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">])</span>
        <span class="n">tl_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">geometry</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">])</span>
        <span class="n">elem_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">geometry</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_node_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">max_node_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_cs_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cs_ids</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">max_cs_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_tl_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tl_ids</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">max_tl_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_elem_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">elem_ids</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">max_elem_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">node_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_node_id</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tl_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_tl_id</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">elem_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_elem_id</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cs_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_cs_id</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_geometries</span> <span class="o">=</span> <span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">modify_ids</span><span class="p">(</span>
            <span class="n">node_change</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">node_length</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">traceline_change</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">tl_length</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">element_change</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">elem_length</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">coordinate_system_change</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cs_length</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geometries</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">color_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">color_override</span><span class="p">):</span>
                <span class="n">new_geometries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
                <span class="n">new_geometries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
                <span class="n">new_geometries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
                <span class="n">new_geometries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>

        <span class="n">new_geometry</span> <span class="o">=</span> <span class="n">new_geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_geometries</span><span class="p">)):</span>
            <span class="n">new_geometry</span> <span class="o">=</span> <span class="n">new_geometry</span> <span class="o">+</span> <span class="n">new_geometries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">return_node_id_offset</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_geometry</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">node_length</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_geometry</span></div>

<div class="viewcode-block" id="Geometry.plot"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">line_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">view_up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the geometry in an interactive 3D window.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_size : int, optional</span>
<span class="sd">            Size to display the nodes in pixels.  Set to 0 to not display nodes. </span>
<span class="sd">            The default is 5.</span>
<span class="sd">        line_width : int, optional</span>
<span class="sd">            Width to display tracelines and element edges in pixels.  Set to 0</span>
<span class="sd">            to not show tracelines or edges.  The default is 1.</span>
<span class="sd">        opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the geometry.</span>
<span class="sd">            Set to 1 for completely opaque, and 0 for completely transparent </span>
<span class="sd">            (invisible).  The default is 1.0, no transparency.</span>
<span class="sd">        view_up : np.ndarray, optional</span>
<span class="sd">            Set the &quot;up&quot; direction in the plot by passing in a size-3 numpy</span>
<span class="sd">            array.  The default is None.</span>
<span class="sd">        view_from : np.ndarray, optional</span>
<span class="sd">            Specify the direction from which the geometry is viewed.  The </span>
<span class="sd">            default is None.</span>
<span class="sd">        plotter : BackgroundPlotter, optional</span>
<span class="sd">            A plotter can be specified to plot the geometry in an existing</span>
<span class="sd">            plot.  The default is None, which creates a new window and plot.</span>
<span class="sd">        show_edges : bool, optional</span>
<span class="sd">            Specify whether or not to draw edges on elements. The default is False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If referenced id numbers are not found in the corresponding object,</span>
<span class="sd">            for example if a traceline references node 11 but there is no node</span>
<span class="sd">            11 in the NodeArray</span>
<span class="sd">        ValueError</span>
<span class="sd">            If an invalid or unknown element type is used</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plotter : BackgroundPlotter</span>
<span class="sd">            A reference to the plotter object that the geometry was plotted in</span>
<span class="sd">        face_mesh : TYPE</span>
<span class="sd">            A reference to the mesh used to plot surface elements</span>
<span class="sd">        point_mesh : TYPE</span>
<span class="sd">            A reference to the mesh used to plot nodes and tracelines</span>
<span class="sd">        solid_mesh : TYPE</span>
<span class="sd">            A reference to the mesh used to plot volume elements</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">IGNORE_PLOTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Get part information</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">CoordinateSystemArray</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="n">coordinate_system</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">css</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">)]</span>
        <span class="n">global_node_positions</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
        <span class="n">node_index_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[()]:</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()}</span>
        <span class="n">node_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">node_index_dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>

        <span class="c1"># Now go through and get the element and line connectivity</span>
        <span class="n">face_element_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">face_element_colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solid_element_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solid_element_colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solid_element_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solid_element_offsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="c1"># element_connectivity.append(1)</span>
            <span class="c1"># element_connectivity.append(index[0])</span>
            <span class="c1"># element_colors.append(node.color)</span>
            <span class="n">node_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elems</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="c1"># Check which type of element it is</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">_beam_elem_types</span><span class="p">:</span>  <span class="c1"># Beamlike element, use a line</span>
                <span class="n">line_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_index_map</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s1">&#39;Element </span><span class="si">{:}</span><span class="s1"> contains a node id not found in the node array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">line_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">_face_element_types</span><span class="p">:</span>
                <span class="n">face_element_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">face_element_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_index_map</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s1">&#39;Element </span><span class="si">{:}</span><span class="s1"> contains a node id not found in the node array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">face_element_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">_solid_element_types</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">solid_element_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_vtk_element_map</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Do not know equivalent VTK element type for </span><span class="si">{:}</span><span class="s1">: </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">_element_types</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">]))</span>
                <span class="n">solid_element_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">solid_element_connectivity</span><span class="p">))</span>
                <span class="n">solid_element_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">solid_element_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">_vtk_connectivity_reorder</span><span class="p">:</span>
                        <span class="n">solid_element_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_index_map</span><span class="p">(</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_vtk_connectivity_reorder</span><span class="p">[</span><span class="n">solid_element_types</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">solid_element_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_index_map</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s1">&#39;Element </span><span class="si">{:}</span><span class="s1"> contains a node id not found in the node array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">solid_element_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown element type </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tl</span> <span class="ow">in</span> <span class="n">tls</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">conn_group</span> <span class="ow">in</span> <span class="n">split_list</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">line_connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn_group</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line_connectivity</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_index_map</span><span class="p">(</span><span class="n">conn_group</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s1">&#39;Traceline </span><span class="si">{:}</span><span class="s1"> contains a node id not found in the node array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">line_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>

        <span class="c1"># Now we start to plot</span>
        <span class="k">if</span> <span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">GeometryPlotter</span><span class="p">(</span><span class="n">editor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Need to split up between point mesh, face/line mesh, and solid mesh</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_element_connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">face_mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">face_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">global_node_positions</span><span class="p">,</span>
                                    <span class="n">faces</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>
                                        <span class="n">face_element_connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">face_element_connectivity</span><span class="p">,</span>
                                    <span class="n">lines</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">line_connectivity</span><span class="p">)</span>
            <span class="n">face_mesh</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_colors</span> <span class="o">+</span> <span class="n">face_element_colors</span>

            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">face_mesh</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                             <span class="n">show_edges</span><span class="o">=</span><span class="n">show_edges</span><span class="p">,</span>  <span class="c1"># True if line_width &gt; 0 else False,</span>
                             <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solid_element_connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">solid_mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solid_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">solid_element_offsets</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">solid_element_connectivity</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">solid_element_types</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">),</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">global_node_positions</span><span class="p">))</span>
            <span class="n">solid_mesh</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solid_element_colors</span>

            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">solid_mesh</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                             <span class="n">show_edges</span><span class="o">=</span><span class="n">show_edges</span><span class="p">,</span>  <span class="c1"># True if line_width &gt; 0 else False,</span>
                             <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">point_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">global_node_positions</span><span class="p">)</span>
            <span class="n">point_mesh</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_colors</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">point_mesh</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                             <span class="n">show_edges</span><span class="o">=</span><span class="n">show_edges</span><span class="p">,</span>  <span class="c1"># True if line_width &gt; 0 else False,</span>
                             <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">point_mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">view_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">focus</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">distance</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">focus</span><span class="p">)</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">view_from</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">view_from</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span> <span class="o">=</span> <span class="n">focus</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">view_up</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">view_up</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">face_mesh</span><span class="p">,</span> <span class="n">point_mesh</span><span class="p">,</span> <span class="n">solid_mesh</span></div>

<div class="viewcode-block" id="Geometry.plot_coordinate"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.plot_coordinate">[docs]</a>    <span class="k">def</span> <span class="nf">plot_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="n">CoordinateArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">arrow_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">arrow_scale_type</span><span class="o">=</span><span class="s1">&#39;bbox&#39;</span><span class="p">,</span> <span class="n">label_dofs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">label_font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                        <span class="n">arrow_ends_on_node</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots coordinate arrows on the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : CoordinateArray, optional</span>
<span class="sd">            Coordinates to draw on the geometry.  If no coordinates are specified,</span>
<span class="sd">            all translation degrees of freedom at each node will be plotted.</span>
<span class="sd">        arrow_scale : float, optional</span>
<span class="sd">            Size of the arrows in proportion to the length of the diagonal of </span>
<span class="sd">            the bounding box of the Geometry if `arrow_scale_type` is &#39;bbox&#39;,</span>
<span class="sd">            otherwise the raw length of the arrow.  The default is 0.1.</span>
<span class="sd">        arrow_scale_type : str, optional</span>
<span class="sd">            Specifies how to compute the size of the arrows.  If &#39;bbox&#39;, then</span>
<span class="sd">            the arrow is scaled based on the size of the geometry.  Otherwise,</span>
<span class="sd">            the arrow size is the specified length.  The default is &#39;bbox&#39;.</span>
<span class="sd">        label_dofs : bool, optional</span>
<span class="sd">            Specify whether or not to label the coordinates with strings.</span>
<span class="sd">            The default is False.</span>
<span class="sd">        label_font_size : int, optional</span>
<span class="sd">            Specifies the font size for the node labels.</span>
<span class="sd">            Default is 16.</span>
<span class="sd">        opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the geometry.</span>
<span class="sd">            Set to 1 for completely opaque, and 0 for completely transparent </span>
<span class="sd">            (invisible).  The default is 1.0, no transparency.</span>
<span class="sd">        arrow_ends_on_node : bool, optional</span>
<span class="sd">            If True, arrow tip ends at the node, otherwise the arrow begins at </span>
<span class="sd">            node.</span>
<span class="sd">            Defualt is False</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Any additional keywords that should be passed to the Geometry.plot</span>
<span class="sd">            function. The default is {}.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plotter : BackgroundPlotter</span>
<span class="sd">            A reference to the window the geometry was plotted in.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">IGNORE_PLOTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">plotter</span><span class="p">,</span> <span class="n">face_mesh</span><span class="p">,</span> <span class="n">point_mesh</span><span class="p">,</span> <span class="n">solid_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="c1"># Add deflection directions to each node</span>
        <span class="c1"># Get local deformation for each coordinate direction</span>

        <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">from_nodelist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">build_coord_mesh</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">geom</span><span class="p">):</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">node</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">local_deformations</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
            <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
                <span class="n">geom</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="n">geom</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
            <span class="n">global_deflections</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span><span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">local_deformations</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
            <span class="c1"># Now add the point array to the mesh</span>
            <span class="n">coord_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            <span class="n">coord_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_deflections</span>
            <span class="n">coord_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="n">coord_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s1">&#39;Node ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span>
            <span class="k">return</span> <span class="n">coord_mesh</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">global_deflections</span>

        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">arrow_scale_type</span> <span class="o">==</span> <span class="s1">&#39;bbox&#39;</span><span class="p">:</span>
            <span class="n">node_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_node_coordinate</span><span class="p">()</span>
            <span class="n">bbox_diagonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">node_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">node_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">arrow_factor</span> <span class="o">=</span> <span class="n">bbox_diagonal</span> <span class="o">*</span> <span class="n">arrow_scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arrow_factor</span> <span class="o">=</span> <span class="n">arrow_scale</span>

        <span class="c1"># Create Straight Arrows and Labels</span>
        <span class="n">coordinates_straight</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">coordinates_straight</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="p">[</span><span class="n">coord_mesh_straight</span><span class="p">,</span> <span class="n">points_straight</span><span class="p">,</span> <span class="n">global_deflections_straight</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_coord_mesh</span><span class="p">(</span>
                <span class="n">coordinates_straight</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arrow_ends_on_node</span><span class="p">:</span>
                <span class="n">arrow_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arrow_start</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">coord_arrows_stright</span> <span class="o">=</span> <span class="n">coord_mesh_straight</span><span class="o">.</span><span class="n">glyph</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">arrow_factor</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">pv</span><span class="o">.</span><span class="n">Arrow</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">arrow_start</span><span class="p">))</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">coord_arrows_stright</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;Direction&#39;</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">coord_colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">label_dofs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arrow_ends_on_node</span><span class="p">:</span>
                    <span class="n">dof_label_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span>
                        <span class="n">points_straight</span> <span class="o">-</span> <span class="n">global_deflections_straight</span> <span class="o">*</span> <span class="n">arrow_factor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dof_label_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span>
                        <span class="n">points_straight</span> <span class="o">+</span> <span class="n">global_deflections_straight</span> <span class="o">*</span> <span class="n">arrow_factor</span><span class="p">)</span>
                <span class="n">dof_label_mesh</span><span class="p">[</span><span class="s1">&#39;DOF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">coordinates_straight</span><span class="o">.</span><span class="n">string_array</span><span class="p">()]</span>
                <span class="n">plotter</span><span class="o">.</span><span class="n">add_point_labels</span><span class="p">(</span><span class="n">dof_label_mesh</span><span class="p">,</span> <span class="s1">&#39;DOF&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">always_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">)</span>

        <span class="c1"># Create Rotational Arrows and Labels</span>
        <span class="n">coordinates_rotation</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coordinates_rotation</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="p">[</span><span class="n">coord_mesh_rotation</span><span class="p">,</span> <span class="n">points_rotation</span><span class="p">,</span> <span class="n">global_deflections_rotation</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_coord_mesh</span><span class="p">(</span>
                <span class="n">coordinates_rotation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="n">arrow_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">head_location_angles</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">arrow_index</span>
            <span class="n">tail_location_angles</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">arrow_index</span>

            <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">arrow_head_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="n">head_location_angles</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">head_location_angles</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">head_location_angles</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">arrow_tail_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="n">tail_location_angles</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tail_location_angles</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tail_location_angles</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">cone_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">head_location_angles</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="n">head_location_angles</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">head_location_angles</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

            <span class="n">arc</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">pv</span><span class="o">.</span><span class="n">CircularArc</span><span class="p">(</span><span class="n">pointa</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">pointb</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">tube</span><span class="p">(</span>
                <span class="n">radius</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arrow_head_locations</span><span class="p">,</span> <span class="n">arrow_tail_locations</span><span class="p">)])</span>
            <span class="n">cone</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">pv</span><span class="o">.</span><span class="n">Cone</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">cone_center</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">cone_vector</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">cone_center</span><span class="p">,</span> <span class="n">cone_vector</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arrow_head_locations</span><span class="p">,</span> <span class="n">cone_vectors</span><span class="p">)])</span>

            <span class="n">curved_arrow</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">arc</span><span class="p">,</span> <span class="n">cone</span><span class="p">])</span>
            <span class="n">coord_arrows_rotation</span> <span class="o">=</span> <span class="n">coord_mesh_rotation</span><span class="o">.</span><span class="n">glyph</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">arrow_factor</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">curved_arrow</span><span class="p">)</span>
            <span class="c1"># Make Colors of Rotations same as Straight</span>
            <span class="n">coord_arrows_rotation</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord_arrows_rotation</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span>

            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">coord_arrows_rotation</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s1">&#39;Direction&#39;</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">coord_colormap</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">label_dofs</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">coordinates_rotation</span><span class="o">.</span><span class="n">node</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">coordinates_rotation</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
                <span class="n">local_deformations</span> <span class="o">=</span> <span class="n">coordinates_rotation</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
                <span class="n">local_deformation_transformation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                                                             <span class="p">[</span><span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span>
                                                                                                               <span class="mi">0</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                                                             <span class="p">[</span><span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arrow_head_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
                <span class="n">local_deformations_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                    <span class="n">local_deformation_transformation</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">local_deformations</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">coordinate_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">global_coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">def_cs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">coordinate</span><span class="p">)</span>
                <span class="n">global_deflections_rotation_new</span> <span class="o">=</span> <span class="n">global_deflection</span><span class="p">(</span>
                    <span class="n">coordinate_systems</span><span class="p">,</span> <span class="n">local_deformations_new</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>

                <span class="n">dof_label_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span>
                    <span class="n">points_rotation</span> <span class="o">+</span> <span class="n">global_deflections_rotation_new</span> <span class="o">*</span> <span class="n">arrow_factor</span><span class="p">)</span>

                <span class="n">dof_label_mesh</span><span class="p">[</span><span class="s1">&#39;DOF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">coordinates_rotation</span><span class="o">.</span><span class="n">string_array</span><span class="p">()]</span>
                <span class="n">plotter</span><span class="o">.</span><span class="n">add_point_labels</span><span class="p">(</span><span class="n">dof_label_mesh</span><span class="p">,</span> <span class="s1">&#39;DOF&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">always_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">label_font_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotter</span></div>

<div class="viewcode-block" id="Geometry.plot_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.plot_shape">[docs]</a>    <span class="k">def</span> <span class="nf">plot_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">background_plotter_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;editor&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">starting_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot mode shapes on the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shape : ShapeArray</span>
<span class="sd">            The set of shapes to plot</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Any additional keywords that should be passed to the Geometry.plot</span>
<span class="sd">            function. The default is {}.</span>
<span class="sd">        background_plotter_kwargs : dict, optional</span>
<span class="sd">            Any additional arguments that should be passed to the</span>
<span class="sd">            BackgroundPlotter initializer.  The default is {&#39;editor&#39;:False}.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the undeformed </span>
<span class="sd">            geometry.  Set to 1 for completely opaque, and 0 for completely</span>
<span class="sd">            transparent (invisible).  The default is 0.25.</span>
<span class="sd">        deformed_opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the deformed </span>
<span class="sd">            geometry.  Set to 1 for completely opaque, and 0 for completely</span>
<span class="sd">            transparent (invisible). The default is 1.0.</span>
<span class="sd">        starting_scale : float, optional</span>
<span class="sd">            The starting scale factor of the animation. The default is 1.0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ShapePlotter</span>
<span class="sd">            A reference to the ShapePlotter class that is created to plot the</span>
<span class="sd">            animated shapes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">IGNORE_PLOTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ShapePlotter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">background_plotter_kwargs</span><span class="p">,</span> <span class="n">undeformed_opacity</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="n">deformed_opacity</span><span class="p">,</span> <span class="n">starting_scale</span><span class="o">=</span><span class="n">starting_scale</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.plot_deflection_shape"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.plot_deflection_shape">[docs]</a>    <span class="k">def</span> <span class="nf">plot_deflection_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deflection_shape_data</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{},</span>
                              <span class="n">background_plotter_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;editor&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                              <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                              <span class="n">starting_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot deflection shapes shapes on the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deflection_shape_data : NDDataArray</span>
<span class="sd">            Data array containing the deflection shapes to plot</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Any additional keywords that should be passed to the Geometry.plot</span>
<span class="sd">            function. The default is {}.</span>
<span class="sd">        background_plotter_kwargs : dict, optional</span>
<span class="sd">            Any additional arguments that should be passed to the</span>
<span class="sd">            BackgroundPlotter initializer.  The default is {&#39;editor&#39;:False}.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the undeformed </span>
<span class="sd">            geometry.  Set to 1 for completely opaque, and 0 for completely</span>
<span class="sd">            transparent (invisible).  The default is 0.25.</span>
<span class="sd">        deformed_opacity : float, optional</span>
<span class="sd">            A float between 0 and 1 to specify the transparency of the deformed </span>
<span class="sd">            geometry.  Set to 1 for completely opaque, and 0 for completely</span>
<span class="sd">            transparent (invisible). The default is 1.0.</span>
<span class="sd">        starting_scale : float, optional</span>
<span class="sd">            The starting scale factor of the animation. The default is 1.0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        deflection_shape_data</span>
<span class="sd">            A reference to the deflection_shape_data object that is created to</span>
<span class="sd">            plot the animated shapes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">IGNORE_PLOTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">DeflectionShapePlotter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deflection_shape_data</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">background_plotter_kwargs</span><span class="p">,</span> <span class="n">undeformed_opacity</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="n">deformed_opacity</span><span class="p">,</span> <span class="n">starting_scale</span><span class="o">=</span><span class="n">starting_scale</span><span class="p">)</span></div>

<div class="viewcode-block" id="Geometry.plot_transient"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.plot_transient">[docs]</a>    <span class="k">def</span> <span class="nf">plot_transient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement_data</span><span class="p">,</span> <span class="n">displacement_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                       <span class="n">frames_per_second</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                       <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                       <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{},</span>
                       <span class="n">transformation_shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">num_curves</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                       <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                       <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">off_screen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">allow_quit_keypress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">menu_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">editor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">update_app_icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a TransientPlotter object to plot displacements over time</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        displacement_data : TimeHistoryArray</span>
<span class="sd">            Transient displacement data that will be applied</span>
<span class="sd">        displacement_scale : float, optional</span>
<span class="sd">            Scale factor applied to displacements. The default is 1.0.</span>
<span class="sd">        frames_per_second : float, optional</span>
<span class="sd">            Number of time steps to plot per second while the displacement is</span>
<span class="sd">            animating.  Default is 20.</span>
<span class="sd">        undeformed_opacity : float, optional</span>
<span class="sd">            Opacity of the undeformed geometry. The default is 0.0, or</span>
<span class="sd">            completely transparent.</span>
<span class="sd">        deformed_opacity : float, optional</span>
<span class="sd">            Opacity of the deformed geometry. The default is 1.0, or completely</span>
<span class="sd">            opaque.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Keyword arguments passed to the Geometry.plot function</span>
<span class="sd">        transformation_shapes : ShapeArray</span>
<span class="sd">            Shape matrix that will be used to expand the data.  Must be the</span>
<span class="sd">            same size as the `displacement_data`</span>
<span class="sd">        num_curves : int, optional</span>
<span class="sd">            Maximum number of curves to plot on the time selector.  Default is</span>
<span class="sd">            50.</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Show the plotting window.  If ``False``, show this window by</span>
<span class="sd">            running ``show()``. The default is True.</span>
<span class="sd">        app : QApplication, optional</span>
<span class="sd">            Creates a `QApplication` if left as `None`.  The default is None.</span>
<span class="sd">        window_size : list of int, optional</span>
<span class="sd">            Window size in pixels.  Defaults to ``[1024, 768]``</span>
<span class="sd">        off_screen : TYPE, optional</span>
<span class="sd">            Renders off screen when True.  Useful for automated</span>
<span class="sd">            screenshots or debug testing. The default is None.</span>
<span class="sd">        allow_quit_keypress : bool, optional</span>
<span class="sd">            Allow user to exit by pressing ``&quot;q&quot;``. The default is True.</span>
<span class="sd">        toolbar : bool, optional</span>
<span class="sd">            If True, display the default camera toolbar. Defaults to True.</span>
<span class="sd">        menu_bar : bool, optional</span>
<span class="sd">            If True, display the default main menu. Defaults to True.</span>
<span class="sd">        editor : TYPE, optional</span>
<span class="sd">            If True, display the VTK object editor. Defaults to False.</span>
<span class="sd">        update_app_icon : bool, optional</span>
<span class="sd">            If True, update_app_icon will be called automatically to update the</span>
<span class="sd">            Qt app icon based on the current rendering output. If None, the</span>
<span class="sd">            logo of PyVista will be used. If False, no icon will be set.</span>
<span class="sd">            Defaults to None. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of plotting window.</span>
<span class="sd">        multi_samples : int, optional</span>
<span class="sd">            The number of multi-samples used to mitigate aliasing. 4 is a</span>
<span class="sd">            good default but 8 will have better results with a potential</span>
<span class="sd">            impact on performance.</span>
<span class="sd">        line_smoothing : bool, optional</span>
<span class="sd">            If True, enable line smothing</span>
<span class="sd">        point_smoothing : bool, optional</span>
<span class="sd">            If True, enable point smothing</span>
<span class="sd">        polygon_smoothing : bool, optional</span>
<span class="sd">            If True, enable polygon smothing</span>
<span class="sd">        auto_update : float, bool, optional</span>
<span class="sd">            Automatic update rate in seconds.  Useful for automatically</span>
<span class="sd">            updating the render window when actors are change without</span>
<span class="sd">            being automatically ``Modified``.  If set to ``True``, update</span>
<span class="sd">            rate will be 1 second.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TransientPlotter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">IGNORE_PLOTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">TransientPlotter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement_data</span><span class="p">,</span> <span class="n">displacement_scale</span><span class="p">,</span>
                                <span class="n">frames_per_second</span><span class="p">,</span>
                                <span class="n">undeformed_opacity</span><span class="p">,</span> <span class="n">deformed_opacity</span><span class="p">,</span>
                                <span class="n">plot_kwargs</span><span class="p">,</span>
                                <span class="n">transformation_shapes</span><span class="p">,</span>
                                <span class="n">num_curves</span><span class="p">,</span>
                                <span class="n">show</span><span class="p">,</span>
                                <span class="n">app</span><span class="p">,</span>
                                <span class="n">window_size</span><span class="p">,</span>
                                <span class="n">off_screen</span><span class="p">,</span>
                                <span class="n">allow_quit_keypress</span><span class="p">,</span>
                                <span class="n">toolbar</span><span class="p">,</span>
                                <span class="n">menu_bar</span><span class="p">,</span>
                                <span class="n">editor</span><span class="p">,</span>
                                <span class="n">update_app_icon</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">final_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;traceline&#39;</span><span class="p">,</span> <span class="s1">&#39;element&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinate_system&#39;</span><span class="p">]:</span>
            <span class="c1"># Look through and see which are in common</span>
            <span class="n">common_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">common_ids</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">equal_ids</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)(</span><span class="n">common_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">field</span><span class="p">)(</span><span class="n">common_ids</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">equal_ids</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both geometries contain </span><span class="si">{:}</span><span class="s1"> with ID </span><span class="si">{:}</span><span class="s1"> but they are not equivalent&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">field</span><span class="p">,</span> <span class="n">common_ids</span><span class="p">[</span><span class="o">~</span><span class="n">equal_ids</span><span class="p">]))</span>
            <span class="n">self_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">common_ids</span><span class="p">))</span>
            <span class="n">geometry_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">final_fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)(</span><span class="n">self_ids</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">field</span><span class="p">)(</span><span class="n">geometry_ids</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="o">**</span><span class="n">final_fields</span><span class="p">)</span>

<div class="viewcode-block" id="Geometry.modify_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.modify_ids">[docs]</a>    <span class="k">def</span> <span class="nf">modify_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_change</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">traceline_change</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">element_change</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">coordinate_system_change</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shifts the id numbers in the geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_change : int, optional</span>
<span class="sd">            The amount to shift the node ids. The default is 0.</span>
<span class="sd">        traceline_change : int, optional</span>
<span class="sd">            The amount to shift the traceline ids.. The default is 0.</span>
<span class="sd">        element_change : int, optional</span>
<span class="sd">            The amount to shift the element ids. The default is 0.</span>
<span class="sd">        coordinate_system_change : int, optional</span>
<span class="sd">            The amount to shift the coordinate system ids. The default is 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        geom_out : Geometry</span>
<span class="sd">            A copy of the original geometry with id numbers modified</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geom_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">+=</span> <span class="n">node_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">id</span> <span class="o">+=</span> <span class="n">traceline_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="o">+=</span> <span class="n">element_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span> <span class="o">+=</span> <span class="n">coordinate_system_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">+=</span> <span class="n">coordinate_system_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">+=</span> <span class="n">coordinate_system_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">+=</span> <span class="n">node_change</span>
        <span class="n">geom_out</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">+=</span> <span class="n">node_change</span>
        <span class="c1"># Set values of tracelines back to zero if they just equal node_change,</span>
        <span class="c1"># because that means they were zero and should represent picking up the</span>
        <span class="c1"># pen</span>
        <span class="k">for</span> <span class="n">connectivity_array</span> <span class="ow">in</span> <span class="n">geom_out</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span><span class="p">:</span>
            <span class="n">connectivity_array</span><span class="p">[</span><span class="n">connectivity_array</span> <span class="o">==</span> <span class="n">node_change</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">geom_out</span></div>

<div class="viewcode-block" id="Geometry.map_ids"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.map_ids">[docs]</a>    <span class="k">def</span> <span class="nf">map_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">traceline_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">element_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coordinate_system_id_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps id numbers from an original set of ids to a new set of ids.</span>

<span class="sd">        This function accepts id_map classes defining &quot;from&quot; and &quot;to&quot; ids</span>
<span class="sd">        Existing ids found in the &quot;from&quot; set are transformed to the corresponding</span>
<span class="sd">        id in the &quot;to&quot; set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id_map : id_map, optional</span>
<span class="sd">            An id_map defining the mapping applied to node ids.</span>
<span class="sd">            The default is None, which results in the ids being unchanged</span>
<span class="sd">        traceline_id_map : id_map, optional</span>
<span class="sd">            An id_map defining the mapping applied to traceline ids.</span>
<span class="sd">            The default is None, which results in the ids being unchanged</span>
<span class="sd">        element_id_map : id_map, optional</span>
<span class="sd">            An id_map defining the mapping applied to element ids.</span>
<span class="sd">            The default is None, which results in the ids being unchanged</span>
<span class="sd">        coordinate_system_id_map : id_map, optional</span>
<span class="sd">            An id_map defining the mapping applied to coordinate system ids.</span>
<span class="sd">            The default is None, which results in the ids being unchanged</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        geom_out : Geometry</span>
<span class="sd">            A copy of the original geometry with id numbers modified</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geom_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_id_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
                <span class="n">geom_out</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
                <span class="n">geom_out</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinate_system_id_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">coordinate_system_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="n">coordinate_system_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span><span class="p">)</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">=</span> <span class="n">coordinate_system_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">traceline_id_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">traceline_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">element_id_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom_out</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">element_id_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geom_out</span></div>

<div class="viewcode-block" id="Geometry.copy"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return&#39;s a copy of the current Geometry</span>

<span class="sd">        Changes to the copy will not also be applied to the original geometry</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            A copy of the current Geometry</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>

<div class="viewcode-block" id="Geometry.save"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the geometry to a numpy .npz file</span>

<span class="sd">        The .npz file will have fields &#39;node&#39;, &#39;coordinate_system&#39;, &#39;element&#39;,</span>
<span class="sd">        and &#39;traceline&#39;, with each field storing the respective portion of the</span>
<span class="sd">        geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename to save the geometry to.  If the filename doesn&#39;t end with</span>
<span class="sd">            .npz, it will be appended.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                 <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>
                 <span class="n">coordinate_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>
                 <span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>
                 <span class="n">traceline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span></div>

<div class="viewcode-block" id="Geometry.rigid_body_shapes"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.rigid_body_shapes">[docs]</a>    <span class="k">def</span> <span class="nf">rigid_body_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inertia</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">principal_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a set of shapes corresponding to the rigid body motions</span>

<span class="sd">        Rigid body translation and rotation shapes are computed analytically</span>
<span class="sd">        from the Geoemtry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : CoordinateArray</span>
<span class="sd">            coordinates at which to compute deformations</span>
<span class="sd">        mass : float, optional</span>
<span class="sd">            The mass of the geometry used to scale the rigid body translation</span>
<span class="sd">            shapes.  The default is 1.</span>
<span class="sd">        inertia : np.ndarray, optional</span>
<span class="sd">            A 3x3 array consisting of the mass moments of inertia, used to</span>
<span class="sd">            scale the rotation shapes.  The default is np.eye(3).</span>
<span class="sd">        cg : np.ndarray, optional</span>
<span class="sd">            The center of gravity of the Geometry about which the rotations</span>
<span class="sd">            occur.  The default is np.zeros(3).</span>
<span class="sd">        principal_axes : bool, optional</span>
<span class="sd">            If True, compute the principal axes of the test article and</span>
<span class="sd">            perform rotations about those axes.  The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_shape : ShapeArray</span>
<span class="sd">            A set of rigid body shapes for the current geometry</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">principal_axes</span><span class="p">:</span>
            <span class="n">rotation_scale</span><span class="p">,</span> <span class="n">rotation_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">inertia</span><span class="p">)</span>
            <span class="n">rotation_directions</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rotation_directions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rotation_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">inertia</span><span class="p">)</span>
            <span class="n">rotation_directions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">mass</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rotation_scale</span><span class="p">)))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
        <span class="c1"># Construct the full coordinate array for all degrees of freedom for each node</span>
        <span class="n">full_coordinates</span> <span class="o">=</span> <span class="n">coordinate_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">node</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                            <span class="p">[</span><span class="s1">&#39;X+&#39;</span><span class="p">,</span> <span class="s1">&#39;Y+&#39;</span><span class="p">,</span> <span class="s1">&#39;Z+&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="c1"># Assume local coordinates for now, transform later</span>
        <span class="n">translation_shape_matrix</span> <span class="o">=</span> <span class="n">full_coordinates</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">rotation_shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">translation_shape_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_coordinates</span><span class="p">)):</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="n">full_coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">local_direction</span><span class="p">()</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">full_coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">coordinate</span>
                <span class="n">rotation_shape_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rotation_directions</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">coord</span> <span class="o">-</span> <span class="n">cg</span><span class="p">))</span>
        <span class="c1"># Concatenate shapes together</span>
        <span class="n">shape_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">translation_shape_matrix</span><span class="p">,</span> <span class="n">rotation_shape_matrix</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">full_shapes</span> <span class="o">=</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">full_coordinates</span><span class="p">,</span> <span class="n">shape_matrix</span><span class="p">)</span>
        <span class="c1"># Now we need to transform to the local coordinate systems</span>
        <span class="c1"># First set up a geometry with just the global coordinate system in it</span>
        <span class="n">global_geometry</span> <span class="o">=</span> <span class="n">Geometry</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                   <span class="n">coordinate_system</span><span class="o">=</span><span class="n">coordinate_system_array</span><span class="p">((</span><span class="mi">1</span><span class="p">,)))</span>
        <span class="n">global_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">global_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">transformed_shape</span> <span class="o">=</span> <span class="n">full_shapes</span><span class="o">.</span><span class="n">transform_coordinate_system</span><span class="p">(</span><span class="n">global_geometry</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Now turn it into our requested coordinates</span>
        <span class="n">reduced_shape_matrix</span> <span class="o">=</span> <span class="n">transformed_shape</span><span class="p">[</span><span class="n">coordinates</span><span class="p">]</span>
        <span class="n">output_shape</span> <span class="o">=</span> <span class="n">shape_array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">reduced_shape_matrix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_shape</span></div>

<div class="viewcode-block" id="Geometry.load"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a geometry from a numpy .npz or .unv file</span>

<span class="sd">        The .npz file must have fields &#39;node&#39;, &#39;coordinate_system&#39;, &#39;element&#39;,</span>
<span class="sd">        and &#39;traceline&#39;, with each field storing the respective portion of the</span>
<span class="sd">        geometry</span>

<span class="sd">        The .unv file will need to have the proper datasets specified to define</span>
<span class="sd">        a geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename to load the geometry from.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Raised if the calling class does not have a `from_unv` method</span>
<span class="sd">            defined</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            Geometry constructed from the data in the loaded file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.unv&#39;</span><span class="p">,</span> <span class="s1">&#39;.uff&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">..fileio.sdynpy_uff</span> <span class="kn">import</span> <span class="n">readunv</span>
                <span class="n">unv_dict</span> <span class="o">=</span> <span class="n">readunv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_unv</span><span class="p">(</span><span class="n">unv_dict</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Class </span><span class="si">{:}</span><span class="s1"> has no from_unv attribute defined&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NodeArray</span><span class="p">),</span>
                                <span class="n">coordinate_system</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;coordinate_system&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
                                    <span class="n">CoordinateSystemArray</span><span class="p">),</span>
                                <span class="n">traceline</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;traceline&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">TracelineArray</span><span class="p">),</span>
                                <span class="n">element</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;element&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">ElementArray</span><span class="p">))</span></div>

<div class="viewcode-block" id="Geometry.write_to_unv"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.write_to_unv">[docs]</a>    <span class="k">def</span> <span class="nf">write_to_unv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">write_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">write_coordinate_systems</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">write_tracelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">write_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">dataset_2412_kwargs</span><span class="o">=</span><span class="p">{},</span>
                     <span class="n">dataset_2420_kwargs</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the geometry to a unversal file format file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename to which the geometry will be written.  If None, a </span>
<span class="sd">            unv data dictionary will be returned instead, similar to that</span>
<span class="sd">            obtained from the readunv function in sdynpy</span>
<span class="sd">        write_nodes : bool, optional</span>
<span class="sd">            If True, write the geometry&#39;s nodes to dataset 2411 in the output</span>
<span class="sd">            file. The default is True.</span>
<span class="sd">        write_coordinate_systems : True, optional</span>
<span class="sd">            If True, write the geometry&#39;s coordinate systems to dataset 2420</span>
<span class="sd">            in the output file. The default is True.</span>
<span class="sd">        write_tracelines : bool, optional</span>
<span class="sd">            If True, write the geometry&#39;s tracelines to dataset 82 in the </span>
<span class="sd">            output file. The default is True.</span>
<span class="sd">        write_elements : TYPE, optional</span>
<span class="sd">            If True, write the geometry&#39;s elements to dataset 2412 in the </span>
<span class="sd">            output file. The default is True.</span>
<span class="sd">        dataset_2412_kwargs : dict, optional</span>
<span class="sd">            Allows users to specify additional element parameters not stored</span>
<span class="sd">            by the Geometry.  The default is {}.</span>
<span class="sd">        dataset_2420_kwargs : dict, optional</span>
<span class="sd">            Allows users to specify additional coordinate system parameters not</span>
<span class="sd">            stored by the Geometry.  The default is {}.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unv_dict : dict</span>
<span class="sd">            Dictionary containing unv information, similar to that obtained from</span>
<span class="sd">            readunv.  Only returned if filename is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..fileio.sdynpy_uff</span> <span class="kn">import</span> <span class="n">dataset_82</span><span class="p">,</span> <span class="n">dataset_2411</span><span class="p">,</span> <span class="n">dataset_2412</span><span class="p">,</span> <span class="n">dataset_2420</span>
        <span class="c1"># Write Coordinate systems</span>
        <span class="k">if</span> <span class="n">write_coordinate_systems</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cs_unv</span> <span class="o">=</span> <span class="n">dataset_2420</span><span class="o">.</span><span class="n">Sdynpy_UFF_Dataset_2420</span><span class="p">(</span>
                    <span class="n">cs_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">cs_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">cs_type</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">cs_colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">cs_names</span><span class="o">=</span><span class="p">[</span><span class="n">cs</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">cs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()],</span>
                    <span class="n">cs_matrices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">dataset_2420_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cs_unv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">write_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_unv</span> <span class="o">=</span> <span class="n">dataset_2411</span><span class="o">.</span><span class="n">Sdynpy_UFF_Dataset_2411</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">def_cs</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">disp_cs</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node_unv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">write_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;physical_property_table_numbers&#39;</span> <span class="ow">in</span> <span class="n">dataset_2412_kwargs</span><span class="p">:</span>
                    <span class="n">dataset_2412_kwargs</span><span class="p">[</span><span class="s1">&#39;physical_property_table_numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;material_property_table_numbers&#39;</span> <span class="ow">in</span> <span class="n">dataset_2412_kwargs</span><span class="p">:</span>
                    <span class="n">dataset_2412_kwargs</span><span class="p">[</span><span class="s1">&#39;material_property_table_numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;beam_orientations&#39;</span> <span class="ow">in</span> <span class="n">dataset_2412_kwargs</span><span class="p">:</span>
                    <span class="n">dataset_2412_kwargs</span><span class="p">[</span><span class="s1">&#39;beam_aft_cross_section_numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;beam_aft_cross_section_numbers&#39;</span> <span class="ow">in</span> <span class="n">dataset_2412_kwargs</span><span class="p">:</span>
                    <span class="n">dataset_2412_kwargs</span><span class="p">[</span><span class="s1">&#39;beam_orientations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;beam_fore_cross_section_numbers&#39;</span> <span class="ow">in</span> <span class="n">dataset_2412_kwargs</span><span class="p">:</span>
                    <span class="n">dataset_2412_kwargs</span><span class="p">[</span><span class="s1">&#39;beam_fore_cross_section_numbers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span>
                <span class="n">elem_unv</span> <span class="o">=</span> <span class="n">dataset_2412</span><span class="o">.</span><span class="n">Sdynpy_UFF_Dataset_2412</span><span class="p">(</span>
                    <span class="n">element_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">fe_descriptor_ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="n">connectivities</span><span class="o">=</span><span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">connectivity</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span>
                                    <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">()],</span>
                    <span class="o">**</span><span class="n">dataset_2412_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elem_unv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">write_tracelines</span><span class="p">:</span>
            <span class="n">tl_unv</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">tl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceline</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">():</span>
                <span class="n">tl_unv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">dataset_82</span><span class="o">.</span><span class="n">Sdynpy_UFF_Dataset_82</span><span class="p">(</span>
                        <span class="n">tl</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">tl</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">tl</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">tl</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span>
                    <span class="p">))</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unv_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">unv_dict</span><span class="p">[</span><span class="mi">2420</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cs_unv</span><span class="p">]</span>
            <span class="n">unv_dict</span><span class="p">[</span><span class="mi">2411</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_unv</span><span class="p">]</span>
            <span class="n">unv_dict</span><span class="p">[</span><span class="mi">2412</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem_unv</span><span class="p">]</span>
            <span class="n">unv_dict</span><span class="p">[</span><span class="mi">82</span><span class="p">]</span> <span class="o">=</span> <span class="n">tl_unv</span>
            <span class="k">return</span> <span class="n">unv_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cs_unv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  2420</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cs_unv</span><span class="o">.</span><span class="n">write_string</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node_unv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  2411</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">node_unv</span><span class="o">.</span><span class="n">write_string</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">elem_unv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  2412</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">elem_unv</span><span class="o">.</span><span class="n">write_string</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">tl_unv</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    82</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">write_string</span><span class="p">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>


<span class="n">from_imat_struct</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">from_imat_struct</span>
<span class="n">from_exodus</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">from_exodus</span>
<span class="n">from_unv</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">from_unv</span>
<span class="n">from_uff</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">from_uff</span>
<span class="n">load</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">load</span>


<div class="viewcode-block" id="id_map"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.id_map.html#sdynpy.core.sdynpy_geometry.id_map">[docs]</a><span class="k">class</span> <span class="nc">id_map</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class defining mapping between two sets of id numbers&quot;&quot;&quot;</span>

<div class="viewcode-block" id="id_map.__init__"><a class="viewcode-back" href="../../../_autosummary/sdynpy.core.sdynpy_geometry.id_map.html#sdynpy.core.sdynpy_geometry.id_map.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_ids</span><span class="p">,</span> <span class="n">to_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the id map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        from_ids : np.ndarray</span>
<span class="sd">            Id numbers to map from</span>
<span class="sd">        to_ids : np.ndarray</span>
<span class="sd">            Id numbers to map to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_ids</span> <span class="o">=</span> <span class="n">from_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_ids</span> <span class="o">=</span> <span class="n">to_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">({</span><span class="n">f</span><span class="p">:</span> <span class="n">t</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">from_ids</span><span class="p">,</span> <span class="n">to_ids</span><span class="p">)}</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span><span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint64&#39;</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map id numbers</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : np.ndarray</span>
<span class="sd">            A set of id numbers to map.  These must all be contained in the</span>
<span class="sd">            id_map&#39;s from_ids array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            The set of id numbers from the id_map&#39;s to_ids array corresponding</span>
<span class="sd">            to those passed in to the function from the from_ids array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
<jinja2.runtime.BlockReference object at 0x7f99ebb760b0>
<img src="_images/snl.jpg" alt="Sandia National Laboratories" style="height:40px">

  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>