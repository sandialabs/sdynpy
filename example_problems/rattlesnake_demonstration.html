<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rattlesnake Demonstration &mdash; SDynPy 0.5.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analysis of Transient Finite Element Results" href="transient_fem_analysis.html" />
    <link rel="prev" title="Airplane Modal Test" href="airplane_modal_test.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> SDynPy
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">SDynpy Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="airplane_modal_test.html">Airplane Modal Test</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rattlesnake Demonstration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-in-test-data">Load in Test Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computing-frfs">Computing FRFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-test-geometry">Creating a Test Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitting-modes-to-the-frfs">Fitting Modes to the FRFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyzing-modal-parameters">Analyzing Modal Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-generation">Documentation Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exporting-to-exodus">Exporting to Exodus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transient_fem_analysis.html">Analysis of Transient Finite Element Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_reduction/model_reduction.html">Model Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="craig_bampton_substructuring.html">Substructuring using Craig-Bampton Superelements from Sierra/SD</a></li>
<li class="toctree-l2"><a class="reference internal" href="transmission_simulator.html">Substructuring using the Transmission Simulator Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="mimo_random_vibration_control.html">MIMO Random Vibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modal_tutorials.html">Modal Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">SDynPy Programming Interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SDynPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">SDynpy Examples</a></li>
      <li class="breadcrumb-item active">Rattlesnake Demonstration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_problems/rattlesnake_demonstration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="rattlesnake-demonstration">
<h1><a class="toc-backref" href="#id1">Rattlesnake Demonstration</a><a class="headerlink" href="#rattlesnake-demonstration" title="Permalink to this heading"></a></h1>
<p>This page contains an example demonstrating some usages of SDynPy.  In this
analysis, we will load in Rattlesnake data, parse the dataset to get the data
we want, compute frequency response functions (FRFs), and fit modes to the data.
We will then load in an exodus file of the same structure used in the test and
compare test data against finite element data.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#rattlesnake-demonstration" id="id1">Rattlesnake Demonstration</a></p>
<ul>
<li><p><a class="reference internal" href="#imports" id="id2">Imports</a></p></li>
<li><p><a class="reference internal" href="#load-in-test-data" id="id3">Load in Test Data</a></p></li>
<li><p><a class="reference internal" href="#computing-frfs" id="id4">Computing FRFs</a></p></li>
<li><p><a class="reference internal" href="#creating-a-test-geometry" id="id5">Creating a Test Geometry</a></p></li>
<li><p><a class="reference internal" href="#fitting-modes-to-the-frfs" id="id6">Fitting Modes to the FRFs</a></p></li>
<li><p><a class="reference internal" href="#analyzing-modal-parameters" id="id7">Analyzing Modal Parameters</a></p></li>
<li><p><a class="reference internal" href="#documentation-generation" id="id8">Documentation Generation</a></p></li>
<li><p><a class="reference internal" href="#exporting-to-exodus" id="id9">Exporting to Exodus</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="imports">
<h2><a class="toc-backref" href="#id2">Imports</a><a class="headerlink" href="#imports" title="Permalink to this heading"></a></h2>
<p>For this project, we will import the following modules, including the SDynPy
module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># Used for array manipulations</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc4</span> <span class="c1"># Used to load the data file</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># Used to create figures</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="c1"># Close all open matplotlib figures</span>
<span class="kn">import</span> <span class="nn">pptx</span> <span class="c1"># Used to load in powerpoint files</span>

<span class="kn">import</span> <span class="nn">sdynpy</span> <span class="k">as</span> <span class="nn">sdpy</span>
</pre></div>
</div>
</section>
<section id="load-in-test-data">
<h2><a class="toc-backref" href="#id3">Load in Test Data</a><a class="headerlink" href="#load-in-test-data" title="Permalink to this heading"></a></h2>
<p>The first thing we will do is load in the data.  We will do this using the
<a class="reference internal" href="../_autosummary/sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output.html#sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output" title="sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.rattlesnake.read_rattlesnake_output</span></code></a>
function.  We could simply pass the file string to this function; however, we
would like to access other metadata inside the Rattlesnake output file as well,
so we load the dataset separately and then pass in a reference to the
<a class="reference internal" href="../_autosummary/sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output.html#sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output" title="sdynpy.fileio.sdynpy_rattlesnake.read_rattlesnake_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.rattlesnake.read_rattlesnake_output</span></code></a>
function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in the specified file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;rattlesnake_modal_data.nc4&#39;</span>
<span class="c1"># Load the netCDF4 dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c1"># Extract the time data and channel table from the test</span>
<span class="n">time_data</span><span class="p">,</span> <span class="n">channel_table</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">rattlesnake</span><span class="o">.</span><span class="n">read_rattlesnake_output</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="c1"># Plot the time data so we can see where valid data is</span>
<span class="n">time_data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Make the figure look nice</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data (various types)&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rattlesnake Data&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<p>The time data plot is shown here:</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_time_data.png"><img alt="Time data measured by Rattlesnake" src="../_images/sdynpy_demo_time_data.png" style="width: 600px;" /></a>
<p>At this point it is worth exploring the time_data object.  If we type <code class="code docutils literal notranslate"><span class="pre">time_data</span></code>
into the IPython console, we obtain some information about the data we’ve loaded.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [1]: time_data</span>
<span class="go">Out[1]: TimeHistoryArray with shape 30 and 31745 elements per function</span>
</pre></div>
</div>
<p>This tells us that there are 30 pieces of data in the test data we loaded which
correspond to the 30 channels in the test.  Each data array contains 31745
samples or time steps.</p>
<p>We can investigate what fields exist in the <code class="code docutils literal notranslate"><span class="pre">time_data</span></code> object by using the
<code class="code docutils literal notranslate"><span class="pre">time_data.fields</span></code> property.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [2]:time_data.fields</span>
<span class="go">Out[2]:</span>
<span class="go">(&#39;abscissa&#39;,</span>
<span class="go"> &#39;ordinate&#39;,</span>
<span class="go"> &#39;comment1&#39;,</span>
<span class="go"> &#39;comment2&#39;,</span>
<span class="go"> &#39;comment3&#39;,</span>
<span class="go"> &#39;comment4&#39;,</span>
<span class="go"> &#39;comment5&#39;,</span>
<span class="go"> &#39;coordinate&#39;)</span>
</pre></div>
</div>
<p>The abscissa, or independent variable (in this case, the time value at each
sample), is stored in the <code class="code docutils literal notranslate"><span class="pre">time_data.abscissa</span></code> field.  The ordinate, or
dependent variable (in this case, the value of acceleration or
force at each sample), is stored in the <code class="code docutils literal notranslate"><span class="pre">time_data.ordinate</span></code> field.
Because there are 30 pieces of data each with 31745 elements, the shape of the
<code class="code docutils literal notranslate"><span class="pre">abscissa</span></code> and <code class="code docutils literal notranslate"><span class="pre">ordinate</span></code> fields are 30 x 31745.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [3]: time_data.abscissa.shape</span>
<span class="go">Out[3]: (30, 31745)</span>
</pre></div>
</div>
<p>Another important field is the <code class="code docutils literal notranslate"><span class="pre">time_data.coordinate</span></code> field.  This stores
degree of freedom information in a
<code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateArray&lt;sdynpy.core.sdynpy_coordinate.CoordinateArray</span></code> object.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [4]: time_data.coordinate</span>
<span class="go">Out[4]:</span>
<span class="go">coordinate_array(string_array=</span>
<span class="go">array([[&#39;28376X+&#39;],</span>
<span class="go">       [&#39;28376Y+&#39;],</span>
<span class="go">       [&#39;28376Z+&#39;],</span>
<span class="go">       [&#39;28560X+&#39;],</span>
<span class="go">       [&#39;28560Y+&#39;],</span>
<span class="go">       [&#39;28560Z+&#39;],</span>
<span class="go">       [&#39;17290X+&#39;],</span>
<span class="go">       [&#39;17290Y+&#39;],</span>
<span class="go">       [&#39;17290Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;],</span>
<span class="go">       [&#39;16733Y+&#39;],</span>
<span class="go">       [&#39;16733Z+&#39;],</span>
<span class="go">       [&#39;2467X+&#39;],</span>
<span class="go">       [&#39;2467Y+&#39;],</span>
<span class="go">       [&#39;2467Z+&#39;],</span>
<span class="go">       [&#39;2392X+&#39;],</span>
<span class="go">       [&#39;2392Y+&#39;],</span>
<span class="go">       [&#39;2392Z+&#39;],</span>
<span class="go">       [&#39;33715Y+&#39;],</span>
<span class="go">       [&#39;36140Y+&#39;],</span>
<span class="go">       [&#39;24046X-&#39;],</span>
<span class="go">       [&#39;30947X-&#39;],</span>
<span class="go">       [&#39;8579Y+&#39;],</span>
<span class="go">       [&#39;12664Y+&#39;],</span>
<span class="go">       [&#39;4475Z+&#39;],</span>
<span class="go">       [&#39;2991Y+&#39;],</span>
<span class="go">       [&#39;5457X-&#39;],</span>
<span class="go">       [&#39;16733X+&#39;],</span>
<span class="go">       [&#39;33715Y+&#39;],</span>
<span class="go">       [&#39;28560Z+&#39;]], dtype=&#39;&lt;U7&#39;))</span>
</pre></div>
</div>
</section>
<section id="computing-frfs">
<h2><a class="toc-backref" href="#id4">Computing FRFs</a><a class="headerlink" href="#computing-frfs" title="Permalink to this heading"></a></h2>
<p>Note that there is a ramp up and down in the shaker data.  We don’t want to
include these data in our analysis, so we will use the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.NDDataArray.html#sdynpy.core.sdynpy_data.NDDataArray.extract_elements" title="sdynpy.core.sdynpy_data.NDDataArray.extract_elements"><code class="xref py py-func docutils literal notranslate"><span class="pre">extract_elements</span></code></a>
method of our <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.TimeHistoryArray.html#sdynpy.core.sdynpy_data.TimeHistoryArray" title="sdynpy.core.sdynpy_data.TimeHistoryArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">time_data</span></code></a>
object to reduce the abscissa.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the plot to figure out the start and stop times of the signal we want to</span>
<span class="c1"># analyze</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="c1"># Time data is stored in the abscissa attribute of the TimeHistoryArray object</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">((</span><span class="n">time_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span> <span class="o">&gt;=</span> <span class="n">time_start</span><span class="p">)</span>
           <span class="o">&amp;</span> <span class="p">(</span><span class="n">time_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abscissa</span> <span class="o">&lt;=</span> <span class="n">time_end</span><span class="p">))</span>
<span class="c1"># Extract elements corresponding to the indices we want to keep</span>
<span class="n">truncated_time_data</span> <span class="o">=</span> <span class="n">time_data</span><span class="o">.</span><span class="n">extract_elements</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to compute FRFs, we will need to separate the data into responses and
references.  In Rattlesnake, the responses were marked as control channels, so
we can parse the channel table to understand which channels were references and
which were responses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separate into references and responses based on the control field of the</span>
<span class="c1"># channel table</span>
<span class="n">response_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">channel_table</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>
<span class="n">reference_indices</span> <span class="o">=</span> <span class="o">~</span><span class="n">response_indices</span>
<span class="c1"># Index the TimeHistoryArray object with the indices to pull out specific channels</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">truncated_time_data</span><span class="p">[</span><span class="n">response_indices</span><span class="p">]</span>
<span class="n">references</span> <span class="o">=</span> <span class="n">truncated_time_data</span><span class="p">[</span><span class="n">reference_indices</span><span class="p">]</span>
<span class="c1"># Now plot to see that we&#39;ve separated them correctly</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="s1">&#39;Time Data&#39;</span><span class="p">)</span>
<span class="n">responses</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Responses&#39;</span><span class="p">)</span>
<span class="n">references</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;References&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The plot is shown here:</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_references_and_responses.png"><img alt="Data split into references and responses." src="../_images/sdynpy_demo_references_and_responses.png" style="width: 600px;" /></a>
<p>We can now finally compute FRFs using the static method
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.TransferFunctionArray.html#sdynpy.core.sdynpy_data.TransferFunctionArray.from_time_data" title="sdynpy.core.sdynpy_data.TransferFunctionArray.from_time_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_time_data</span></code></a>.
This method is passed the reference and response
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.TimeHistoryArray.html#sdynpy.core.sdynpy_data.TimeHistoryArray" title="sdynpy.core.sdynpy_data.TimeHistoryArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeHistoryArray</span></code></a>
as well as various signal processing parameters that are extracted from the
metadata of the Rattlesnake output file.  We will remove the zero frequency
line and then plot the <code class="code docutils literal notranslate"><span class="pre">frfs</span></code> to make sure they look as expected.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute FRFs from references, responses, and signal processing parameters</span>
<span class="c1"># from Rattlesnake</span>
<span class="n">frfs</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">TransferFunctionArray</span><span class="o">.</span><span class="n">from_time_data</span><span class="p">(</span>
    <span class="n">references</span><span class="p">,</span> <span class="n">responses</span><span class="p">,</span>
    <span class="n">samples_per_average</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;Launch Random&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">samples_per_frame</span><span class="p">,</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;Launch Random&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;Launch Random&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">frf_window</span>
    <span class="p">)</span>
<span class="c1"># Remove the zero frequency line</span>
<span class="n">frfs</span> <span class="o">=</span> <span class="n">frfs</span><span class="o">.</span><span class="n">extract_elements</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
<span class="c1"># Plot the FRFs</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">frfs</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Make the plots look nice</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;FRFs from Rattlesnake Data&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (in/lbf)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<p>The plot is shown here:</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_frfs.png"><img alt="FRFs from Rattlesnake Data." src="../_images/sdynpy_demo_frfs.png" style="width: 600px;" /></a>
<p>It can be difficult to visualize the plots on top of one another, and we really
don’t want to plot 30 separate plots, so it can be useful to quickly iterate
through the curves to ensure they all look right.  This is handled well by the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.GUIPlot.html#sdynpy.core.sdynpy_data.GUIPlot" title="sdynpy.core.sdynpy_data.GUIPlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.data.GUIPlot</span></code></a> class, which
allows a user to load in a number of functions and graphically select which to
plot.  By using the arrow keys, a user can quickly page through each plot.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [5]: sdpy.data.GUIPlot(frfs)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_guiplot.png"><img alt="FRFs from Rattlesnake Data." src="../_images/sdynpy_demo_guiplot.png" style="width: 600px;" /></a>
<p>It is again worth investigating the <code class="code docutils literal notranslate"><span class="pre">frfs</span></code> object to see what it contains.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [6]: frfs</span>
<span class="go">Out[6]: TransferFunctionArray with shape 27 x 3 and 510 elements per function</span>
</pre></div>
</div>
<p>This tells us that there are 27 x 3 functions in <code class="code docutils literal notranslate"><span class="pre">frfs</span></code> which
correspond to the 27 response channels and 3 references in the test.  Each FRF
contains 510 frequency lines.</p>
<p>We can investigate what fields exist in the <code class="code docutils literal notranslate"><span class="pre">frfs</span></code> object by using the
<code class="code docutils literal notranslate"><span class="pre">frfs.fields</span></code> property.  These will be identical to the <code class="code docutils literal notranslate"><span class="pre">time_data</span></code>
because they are both subclasses of <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.NDDataArray.html#sdynpy.core.sdynpy_data.NDDataArray" title="sdynpy.core.sdynpy_data.NDDataArray"><code class="xref py py-func docutils literal notranslate"><span class="pre">NDDataArray</span></code></a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [7]: frfs.fields</span>
<span class="go">Out[7]:</span>
<span class="go">(&#39;abscissa&#39;,</span>
<span class="go"> &#39;ordinate&#39;,</span>
<span class="go"> &#39;comment1&#39;,</span>
<span class="go"> &#39;comment2&#39;,</span>
<span class="go"> &#39;comment3&#39;,</span>
<span class="go"> &#39;comment4&#39;,</span>
<span class="go"> &#39;comment5&#39;,</span>
<span class="go"> &#39;coordinate&#39;)</span>
</pre></div>
</div>
<p>The abscissa, or independent variable (in this case, the frequency value at each
frequency line), is stored in the <code class="code docutils literal notranslate"><span class="pre">frfs.abscissa</span></code> field.  The ordinate, or
dependent variable (in this case, the value of the transfer function),
is stored in the <code class="code docutils literal notranslate"><span class="pre">frfs.ordinate</span></code> field.
Because there are 27 x 3 pieces of data each with 510 elements, the shape of the
<code class="code docutils literal notranslate"><span class="pre">abscissa</span></code> and <code class="code docutils literal notranslate"><span class="pre">ordinate</span></code> fields are 27 x 3 x 510.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [8]: frfs.abscissa.shape</span>
<span class="go">Out[8]: (27, 3, 510)</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">frfs.coordinate</span></code> field contains the degrees of freedom for each FRF.
However, now there is a reference coordinate and a response coordinate for each
function.  Looking at the shape of <code class="code docutils literal notranslate"><span class="pre">frfs.coordinate</span></code>, we see that there are
now two coordinate for each of the 27 x 3 functions, resulting in a final shape
of 27 x 3 x 2.  We can also access reference and response coordinates using the
helper propreties <code class="code docutils literal notranslate"><span class="pre">response_coordinate</span></code> and <code class="code docutils literal notranslate"><span class="pre">reference_coordinate</span></code>.
Here it should also be obvious that the response coordinates vary with the row
and the reference coordinates vary with the column of the FRF matrix.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [9]: frfs.coordinate.shape</span>
<span class="go">Out[9]: (27, 3, 2)</span>

<span class="go">In [10]: frfs.response_coordinate</span>
<span class="go">Out[10]:</span>
<span class="go">coordinate_array(string_array=</span>
<span class="go">array([[&#39;28376X+&#39;, &#39;28376X+&#39;, &#39;28376X+&#39;],</span>
<span class="go">       [&#39;28376Y+&#39;, &#39;28376Y+&#39;, &#39;28376Y+&#39;],</span>
<span class="go">       [&#39;28376Z+&#39;, &#39;28376Z+&#39;, &#39;28376Z+&#39;],</span>
<span class="go">       [&#39;28560X+&#39;, &#39;28560X+&#39;, &#39;28560X+&#39;],</span>
<span class="go">       [&#39;28560Y+&#39;, &#39;28560Y+&#39;, &#39;28560Y+&#39;],</span>
<span class="go">       [&#39;28560Z+&#39;, &#39;28560Z+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;17290X+&#39;, &#39;17290X+&#39;, &#39;17290X+&#39;],</span>
<span class="go">       [&#39;17290Y+&#39;, &#39;17290Y+&#39;, &#39;17290Y+&#39;],</span>
<span class="go">       [&#39;17290Z+&#39;, &#39;17290Z+&#39;, &#39;17290Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;16733X+&#39;, &#39;16733X+&#39;],</span>
<span class="go">       [&#39;16733Y+&#39;, &#39;16733Y+&#39;, &#39;16733Y+&#39;],</span>
<span class="go">       [&#39;16733Z+&#39;, &#39;16733Z+&#39;, &#39;16733Z+&#39;],</span>
<span class="go">       [&#39;2467X+&#39;, &#39;2467X+&#39;, &#39;2467X+&#39;],</span>
<span class="go">       [&#39;2467Y+&#39;, &#39;2467Y+&#39;, &#39;2467Y+&#39;],</span>
<span class="go">       [&#39;2467Z+&#39;, &#39;2467Z+&#39;, &#39;2467Z+&#39;],</span>
<span class="go">       [&#39;2392X+&#39;, &#39;2392X+&#39;, &#39;2392X+&#39;],</span>
<span class="go">       [&#39;2392Y+&#39;, &#39;2392Y+&#39;, &#39;2392Y+&#39;],</span>
<span class="go">       [&#39;2392Z+&#39;, &#39;2392Z+&#39;, &#39;2392Z+&#39;],</span>
<span class="go">       [&#39;33715Y+&#39;, &#39;33715Y+&#39;, &#39;33715Y+&#39;],</span>
<span class="go">       [&#39;36140Y+&#39;, &#39;36140Y+&#39;, &#39;36140Y+&#39;],</span>
<span class="go">       [&#39;24046X-&#39;, &#39;24046X-&#39;, &#39;24046X-&#39;],</span>
<span class="go">       [&#39;30947X-&#39;, &#39;30947X-&#39;, &#39;30947X-&#39;],</span>
<span class="go">       [&#39;8579Y+&#39;, &#39;8579Y+&#39;, &#39;8579Y+&#39;],</span>
<span class="go">       [&#39;12664Y+&#39;, &#39;12664Y+&#39;, &#39;12664Y+&#39;],</span>
<span class="go">       [&#39;4475Z+&#39;, &#39;4475Z+&#39;, &#39;4475Z+&#39;],</span>
<span class="go">       [&#39;2991Y+&#39;, &#39;2991Y+&#39;, &#39;2991Y+&#39;],</span>
<span class="go">       [&#39;5457X-&#39;, &#39;5457X-&#39;, &#39;5457X-&#39;]], dtype=&#39;&lt;U7&#39;))</span>

<span class="go">In [11]: frfs.reference_coordinate</span>
<span class="go">Out[11]:</span>
<span class="go">coordinate_array(string_array=</span>
<span class="go">array([[&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;],</span>
<span class="go">       [&#39;16733X+&#39;, &#39;33715Y+&#39;, &#39;28560Z+&#39;]], dtype=&#39;&lt;U7&#39;))</span>
</pre></div>
</div>
</section>
<section id="creating-a-test-geometry">
<h2><a class="toc-backref" href="#id5">Creating a Test Geometry</a><a class="headerlink" href="#creating-a-test-geometry" title="Permalink to this heading"></a></h2>
<p>Now that we have our data, it would be useful to create our test geometry so
we can eventually visualize mode shapes.  For this, we will extract geometry
from a finite element model.  For this test, the nodes in the channel table were
named identically to the corresponding nodes in the finite element model, so
we can use the node numbers to correlate degrees of freedom.</p>
<p>The finite element model in question is an Exodus file with an eigensolution
stored in its displacement data.  We will load that in, create a geometry from
the model data, and then plot it to make sure it looks right.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in the exodus file into an Exodus object</span>
<span class="n">exo</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">Exodus</span><span class="p">(</span><span class="s1">&#39;exodus_eigensolution.exo&#39;</span><span class="p">)</span>
<span class="c1"># Create a geometry from the full finite element model</span>
<span class="n">fem_geometry</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">from_exodus</span><span class="p">(</span><span class="n">exo</span><span class="p">)</span>
<span class="c1"># Now plot the geometry</span>
<span class="n">fem_geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">view_up</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The plot of the finite element geometry is shown here:</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_fem_geometry.png"><img alt="Finite Element Model Geometry" src="../_images/sdynpy_demo_fem_geometry.png" style="width: 600px;" /></a>
<p>Now we would like to reduce the finite element geometry down to our sensor
locations in the test.  We first visualize the reference and response coordinates
on the finite element model to make sure our bookkeeping is correct and they match
the test excitation locations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now plot the coordinates from our test, note we can use numpy set operations</span>
<span class="c1"># on CoordinateArrays</span>
<span class="n">response_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frfs</span><span class="o">.</span><span class="n">response_coordinate</span><span class="p">)</span>
<span class="n">reference_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frfs</span><span class="o">.</span><span class="n">reference_coordinate</span><span class="p">)</span>
<span class="c1"># Plot the coordinates on the finite element geometry</span>
<span class="n">fem_geometry</span><span class="o">.</span><span class="n">plot_coordinate</span><span class="p">(</span><span class="n">response_coordinates</span><span class="p">,</span><span class="n">label_dofs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;view_up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]})</span>
<span class="n">fem_geometry</span><span class="o">.</span><span class="n">plot_coordinate</span><span class="p">(</span><span class="n">reference_coordinates</span><span class="p">,</span><span class="n">label_dofs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;view_up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]})</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_response_coordinates.png"><img alt="Response coordinates overlaid on the finite element model" src="../_images/sdynpy_demo_response_coordinates.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_reference_coordinates.png"><img alt="Reference coordinates overlaid on the finite element model" src="../_images/sdynpy_demo_reference_coordinates.png" style="width: 600px;" /></a>
<p>Because there are common node numbers between test and analysis, we can easily
reduce down to only the nodes in our test using the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.reduce" title="sdynpy.core.sdynpy_geometry.Geometry.reduce"><code class="xref py py-func docutils literal notranslate"><span class="pre">reduce</span></code></a>
method, which accepts a list of nodes to keep.  Note that this will reduce the
geometry to only those nodes kept in the test, which will also destroy all elements
used to visualize the model.  Make sure when plotting this geometry, ensure that
the node size is not set to zero!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reduce down to only the nodes that are in our test</span>
<span class="n">keep_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frfs</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<span class="c1"># Call the reduce function to reduce the geometry to just the kept nodes</span>
<span class="n">test_geometry</span> <span class="o">=</span> <span class="n">fem_geometry</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">keep_nodes</span><span class="p">)</span>
<span class="c1"># Plot to make sure it looks right</span>
<span class="n">test_geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">view_up</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>At this point, it can be very difficult to visualize the model, as there are
only a handful of points.  We will add some tracelines to make visualization a
bit easier.  We can use the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.add_traceline" title="sdynpy.core.sdynpy_geometry.Geometry.add_traceline"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_traceline</span></code></a>
method to quickly add a traceline to the model.  We can then plot it to see the
improvement.  We will also save it to a file so we can load it into our graphical
curve fitters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s add some tracelines to aid in visualization.  We can pick the node</span>
<span class="c1"># numbers from the plot of the response coordinates</span>
<span class="n">test_geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">([</span><span class="mi">12664</span><span class="p">,</span><span class="mi">17290</span><span class="p">,</span><span class="mi">30947</span><span class="p">,</span><span class="mi">28560</span><span class="p">,</span><span class="mi">36140</span><span class="p">,</span><span class="mi">33715</span><span class="p">,</span><span class="mi">28376</span><span class="p">,</span><span class="mi">24046</span><span class="p">,</span><span class="mi">16733</span><span class="p">,</span><span class="mi">8579</span><span class="p">],</span>
                            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">test_geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">([</span><span class="mi">4475</span><span class="p">,</span><span class="mi">2467</span><span class="p">,</span><span class="mi">2991</span><span class="p">,</span><span class="mi">2392</span><span class="p">,</span><span class="mi">5457</span><span class="p">],</span>
                            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;rc&#39;</span><span class="p">)</span>
<span class="c1"># Plot the test geometry now with tracelines</span>
<span class="n">test_geometry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">view_up</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Save the test geometry to a file</span>
<span class="n">test_geometry</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_geometry.npz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fitting-modes-to-the-frfs">
<h2><a class="toc-backref" href="#id6">Fitting Modes to the FRFs</a><a class="headerlink" href="#fitting-modes-to-the-frfs" title="Permalink to this heading"></a></h2>
<p>Now that we have data and geometry, we can perform experimental modal analysis.
We will fit modes both with SMAC and PolyMax.  First we will do SMAC, so we can
call <a class="reference internal" href="../_autosummary/sdynpy.modal.sdynpy_smac.SMAC_GUI.html#sdynpy.modal.sdynpy_smac.SMAC_GUI" title="sdynpy.modal.sdynpy_smac.SMAC_GUI"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.SMAC_GUI</span></code></a> in the
IPython console to load the GUI.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [12]: sdynpy.SMAC_GUI(frfs)</span>
<span class="go">Out[12]: &lt;sdynpy.modal.sdynpy_smac.SMAC_GUI at 0x14fe6f05b80&gt;</span>
</pre></div>
</div>
<p>We then work through the SMAC GUI to fit shapes.  The first page selects the
mode type, the frequency range, and the data type.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_pseudoinverse.png"><img alt="Computing the pseudoinverse in SMAC" src="../_images/sdynpy_demo_smac_pseudoinverse.png" style="width: 600px;" /></a>
<p>The second page selects initial guiesses for frequency and damping ratios for
use in computing the correlation coefficient.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_corrcoef.png"><img alt="Computing the iniial correlation in SMAC" src="../_images/sdynpy_demo_smac_corrcoef.png" style="width: 600px;" /></a>
<p>The third page selects the initial roots that will be optimized by the solver.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_initial_rootlist.png"><img alt="Selecting the initial roots in SMAC" src="../_images/sdynpy_demo_smac_initial_rootlist.png" style="width: 600px;" /></a>
<p>We then select optimizer parameters for SMAC’s autofit.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_autofit.png"><img alt="Autofit parameters in SMAC." src="../_images/sdynpy_demo_smac_autofit.png" style="width: 600px;" /></a>
<p>Finally, we select the final shapes.  At this page we also resynthesize FRFs and
mode indicator functions, plot shapes and the Modal Assurance Criterion.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_shape_and_eval.png"><img alt="Autofit parameters in SMAC." src="../_images/sdynpy_demo_smac_shape_and_eval.png" style="width: 600px;" /></a>
<p>FRFs and CMIFs are visualized in the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_data.GUIPlot.html#sdynpy.core.sdynpy_data.GUIPlot" title="sdynpy.core.sdynpy_data.GUIPlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.data.GUIPlot</span></code></a>
GUI, so we can quickly switch between shapes and compare resynthesized to
experimental data.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_frf_resynthesis.png"><img alt="Resynthesized FRFs" src="../_images/sdynpy_demo_smac_frf_resynthesis.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_cmif_resynthesis.png"><img alt="Resynthesized CMIFs" src="../_images/sdynpy_demo_smac_cmif_resynthesis.png" style="width: 600px;" /></a>
<p>The MAC can also be plotted to visualize the independence of the shapes.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_smac_mac.png"><img alt="MAC matrix between SMAC shapes" src="../_images/sdynpy_demo_smac_mac.png" style="width: 600px;" /></a>
<p>Shapes are saved to the file <code class="code docutils literal notranslate"><span class="pre">'rattlesnake_test_shapes_smac.npy'</span></code> so they
can be loaded into the script without re-running SMAC.</p>
<p>Similarly, PolyMax can be run by calling the <code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.PolyMax_GUI</span></code>
class from the IPython console.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">In [13]: sdynpy.PolyMax_GUI(frfs)</span>
<span class="go">Out[13]: &lt;sdynpy.modal.sdynpy_polymax.PolyMax_GUI at 0x14fff4c5d30&gt;</span>
</pre></div>
</div>
<p>The first page of the SDynPy PolyMax implementation allows users to select the
frequency range of the analysis.  Also selected is the number of poles to use
in the polynomial fitter.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_polymax_setup.png"><img alt="Initial setup for PolyMax frequency range" src="../_images/sdynpy_demo_polymax_setup.png" style="width: 600px;" /></a>
<p>Once the poles are solved, a stability plot is presented.  The user can click
on individual icons on the stability plot to select given poles to use in the
resynthesis.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_polymax_stability_plot.png"><img alt="PolyMax stability plot" src="../_images/sdynpy_demo_polymax_stability_plot.png" style="width: 600px;" /></a>
<p>With the poles selected, shapes can be computed.  Resynthesized FRFs are plotted
for the user to investigate.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_polymax_resynthesize.png"><img alt="PolyMax resynthesis" src="../_images/sdynpy_demo_polymax_resynthesize.png" style="width: 600px;" /></a>
<p>Shapes are saved to the file <code class="code docutils literal notranslate"><span class="pre">'rattlesnake_test_shapes_polymax.npy'</span></code> so they
can be loaded into the script without re-running PolyMax.</p>
</section>
<section id="analyzing-modal-parameters">
<h2><a class="toc-backref" href="#id7">Analyzing Modal Parameters</a><a class="headerlink" href="#analyzing-modal-parameters" title="Permalink to this heading"></a></h2>
<p>At this point, we would like to analyze the modal parameters.  We will load the
shape files into our script for analysis using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_array.SdynpyArray.html#sdynpy.core.sdynpy_array.SdynpyArray.load" title="sdynpy.core.sdynpy_array.SdynpyArray.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.shape.load</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the shape files from our curve fitting into the script</span>
<span class="n">test_shapes_smac</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_shapes_smac.npy&#39;</span><span class="p">)</span>
<span class="n">test_shapes_polymax</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_shapes_smac.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We also want to extract finite element shapes from the Exodus file using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.from_exodus" title="sdynpy.core.sdynpy_shape.ShapeArray.from_exodus"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.shape.from_exodus</span></code></a>
method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the finite element shapes</span>
<span class="n">fem_shapes</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">from_exodus</span><span class="p">(</span><span class="n">exo</span><span class="p">)</span>
<span class="c1"># Only keep shapes below 2000 Hz for comparison</span>
<span class="n">fem_shapes</span> <span class="o">=</span> <span class="n">fem_shapes</span><span class="p">[</span><span class="n">fem_shapes</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">]</span>
</pre></div>
</div>
<p>In order to make meaningful comparisons between shapes, we need to reduce to a
common set of degrees of freedom.  This can be easily done in SDynPy by indexing
a <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray" title="sdynpy.core.sdynpy_shape.ShapeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.ShapeArray</span></code></a> with a
<code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.CoordinateArray</span></code>
containing the degrees of freedom to keep.  Note that the shape arrays are
returned in a number-of-modes x number-of-degrees-of-freedom array, which is
transposed from the typical mode shape matrix, so we transpose the array
to orient it the typical way.  We can also use the shape matrices to create a
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray" title="sdynpy.core.sdynpy_shape.ShapeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.ShapeArray</span></code></a> object for the
finite element shapes reduced to the test degrees of freedom.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reduce the shapes to a common set of degrees of freedom to compare shapes</span>
<span class="c1"># Extract the degrees of freedom from a test shape</span>
<span class="n">response_dofs</span> <span class="o">=</span> <span class="n">test_shapes_smac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coordinate</span>
<span class="c1"># Can extract a shape matrix by indexing the shape arrays with a CoordinateArray</span>
<span class="n">test_shape_matrix_smac</span> <span class="o">=</span> <span class="n">test_shapes_smac</span><span class="p">[</span><span class="n">response_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="n">test_shape_matrix_polymax</span> <span class="o">=</span> <span class="n">test_shapes_smac</span><span class="p">[</span><span class="n">response_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="n">test_shape_matrix_fem</span> <span class="o">=</span> <span class="n">fem_shapes</span><span class="p">[</span><span class="n">response_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Create an actual ShapeArray object</span>
<span class="n">fem_shapes_reduced</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape_array</span><span class="p">(</span><span class="n">response_dofs</span><span class="p">,</span>
                                      <span class="n">test_shape_matrix_fem</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                      <span class="n">fem_shapes</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span><span class="n">fem_shapes</span><span class="o">.</span><span class="n">damping</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_autosummary/sdynpy.signal_processing.sdynpy_correlation.html#module-sdynpy.signal_processing.sdynpy_correlation" title="sdynpy.signal_processing.sdynpy_correlation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdpy.correlation</span></code></a> contains
a number of functions that can be used to correlate data.  We will use
<a class="reference internal" href="../_autosummary/sdynpy.signal_processing.sdynpy_correlation.mac.html#sdynpy.signal_processing.sdynpy_correlation.mac" title="sdynpy.signal_processing.sdynpy_correlation.mac"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.correlation.mac</span></code></a>
to compute the Modal Assurance Criterion matrix.  The <a class="reference internal" href="../_autosummary/sdynpy.signal_processing.sdynpy_correlation.html#module-sdynpy.signal_processing.sdynpy_correlation" title="sdynpy.signal_processing.sdynpy_correlation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdpy.correlation</span></code></a>
module also contains a <a class="reference internal" href="../_autosummary/sdynpy.signal_processing.sdynpy_correlation.matrix_plot.html#sdynpy.signal_processing.sdynpy_correlation.matrix_plot" title="sdynpy.signal_processing.sdynpy_correlation.matrix_plot"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.correlation.matrix_plot</span></code></a>
function that provides a nice visualization of the Modal Assurance Criterion matrix.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at correlation between shapes from different tests/analyses</span>
<span class="n">mac_smac_polymax</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">mac</span><span class="p">(</span><span class="n">test_shape_matrix_smac</span><span class="p">,</span><span class="n">test_shape_matrix_polymax</span><span class="p">)</span>
<span class="n">mac_smac_fem</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">mac</span><span class="p">(</span><span class="n">test_shape_matrix_smac</span><span class="p">,</span><span class="n">test_shape_matrix_fem</span><span class="p">)</span>
<span class="n">mac_polymax_fem</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">mac</span><span class="p">(</span><span class="n">test_shape_matrix_polymax</span><span class="p">,</span><span class="n">test_shape_matrix_fem</span><span class="p">)</span>
<span class="c1"># Plot the mac matrix between the</span>
<span class="n">sdpy</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">matrix_plot</span><span class="p">(</span><span class="n">mac_polymax_fem</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_mac_test_fem.png"><img alt="MAC between test and FEM" src="../_images/sdynpy_demo_mac_test_fem.png" style="width: 600px;" /></a>
<p>Another way to compare shapes is to plot them on top of one another so the
differences are obvious.  We can use the Modal Assurance Matrix to figure out
the best matches between test and analysis.  Then we can use the
<code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.shape.overlay_shapes</span></code>
function to create both geometry and shapes that combine two geometries and
shapes.  Using the optional <code class="code docutils literal notranslate"><span class="pre">color_override</span></code> argument allows setting a
different color to each geometry to aid in visualization.  We can then set up
the plotting arguments and plot the combined shapes.  We also save out an animation
of the first mode to a <code class="code docutils literal notranslate"><span class="pre">.gif</span></code> file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare shapes by overlaying them</span>
<span class="c1"># Find the best match in the FEM to each of the test shapes</span>
<span class="n">fem_matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mac_polymax_fem</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Overlay the shapes and geometry</span>
<span class="n">combined_geometry</span><span class="p">,</span><span class="n">combined_shapes</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">overlay_shapes</span><span class="p">(</span>
    <span class="p">(</span><span class="n">test_geometry</span><span class="p">,</span><span class="n">test_geometry</span><span class="p">),</span>
    <span class="p">(</span><span class="n">test_shapes_polymax</span><span class="p">,</span><span class="n">fem_shapes_reduced</span><span class="p">[</span><span class="n">fem_matches</span><span class="p">]),</span>
    <span class="n">color_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">])</span>
<span class="c1"># Plot the shapes to set up the animation</span>
<span class="n">geometry_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;view_up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;line_width&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span>
<span class="c1"># Plot the shapes</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">combined_geometry</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">combined_shapes</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">geometry_kwargs</span><span class="p">)</span>
<span class="c1"># Save the initial mode showing as a .gif</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">save_animation</span><span class="p">(</span><span class="s1">&#39;mode_1.gif&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The overlaid shapes show good agreement between test and analysis.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_mode_1.gif"><img alt="First mode plotted against the corresponding finite element mode." src="../_images/sdynpy_demo_mode_1.gif" style="width: 600px;" /></a>
</section>
<section id="documentation-generation">
<h2><a class="toc-backref" href="#id8">Documentation Generation</a><a class="headerlink" href="#documentation-generation" title="Permalink to this heading"></a></h2>
<p>While SDynPy is perfectly capable of generating and saving figures and animations
of mode shapes, it is often tedious to export the identical information for a
large number of modes.  Therefore SDynPy has the ability to export typical
documentation in either Powerpoint or LaTeX format.  This export will generally
not be enough to completely describe a given test, but it is easy enough to
take the exported data and add it to a completed report.</p>
<p>SDynPy can create a Powerpoint presentation using the
<a class="reference internal" href="../_autosummary/sdynpy.doc.sdynpy_ppt.create_summary_pptx.html#sdynpy.doc.sdynpy_ppt.create_summary_pptx" title="sdynpy.doc.sdynpy_ppt.create_summary_pptx"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.doc.create_summary_pptx</span></code></a>
function.  This function can either take a filename to save the output presentation
as, or it can take an existing presentation object that it will add to.  This latter
approach is most useful for creeating a presentation with an existing template or
design.  If only a filename is specified, the output presentation will consist of
data over the default white slide backgrounds.  We will therefore load in a
Powerpoint containing the Sandia corporate template to save us from having to
reformat the presentation into that template at a later time.</p>
<p>Note that different templates have different types of slides, so if using a custom
template, ensure that the <code class="code docutils literal notranslate"><span class="pre">title_slide_layout_index</span></code>, <code class="code docutils literal notranslate"><span class="pre">content_slide_layout_index</span></code>,
and <code class="code docutils literal notranslate"><span class="pre">empty_slide_layout_index</span></code> point to the proper layouts within the presentation.
Otherwise, errors may occur if, for example, SDynPy tries to access the subtitle on a
slide that does not have a subtitle placeholder on it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open up a presentation with the Sandia theme</span>
<span class="n">prs</span> <span class="o">=</span> <span class="n">pptx</span><span class="o">.</span><span class="n">Presentation</span><span class="p">(</span><span class="s1">&#39;C:/users/dprohe/documents/Powerpoint_Sandia_Theme.pptx&#39;</span><span class="p">)</span>
<span class="c1"># Fill the presentation with our analysis data</span>
<span class="n">sdpy</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">create_summary_pptx</span><span class="p">(</span><span class="n">prs</span><span class="p">,</span>
                              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;BARC Modal with Rattlesnake&#39;</span><span class="p">,</span>
                              <span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;A SDynPy Demonstration&#39;</span><span class="p">,</span>
                              <span class="n">geometry</span> <span class="o">=</span> <span class="n">test_geometry</span><span class="p">,</span>
                              <span class="n">shapes</span> <span class="o">=</span> <span class="n">test_shapes_polymax</span><span class="p">,</span>
                              <span class="n">frfs</span><span class="o">=</span><span class="n">frfs</span><span class="p">,</span>
                              <span class="n">geometry_plot_kwargs</span> <span class="o">=</span> <span class="n">geometry_kwargs</span><span class="p">,</span>
                              <span class="n">content_slide_layout_index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">empty_slide_layout_index</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Save the presentation out</span>
<span class="n">prs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_quicklook.pptx&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The output presentation is then formatted as specified and has the test
information automatically populated.  A geometry overview slide is presented,
as well as a modal slide.  Then there is one slide for each mode showing the
natural frequency, damping ratio, and animated shape.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_slide_title.png"><img alt="Title slide of exported presentation" src="../_images/sdynpy_demo_slide_title.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_slide_geometry.png"><img alt="Slide containing geometry overview" src="../_images/sdynpy_demo_slide_geometry.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_slide_mode_parameters.png"><img alt="Overview slide of modal parameters" src="../_images/sdynpy_demo_slide_mode_parameters.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_slide_mode_1.png"><img alt="Slide containing information for mode 1" src="../_images/sdynpy_demo_slide_mode_1.png" style="width: 600px;" /></a>
<p>If a report document is required, SDynPy can also export LaTeX source code.
To remain as flexible as possible, SDynPy does not export a complete document,
as it cannot know which document class or template the data may be used in.
Instead, SDynPy outputs a portion of a LaTeX document that can be included in
a full document.  This is done using the
<a class="reference internal" href="../_autosummary/sdynpy.doc.sdynpy_latex.create_latex_summary.html#sdynpy.doc.sdynpy_latex.create_latex_summary" title="sdynpy.doc.sdynpy_latex.create_latex_summary"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.doc.create_latex_summary</span></code></a>
function.  It is strongly suggested to set the <code class="code docutils literal notranslate"><span class="pre">figure_basename</span></code> argument
of that function to a subdirectory; a large number of figures will be generated
to allow animation of the shapes inside the exported PDF.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a LaTeX snippet that can be included in a larger document</span>
<span class="n">sdpy</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">create_latex_summary</span><span class="p">(</span>
    <span class="n">figure_basename</span><span class="o">=</span><span class="s1">&#39;figures/rattlesnake_test.png&#39;</span><span class="p">,</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">test_geometry</span><span class="p">,</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="n">test_shapes_polymax</span><span class="p">,</span>
    <span class="n">frfs</span> <span class="o">=</span> <span class="n">frfs</span><span class="p">,</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;rattlesnake_test_memo_content.tex&#39;</span><span class="p">,</span>
    <span class="n">geometry_plot_kwargs</span> <span class="o">=</span> <span class="n">geometry_kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This output LaTeX source code can be easily included in another document,
for example, this minimal Article class</p>
<div class="highlight-latex notranslate"><div class="highlight"><pre><span></span><span class="k">\documentclass</span><span class="na">[]</span><span class="nb">{</span>article<span class="nb">}</span>

<span class="k">\usepackage</span><span class="nb">{</span>graphicx<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>animate<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>caption<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>subcaption<span class="nb">}</span>

<span class="c">%opening</span>
<span class="k">\title</span><span class="nb">{</span>SDynPy Example LaTeX Documentation<span class="nb">}</span>
<span class="k">\author</span><span class="nb">{</span>Dan Rohe<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>document<span class="nb">}</span>

<span class="k">\maketitle</span>

<span class="k">\begin</span><span class="nb">{</span>abstract<span class="nb">}</span>

<span class="k">\end</span><span class="nb">{</span>abstract<span class="nb">}</span>

<span class="k">\section</span><span class="nb">{</span>SDynPy Content<span class="nb">}</span>

<span class="k">\input</span><span class="nb">{</span>rattlesnake<span class="nb">_</span>test<span class="nb">_</span>memo<span class="nb">_</span>content.tex<span class="nb">}</span>

<span class="k">\end</span><span class="nb">{</span>document<span class="nb">}</span>
</pre></div>
</div>
<p>produces the following PDF:</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_latex_title.png"><img alt="Title page of minimal article class" src="../_images/sdynpy_demo_latex_title.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_latex_figures.png"><img alt="Some figures in the minimal article class" src="../_images/sdynpy_demo_latex_figures.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_latex_modeshapes.png"><img alt="Modeshapes in the minimal article class" src="../_images/sdynpy_demo_latex_modeshapes.png" style="width: 600px;" /></a>
<p>The user could obviously add context surrounding the exported content to describe
the test setup, etc.</p>
</section>
<section id="exporting-to-exodus">
<h2><a class="toc-backref" href="#id9">Exporting to Exodus</a><a class="headerlink" href="#exporting-to-exodus" title="Permalink to this heading"></a></h2>
<p>Finally, in order to share modal data with analysts who may be updating a model,
it is often useful to export data to their finite element format so the same
postprocessing tools can be used to visualize test and analysis results.
We will therefore export our results to exodus format.</p>
<p>It can be, however, difficult to gain an intuitive understanding about what is
happening in test shapes, particularly when some nodes have a limited number of
degrees of freedom (e.g. displacements from a uniaxial accelerometer).  Finite
element expansion techniques can be used to “fill in the gaps” of a test model
to make it easier to visualize the deformations of a given shape.</p>
<p>We will therefore perform SEREP expansion of the test data using the finite
element shapes as basis functions.  To do this, we solve for modal coefficients
that multiply the FEM shapes to produce the test shapes.  We can use the
Modal Assurance Criterion matrix to help identify which finite element mode
shapes should be included in the expansion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">test_shape_matrix_fem</span><span class="p">[:,:</span><span class="mi">14</span><span class="p">],</span><span class="n">test_shape_matrix_polymax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>We then want to multiply this coefficient by the full finite element shapes to
estimate what the test shapes would look like in the full finite element space.
While we could extract the full finite element shapes from the finite element
model, multiply them by the coefficients <code class="code docutils literal notranslate"><span class="pre">q</span></code>, and then rebuild the Exodus
file displacements, we can instead use the
<a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.repack" title="sdynpy.fem.sdynpy_exodus.ExodusInMemory.repack"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.ExodusInMemory.repack</span></code></a>
method, which is designed to produce new Exodus results that are a linear
combination of old Exodus results.  We will first load our
<a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus" title="sdynpy.fem.sdynpy_exodus.Exodus"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.Exodus</span></code></a> object into
memory to obtain an <a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory" title="sdynpy.fem.sdynpy_exodus.ExodusInMemory"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.ExodusInMemory</span></code></a>
object.  Note that we need to ensure that we load in the same time steps that
were used in the expansion to make sure all matrices are properly sized.
<a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.ExodusInMemory.html#sdynpy.fem.sdynpy_exodus.ExodusInMemory.repack" title="sdynpy.fem.sdynpy_exodus.ExodusInMemory.repack"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.ExodusInMemory.repack</span></code></a>
makes no assumptions what the time steps in the model should be, so it is up to
us to fill that information in with the test frequencies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the Exodus object into memory</span>
<span class="n">fexo</span> <span class="o">=</span> <span class="n">exo</span><span class="o">.</span><span class="n">load_into_memory</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DispX&#39;</span><span class="p">,</span><span class="s1">&#39;DispY&#39;</span><span class="p">,</span><span class="s1">&#39;DispZ&#39;</span><span class="p">],</span><span class="n">timesteps</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span>
                        <span class="n">blocks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="c1"># Linearly combine the existing shapes into new shapes</span>
<span class="n">fexo_repack</span> <span class="o">=</span> <span class="n">fexo</span><span class="o">.</span><span class="n">repack</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="c1"># Fill in the abscissa data (frequencies in this case)</span>
<span class="n">fexo_repack</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">test_shapes_polymax</span><span class="o">.</span><span class="n">frequency</span>
</pre></div>
</div>
<p>If we want to plot the new shapes in SDynPy, we could load the shapes back into
a <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray" title="sdynpy.core.sdynpy_shape.ShapeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">sdpy.ShapeArray</span></code></a> object, and
even combine with the finite element shapes for comparison.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot expanded shapes against finite element shapes</span>
<span class="c1"># Load shapes into sdynpy ShapeArray object</span>
<span class="n">expanded_shapes_polymax</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">from_exodus</span><span class="p">(</span><span class="n">fexo_repack</span><span class="p">)</span>
<span class="c1"># combine the shapes</span>
<span class="n">combined_expanded_geometry</span><span class="p">,</span><span class="n">combined_expanded_shapes</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">overlay_shapes</span><span class="p">(</span>
    <span class="p">(</span><span class="n">fem_geometry</span><span class="p">,</span><span class="n">fem_geometry</span><span class="p">),</span>
    <span class="p">(</span><span class="n">expanded_shapes_polymax</span><span class="p">,</span><span class="n">fem_shapes</span><span class="p">[</span><span class="n">fem_matches</span><span class="p">]),</span><span class="n">color_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">])</span>
<span class="c1"># Plot the shapes overlaid</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">combined_expanded_geometry</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span>
    <span class="n">combined_expanded_shapes</span><span class="p">,{</span><span class="s1">&#39;view_up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
    <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">undeformed_opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">save_animation</span><span class="p">(</span><span class="s1">&#39;expanded_mode_1.gif&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_expanded_mode_1.gif"><img alt="Comparison of expanded mode shape 1 against finite element shape 1" src="../_images/sdynpy_demo_expanded_mode_1.gif" style="width: 600px;" /></a>
<p>We can also write out both the test data and expanded data to Exodus files
to visualize in external software.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an ExodusInMemory object from sdynpy objects</span>
<span class="n">fexo_out</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">ExodusInMemory</span><span class="o">.</span><span class="n">from_sdynpy</span><span class="p">(</span><span class="n">test_geometry</span><span class="p">,</span><span class="n">test_shapes_polymax</span><span class="p">)</span>
<span class="c1"># Write it to a file</span>
<span class="n">fexo_out</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_output.exo&#39;</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Repeat with the expanded data</span>
<span class="n">fexo_out</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">ExodusInMemory</span><span class="o">.</span><span class="n">from_sdynpy</span><span class="p">(</span><span class="n">fem_geometry</span><span class="p">,</span><span class="n">expanded_shapes_polymax</span><span class="p">)</span>
<span class="n">fexo_out</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="s1">&#39;rattlesnake_test_output_expanded.exo&#39;</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The Exodus files can then be loaded into an external software such as Paraview
for visualization, which provides more flexibility than exists in SDynPy.</p>
<a class="reference internal image-reference" href="../_images/sdynpy_demo_vis_paraview.png"><img alt="Exodus files visualized in Paraview." src="../_images/sdynpy_demo_vis_paraview.png" style="width: 600px;" /></a>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="airplane_modal_test.html" class="btn btn-neutral float-left" title="Airplane Modal Test" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transient_fem_analysis.html" class="btn btn-neutral float-right" title="Analysis of Transient Finite Element Results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 National Technology &amp; Engineering Solutions of Sandia,     LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS,     the U.S. Government retains certain rights in this software.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>