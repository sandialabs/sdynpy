<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Substructuring using the Transmission Simulator Method &mdash; SDynPy 0.14.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MIMO Random Vibration" href="mimo_random_vibration_control.html" />
    <link rel="prev" title="Substructuring using Craig-Bampton Superelements from Sierra/SD" href="craig_bampton_substructuring.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_horizontal_light.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sdynpy_showcase.html">SDynPy Showcase</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">SDynpy Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="airplane_modal_test.html">Airplane Modal Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="rattlesnake_demonstration.html">Rattlesnake Demonstration</a></li>
<li class="toctree-l2"><a class="reference internal" href="transient_fem_analysis.html">Analysis of Transient Finite Element Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_reduction/model_reduction.html">Model Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="craig_bampton_substructuring.html">Substructuring using Craig-Bampton Superelements from Sierra/SD</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Substructuring using the Transmission Simulator Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-problem">Setting up the Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-results-into-sdynpy">Loading the results into SDynPy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reducing-to-test-degrees-of-freedom">Reducing to Test Degrees of Freedom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Substructuring using the Transmission Simulator Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mimo_random_vibration_control.html">MIMO Random Vibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modal_tutorials.html">Modal Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">SDynPy Programming Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SDynPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">SDynpy Examples</a></li>
      <li class="breadcrumb-item active">Substructuring using the Transmission Simulator Method</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_problems/transmission_simulator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="substructuring-using-the-transmission-simulator-method">
<h1><a class="toc-backref" href="#id22">Substructuring using the Transmission Simulator Method</a><a class="headerlink" href="#substructuring-using-the-transmission-simulator-method" title="Permalink to this heading"></a></h1>
<p>This example will demonstrate the capabilities in SDynPy for performing more
advanced substructuring calculations using the Transmission Simulator Method.
The transmission simulator method is a useful form of substructuring which
allows the interface of the substructures to be mass-loaded, which provides a
better set of basis shapes to use in the substructuring calculation.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#substructuring-using-the-transmission-simulator-method" id="id22">Substructuring using the Transmission Simulator Method</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-the-problem" id="id23">Setting up the Problem</a></p></li>
<li><p><a class="reference internal" href="#loading-the-results-into-sdynpy" id="id24">Loading the results into SDynPy</a></p></li>
<li><p><a class="reference internal" href="#reducing-to-test-degrees-of-freedom" id="id25">Reducing to Test Degrees of Freedom</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id26">Substructuring using the Transmission Simulator Method</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id27">Summary</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="setting-up-the-problem">
<h2><a class="toc-backref" href="#id23">Setting up the Problem</a><a class="headerlink" href="#setting-up-the-problem" title="Permalink to this heading"></a></h2>
<p>We will first use the Cubit software to generate a mesh for the finite element
analysis that will be used in this example problem.  We will create a 3-part
model of a box inside of a container.  The container is labeled <code class="docutils literal notranslate"><span class="pre">A</span></code>, the lid is
labeled <code class="docutils literal notranslate"><span class="pre">B</span></code>, and the internal box is labeled <code class="docutils literal notranslate"><span class="pre">C</span></code>.  The attached input file can
be executed using Cubit’s Python interface to create the model.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/transmission_simulator_setup.png"><img alt="Mesh generated by Cubit" src="../_images/transmission_simulator_setup.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mesh generated by Cubit shown both in whole and in cross section to reveal
the three components.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><a class="reference download internal" download="" href="../_downloads/11f1d40bf807bc0274f013d0d9ef9d79/create_models.py"><code class="xref download docutils literal notranslate"><span class="pre">Cubit</span> <span class="pre">Input</span> <span class="pre">File</span></code></a></p>
<p>The model contains 3 element blocks, block 1, block 2, and block 3, which are
the container <code class="docutils literal notranslate"><span class="pre">A</span></code>, the lid <code class="docutils literal notranslate"><span class="pre">B</span></code>, and the internal box <code class="docutils literal notranslate"><span class="pre">C</span></code>, respectively.  The attached
input file will generate several exodus files that can be used to investigate
substructuring.  Each object will be generated independently, <code class="docutils literal notranslate"><span class="pre">a.exo</span></code>, <code class="docutils literal notranslate"><span class="pre">b.exo</span></code>,
and <code class="docutils literal notranslate"><span class="pre">c.exo</span></code>.  Additionally, meshes will be generated for pairs of components,
<code class="docutils literal notranslate"><span class="pre">ab.exo</span></code> and <code class="docutils literal notranslate"><span class="pre">bc.exo</span></code>.  Finally, a full model <code class="docutils literal notranslate"><span class="pre">abc.exo</span></code> will be generated which
will provide truth data to compare the substructuring results to.</p>
<p>Input files are then set up for the Sierra/SD code.  Each input file will
contain an Eigensolution <code class="docutils literal notranslate"><span class="pre">eigen</span></code> which will solve for the component modes
used in the substructuring.  The input files for each mesh are attached:</p>
<p><a class="reference download internal" download="" href="../_downloads/768276c04c0134d8f654b40c51aaa12e/abc.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">ABC</span></code></a></p>
<p><a class="reference download internal" download="" href="../_downloads/5133a2a7461eb42336d657a401d01fc9/ab.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">AB</span></code></a></p>
<p><a class="reference download internal" download="" href="../_downloads/f38fc3e4275c2155c894541014a54a53/bc.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">BC</span></code></a></p>
<p><a class="reference download internal" download="" href="../_downloads/655358ba9e37d49f2c847736aaebf5a9/a.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">A</span></code></a></p>
<p><a class="reference download internal" download="" href="../_downloads/3d472b4bccadaaeb5b9d1d8d99f7e583/b.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">B</span></code></a></p>
<p><a class="reference download internal" download="" href="../_downloads/6952e7f4caf8c0fb6d3e98e438f558d7/c.inp"><code class="xref download docutils literal notranslate"><span class="pre">Sierra/SD</span> <span class="pre">Input</span> <span class="pre">for</span> <span class="pre">C</span></code></a></p>
<p>When run, these will generate output files containing the natural frequencies
and mode shapes of the structures.</p>
<p>To perform the transmission simulator approach, we will add substructure <code class="docutils literal notranslate"><span class="pre">AB</span></code>
to substructure <code class="docutils literal notranslate"><span class="pre">BC</span></code> and then subtract off the extra <code class="docutils literal notranslate"><span class="pre">B</span></code>.  In this case, the
structure <code class="docutils literal notranslate"><span class="pre">B</span></code> serves as the transmission simulator because it mass-loads the
interfaces of <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> to give a better set of basis shapes to use in the
substructuring.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/transmission_simulator_math.png"><img alt="Transmission Simulator Operations" src="../_images/transmission_simulator_math.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Substructuring operations performed in the transmission simulator method.
The system <code class="docutils literal notranslate"><span class="pre">AB</span></code> is added to <code class="docutils literal notranslate"><span class="pre">BC</span></code> and then system <code class="docutils literal notranslate"><span class="pre">B</span></code> is subtracted to
produce system <code class="docutils literal notranslate"><span class="pre">ABC</span></code>.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="loading-the-results-into-sdynpy">
<h2><a class="toc-backref" href="#id24">Loading the results into SDynPy</a><a class="headerlink" href="#loading-the-results-into-sdynpy" title="Permalink to this heading"></a></h2>
<p>We will now load the models into SDynPy in order to perform the analysis.  We
will start by importing the required modules and setting up plotting options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import modules</span>
<span class="kn">import</span> <span class="nn">sdynpy</span> <span class="k">as</span> <span class="nn">sdpy</span> <span class="c1"># For dynamics</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># For numerics</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># For plotting</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">QhullError</span> <span class="c1"># For creating elements for visualization</span>

<span class="c1"># Set up options to use for plotting</span>
<span class="n">plot_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;line_width&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;show_edges&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;view_up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]}</span>
</pre></div>
</div>
<p>We will now load in the models and plot their mode shapes to make sure
everything looks right.  For each model we will reduce to just the surface
nodes and elements for visualization using the
<a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus.reduce_to_surfaces" title="sdynpy.fem.sdynpy_exodus.Exodus.reduce_to_surfaces"><code class="xref py py-func docutils literal notranslate"><span class="pre">reduce_to_surfaces</span></code></a>
method of the <a class="reference internal" href="../_autosummary/sdynpy.fem.sdynpy_exodus.Exodus.html#sdynpy.fem.sdynpy_exodus.Exodus" title="sdynpy.fem.sdynpy_exodus.Exodus"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exodus</span></code></a> class.
We will then create <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry" title="sdynpy.core.sdynpy_geometry.Geometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">Geometry</span></code></a>
as well as a <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray" title="sdynpy.core.sdynpy_shape.ShapeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shapes</span></code></a> from the
finite element data using the respective
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.from_exodus.html#sdynpy.core.sdynpy_geometry.from_exodus" title="sdynpy.core.sdynpy_geometry.from_exodus"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.geometry.from_exodus</span></code></a> and
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.from_exodus.html#sdynpy.core.sdynpy_shape.from_exodus" title="sdynpy.core.sdynpy_shape.from_exodus"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdpy.shape.from_exodus</span></code></a> methods.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the models to load into SDynPy</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;ab&#39;</span><span class="p">,</span><span class="s1">&#39;bc&#39;</span><span class="p">,</span><span class="s1">&#39;abc&#39;</span><span class="p">]</span>

<span class="c1"># For each model, load in the exodus file and reduce it to surfaces</span>
<span class="n">fexos</span> <span class="o">=</span> <span class="p">{</span><span class="n">model</span><span class="p">:</span><span class="n">sdpy</span><span class="o">.</span><span class="n">Exodus</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s1">&#39;-out.exo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reduce_to_surfaces</span><span class="p">()</span>
         <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">}</span>

<span class="c1"># For each model create a SDynPy Geometry from the finite element model</span>
<span class="n">geometries</span> <span class="o">=</span> <span class="p">{</span><span class="n">model</span><span class="p">:</span><span class="n">sdpy</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">from_exodus</span><span class="p">(</span><span class="n">fexos</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
              <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">}</span>

<span class="c1"># For each model create a SDynPy ShapeArray from the eigensolution results</span>
<span class="n">shapes</span> <span class="o">=</span> <span class="p">{</span><span class="n">model</span><span class="p">:</span><span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">from_exodus</span><span class="p">(</span><span class="n">fexos</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
          <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">}</span>
<span class="c1"># For each model, plot the mode shapes on the geometry</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="n">model</span><span class="p">],</span><span class="n">plot_options</span><span class="p">,</span>
                                 <span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/transmission_simulator_A_mode_example.gif"><img alt="A Mode Shape" src="../_images/transmission_simulator_A_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">A</span></code></span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/transmission_simulator_B_mode_example.gif"><img alt="B Mode Shape" src="../_images/transmission_simulator_B_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">B</span></code></span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../_images/transmission_simulator_C_mode_example.gif"><img alt="C Mode Shape" src="../_images/transmission_simulator_C_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">C</span></code></span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../_images/transmission_simulator_AB_mode_example.gif"><img alt="AB Mode Shape" src="../_images/transmission_simulator_AB_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">AB</span></code></span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../_images/transmission_simulator_BC_mode_example.gif"><img alt="BC Mode Shape" src="../_images/transmission_simulator_BC_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">BC</span></code></span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../_images/transmission_simulator_ABC_mode_example.gif"><img alt="ABC Mode Shape" src="../_images/transmission_simulator_ABC_mode_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">ABC</span></code></span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="reducing-to-test-degrees-of-freedom">
<h2><a class="toc-backref" href="#id25">Reducing to Test Degrees of Freedom</a><a class="headerlink" href="#reducing-to-test-degrees-of-freedom" title="Permalink to this heading"></a></h2>
<p>For this example, we will pretend that the finite element results are actually
test data, and for this reason, we will reduce to a more limited set of degrees
of freedom in each model that may have been measured in a test.  We will first
define the geometry of the system so we can select the final kept set of nodes
by position.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">container_size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]</span>
<span class="n">component_size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.7</span><span class="p">]</span>
<span class="n">lid_depth</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">container_thickness</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">lid_position</span> <span class="o">=</span> <span class="n">container_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">lid_depth</span>
<span class="n">component_position</span> <span class="o">=</span> <span class="n">container_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">container_thickness</span><span class="o">-</span><span class="n">component_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>

<span class="n">grid_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">component_grid_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">grid_inset</span> <span class="o">=</span> <span class="mf">0.1</span>
</pre></div>
</div>
<p>We will then loop through each face of the model to get sensor positions that
we would like to use in the test.  We will use NumPy functions
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linspace.html">linspace</a>
and <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.meshgrid.html">meshgrid</a>.
to produce grids of sensors on each surface.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through each face to get sensor positions</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Outer box</span>
<span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">other_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="o">==</span> <span class="n">dimension</span><span class="p">]</span>
    <span class="n">meshgrid_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">grid_0</span> <span class="o">=</span> <span class="n">container_size</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">grid_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">container_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">container_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">grid_size</span><span class="p">)</span>
    <span class="n">grid_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">container_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">container_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">grid_size</span><span class="p">)</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_0</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">grid_1</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">grid_2</span>
    <span class="n">this_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">meshgrid_inputs</span><span class="p">,</span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_positions</span><span class="p">)</span>
    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">this_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">index</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Now do the negative side</span>
    <span class="n">this_positions_opposite</span> <span class="o">=</span> <span class="n">this_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">this_positions_opposite</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">dimension</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_positions_opposite</span><span class="p">)</span>
    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">this_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">index</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1"># Component box</span>
<span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">other_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="o">==</span> <span class="n">dimension</span><span class="p">]</span>
    <span class="n">meshgrid_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">grid_0</span> <span class="o">=</span> <span class="n">component_size</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">grid_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">component_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">component_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">grid_inset</span><span class="p">,</span>
                          <span class="n">component_grid_size</span><span class="p">)</span>
    <span class="n">grid_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">component_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">grid_inset</span><span class="o">+</span><span class="n">component_position</span><span class="p">,</span>
                          <span class="n">component_size</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">grid_inset</span><span class="o">+</span><span class="n">component_position</span><span class="p">,</span>
                          <span class="n">component_grid_size</span><span class="p">)</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_0</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">grid_1</span>
    <span class="n">meshgrid_inputs</span><span class="p">[</span><span class="n">other_dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">grid_2</span>
    <span class="n">this_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">meshgrid_inputs</span><span class="p">,</span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_positions</span><span class="p">)</span>
    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">this_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">index</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Now do the negative side</span>
    <span class="n">this_positions_opposite</span> <span class="o">=</span> <span class="n">this_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">this_positions_opposite</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">dimension</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_positions_opposite</span><span class="p">)</span>
    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">this_positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">index</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We will now reduce each of the geometries down to its test sensors using
the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.reduce" title="sdynpy.core.sdynpy_geometry.Geometry.reduce"><code class="xref py py-func docutils literal notranslate"><span class="pre">reduce</span></code></a> method,
using the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.by_position" title="sdynpy.core.sdynpy_geometry.NodeArray.by_position"><code class="xref py py-func docutils literal notranslate"><span class="pre">by_position</span></code></a>
method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray" title="sdynpy.core.sdynpy_geometry.NodeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeArray</span></code></a>
object to select which nodes to keep.  Note that this will simply select the
closest node to the position specified, which isn’t exactly what we want.  For
example, if a position is specified that corresponds to a node on system <code class="docutils literal notranslate"><span class="pre">A</span></code>,
but the system we are generating test data for is system <code class="docutils literal notranslate"><span class="pre">BC</span></code> (which doesn’t
contain system <code class="docutils literal notranslate"><span class="pre">A</span></code>) it will instead select a node the closest node on <code class="docutils literal notranslate"><span class="pre">BC</span></code>
to that point, rather than simply not selecting a node at all.  We will discard
these points and connect the test nodes with elements and tracelines to ease
visualization.</p>
<p>We will specify a distance threshold to compare the point where we wanted to
select a node and where the closest node was selected, and use that to discard
improperly selected nodes.  We will also specify a maximum condition number for
triangles created as elements for visualization.  We will also set up a
dictionary of <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.id_map.html#sdynpy.core.sdynpy_geometry.id_map" title="sdynpy.core.sdynpy_geometry.id_map"><code class="xref py py-class docutils literal notranslate"><span class="pre">id_map</span></code></a> objects
to map the nodes between the test geometry and the finite element model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">distance_threshold</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">max_condition</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">node_id_maps</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>We will then loop through all of our test geometries and finish their creation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now create the test geometries</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">test_geometries</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating test geometry for </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
</pre></div>
</div>
<p>Within this loop, we will set up a node map from the finite element model nodes
to the test nodes, which will be labeled 1 through $n_nodes$ for each system,
where $n_nodes$ is the number of nodes for each test geometry.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">geometry</span> <span class="o">=</span> <span class="n">test_geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
<span class="n">from_ids</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span>
<span class="n">to_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">node_id_maps</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">id_map</span><span class="p">(</span><span class="n">from_ids</span><span class="p">,</span> <span class="n">to_ids</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, we will now discard the nodes that aren’t close enough to their
desired positions, and then use the node map to rename the nodes in the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Throw away nodes that aren&#39;t in the model</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">coordinate</span><span class="o">-</span><span class="n">positions</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">keep_indices</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_threshold</span>
<span class="n">new_geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">keep_indices</span><span class="p">])</span>
<span class="n">new_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">node_id_maps</span><span class="p">[</span><span class="n">model</span><span class="p">](</span><span class="n">new_geometry</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">original_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">keep_indices</span><span class="p">]</span>
</pre></div>
</div>
<p>We will then add elements using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray.triangulate" title="sdynpy.core.sdynpy_geometry.NodeArray.triangulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">triangulate</span></code></a> method
of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.NodeArray.html#sdynpy.core.sdynpy_geometry.NodeArray" title="sdynpy.core.sdynpy_geometry.NodeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">NodeArray</span></code></a> object.  If
the nodes cannot be triangulated, they are instead connected with a traceline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create elements</span>
<span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">original_indices</span><span class="p">):</span>
    <span class="n">face_indices</span> <span class="o">=</span> <span class="n">original_indices</span> <span class="o">==</span> <span class="n">value</span>
    <span class="n">face_nodes</span> <span class="o">=</span> <span class="n">new_geometry</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">face_indices</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">face_elements</span> <span class="o">=</span> <span class="n">face_nodes</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">new_geometry</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
                                               <span class="n">condition_threshold</span><span class="o">=</span><span class="n">max_condition</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">face_elements</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">QhullError</span><span class="p">:</span>
        <span class="n">new_geometry</span><span class="o">.</span><span class="n">add_traceline</span><span class="p">(</span><span class="n">face_nodes</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">new_geometry</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="n">new_geometry</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new_geometry</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">test_geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_geometry</span>
</pre></div>
</div>
<p>We can then similarly map the shapes to the new test geometries.  We will use
the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray.transform_coordinate_system" title="sdynpy.core.sdynpy_shape.ShapeArray.transform_coordinate_system"><code class="xref py py-func docutils literal notranslate"><span class="pre">transform_coordinate_system</span></code></a>
method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_shape.ShapeArray.html#sdynpy.core.sdynpy_shape.ShapeArray" title="sdynpy.core.sdynpy_shape.ShapeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShapeArray</span></code></a> object
to simultaneously reduce the shape down to the test geometry and apply the
node map.  We will also assign a 1% damping to each of the test shapes.  We will
plot the reduced shapes as well as a MAC matrix to ensure the shapes are still
distinguishable in their reduced form.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now create the test shapes</span>
<span class="n">test_shapes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating test shapes for </span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="n">original_geometry</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="n">new_geometry</span> <span class="o">=</span> <span class="n">test_geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="n">id_map</span> <span class="o">=</span> <span class="n">node_id_maps</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="n">test_shape</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">transform_coordinate_system</span><span class="p">(</span><span class="n">original_geometry</span><span class="p">,</span><span class="n">new_geometry</span><span class="p">,</span><span class="n">id_map</span><span class="p">)</span>
    <span class="n">test_shape</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">test_shapes</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_shape</span>
    <span class="n">test_geometries</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">test_shapes</span><span class="p">[</span><span class="n">model</span><span class="p">],</span><span class="n">plot_options</span><span class="p">,</span><span class="n">undeformed_opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">sdpy</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">matrix_plot</span><span class="p">(</span><span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">mac</span><span class="p">(</span><span class="n">test_shapes</span><span class="p">[</span><span class="n">model</span><span class="p">]))</span>
</pre></div>
</div>
<figure class="align-center" id="id10">
<a class="reference internal image-reference" href="../_images/transmission_simulator_A_mode_reduced_example.gif"><img alt="Test A Mode Shape" src="../_images/transmission_simulator_A_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">A</span></code></span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id11">
<a class="reference internal image-reference" href="../_images/transmission_simulator_B_mode_reduced_example.gif"><img alt="Test B Mode Shape" src="../_images/transmission_simulator_B_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">B</span></code></span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id12">
<a class="reference internal image-reference" href="../_images/transmission_simulator_C_mode_reduced_example.gif"><img alt="Test C Mode Shape" src="../_images/transmission_simulator_C_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">C</span></code></span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id13">
<a class="reference internal image-reference" href="../_images/transmission_simulator_AB_mode_reduced_example.gif"><img alt="Test AB Mode Shape" src="../_images/transmission_simulator_AB_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">AB</span></code></span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id14">
<a class="reference internal image-reference" href="../_images/transmission_simulator_BC_mode_reduced_example.gif"><img alt="Test BC Mode Shape" src="../_images/transmission_simulator_BC_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">BC</span></code></span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id15">
<a class="reference internal image-reference" href="../_images/transmission_simulator_ABC_mode_reduced_example.gif"><img alt="Test ABC Mode Shape" src="../_images/transmission_simulator_ABC_mode_reduced_example.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Test Mode Shape for System <code class="docutils literal notranslate"><span class="pre">ABC</span></code></span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id26">Substructuring using the Transmission Simulator Method</a><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Now that we have our models set up, we can proceed with the substructuring.
We will define our bandwidth as 2000 Hz, and select to use 15 transmission
simulator modes to perform the substructuring.  We can then reduce down to
just the shapes satisfying these critera, and create modal
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System" title="sdynpy.core.sdynpy_system.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> from them.  This will
result in diagonal mass, stiffness, and damping matrices, with the mode shape
matrix as the transformation to physical coordinates.</p>
<p>Recall, we will be attempting to compute system <code class="docutils literal notranslate"><span class="pre">ABC</span></code> from components <code class="docutils literal notranslate"><span class="pre">AB</span></code>,
<code class="docutils literal notranslate"><span class="pre">BC</span></code>, and <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bandwidth</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">transmission_simulator_modes</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">system_ab</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">][</span><span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&lt;</span> <span class="n">bandwidth</span><span class="p">]</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
<span class="n">system_bc</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">][</span><span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&lt;</span> <span class="n">bandwidth</span><span class="p">]</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
<span class="n">system_b</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][:</span><span class="n">transmission_simulator_modes</span><span class="p">]</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
</pre></div>
</div>
<p>The first step is to combine the components <code class="docutils literal notranslate"><span class="pre">AB</span></code>, <code class="docutils literal notranslate"><span class="pre">BC</span></code>, and <code class="docutils literal notranslate"><span class="pre">B</span></code> into one
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System" title="sdynpy.core.sdynpy_system.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> object.  Note that no
constraints have been applied, so the system matrices will be block diagonal.
We will also combine the geometries so we can eventually plot mode shapes of
the combined system.  We will combine the geometries first, as it will give us
a node offset that we can use to avoid conflicting nodes in the various
substructures using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry.overlay_geometries" title="sdynpy.core.sdynpy_geometry.Geometry.overlay_geometries"><code class="xref py py-func docutils literal notranslate"><span class="pre">overlay_geometries</span></code></a>
static method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.Geometry.html#sdynpy.core.sdynpy_geometry.Geometry" title="sdynpy.core.sdynpy_geometry.Geometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">Geometry</span></code></a>
object.  We pass it a list of geometries to combine, a set of colors to make
each geometry, as well as tell it to return the node offset used to avoid
conflicts.  We will then combine the systems using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.concatenate" title="sdynpy.core.sdynpy_system.System.concatenate"><code class="xref py py-func docutils literal notranslate"><span class="pre">concatenate</span></code></a> static
method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System" title="sdynpy.core.sdynpy_system.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> object
to combine the systems, passing the node offset as an argument to keep the
concatenated systems consistent with the combined geometries.  Note that because
we will be subtracting component <code class="docutils literal notranslate"><span class="pre">B</span></code> from the assembly, we will specify a
negative <code class="docutils literal notranslate"><span class="pre">system_b</span></code> during the concatenation.  We can use the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.spy" title="sdynpy.core.sdynpy_system.System.spy"><code class="xref py py-func docutils literal notranslate"><span class="pre">System.spy</span></code></a> method to visualize
the structure of the created system and ensure that it is block-diagonal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">geoms</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">],</span><span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">],</span><span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="n">combined_geometry</span><span class="p">,</span><span class="n">node_offset</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">overlay_geometries</span><span class="p">(</span>
    <span class="n">geoms</span><span class="p">,</span>
    <span class="n">color_override</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span>
    <span class="n">return_node_id_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">systems</span> <span class="o">=</span> <span class="p">(</span><span class="n">system_ab</span><span class="p">,</span><span class="n">system_bc</span><span class="p">,</span><span class="o">-</span><span class="n">system_b</span><span class="p">)</span> <span class="c1"># Note that system_b is negative</span>
<span class="n">combined_system</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="n">systems</span><span class="p">,</span><span class="n">node_offset</span><span class="p">)</span>
<span class="n">combined_system</span><span class="o">.</span><span class="n">spy</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-center" id="id16">
<a class="reference internal image-reference" href="../_images/transmission_simulator_concatenated_systems.png"><img alt="Concatenated System Structure" src="../_images/transmission_simulator_concatenated_systems.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Structure of the concatenated system, showing block-diagonal structure.</span><a class="headerlink" href="#id16" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>If we were to plot this concatenated system’s modes, it would be like we just
overlaid all three systems on top of one another.  This is because no constraints
have yet been applied, so, e.g., component <code class="docutils literal notranslate"><span class="pre">AB</span></code> has no effect on component
<code class="docutils literal notranslate"><span class="pre">BC</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">combined_geometry</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">combined_system</span><span class="o">.</span><span class="n">eigensolution</span><span class="p">(),</span><span class="n">plot_options</span><span class="p">)</span>
</pre></div>
</div>
<p>Note however, that this will not work in its current state, due to the negative
mass on component <code class="docutils literal notranslate"><span class="pre">B</span></code>.  If we instead flip <code class="docutils literal notranslate"><span class="pre">B</span></code> to positive and re-run the
previous code block, we can then plot the shapes.  If you do this, don’t forget
to flip the sign back to negative, otherwise the substructuring won’t work!</p>
<figure class="align-center" id="id17">
<a class="reference internal image-reference" href="../_images/transmission_simulator_concatenated_B_mode.gif"><img alt="Concatenated ``B`` Mode Shape" src="../_images/transmission_simulator_concatenated_B_mode.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">B</span></code> in the concatenated system</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id18">
<a class="reference internal image-reference" href="../_images/transmission_simulator_concatenated_AB_mode.gif"><img alt="Concatenated ``AB`` Mode Shape" src="../_images/transmission_simulator_concatenated_AB_mode.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">AB</span></code> in the concatenated system</span><a class="headerlink" href="#id18" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id19">
<a class="reference internal image-reference" href="../_images/transmission_simulator_concatenated_BC_mode.gif"><img alt="Concatenated ``BC`` Mode Shape" src="../_images/transmission_simulator_concatenated_BC_mode.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Mode Shape for System <code class="docutils literal notranslate"><span class="pre">BC</span></code> in the concatenated system</span><a class="headerlink" href="#id19" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Finally, we can apply constraints to the model.  We will first find the nodes
that are used in the constraint.  These will be the nodes in <code class="docutils literal notranslate"><span class="pre">B</span></code> that are also
in <code class="docutils literal notranslate"><span class="pre">AB</span></code>.  We will create another set of
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_geometry.id_map.html#sdynpy.core.sdynpy_geometry.id_map" title="sdynpy.core.sdynpy_geometry.id_map"><code class="xref py py-class docutils literal notranslate"><span class="pre">id_map</span></code></a> objects to map the
degrees of freedom from the original test geometries to the combined test
geometry, which has the node offset applied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;ab&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">connection_map_ab</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">id_map</span><span class="p">(</span><span class="n">connection_nodes</span><span class="p">,</span><span class="n">connection_nodes</span> <span class="o">+</span> <span class="n">node_offset</span><span class="p">)</span>
<span class="n">connection_map_bc</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">id_map</span><span class="p">(</span><span class="n">connection_nodes</span><span class="p">,</span><span class="n">connection_nodes</span> <span class="o">+</span> <span class="n">node_offset</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">connection_map_b</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">id_map</span><span class="p">(</span><span class="n">connection_nodes</span><span class="p">,</span><span class="n">connection_nodes</span> <span class="o">+</span> <span class="n">node_offset</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Because the transmission simulator method uses softened, least-squares constraints,
we must also construct the basis set of shapes used in the constraint.  These
will be the mode shapes of the transmission simulator mapped to the nodes in the
combined system for each substructure.  To help verify that they are assembled
correctly, these shapes can be plotted on the combined geometry.  If degrees of
freedom have been correctly selected for each constraint, the boundary nodes
of the substructures should be seen to move identically in each shape.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection_shapes_ab</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][:</span><span class="n">transmission_simulator_modes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">connection_shapes_ab</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">connection_map_ab</span><span class="p">(</span><span class="n">connection_shapes_ab</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<span class="n">connection_shapes_bc</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][:</span><span class="n">transmission_simulator_modes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">connection_shapes_bc</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">connection_map_bc</span><span class="p">(</span><span class="n">connection_shapes_bc</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<span class="n">connection_shapes_b</span> <span class="o">=</span> <span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][:</span><span class="n">transmission_simulator_modes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">connection_shapes_b</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">connection_map_b</span><span class="p">(</span><span class="n">connection_shapes_b</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
<span class="c1"># Combine all the shape degrees of freedom into one shape</span>
<span class="n">connection_shapes</span> <span class="o">=</span> <span class="n">sdpy</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">concatenate_dofs</span><span class="p">([</span><span class="n">connection_shapes_ab</span><span class="p">,</span><span class="n">connection_shapes_bc</span><span class="p">,</span><span class="n">connection_shapes_b</span><span class="p">])</span>

<span class="c1"># Now to make sure this is correct, if we plot these shapes on the combined</span>
<span class="c1"># geometry, it should move all of the connection degrees of freedom in the</span>
<span class="c1"># shapes of the transmission simulator</span>
<span class="n">combined_geometry</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">connection_shapes</span><span class="p">,</span><span class="n">plot_options</span><span class="p">,</span><span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                             <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we have these shapes, we can select the coordinates in each system
in each shape and then create the constraint matrix using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.substructure_by_shape" title="sdynpy.core.sdynpy_system.System.substructure_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">substructure_by_shape</span></code></a>
method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System" title="sdynpy.core.sdynpy_system.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> object.
To this method get passed the shapes to use as the basis for the constraints
as well as the degrees of freedom to use in each system for the computation of
the least-squares constraint.  This method could directly return a constrained
system, but instead we set the argument <code class="docutils literal notranslate"><span class="pre">return_constrained_system=False</span></code>,
which instead makes the method return the constraint matrix instead.  We
do this because we will be applying another set of shape constraints for the
other substructure, and wish to apply the constraints all at once.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">connection_dofs_ab</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
                                                        <span class="n">connection_map_ab</span><span class="o">.</span><span class="n">to_ids</span><span class="p">)]</span>
<span class="n">connection_dofs_bc</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
                                                        <span class="n">connection_map_bc</span><span class="o">.</span><span class="n">to_ids</span><span class="p">)]</span>
<span class="n">connection_dofs_b</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">combined_system</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
                                                        <span class="n">connection_map_b</span><span class="o">.</span><span class="n">to_ids</span><span class="p">)]</span>

<span class="n">constraint_matrix_ab_b</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">substructure_by_shape</span><span class="p">(</span><span class="n">connection_shapes</span><span class="p">,</span>
                                                          <span class="n">connection_dofs_ab</span><span class="p">,</span>
                                                          <span class="n">connection_dofs_b</span><span class="p">,</span>
                                                          <span class="n">return_constrained_system</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">constraint_matrix_bc_b</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">substructure_by_shape</span><span class="p">(</span><span class="n">connection_shapes</span><span class="p">,</span>
                                                          <span class="n">connection_dofs_bc</span><span class="p">,</span>
                                                          <span class="n">connection_dofs_b</span><span class="p">,</span>
                                                          <span class="n">return_constrained_system</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that all of the bookkeeping is handled automatically by the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.substructure_by_shape" title="sdynpy.core.sdynpy_system.System.substructure_by_shape"><code class="xref py py-func docutils literal notranslate"><span class="pre">substructure_by_shape</span></code></a>
method, we simply had to specify which degrees of freedom were to be used in the
substructuring, and ensure that those degrees of freedom existed in the shapes
used for the modal constraints.</p>
<p>We can then concatenate the two constraint matrices into a single constraint
matrix and apply it to the system using the
<a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.constrain" title="sdynpy.core.sdynpy_system.System.constrain"><code class="xref py py-func docutils literal notranslate"><span class="pre">constrain</span></code></a>
method of the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System" title="sdynpy.core.sdynpy_system.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">constraint_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">constraint_matrix_ab_b</span><span class="p">,</span><span class="n">constraint_matrix_bc_b</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">constrained_system</span> <span class="o">=</span> <span class="n">combined_system</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">constraint_matrix</span><span class="p">)</span>
</pre></div>
</div>
<p>We can then solve for the modes of the constrained system, and compare them
against the truth shapes from the full finite element model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">constrained_shapes</span> <span class="o">=</span> <span class="n">constrained_system</span><span class="o">.</span><span class="n">eigensolution</span><span class="p">()</span>

<span class="n">combined_geometry</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">constrained_shapes</span><span class="p">,</span><span class="n">plot_options</span><span class="p">,</span><span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                             <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">test_geometries</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">(</span><span class="n">test_shapes</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">],</span><span class="n">plot_options</span><span class="p">,</span><span class="n">deformed_opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                             <span class="n">undeformed_opacity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id20">
<a class="reference internal image-reference" href="../_images/transmission_simulator_truth_mode_shape.gif"><img alt="Example truth mode shape" src="../_images/transmission_simulator_truth_mode_shape.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Example truth mode to compare to the substructured modes</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id21">
<a class="reference internal image-reference" href="../_images/transmission_simulator_substructured_mode_shape.gif"><img alt="Example substructured mode shape" src="../_images/transmission_simulator_substructured_mode_shape.gif" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Example substructured mode showing the the constraints have been satisfied.</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Note again that the <a class="reference internal" href="../_autosummary/sdynpy.core.sdynpy_system.System.html#sdynpy.core.sdynpy_system.System.constrain" title="sdynpy.core.sdynpy_system.System.constrain"><code class="xref py py-func docutils literal notranslate"><span class="pre">constrain</span></code></a>
method automatically updated not only the system mass, stiffness, and damping
matrices to apply the constraint, but also updated the transformation from the
constrained space to the physical degrees of freedom.  Therefore when we
compute the eigensolution, the shapes are already set up in the physical degrees
of freedom.</p>
</section>
<section id="summary">
<h2><a class="toc-backref" href="#id27">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>This example has demonstrated how substructuring using the transmission
simulator method can be performed.  A set of finite element models was created
that serve as the example problem.  These were then reduced to a simulated test
geometry that was used to perform the substructuring.</p>
<p>With the models set up, the components were reduced to a test bandwidth and
concatenated to form a single system.  A set of basis shapes were constructed
to perform the least-squares modal constraints.  These were then passed to the
substructuring calculation along with the degrees of freedom to use for each
constraint.  The constraint matrices were then used to constrain the system, and
plotting the mode shapes revealed that the model was constrained successfully.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="craig_bampton_substructuring.html" class="btn btn-neutral float-left" title="Substructuring using Craig-Bampton Superelements from Sierra/SD" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mimo_random_vibration_control.html" class="btn btn-neutral float-right" title="MIMO Random Vibration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
<jinja2.runtime.BlockReference object at 0x7f0105721330>
<img src="_images/snl.jpg" alt="Sandia National Laboratories" style="height:40px">

  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>